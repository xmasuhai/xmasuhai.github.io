<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="7.1 简单轮子：VuePopover组件 大纲链接§ [toc] popover组件 需求 可以激活 hover click 激活后弹出提示 简单文本提示 复杂内容 两种形式 按钮在popov" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.59.1" />


<link rel="canonical" href="http://xmasuhai.xyz/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%907.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuepopover%E7%BB%84%E4%BB%B6-%E4%B9%8B-scrolly/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY" />
<meta property="og:description" content="7.1 简单轮子：VuePopover组件 大纲链接§ [toc] popover组件 需求 可以激活 hover click 激活后弹出提示 简单文本提示 复杂内容 两种形式 按钮在popov" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%907.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuepopover%E7%BB%84%E4%BB%B6-%E4%B9%8B-scrolly/" />
<meta property="article:published_time" content="2022-01-21T12:37:02+08:00" />
<meta property="article:modified_time" content="2022-07-18T08:20:24+08:00" />
<meta itemprop="name" content="【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY">
<meta itemprop="description" content="7.1 简单轮子：VuePopover组件 大纲链接§ [toc] popover组件 需求 可以激活 hover click 激活后弹出提示 简单文本提示 复杂内容 两种形式 按钮在popov">


<meta itemprop="datePublished" content="2022-01-21T12:37:02&#43;08:00" />
<meta itemprop="dateModified" content="2022-07-18T08:20:24&#43;08:00" />
<meta itemprop="wordCount" content="14986">



<meta itemprop="keywords" content="FrontEnd,Project,vueel,vue2," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY"/>
<meta name="twitter:description" content="7.1 简单轮子：VuePopover组件 大纲链接§ [toc] popover组件 需求 可以激活 hover click 激活后弹出提示 简单文本提示 复杂内容 两种形式 按钮在popov"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY</h1>
      
      <div class="post-meta">
        <time datetime="2022-01-21" class="post-time">
          2022-01-21
        </time>
        <div class="post-category">
            
          </div>
        <span class="more-meta"> 约 14986 字 </span>
          <span class="more-meta"> 预计阅读 30 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#7-1-简单轮子-vuepopover组件">7.1 简单轮子：VuePopover组件</a>
<ul>
<li><a href="#popover组件-需求">popover组件 需求</a></li>
<li><a href="#api设计">API设计</a></li>
<li><a href="#popover组件-ui">popover组件 UI</a>
<ul>
<li><a href="#显示和隐藏提示消息">显示和隐藏提示消息</a></li>
<li><a href="#实现隐藏消息框">实现隐藏消息框</a>
<ul>
<li><a href="#使用异步-this-nexttick-来控制执行顺序">使用异步<code>this.$nextTick</code>来控制执行顺序</a></li>
<li><a href="#尝试使用-function-x-bind-this">尝试使用<code>function x() {}.bind(this)</code></a></li>
</ul></li>
<li><a href="#还有几个-bug">还有几个 bug</a></li>
</ul></li>
<li><a href="#解决-popover-的三个问题">解决<code>popover</code>的三个问题</a>
<ul>
<li><a href="#用js获取按钮元素的位置">用JS获取按钮元素的位置</a>
<ul>
<li><a href="#使用-element-getboundingclientrect-api-获取元素尺寸与位置">使用<code>Element.getBoundingClientRect() API</code>获取元素尺寸与位置</a></li>
</ul></li>
<li><a href="#解决容器有-overflow-hidden-的bug">解决容器有<code>overflow hidden</code>的bug</a>
<ul>
<li><a href="#当用户点击按钮时-触发外层div的click事件的bug">当用户点击按钮时，触发外层div的click事件的bug</a></li>
<li><a href="#判断点击事件目标对象">判断点击事件目标对象</a></li>
<li><a href="#当-popover-显示时-执行的逻辑">当 popover 显示时 执行的逻辑</a></li>
<li><a href="#解决重复叠加监听与重复多次移除监听的bug">解决重复叠加监听与重复多次移除监听的bug</a></li>
</ul></li>
</ul></li>
<li><a href="#添加支持四个方位功能">添加支持四个方位功能</a>
<ul>
<li><a href="#添加消息框的三角指向样式">添加消息框的三角指向样式</a></li>
<li><a href="#添加消息框的四个方向-的外部数据">添加消息框的四个方向 的外部数据</a></li>
<li><a href="#区分位置样式">区分位置样式</a></li>
<li><a href="#使用表驱动编程重构">使用表驱动编程重构</a></li>
<li><a href="#动态监听事件-vue2-6">动态监听事件<code>vue2.6+</code></a></li>
</ul></li>
<li><a href="#添加支持可选的-click-和-hover-两种触发-popover-方式">添加支持可选的<code>click</code>和<code>hover</code>两种触发<code>popover</code>方式</a></li>
<li><a href="#在弹出框中加上按钮-并且传递属性参数">在弹出框中加上按钮，并且传递属性参数</a>
<ul>
<li><a href="#使用具名插槽-https-cn-vuejs-org-v2-guide-components-slots-html-e5-85-b7-e5-90-8d-e6-8f-92-e6-a7-bd"><a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD">使用具名插槽</a></a></li>
<li><a href="#使用-作用域插槽-https-cn-vuejs-org-v2-guide-components-slots-html-e4-bd-9c-e7-94-a8-e5-9f-9f-e6-8f-92-e6-a7-bd-实现传递组件的方法到-slot-中">使用 <strong><a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD">作用域插槽</a></strong> ，实现传递组件的方法到<code>&lt;slot&gt;</code>中</a></li>
<li><a href="#使用-es2015-解构来传入具体的插槽-prop">使用 ES2015 解构来传入具体的插槽 prop</a></li>
</ul></li>
<li><a href="#封装为指令">封装为指令</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h1 id="7-1-简单轮子-vuepopover组件">7.1 简单轮子：VuePopover组件</h1>

<blockquote>
<p>大纲链接<a id="catalogue" href="#catalogue" > § </a></p>
</blockquote>

<p>[toc]</p>

<hr />

<h2 id="popover组件-需求">popover组件 需求</h2>

<ul>
<li>可以激活

<ul>
<li>hover</li>
<li>click</li>
</ul></li>
<li>激活后弹出提示

<ul>
<li>简单文本提示</li>
<li>复杂内容</li>
</ul></li>
<li>两种形式

<ul>
<li>按钮在popover组件中</li>
<li>封装为指令，在按钮中使用</li>
</ul></li>
</ul>

<hr />

<h2 id="api设计">API设计</h2>

<hr />

<h2 id="popover组件-ui">popover组件 UI</h2>

<blockquote>
<p>为什么需要单独的 popover 组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;x&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;xxx&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;x = true&#34;</span><span class="p">&gt;</span>click<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>需要让浮动消息出现在按钮正上方</li>
<li>提供给用户以封装好样式的popover 组件，不用另外写样式</li>
</ul>

<blockquote>
<p>基本结构</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- 组件包裹按钮 --&gt;</span>
<span class="p">&lt;</span><span class="nt">g-popover</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">template</span> <span class="na">slot</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>click<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">g-popover</span><span class="p">&gt;</span>
<span class="c">&lt;!-- 使用封装的指令 --&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;xxx&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">v-pop</span><span class="o">=</span><span class="s">&#34;xxx&#34;</span><span class="p">&gt;</span>click<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<blockquote>
<p>先实现VuePopover组件包裹按钮的方式</p>
</blockquote>

<h3 id="显示和隐藏提示消息">显示和隐藏提示消息</h3>

<blockquote>
<p>使用展示组件<code>Popovers.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">fieldset</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Popover<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>组件包裹按钮<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">template</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">template</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VuePopover</span> <span class="nx">from</span> <span class="s1">&#39;./popover/VuePopover.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">VuePopover</span><span class="p">,</span> <span class="nx">VueButton</span><span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Popovers</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Popovers&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span><span class="p">{</span>
  <span class="k">margin-right</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>VuePopover.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>在<code>slot</code>上添加样式时无效的</li>
<li>需要<code>slot</code>在外边再包裹一层<code>div</code></li>
<li>将<code>v-if=&quot;visible&quot;</code>的控制逻辑页移至外层<code>div</code></li>

<li><p>如此就可以加样式，使得弹出消息框的<code>div</code>可以定位</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
<span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

<span class="err">.content-wrapper</span> <span class="err">{</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
<span class="k">bottom</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>目前存在的 bug</p>
</blockquote>

<ul>
<li>未实现点击外边空白处，隐藏消息框</li>
</ul>

<h3 id="实现隐藏消息框">实现隐藏消息框</h3>

<blockquote>
<p>在<code>document.body</code>上添加监听<code>click</code>事件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span><span class="o">...</span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>document.body.addEventListener('click', () =&gt; { this.visible = false; });</code></li>
<li>当点击外部，就隐藏消框</li>
</ul>

<blockquote>
<p>无法出现消息框 bug</p>
</blockquote>

<ul>
<li>由于事件冒泡机制</li>
<li>未在点击事件结束后就添加监听点击事件</li>
<li>会连续触发点击切换与隐藏消息框两个执行逻辑因此导致了 bug</li>
</ul>

<blockquote>
<p>加两句log来测试</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击body就关闭popover&#39;</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>连续触发 点击切换 与 隐藏消息框</li>
<li>先把<code>this.visible</code>变成<code>true</code>，紧接着就把<code>this.visible</code>变成<code>false</code></li>
<li>弹出后立马关闭</li>
<li>显然不符合预期的需求</li>
</ul>

<h4 id="使用异步-this-nexttick-来控制执行顺序">使用异步<code>this.$nextTick</code>来控制执行顺序</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击body就关闭popover&#39;</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>另一个 bug</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">...
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="nt">body</span> <span class="p">{</span><span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">red</span><span class="p">;}</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

  <span class="err">.content-wrapper</span> <span class="err">{</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>将<code>body</code>区域使用<code>border</code>标识出来</li>
<li>当body未占满时，当点击下方非body区时，无法关闭消息框</li>

<li><p>解决方法时不监听<code>document.body</code>，而直接监听<code>document</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击body就关闭popover&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>点三次点击的bug</p>
</blockquote>

<ul>
<li>点击按钮，出现消息框</li>
<li>点击外部空白，隐藏消息框</li>
<li>再次点击按钮，消息框未出现</li>
</ul>

<blockquote>
<p>原因</p>
</blockquote>

<ul>
<li>目前存在两个监听器，都在监听<code>click</code>事件

<ul>
<li>第一个是按钮在监听用户点击</li>
<li>第二个是<code>document</code>上在监听点击</li>
<li>调用顺序是，先调用按钮的，在调用<code>document</code>的</li>
</ul></li>
<li>而<code>document</code>上的监听事件未被移除掉，就在再次点击后添加了另一个点击事件监听</li>
<li>造成监听器越积越多</li>
</ul>

<blockquote>
<p>需要及时地销毁监听器</p>
</blockquote>

<ul>
<li>在<code>this.visible = false;</code>后就销毁监听器</li>
<li>需要一个具名函数，并且注意<code>this</code>的指向</li>
</ul>

<h4 id="尝试使用-function-x-bind-this">尝试使用<code>function x() {}.bind(this)</code></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>
  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span>
          <span class="kd">function</span> <span class="nx">x</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;删除监听器&#39;</span><span class="p">);</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击body就关闭popover&#39;</span><span class="p">);</span>
          <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>() =&gt; {}</code>相当于<code>function x() {}.bind(this)</code></li>
<li>不改变<code>this</code>的指向</li>
<li>尝试失败<code>.bind</code>每次执行返回一个新的函数（堆内存中）</li>
<li>事件添加的回调函数和（堆内存中） 删除的<strong>不是同一个函数</strong></li>
</ul>

<blockquote>
<p>老老实实地声明<code>const eventHandler = () =&gt; {...}</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>
  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;删除监听器&#39;</span><span class="p">);</span>
          <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;添加监听函数&#39;</span><span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div>
<h3 id="还有几个-bug">还有几个 bug</h3>

<ul>
<li><p>改变节点</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;声明回调函数&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;document 隐藏 popover&#39;</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;删除监听器&#39;</span><span class="p">);</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;添加监听函数&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;vm 隐藏 popover&#39;</span><span class="p">);}</span>
    
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>

<li><p>点击多次按钮切换时，再点击<code>document</code>，会累积执行多个<code>document.removeEventListener('click', eventHandler);</code></p></li>

<li><p>当出现弹出框时，点击弹出框，此时弹出框不应该消失</p></li>

<li><p>第一次点击显示popover，第二次点击按钮隐藏了两次popover</p></li>

<li><p>需要阻止冒泡</p></li>

<li><p>使用<code>.stop</code>事件修饰符<code>&lt;div class=&quot;popover&quot; @click.stop=&quot;togglePop&quot;&gt;</code></p>

<ul>
<li>阻止popover组件上的点击事件冒泡到外层节点上</li>
<li>同时阻止消息框<code>content-wrapper</code>节点上的点击事件冒泡到外层节点上</li>

<li><p><code>&lt;div class=&quot;content-wrapper&quot; v-if=&quot;visible&quot; @click.stop&gt;...</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>

<span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;document 隐藏 popover&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;删除监听器&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>

<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;声明回调函数&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换 visible&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;添加监听函数&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>

<span class="p">});</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;vm 隐藏 popover&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">);</span>

<span class="p">}</span>

<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul></li>
</ul>

<blockquote>
<p>如果组件在一个有着<code>overflow: hidden;</code>的样式的节点中</p>
</blockquote>

<ul>
<li>弹出消息框会被外层节点遮挡</li>
<li>应该将<code>popover</code>组件的弹出消息框的节点放在<code>&lt;/body&gt;</code>关闭标签前</li>
</ul>

<blockquote>
<p><code>@click.stop</code>阻止冒泡带来的 bug</p>
</blockquote>

<ul>
<li>用户使用<code>popover</code>组件时，无法使用监听组件外层点击事件</li>
<li>打断了用户的事件传播链</li>
<li>推翻使用<code>@click.stop</code></li>
</ul>

<hr />

<h2 id="解决-popover-的三个问题">解决<code>popover</code>的三个问题</h2>

<ul>
<li><code>overflow: hidden;</code></li>
<li>重复切换按钮多次，点击一次document，关闭重复n次</li>
<li>未取消监听 document</li>
</ul>

<blockquote>
<p>使用<code>ref</code>属性，获取到 消息框的节点，并打印在控制台</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意，当使用了条件渲染<code>v-if</code>时，<strong>未出现在文档流中的节点上的<code>ref</code>无法获取</strong></li>
<li>补充<code>v-show</code> V.S. <code>v-if</code>的知识点

<ul>
<li><code>v-show</code>只改变节点的样式</li>
<li><code>v-if</code>会改变节点存在于DOM树与否</li>
</ul></li>
</ul>

<blockquote>
<p>获取<code>this.$refs.contentWrapper</code>之后，就可以将获取到的节点添加到<code>document.body</code>上</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>当改变 vue 中组件节点在文档中的位置时，并不影响组件的功能</li>
<li>包括点击事件执行回调依然有效</li>
<li>只是需要注意的是，

<ul>
<li>如果vue文件的<code>&lt;style lang=&quot;scss&quot; scoped&gt;...</code>标签中如果写了<code>scoped</code>属性，并且类样式互相嵌套</li>
<li>则被改变位置的元素不再具有该样式</li>
</ul></li>

<li><p>解决方法是将该类样式提出到嵌套最外边</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">...
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
<span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>不在组件挂载一完成时，就将消息框添节点加到<code>document.body</code>上</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>而是等到当满足条件<code>this.visible === true</code> 显示时，再把消息框添节点加到<code>document.body</code>上</li>
<li>注意刚<code>this.visible === true</code>时，节点并未出现在文档中，需要使用<code>this.$nextTick</code></li>
<li>这样就不用担心被外层<code>css</code>样式设置的<code>overflow: hidden;</code>遮住</li>
<li>接下来只需获取按钮元素的位置，据此改变定位样式，让节点出现在按钮上方</li>
</ul>

<h3 id="用js获取按钮元素的位置">用JS获取按钮元素的位置</h3>

<ul>
<li>同样地在<code>slot</code>上方加<code>ref</code>引用属性是无效的</li>

<li><p>需要再包裹一层节点，在外层节点上添加<code>ref</code>引用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

  <span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">trigger</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<h4 id="使用-element-getboundingclientrect-api-获取元素尺寸与位置">使用<code>Element.getBoundingClientRect() API</code>获取元素尺寸与位置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>
  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
          <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>将得到的值赋给

<ul>
<li><code>(this.$refs.contentWrapper as any).style.left</code></li>
<li><code>(this.$refs.contentWrapper as any).style.top</code></li>
</ul></li>
<li>并且调整一下样式

<ul>
<li><code>transform: translateY(100%);</code></li>
</ul></li>
</ul>

<hr />

<h3 id="解决容器有-overflow-hidden-的bug">解决容器有<code>overflow hidden</code>的bug</h3>

<blockquote>
<p>测试poopover</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;border: 10px solid blue; height: 1000px;&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;margin-left: 2000px; padding-top: 100px; padding-left: 100px;  border: 1px solid red; width: 1000px;&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow: hidden; border: 1px solid green; padding: 5px;&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">template</span> <span class="na">slot</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>点击<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>VuePopover.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span> <span class="err">@</span><span class="na">click</span><span class="err">.</span><span class="na">stop</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;trigger&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">togglePop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
          <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">).</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意相对的位置距离是不同的

<ul>
<li><code>clientLeft</code>是相对于屏幕可视区域</li>
<li>而绝对定位是相对于<code>body</code>元素的左上坐标点的</li>
</ul></li>
<li>需要得到相对于可视区域的差值

<ul>
<li><code>document.documentElement.scrollHeight</code>获取页面的可滚动总高</li>
<li><code>window.scrollY</code>获取页面顶部至可视区域（视口）的顶部的高度，即文档在垂直方向已滚动的像素差值</li>
</ul></li>
<li>补上差值

<ul>
<li>(this.$refs.contentWrapper as any).style.top = `${top + window.scrollY}px`;</li>
</ul></li>
<li>注意<code>scrollY</code>的兼容性</li>
<li>同理<code>scrollX</code>，出现X轴滚动条，相对位置发生变化</li>
<li>需要补上一个差值

<ul>
<li>(this.$refs.contentWrapper as any).style.left = `${left + window.scrollX}px`;</li>
</ul></li>
</ul>

<blockquote>
<p>搜索<code>js get element offset relative to body</code> 获取元素相对于body的偏移量（即偏移位置，包括top和left）</p>
</blockquote>

<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/scrollY">MDN Window.scrollY</a></li>
</ul>

<h4 id="当用户点击按钮时-触发外层div的click事件的bug">当用户点击按钮时，触发外层div的click事件的bug</h4>

<blockquote>
<p>会触发多余的关闭</p>
</blockquote>

<ul>
<li>一次是由<code>document</code>引起的：<code>document.removeEventListener('click', eventHandler);</code></li>
<li>一次是 button 事件引起的</li>
</ul>

<blockquote>
<p><code>vue@2.5*</code>和<code>vue@2.6*</code>的<code>$nextTick</code>不同</p>
</blockquote>

<hr />

<h4 id="判断点击事件目标对象">判断点击事件目标对象</h4>

<blockquote>
<p>目标对象是<strong>按钮</strong>，还是<strong>弹出消息框</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span>
      <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
      <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
      <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
      <span class="err">@</span><span class="na">click</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>botton<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
  
    <span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span>    <span class="k">if</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;x下面 按钮&#39;</span><span class="p">);</span>
      <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
      <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{...}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;x上面 弹出消息框&#39;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>实现点击按钮切换，点击消息框不切换的逻辑分开</li>
<li>判断点击的目标对象 <code>event.target</code>

<ul>
<li>是否包含在<code>this.$refs.triggerWrapper</code>中</li>
<li>即是否点击了按钮<code>this.$refs.triggerWrapper.contains(event.target)</code></li>
</ul></li>
<li>当 弹出框 显示

<ul>
<li>将弹出框节点放到 body 子节点的最后</li>
<li>改变弹出框样式，使其出现在相对按钮合适的位置</li>
</ul></li>
</ul>

<h4 id="当-popover-显示时-执行的逻辑">当 popover 显示时 执行的逻辑</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span>
      <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
      <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
      <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">requestAnimationFrameId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 点击按钮部分 执行的逻辑(如果点击了按钮)
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;x下面&#39;</span><span class="p">);</span>
      <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>

      <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>      <span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1"></span>      <span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span>          <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

          <span class="c1">// 获取 按钮元素 左上顶点的位置坐标 top, left
</span><span class="c1"></span>          <span class="kr">const</span> <span class="p">{</span><span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
            <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
          <span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方
</span><span class="c1"></span>          <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
          <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>

          <span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span>          <span class="kr">const</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
            <span class="nb">window</span><span class="o">?</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">requestAnimationFrameId</span><span class="p">);</span>
          <span class="p">};</span>

          <span class="c1">// 在文档上 添加 点击事件 的监听
</span><span class="c1"></span>          <span class="k">this</span><span class="p">.</span><span class="nx">requestAnimationFrameId</span> <span class="o">=</span> <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;在文档上 添加 点击事件 的监听&#39;</span><span class="p">);</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
          <span class="p">});</span>

        <span class="p">});</span>

      <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;x上面&#39;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>点击按钮 执行的方法：切换显示/隐藏 popover

<ul>
<li>点击按钮部分 执行的逻辑</li>
<li>切换显示/隐藏 popover <code>this.visible = !this.visible;</code></li>
<li>当 popover 显示时 执行的逻辑， 必须为异步

<ul>
<li>显示 弹出框，将弹出框节点放到 body 子节点的最后 <code>document.body.appendChild(this.$refs.contentWrapper as Node);</code></li>
<li>改变弹出框样式，使其出现在相对按钮合适的位置</li>
<li>获取 按钮元素 左上顶点的位置坐标 top, left</li>
<li>设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方</li>
<li>定义一个点击文档事件的回调函数 <code>eventHandler</code></li>
<li>如果点击了<code>document</code>就隐藏 popover弹出框 <code>this.visible = false;</code></li>
<li>移除 事件监听 <code>document.removeEventListener('click', eventHandler);</code></li>
<li>在文档上 添加 点击事件 的监听，必须为异步</li>
<li><code>this.requestAnimationFrameId = requestAnimationFrame(() =&gt; {...});</code></li>
<li><code>document.addEventListener('click', eventHandler);</code></li>
</ul></li>
<li>当 popover 隐藏时 执行的逻辑</li>
<li>点击popover部分 执行的逻辑</li>
</ul></li>

<li><p>重构 抽象提出<code>positionPop</code> <code>listenToDocument</code>方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span>
  <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
  <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
  <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;this.$refs.contentWrapper: &#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

<span class="c1">// 获取 按钮元素 左上顶点的位置坐标 top, left
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span><span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
  <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方
</span><span class="c1"></span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
<span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>

<span class="p">}</span>

<span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">closeHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 如果点击的目标对象 不存在于 包裹弹出框的div中
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">)))</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">,</span> <span class="s1">&#39;立即关闭了弹出框&#39;</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">closeHandler</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;移除事件监听&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 在文档上 添加 点击事件 的监听
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;在文档上 添加 点击事件 的监听&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">closeHandler</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span><span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span><span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
  <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换显示/隐藏 popover&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">);</span>

  <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>  <span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1"></span>  <span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
    <span class="p">});</span>

  <span class="p">}</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击popover部分 执行的逻辑&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
<span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

<span class="err">.content-wrapper</span> <span class="err">{</span>
<span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">triggerWrapper</span> <span class="p">{</span>
<span class="p">}</span>
<span class="err">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>在不阻止冒泡的条件下，判断事件的回调函数的目标对象</p>
</blockquote>

<ul>
<li>重构 抽象提出<code>closeHandler</code> <code>closeEvent</code>方法</li>
<li>如果目标对象 存在于 包裹弹出框的div中，则什么也不做</li>
<li>如果目标对象 不存在于 包裹弹出框的div中，则

<ul>
<li>隐藏 popover弹出框 <code>this.visible = false;</code></li>
<li>移除 事件监听 <code>document.removeEventListener('click', eventHandler);</code></li>
</ul></li>

<li><p><code>this.listenToDocument()</code>还是会在点击事件冒泡完成之前执行</p>

<ul>
<li><p>必须使用<code>setTimeout</code>来延迟，使 添加监听在 点击事件冒泡 之后 执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span>
<span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
<span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
<span class="na">v-if</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;this.$refs.contentWrapper: &#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

<span class="c1">// 获取 按钮元素 左上顶点的位置坐标 top, left
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span><span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
<span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
<span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方
</span><span class="c1"></span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
<span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>

<span class="p">}</span>

<span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 关闭 弹出框
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">,</span> <span class="s1">&#39;立即关闭了弹出框&#39;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;移除事件监听&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span><span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
<span class="kr">const</span> <span class="nx">hasPopover</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
<span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">));</span>

<span class="c1">// 如果 点击的目标对象 不存在于 包裹弹出框的div中
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPopover</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
<span class="p">}</span>
    
<span class="p">}</span>

<span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 在文档上 添加 点击事件 的监听
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;在文档上 添加 点击事件 的监听&#39;</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span><span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span><span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
<span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
<span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;切换显示/隐藏 popover&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">);</span>

<span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span><span class="cm">/*
</span><span class="cm">if (this.visible) {
</span><span class="cm">this.$nextTick(() =&gt; {
</span><span class="cm">  // 将 弹出框 放到body 里
</span><span class="cm">  this.positionPop();
</span><span class="cm">});
</span><span class="cm">}*/</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;点击popover部分 执行的逻辑&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">}</span>

<span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">)</span>
<span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;打开状态&#39;</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="c1">// 将 弹出框 放到body 里
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>

<span class="c1">// 使 添加监听在 点击事件冒泡 之后 执行
</span><span class="c1"></span><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 给 document 添加 click 事件监听
</span><span class="c1"></span>  <span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
<span class="p">});</span>
<span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="c1">// 当 popover 隐藏时 执行的逻辑
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;关闭&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span><span class="o">...</span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul></li>

<li><p><code>@Watch('visible')</code>监听数据<code>this.visible</code>的变化</p></li>

<li><p><code>visible</code>重构改成<code>isVisible</code></p></li>
</ul>

<h4 id="解决重复叠加监听与重复多次移除监听的bug">解决重复叠加监听与重复多次移除监听的bug</h4>

<blockquote>
<p>是否可以在<code>created</code>时，执行<code>this.listenToDocument()</code></p>
</blockquote>

<ul>
<li>不可

<ul>
<li>当页面中有多个<code>popover</code>组件时，每次创建就添加监听会造成不必要的性能浪费</li>
</ul></li>
<li>而监听事件正确的做法是 <strong>即用即添，用完即毁</strong>

<ul>
<li>当点击弹出一个消息框，就添加一个监听</li>
<li>当消息框关闭时，立即清除</li>
</ul></li>
</ul>

<blockquote>
<p>收拢关闭操作的入口</p>
</blockquote>

<ul>
<li><strong>高内聚</strong></li>
<li>抽象方法</li>
<li>将多个表达相同逻辑的代码抽象成一个方法，在处理该逻辑的时候调用这个方法</li>

<li><p>实例代码的<code>closeEvent()</code>，将收尾的逻辑聚拢到一个方法中，有两个操作</p>

<ul>
<li>关闭显示<code>this.isVisible = false;</code></li>

<li><p>移除监听<code>this.rmListenerToDocument();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
<span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
<span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
 <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
 <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="c1">// 定位 popover 显示位置
</span><span class="c1"></span><span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="o">?</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

<span class="c1">// 获取 按钮元素 左上顶点的位置坐标 top, left
</span><span class="c1"></span><span class="kr">const</span> <span class="p">{</span><span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
<span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
<span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方
</span><span class="c1"></span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
<span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">any</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>

<span class="p">}</span>

<span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span><span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 点击的目标对象 是否存在于 popover 包裹div中
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">hasPopover</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
<span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">));</span>
<span class="c1">// 如果 点击的目标对象 不存在于 包裹弹出框的div中 即 点击了document
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPopover</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">popover</span> <span class="o">&amp;&amp;</span>
<span class="p">(</span><span class="nx">hasPopover</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">popover</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">))</span> <span class="p">{</span>
<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">rmListenerToDocument</span><span class="p">()</span> <span class="p">{</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 关闭 弹出框 销毁事件监听
</span><span class="c1"></span><span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">rmListenerToDocument</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">openEvent</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span><span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span><span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
<span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
<span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span><span class="p">}</span>

<span class="p">}</span>

<span class="nx">onShowPopover</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>

<span class="c1">// 使 添加监听在 点击事件冒泡 之后 异步执行
</span><span class="c1"></span><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="c1">// 给 document 添加 click 事件监听
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
<span class="p">});</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 监听 this.isVisible 状态变化 执行对应的逻辑
</span><span class="c1"></span><span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isVisible&#39;</span><span class="p">)</span>
<span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="c1">// 当 popover 隐藏时 执行的逻辑
</span><span class="c1"></span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
<span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

<span class="err">.triggerWrapper</span> <span class="err">{</span>
<span class="p">}</span>
<span class="err">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul></li>

<li><p>设置触发部分<code>&lt;span class=&quot;triggerWrapper&quot; ref=&quot;triggerWrapper&quot;&gt;...</code>的样式</p>

<ul>
<li>将默认行内显示的<code>&lt;span&gt;</code>标签添加样式<code>display: inline-block;</code></li>
</ul></li>
</ul>

<hr />

<blockquote>
<p>小结 popover 的三个问题</p>
</blockquote>

<ul>
<li><code>overflow: hidden;</code> 由<code>body.appendChild</code>解决

<ul>
<li>处理<code>window.scrollX</code>和<code>window.scrollY</code>滚动偏移量</li>
</ul></li>
<li>关闭重复n次，分开处理逻辑

<ul>
<li>职责明确</li>
<li><code>document</code>只管外面</li>
<li><code>popover</code>只管里面</li>
</ul></li>
<li>未取消监听 document，由收拢<code>close</code>的逻辑解决</li>
</ul>

<hr />

<h2 id="添加支持四个方位功能">添加支持四个方位功能</h2>

<h3 id="添加消息框的三角指向样式">添加消息框的三角指向样式</h3>

<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter-function/drop-shadow()"><code>MDN filter: drop-shadow()</code></a>代替<code>box-shadow</code>

<ul>
<li>需要配合<code>background-color: white;</code></li>
</ul></li>
</ul>

<h3 id="添加消息框的四个方向-的外部数据">添加消息框的四个方向 的外部数据</h3>

<blockquote>
<p>可以看到，去掉了<code>transition</code>和<code>margin-top</code>属性的<code>popover</code>和按钮的左上角是对齐的</p>
</blockquote>

<h3 id="区分位置样式">区分位置样式</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="nx">string</span><span class="p">;</span>

  <span class="c1">// 定位 popover 显示位置
</span><span class="c1"></span>  <span class="c1">// &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;
</span><span class="c1"></span>  <span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

    <span class="kr">const</span> <span class="p">{</span><span class="nx">contentWrapper</span><span class="p">,</span> <span class="nx">triggerWrapper</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">;</span>
    <span class="c1">// 获取 按钮元素 左上顶点的位置坐标 top, left
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
      <span class="o">=</span> <span class="p">(</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">height</span><span class="o">:</span> <span class="nx">popHeight</span><span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

    <span class="c1">// 需要表驱动编程重构
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 上方
</span><span class="c1"></span>      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 下方
</span><span class="c1"></span>      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 左侧
</span><span class="c1"></span>      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="c1">// popover高度居中 对齐于 按钮高度，按钮于popover高度差值的1/2
</span><span class="c1"></span>      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span>
        <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">===</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 设置 弹出消息框节点 的行内样式，使其定位到 按钮元素 右侧
</span><span class="c1"></span>      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span>
        <span class="sb">`</span><span class="si">${</span><span class="nx">top</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">}</span>

  <span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span>  <span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击的目标对象 是否存在于 popover 包裹div中
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">hasPopover</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">));</span>
    <span class="c1">// 如果 点击的目标对象 不存在于 包裹弹出框的div中 即 点击了document
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPopover</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
  <span class="p">}</span>

  <span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">rmListenerToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 关闭 弹出框 销毁事件监听
</span><span class="c1"></span>  <span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rmListenerToDocument</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">openEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>    <span class="p">}</span>

  <span class="p">}</span>

  <span class="nx">onShowPopover</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1"></span>      <span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>

      <span class="c1">// 使 添加监听在 点击事件冒泡 之后 异步执行
</span><span class="c1"></span>      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// 给 document 添加 click 事件监听
</span><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// 监听 this.isVisible 状态变化 执行对应的逻辑
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isVisible&#39;</span><span class="p">)</span>
  <span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 当 popover 隐藏时 执行的逻辑
</span><span class="c1"></span>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">border-color</span><span class="o">:</span> <span class="p">#</span><span class="nn">333</span><span class="o">;</span>
<span class="o">$</span><span class="nt">border-radius</span><span class="o">:</span> <span class="nt">4px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

  <span class="err">.triggerWrapper</span> <span class="err">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="p">}</span>
<span class="err">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="err">$</span><span class="k">border</span><span class="o">-</span><span class="kc">color</span><span class="p">;</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="err">$</span><span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="p">;</span>
  <span class="err">//</span><span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
  <span class="k">filter</span><span class="p">:</span> <span class="nb">drop-shadow</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">2</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">));</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
  <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">max-width</span><span class="p">:</span> <span class="mi">20</span><span class="kt">em</span><span class="p">;</span>
  <span class="k">word-break</span><span class="p">:</span> <span class="n">break-all</span><span class="p">;</span>

  <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
    <span class="k">content</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">transparent</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-top</span> <span class="p">{</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>

    <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
      <span class="k">left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">border-top-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
      <span class="k">top</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
      <span class="k">border-top-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="err">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-bottom</span> <span class="p">{</span>
    <span class="k">margin-top</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>

    <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
      <span class="k">left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">border-bottom-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
      <span class="k">bottom</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
      <span class="k">border-bottom-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="err">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-left</span> <span class="p">{</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>

    <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
      <span class="k">left</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">border-left-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
      <span class="k">left</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
      <span class="k">border-left-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="err">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-right</span> <span class="p">{</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>

    <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
      <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
      <span class="k">right</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
      <span class="k">border-right-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
      <span class="k">right</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
      <span class="k">border-right-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="err">}</span>

<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="使用表驱动编程重构">使用表驱动编程重构</h3>

<ul>
<li>创建一张表<code>const positionList = {...}</code> 分别对应四个位置

<ul>
<li><code>'position-top': {...},</code></li>
<li><code>'position-bottom': {...},</code></li>
<li><code>'position-left': {...},</code></li>
<li><code>'position-right': {...},</code></li>
</ul></li>
<li>设置每个位置的<code>top</code>和<code>left</code>属性</li>
<li>提取重复代码

<ul>
<li><code>(contentWrapper as HTMLElement).style.top = ...</code></li>
<li><code>(contentWrapper as HTMLElement).style.left = ...</code></li>
</ul></li>
<li>去除<code>if</code>的判断，简化逻辑为一一对应</li>
</ul>

<blockquote>
<p><code>VuePopover.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
         <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
         <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span>
         <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{[`position-${position}`]: true}&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span> <span class="o">|</span> <span class="s1">&#39;left&#39;</span> <span class="o">|</span> <span class="s1">&#39;right&#39;</span><span class="p">;</span>

  <span class="c1">// 定位 popover 显示位置
</span><span class="c1"></span>  <span class="c1">// &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;
</span><span class="c1"></span>  <span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

    <span class="c1">// 获取 popover元素 按钮元素
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">contentWrapper</span><span class="p">,</span> <span class="nx">triggerWrapper</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">;</span>
    <span class="c1">// 获取 按钮元素 左上顶点的位置坐标 width, height, top, left
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="p">}</span>
      <span class="o">=</span> <span class="p">(</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="c1">// 获取 popover元素 height
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">height</span><span class="o">:</span> <span class="nx">popHeight</span><span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

    <span class="c1">// 表驱动编程
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">positionList</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;position-top&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-bottom&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-left&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// popover高度居中 对齐于 按钮高度，按钮于popover高度差值的1/2
</span><span class="c1"></span>        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-right&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">left</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span>
      <span class="nx">positionList</span><span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span> <span class="nx">as</span> <span class="nx">positionListString</span><span class="p">].</span><span class="nx">top</span> <span class="o">+</span> <span class="sb">`px`</span><span class="p">;</span>
    <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span>
      <span class="nx">positionList</span><span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span> <span class="nx">as</span> <span class="nx">positionListString</span><span class="p">].</span><span class="nx">left</span> <span class="o">+</span> <span class="sb">`px`</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="c1">// 定义一个点击事件的回调函数
</span><span class="c1"></span>  <span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击的目标对象 是否存在于 popover 包裹div中
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">hasPopover</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">));</span>
    <span class="c1">// 如果 点击的目标对象 不存在于 包裹弹出框的div中 即 点击了document
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPopover</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
  <span class="p">}</span>

  <span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">rmListenerToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 关闭 弹出框 销毁事件监听
</span><span class="c1"></span>  <span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rmListenerToDocument</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">openEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>    <span class="p">}</span>

  <span class="p">}</span>

  <span class="nx">onShowPopover</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1"></span>      <span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>

      <span class="c1">// 使 添加监听在 点击事件冒泡 之后 异步执行
</span><span class="c1"></span>      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// 给 document 添加 click 事件监听
</span><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// 监听 this.isVisible 状态变化 执行对应的逻辑
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isVisible&#39;</span><span class="p">)</span>
  <span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 当 popover 隐藏时 执行的逻辑
</span><span class="c1"></span>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">@</span><span class="k">import</span> <span class="s1">&#39;./VuePopover.scss&#39;</span><span class="p">;</span>

<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">top</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>

  <span class="err">.triggerWrapper</span> <span class="err">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
  <span class="p">}</span>

<span class="err">}</span>

<span class="p">.</span><span class="nc">content-wrapper</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
  <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="err">$</span><span class="k">border</span><span class="o">-</span><span class="kc">color</span><span class="p">;</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="err">$</span><span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="p">;</span>
  <span class="err">//</span><span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">);</span>
  <span class="k">filter</span><span class="p">:</span> <span class="nb">drop-shadow</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="kt">px</span> <span class="mi">2</span><span class="kt">px</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">));</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mf">0.5</span><span class="kt">em</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
  <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">max-width</span><span class="p">:</span> <span class="mi">20</span><span class="kt">em</span><span class="p">;</span>
  <span class="k">word-break</span><span class="p">:</span> <span class="n">break-all</span><span class="p">;</span>

  <span class="err">//</span> <span class="err">方向指向尖角基础样式</span>
  <span class="err">&amp;::before,</span> <span class="err">&amp;::after</span> <span class="err">{</span>
    <span class="k">content</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">block</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mf">.65</span><span class="kt">em</span> <span class="kc">solid</span> <span class="kc">transparent</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">//</span> <span class="nt">方向指向尖角样式</span>
  <span class="o">$</span><span class="nt">position-list</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="o">,</span> <span class="s1">&#39;bottom&#39;</span><span class="o">,</span> <span class="s1">&#39;left&#39;</span><span class="o">,</span> <span class="s1">&#39;right&#39;</span><span class="o">;</span>
  <span class="p">@</span><span class="k">each</span> <span class="o">$</span><span class="nt">name</span> <span class="nt">in</span> <span class="o">$</span><span class="nt">position-list</span> <span class="p">{</span>
    <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-</span><span class="err">#</span><span class="p">{</span><span class="err">$name</span><span class="p">}</span> <span class="p">{</span>
      <span class="err">//noinspection</span> <span class="err">SassScssUnresolvedPlaceholderSelector</span>
      <span class="err">@extend</span> <span class="err">%position-#{$name</span><span class="p">}</span><span class="nt">-default</span><span class="o">;</span>

      <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span><span class="o">,</span> <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
        <span class="err">//noinspection</span> <span class="err">SassScssUnresolvedPlaceholderSelector</span>
        <span class="err">@extend</span> <span class="err">%position-#{$name</span><span class="p">}</span><span class="nt">-common</span><span class="o">;</span>
      <span class="p">}</span>

      <span class="o">&amp;</span><span class="p">::</span><span class="nd">before</span> <span class="p">{</span>
        <span class="err">//noinspection</span> <span class="err">SassScssUnresolvedPlaceholderSelector</span>
        <span class="err">@extend</span> <span class="err">%position-#{$name</span><span class="p">}</span><span class="nt">-before</span><span class="o">;</span>
      <span class="err">}</span>

      <span class="o">&amp;</span><span class="p">::</span><span class="nd">after</span> <span class="p">{</span>
        <span class="err">//noinspection</span> <span class="err">SassScssUnresolvedPlaceholderSelector</span>
        <span class="err">@extend</span> <span class="err">%position-#{$name</span><span class="p">}</span><span class="nt">-after</span><span class="o">;</span>
      <span class="err">}</span>

    <span class="err">}</span>

  <span class="err">}</span>


<span class="err">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>抽出部分<code>VuePopover.scss</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-css" data-lang="css"><span class="o">$</span><span class="nt">border-color</span><span class="o">:</span> <span class="p">#</span><span class="nn">333</span><span class="o">;</span>
<span class="o">$</span><span class="nt">border-radius</span><span class="o">:</span> <span class="nt">4px</span><span class="o">;</span>

<span class="o">%</span><span class="nt">position-top-default</span> <span class="p">{</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">margin-top</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-top-common</span> <span class="p">{</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="err">//</span> <span class="err">防止popover的border</span> <span class="err">遮盖button</span> <span class="err">导致hover重复触发</span>
  <span class="k">border-bottom</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-top-before</span> <span class="p">{</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">border-top-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-top-after</span> <span class="p">{</span>
  <span class="k">top</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
  <span class="k">border-top-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-bottom-default</span> <span class="p">{</span>
  <span class="k">margin-top</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-bottom-common</span> <span class="p">{</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">border-top</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-bottom-before</span> <span class="p">{</span>
  <span class="k">bottom</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">border-bottom-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-bottom-after</span> <span class="p">{</span>
  <span class="k">bottom</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
  <span class="k">border-bottom-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-left-default</span> <span class="p">{</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-left-common</span> <span class="p">{</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">border-right</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-left-before</span> <span class="p">{</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">border-left-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-left-after</span> <span class="p">{</span>
  <span class="k">left</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
  <span class="k">border-left-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-right-default</span> <span class="p">{</span>
  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-right-common</span> <span class="p">{</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateY</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">border-left</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-right-before</span> <span class="p">{</span>
  <span class="k">right</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">border-right-color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">%</span><span class="nt">position-right-after</span> <span class="p">{</span>
  <span class="k">right</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">100</span><span class="kt">%</span> <span class="o">-</span> <span class="mi">1</span><span class="kt">px</span><span class="p">);</span>
  <span class="k">border-right-color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="动态监听事件-vue2-6">动态监听事件<code>vue2.6+</code></h3>

<ul>
<li>动态绑定事件

<ul>
<li><code>@[event]=&quot;eventFn&quot;</code></li>
<li><code>v-on=&quot;{[popUp]: [openEvent, clearTimer], [popDown]: startTimer}&quot;</code></li>
</ul></li>

<li><p>一次绑定多个事件</p>

<ul>
<li><code>v-on=&quot;{mouseover: this.clearTimer, mouseout: this.startTimer}&quot;</code></li>
<li>可使用计算属性简化为<code>v-on=&quot;multiEvent&quot;</code></li>

<li><p>不可使用缩写<code>@</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
<span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
<span class="na">v-on</span><span class="o">=</span><span class="s">&#34;{[popUp]: [openEvent, clearTimer], [popDown]: startTimer}&#34;</span>
<span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
 <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
 <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span>
 <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span>
 <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{[`position-${position}`]: true}&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span> <span class="na">:closeEvent</span><span class="o">=</span><span class="s">&#34;closeEvent&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
  <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
  <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
<span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// prop: [autoCloseDelay, position, trigger]
</span><span class="c1"></span><span class="err">@</span><span class="nx">Prop</span><span class="p">({...})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="kc">false</span> <span class="o">|</span> <span class="nx">number</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({...})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span> <span class="o">|</span> <span class="s1">&#39;left&#39;</span> <span class="o">|</span> <span class="s1">&#39;right&#39;</span><span class="p">;</span>

<span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
<span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">get</span> <span class="nx">multiEvent</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span><span class="nx">mouseover</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">clearTimer</span><span class="p">,</span> <span class="nx">mouseout</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">};</span>
<span class="p">}</span>

<span class="nx">get</span> <span class="nx">popUp</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">===</span> <span class="s1">&#39;hover&#39;</span>
<span class="o">?</span> <span class="s1">&#39;mouseenter&#39;</span>
<span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">get</span> <span class="nx">popDown</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">===</span> <span class="s1">&#39;hover&#39;</span>
<span class="o">?</span> <span class="s1">&#39;mouseleave&#39;</span>
<span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 定位 popover 显示位置
</span><span class="c1"></span><span class="nx">positionPop</span><span class="p">()</span> <span class="p">{...}</span>

<span class="c1">// 定义一个点击关闭事件的回调函数
</span><span class="c1"></span><span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{...}</span>

<span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{...}</span>

<span class="nx">rmListenerToDocument</span><span class="p">()</span> <span class="p">{...}</span>

<span class="c1">// 关闭 弹出框 销毁事件监听
</span><span class="c1"></span><span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{...}</span>

<span class="nx">openEvent</span><span class="p">()</span> <span class="p">{...}</span>

<span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span><span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{...}</span>

<span class="nx">onShowPopover</span><span class="p">()</span> <span class="p">{...}</span>

<span class="c1">// 监听 this.isVisible 状态变化 执行对应的逻辑
</span><span class="c1"></span><span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isVisible&#39;</span><span class="p">)</span>
<span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{...}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div></li>
</ul></li>
</ul>

<hr />

<h2 id="添加支持可选的-click-和-hover-两种触发-popover-方式">添加支持可选的<code>click</code>和<code>hover</code>两种触发<code>popover</code>方式</h2>

<blockquote>
<p><code>Popovers.vue</code>添加外部数据<code>trigger</code> 默认为<code>hover</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">fieldset</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Popover<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>Popover 可click/hover<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">VuePopover</span> <span class="na">trigger</span><span class="o">=</span><span class="s">&#34;click&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">template</span> <span class="err">#</span><span class="na">content</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>鼠标点击触发popover<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">VuePopover</span> <span class="na">trigger</span><span class="o">=</span><span class="s">&#34;hover&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">template</span> <span class="na">slot</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>鼠标悬停触发popover<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VuePopover</span> <span class="nx">from</span> <span class="s1">&#39;./popover/VuePopover.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">VuePopover</span><span class="p">,</span> <span class="nx">VueButton</span><span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Popovers</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Popovers&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">popover</span> <span class="p">{</span>
  <span class="k">margin-top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">margin-right</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>VuePopover.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;{[popUp]: [openEvent, clearTimer], [popDown]: startTimer}&#34;</span>
       <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
         <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
         <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span>
         <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span>
         <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{[`position-${position}`]: true}&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span> <span class="na">:closeEvent</span><span class="o">=</span><span class="s">&#34;closeEvent&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
          <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
          <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VuePopover</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VuePopover&#39;</span><span class="p">;</span>
  <span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="c1">// prop: [autoCloseDelay, position, trigger]
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="p">[</span><span class="nb">Number</span><span class="p">,</span> <span class="nb">Boolean</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="mi">580</span><span class="p">,</span> <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="kc">false</span> <span class="o">|</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="kc">false</span> <span class="o">|</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span> <span class="o">|</span> <span class="s1">&#39;left&#39;</span> <span class="o">|</span> <span class="s1">&#39;right&#39;</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;hover&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;hover&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">trigger</span><span class="o">!:</span> <span class="s1">&#39;hover&#39;</span> <span class="o">|</span> <span class="s1">&#39;click&#39;</span><span class="p">;</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">multiEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">mouseover</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">clearTimer</span><span class="p">,</span> <span class="nx">mouseout</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">popUp</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">===</span> <span class="s1">&#39;hover&#39;</span>
      <span class="o">?</span> <span class="s1">&#39;mouseenter&#39;</span>
      <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">popDown</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">===</span> <span class="s1">&#39;hover&#39;</span>
      <span class="o">?</span> <span class="s1">&#39;mouseleave&#39;</span>
      <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 定位 popover 显示位置
</span><span class="c1"></span>  <span class="nx">positionPop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 获取 弹出消息框节点 的引用，放到 body 子节点的最后
</span><span class="c1"></span>    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">);</span>

    <span class="c1">// 获取 popover元素 按钮元素
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">contentWrapper</span><span class="p">,</span> <span class="nx">triggerWrapper</span><span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">;</span>
    <span class="c1">// 获取 按钮元素 左上顶点的位置坐标 width, height, top, left
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">buttonWidth</span><span class="p">,</span>
      <span class="nx">height</span><span class="o">:</span> <span class="nx">buttonHeight</span><span class="p">,</span>
      <span class="nx">top</span><span class="o">:</span> <span class="nx">buttonTop</span><span class="p">,</span>
      <span class="nx">left</span><span class="o">:</span> <span class="nx">buttonLeft</span>
    <span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
    <span class="c1">// 获取 popover元素 height
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span><span class="nx">height</span><span class="o">:</span> <span class="nx">popHeight</span><span class="p">}</span> <span class="o">=</span> <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

    <span class="c1">// 表驱动编程
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">positionList</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;position-top&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">buttonTop</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">buttonLeft</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-bottom&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">buttonTop</span> <span class="o">+</span> <span class="nx">buttonHeight</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">buttonLeft</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-left&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// popover高度居中 对齐于 按钮高度，按钮于popover高度差值的1/2
</span><span class="c1"></span>        <span class="nx">top</span><span class="o">:</span> <span class="nx">buttonTop</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">buttonHeight</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">buttonLeft</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
      <span class="s1">&#39;position-right&#39;</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">buttonTop</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">buttonHeight</span> <span class="o">-</span> <span class="nx">popHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollY</span><span class="p">,</span>
        <span class="nx">left</span><span class="o">:</span> <span class="nx">buttonLeft</span> <span class="o">+</span> <span class="nx">buttonWidth</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">scrollX</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span>
      <span class="nx">positionList</span><span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span> <span class="nx">as</span> <span class="nx">positionListString</span><span class="p">].</span><span class="nx">top</span> <span class="o">+</span> <span class="sb">`px`</span><span class="p">;</span>
    <span class="p">(</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span>
      <span class="nx">positionList</span><span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span> <span class="nx">as</span> <span class="nx">positionListString</span><span class="p">].</span><span class="nx">left</span> <span class="o">+</span> <span class="sb">`px`</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="c1">// 定义一个点击关闭事件的回调函数
</span><span class="c1"></span>  <span class="nx">closeHandler</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击的目标对象 是否存在于 popover 包裹div中
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">hasPopover</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">contentWrapper</span> <span class="nx">as</span> <span class="nx">Element</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">));</span>
    <span class="c1">// 如果 点击的目标对象 不存在于 包裹弹出框的div中 即 点击了document
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasPopover</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeEvent</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
  <span class="p">}</span>

  <span class="nx">listenToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">rmListenerToDocument</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">closeHandler</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 关闭 弹出框 销毁事件监听
</span><span class="c1"></span>  <span class="nx">closeEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rmListenerToDocument</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">openEvent</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// 点击按钮 执行的方法：切换显示/隐藏 popover
</span><span class="c1"></span>  <span class="nx">togglePop</span><span class="p">(</span><span class="nx">event</span><span class="o">:</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 点击按钮部分 执行的逻辑
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">triggerWrapper</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">)</span>
      <span class="o">?</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">Node</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// 切换显示/隐藏 popover
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span> <span class="o">=</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 点击popover部分 执行的逻辑
</span><span class="c1"></span>    <span class="p">}</span>

  <span class="p">}</span>

  <span class="nx">onShowPopover</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 显示 弹出框，将弹出框节点放到 body 子节点的最后
</span><span class="c1"></span>      <span class="c1">// 改变弹出框样式，使其出现在相对按钮合适的位置
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">positionPop</span><span class="p">();</span>

      <span class="c1">// 使 添加监听在 点击事件冒泡 之后 异步执行
</span><span class="c1"></span>      <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="c1">// 给 document 添加 click 事件监听
</span><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="nx">listenToDocument</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// 监听 this.isVisible 状态变化 执行对应的逻辑
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isVisible&#39;</span><span class="p">)</span>
  <span class="nx">onVisibleChange</span><span class="p">(</span><span class="nx">newValue</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 当 popover 显示时 执行的逻辑
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">onShowPopover</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 当 popover 隐藏时 执行的逻辑
</span><span class="c1"></span>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span><span class="o">...</span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="在弹出框中加上按钮-并且传递属性参数">在弹出框中加上按钮，并且传递属性参数</h2>

<blockquote>
<p>在弹出框加上关闭按钮，并将组件中的关闭方法传给按钮，使按钮可以调用组件传来的 API</p>
</blockquote>

<h3 id="使用具名插槽-https-cn-vuejs-org-v2-guide-components-slots-html-e5-85-b7-e5-90-8d-e6-8f-92-e6-a7-bd"><a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD">使用具名插槽</a></h3>

<ul>
<li><strong>在组件的<code>slot</code>标签中</strong>，提供属性<code>name</code>，用来定义具名插槽

<ul>
<li>不带 <code>name</code> 的匿名插槽 <code>&lt;slot&gt;</code> 出口会带有隐含的<code>name</code>属性<code>“default”</code></li>
</ul></li>
<li><strong>使用组件时</strong>，即向具名插槽提供内容时，在<code>template</code>标签上使用 <strong><code>v-slot</code></strong> 指令

<ul>
<li>以 <code>v-slot:xxx</code> 的参数的形式提供其名称<code>xxx</code></li>
<li><code>&lt;template&gt;</code> 元素中的所有内容都将会被传入对应<code>name</code>属性插槽</li>
<li>组件标签内，带有 v-slot 的 <template>标签 之外的内容都会被视为默认插槽的内容</li>
<li>即与<code>&lt;template v-slot:default&gt;...&lt;/template&gt;</code>等效</li>
</ul></li>
</ul>

<h3 id="使用-作用域插槽-https-cn-vuejs-org-v2-guide-components-slots-html-e4-bd-9c-e7-94-a8-e5-9f-9f-e6-8f-92-e6-a7-bd-实现传递组件的方法到-slot-中">使用 <strong><a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD">作用域插槽</a></strong> ，实现传递组件的方法到<code>&lt;slot&gt;</code>中</h3>

<ul>
<li><strong>在组件的<code>slot</code>标签中</strong>，在<code>slot</code>上绑定组件的数据

<ul>
<li><code>&lt;slot v-bind:data=&quot;data&quot;&gt;...后备内容...&lt;/slot&gt;</code> 匿名插槽</li>
<li>缩写<code>&lt;slot :data=&quot;data&quot;&gt;...后备内容...&lt;/slot&gt;</code></li>
<li><code>&lt;slot name=&quot;xxx&quot;  :data=&quot;data&quot;&gt;...后备内容...&lt;/slot&gt;</code> 具名插槽</li>
<li><code>&lt;slot&gt;</code> 元素上绑定的 attribute 被称为 <strong>插槽 prop</strong></li>
</ul></li>
<li><strong>使用组件时</strong>，写在组件内的<code>template</code>标签中使用带值的 <code>v-slot</code> 来定义提供的 <strong>插槽 prop</strong> 的名字

<ul>
<li><code>&lt;template v-slot:default=&quot;slotProps&quot;&gt;...&lt;/template&gt;</code> 匿名插槽</li>
<li>缩写<code>&lt;template #default=&quot;slotProps&quot;&gt;...&lt;/template&gt;</code></li>
<li><code>&lt;template #xxx=&quot;slotProps&quot;&gt;...&lt;/template&gt;</code> 具名插槽</li>
<li>插槽内容（可以为一个子组件）能够访问组件中才有的数据</li>
<li>即向插槽传值</li>
</ul></li>
<li>独占默认插槽的缩写语法不能和具名插槽混用，因为它会导致作用域不明确，会导致警告</li>
<li><a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E7%BC%96%E8%AF%91%E4%BD%9C%E7%94%A8%E5%9F%9F">模板内容中编译规则</a>

<ul>
<li>父级组件模板里的所有内容都是在父级作用域中编译的</li>
<li>子组件模板里的所有内容都是在子作用域中编译的</li>
</ul></li>
</ul>

<blockquote>
<p>例如</p>
</blockquote>

<ul>
<li>父组件可以访问到数据 faData，提供的内容是在父级渲染的</li>
<li>插槽中的子组件无法直接访问 faData</li>
<li>为了让 faData 在父级的插槽内容在子组件中可用

<ul>
<li>可以将 faData 作为 <slot> 元素的一个 <strong>attribute 属性绑定</strong></li>
<li>在<code>&lt;slot :faData=&quot;faData&quot;&gt;&lt;/slot&gt;</code>上绑定属性</li>
</ul></li>
<li>绑定在 <slot> 元素上的 attribute 被称为 <strong>插槽 prop</strong></li>
<li>在<strong>父级作用域</strong>中，可使用带值的 v-slot 来定义提供的插槽 prop 的名字

<ul>
<li><code>&lt;template v-slot:default=&quot;anySlotPropsNameLikefaData&quot;&gt;...&lt;/template&gt;</code></li>
</ul></li>
</ul>

<h3 id="使用-es2015-解构来传入具体的插槽-prop">使用 ES2015 解构来传入具体的插槽 prop</h3>

<ul>
<li><code>&lt;template v-slot:xxx=&quot;{ data }&quot;&gt;...</code></li>
<li>写在<code>&lt;template&gt;&lt;/template&gt;</code>中，可以缩写具名插槽

<ul>
<li><code>v-slot:xxx</code>缩写为<code>#xxx</code></li>
<li><code>...&lt;template #xxx&gt;&lt;/template&gt;...</code></li>
<li>默认插槽<code>...&lt;comp #default=&quot;{ data }&quot;&lt;/comp&gt;...</code></li>
</ul></li>
<li>可以从外层组件获取数据</li>
</ul>

<blockquote>
<p><code>VuePopover.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="na">class</span><span class="o">=</span><span class="s">&#34;popover&#34;</span>
       <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;{[popUp]: [openEvent, clearTimer], [popDown]: startTimer}&#34;</span>
       <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;togglePop&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;contentWrapper&#34;</span>
         <span class="na">class</span><span class="o">=</span><span class="s">&#34;content-wrapper&#34;</span>
         <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span>
         <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span>
         <span class="na">:class</span><span class="o">=</span><span class="s">&#34;{[`position-${position}`]: true}&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;content&#34;</span> <span class="na">:closeEvent</span><span class="o">=</span><span class="s">&#34;closeEvent&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
          <span class="na">ref</span><span class="o">=</span><span class="s">&#34;triggerWrapper&#34;</span>
          <span class="na">v-on</span><span class="o">=</span><span class="s">&#34;multiEvent&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>button<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>&lt;slot name=&quot;content&quot; :closeEvent=&quot;closeEvent&quot;&gt;&lt;/slot&gt;</code></li>
<li>在具名插槽<code>content</code>中绑定数据<code>:closeEvent=&quot;closeEvent&quot;</code></li>
</ul>

<blockquote>
<p><code>Popovers.vue</code> 展示组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">fieldset</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">legend</span><span class="p">&gt;</span>Popover<span class="p">&lt;/</span><span class="nt">legend</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>Popover 带关闭按钮<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">VuePopover</span> <span class="na">trigger</span><span class="o">=</span><span class="s">&#34;hover&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">template</span> <span class="err">#</span><span class="na">content</span><span class="o">=</span><span class="s">&#34;{closeEvent}&#34;</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>popover使用 slotScope 传参给slot<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
              <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;closeEvent&#34;</span><span class="p">&gt;</span>关闭<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">VueButton</span><span class="p">&gt;</span>提供slot事件回调closeEvent<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">VuePopover</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>&lt;template #content=&quot;{closeEvent}&quot;&gt;...&lt;/template&gt;</code>

<ul>
<li>解构数据<code>#content=&quot;{closeEvent}&quot;</code></li>
<li>使用解构出的方法<code>&lt;VueButton @click=&quot;closeEvent&quot;&gt;关闭&lt;/VueButton&gt;</code></li>
</ul></li>
</ul>

<blockquote>
<p>参考</p>
</blockquote>

<ul>
<li><a href="https://cn.vuejs.org/v2/guide/components-slots.html">vue2.6 插槽</a></li>
</ul>

<hr />

<h2 id="封装为指令">封装为指令</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"></code></pre></td></tr></table>
</div>
</div>
<hr />

<hr />

<blockquote>
<p>参考</p>
</blockquote>

<ul>
<li>代码链接：<a href="https://github.com/FrankFang/frank-test-1/blob/master/src/popover.vue">popover.vue</a></li>
</ul>

<hr />

<hr />

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-07-18
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/project/">Project</a>
          <a href="http://xmasuhai.xyz/tags/vueel/">vueel</a>
          <a href="http://xmasuhai.xyz/tags/vue2/">vue2</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/css/css%E9%9D%9E%E5%85%A8%E8%A7%A300%E5%AE%9A%E4%BD%8D%E5%B1%85%E4%B8%AD%E6%96%B9%E5%BC%8F%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E9%80%9F%E8%AE%B0/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">【CSS非全解00】定位居中方式应用场景速记</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%906.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuetoast-%E4%BF%A1%E6%81%AF%E5%BC%B9%E5%87%BA%E7%BB%84%E4%BB%B6/">
            <span class="next-text nav-default">【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2026
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
