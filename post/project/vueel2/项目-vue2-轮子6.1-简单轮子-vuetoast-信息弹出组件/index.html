<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="6.1 简单轮子：VueToast 信息弹出组件 大纲链接§ [toc] 需求分析 用例图 用户触发 弹出信息位置 置顶 底部 中心 弹出信息 自动关闭 可设置 n 秒后关闭 点击后关闭" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.59.1" />


<link rel="canonical" href="http://xmasuhai.xyz/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%906.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuetoast-%E4%BF%A1%E6%81%AF%E5%BC%B9%E5%87%BA%E7%BB%84%E4%BB%B6/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件" />
<meta property="og:description" content="6.1 简单轮子：VueToast 信息弹出组件 大纲链接§ [toc] 需求分析 用例图 用户触发 弹出信息位置 置顶 底部 中心 弹出信息 自动关闭 可设置 n 秒后关闭 点击后关闭" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%906.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuetoast-%E4%BF%A1%E6%81%AF%E5%BC%B9%E5%87%BA%E7%BB%84%E4%BB%B6/" />
<meta property="article:published_time" content="2022-01-19T12:35:54+08:00" />
<meta property="article:modified_time" content="2022-07-06T08:18:02+08:00" />
<meta itemprop="name" content="【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件">
<meta itemprop="description" content="6.1 简单轮子：VueToast 信息弹出组件 大纲链接§ [toc] 需求分析 用例图 用户触发 弹出信息位置 置顶 底部 中心 弹出信息 自动关闭 可设置 n 秒后关闭 点击后关闭">


<meta itemprop="datePublished" content="2022-01-19T12:35:54&#43;08:00" />
<meta itemprop="dateModified" content="2022-07-06T08:18:02&#43;08:00" />
<meta itemprop="wordCount" content="13016">



<meta itemprop="keywords" content="FrontEnd,Project,vueel,vue2," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件"/>
<meta name="twitter:description" content="6.1 简单轮子：VueToast 信息弹出组件 大纲链接§ [toc] 需求分析 用例图 用户触发 弹出信息位置 置顶 底部 中心 弹出信息 自动关闭 可设置 n 秒后关闭 点击后关闭"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【项目 Vue2 轮子】6.1 简单轮子：VueToast 信息弹出组件</h1>
      
      <div class="post-meta">
        <time datetime="2022-01-19" class="post-time">
          2022-01-19
        </time>
        <div class="post-category">
            
          </div>
        <span class="more-meta"> 约 13016 字 </span>
          <span class="more-meta"> 预计阅读 26 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li><a href="#6-1-简单轮子-vuetoast-信息弹出组件">6.1 简单轮子：VueToast 信息弹出组件</a>
<ul>
<li><a href="#需求分析">需求分析</a></li>
<li><a href="#api设计">API设计</a></li>
<li><a href="#初步实现-ui">初步实现 UI</a>
<ul>
<li><a href="#如何使用-vuetoast-组件">如何使用 <code>VueToast</code>组件</a></li>
<li><a href="#让-vuetoast-组件-出现在页面中">让 <code>VueToast</code>组件 出现在页面中</a>
<ul>
<li><a href="#加样式使得-vuetoast-组件出现在页面顶部">加样式使得<code>VueToast</code>组件出现在页面顶部</a></li>
<li><a href="#添加-toastplugin-d-ts-声明">添加<code>toastPlugin.d.ts</code>声明</a></li>
</ul></li>
<li><a href="#对比-vue-3-的内置标签-teleport-to-xxx">对比 Vue 3 的内置标签<code>&lt;Teleport to=&quot;xxx&quot;/&gt;</code></a></li>
</ul></li>
<li><a href="#完善功能">完善功能</a>
<ul>
<li><a href="#为-vuetoast-vue-添加过渡动画">为 <code>VueToast.vue</code> 添加过渡动画</a></li>
<li><a href="#添加自动关闭-与-定时清除功能">添加自动关闭 与 定时清除功能</a></li>
<li><a href="#添加关闭按钮">添加关闭按钮</a></li>
<li><a href="#在-callback-中传递-this-即实例本身-从而使用实例上的方法">在<code>callback</code>中传递<code>this</code>，即实例本身，从而使用实例上的方法</a></li>
<li><a href="#传递自定义html节点-不安全">传递自定义HTML节点，不安全</a>
<ul>
<li><a href="#让ui开发者控制是否开启传-html-标签功能">让UI开发者控制是否开启传<code>HTML</code>标签功能</a></li>
</ul></li>
<li><a href="#样式-bug">样式 bug</a></li>
<li><a href="#重构代码-样式分离">重构代码 样式分离</a></li>
</ul></li>
<li><a href="#更多需求">更多需求</a>
<ul>
<li><a href="#出现位置-顶部-中部-底部">出现位置 顶部 中部 底部</a></li>
<li><a href="#只出现一个信息框">只出现一个信息框</a>
<ul>
<li><a href="#重构第一步-创建函数">重构第一步：创建函数</a></li>
<li><a href="#第二步-命名函数">第二步：命名函数</a></li>
<li><a href="#第三部-提出参数">第三部：提出参数</a></li>
</ul></li>
<li><a href="#优化消息动画-vuetoast-vue">优化消息动画 <code>VueToast.vue</code></a></li>
<li><a href="#可以出现多个信息框">可以出现多个信息框</a></li>
<li><a href="#添加-按-escape-键关闭-功能">添加 按<code>Escape</code>键关闭 功能</a></li>
</ul></li>
<li><a href="#重构">重构</a>
<ul>
<li><a href="#重构-vuetoast-vue">重构<code>VueToast.vue</code></a></li>
<li><a href="#重构-toastplugin-ts">重构<code>toastPlugin.ts</code></a></li>
<li><a href="#重构-toastplugin-ts-1">重构<code>toastPlugin.ts</code></a></li>
</ul></li>
<li><a href="#测试用例">测试用例</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h1 id="6-1-简单轮子-vuetoast-信息弹出组件">6.1 简单轮子：VueToast 信息弹出组件</h1>

<blockquote>
<p>大纲链接<a id="catalogue" href="#catalogue" > § </a></p>
</blockquote>

<p>[toc]</p>

<hr />

<h2 id="需求分析">需求分析</h2>

<blockquote>
<p>用例图</p>
</blockquote>

<ul>
<li>用户触发

<ul>
<li>弹出信息位置</li>
<li>置顶</li>
<li>底部</li>
<li>中心</li>
<li>弹出信息</li>
<li>自动关闭

<ul>
<li>可设置 n 秒后关闭</li>
</ul></li>
<li>点击后关闭

<ul>
<li>关闭按钮</li>
<li>多行文字关闭按钮</li>
</ul></li>
<li>关闭后执行回调</li>
</ul></li>
<li>用户连续触发两次以上

<ul>
<li>弹出一个信息</li>
<li>关闭上个信息</li>
<li>再弹出一个</li>
<li>期间不能再次点击</li>
<li>可设置 不会同时出现两个 toast 提示信息</li>
</ul></li>
<li>可设置允许多个 Toast 出现

<ul>
<li>在相同的位置，依次出现</li>
<li>限制出现次数，超过次数，清楚最前一次的</li>
</ul></li>
<li>弹出动画</li>
</ul>

<hr />

<h2 id="api设计">API设计</h2>

<hr />

<h2 id="初步实现-ui">初步实现 UI</h2>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>初步实现，只包含一个插槽来传递信息</li>
</ul>

<h3 id="如何使用-vuetoast-组件">如何使用 <code>VueToast</code>组件</h3>

<ul>
<li>添加方法：<code>showToast() {this.$toast('提示信息提示信息提示信息')}</code></li>
<li>实现 <code>this.$toast</code> 方法

<ul>
<li>使用<a href="https://note.youdao.com/"><code>install</code> API</a>，开发插件的方式实现</li>
<li>开发者使用<code>Vue.use( MyPlugin )</code></li>
</ul></li>
</ul>

<blockquote>
<p>实现<code>Vue.use( MyPlugin )</code>的原理</p>
</blockquote>

<ul>
<li><code>import Vue from 'vue'</code></li>
<li>在实例上挂载方法<code>Vue.prototype.$toast = ()=&gt; {...}</code></li>
<li><code>const vm = new Vue({...})</code>后，使用<code>vm.$toast()</code></li>
<li>全局引入组件，在实例中调用钩子<code>created() {this.$toast(...)}</code></li>
</ul>

<blockquote>
<p>直接修改<code>Vue.prototype.*</code>不符合<strong>工程实践</strong>，带来工程问题</p>
</blockquote>

<ul>
<li>组件开发者并不知道组件使用者是否已经使用了相同的命名，导致<strong>同名覆盖</strong></li>
<li>直接修改<code>Vue.prototype.*</code>，<strong>侵入性太强</strong></li>
<li>墨菲定理：小概率事件在足够多的实践后一定会发生

<ul>
<li><code>import Vue from 'vue*'</code> 不能确定用户使用的版本</li>
</ul></li>
</ul>

<blockquote>
<p>解决方法：写一个插件，让项目开发者主动使用插件</p>
</blockquote>

<ul>
<li><p>在<code>toastPlugin.ts</code>中定义一个<code>install</code>方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
<span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span>: <span class="kt">any</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span> <span class="o">|</span> <span class="kt">string</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>使用时或者在入口文件中</p>
</blockquote>

<ul>
<li>引入<code>import toastPlugin from '.../toastPlugin'</code></li>
<li>写<code>Vue.use(toastPlugin)</code>去自动执行<code>install</code>方法</li>
<li>执行<code>created() {this.$toast('Hi')}</code></li>
</ul>

<blockquote>
<p>将选择留给UI使用用户</p>
</blockquote>

<ul>
<li>用户自己决定是否<code>Vue.use(plugin)</code></li>
<li><code>toastPlugin.ts</code>中没有引入具体版本的Vue</li>
</ul>

<h3 id="让-vuetoast-组件-出现在页面中">让 <code>VueToast</code>组件 出现在页面中</h3>

<blockquote>
<p><code>toastPlugin.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">decument</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>使用JS原生 API ，背离了使用 Vue 的初衷，改为 Vue 用法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
<span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">();</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>为组件实例添加<code>$toast</code>方法</p></li>

<li><p>动态地创建一个<code>VueToast.vue</code>组件</p>

<ul>
<li><code>const Constructor = Vue.extend(Toast);</code></li>
<li><code>const toast = new Constructor();</code></li>
<li>将传参放入插槽 <code>toast.$slots.default = [message];</code>，注意<strong>必须放在<code>$mount()</code>之前</strong></li>
<li>挂载到内存中 <code>toast.$mount();</code>，使得组件的所有生命周期执行，但页面中还未出现</li>
<li>将节点添加到页面 <code>document.body.appendChild(toast.$el);</code></li>
</ul></li>
</ul>

<blockquote>
<p><code>ToastsTips.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToast&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueToast</span> <span class="nx">from</span> <span class="s1">&#39;./toast/VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">toastPlugin</span> <span class="nx">from</span> <span class="s1">&#39;./toast/toastPlugin&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">toastPlugin</span><span class="p">);</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VueToast</span><span class="p">,</span>
    <span class="nx">VueButton</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ToastsTips</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;ToastsTips&#39;</span><span class="p">;</span>

  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>VueToast</code> 组件不直接出现在页面中</li>
<li>通过监听按钮点击事件，回调中动态创建组件

<ul>
<li>调用<code>this.$toast('我是一个VueToast组件');</code></li>
</ul></li>
</ul>

<blockquote>
<p>参考</p>
</blockquote>

<ul>
<li><a href="https://zhuanlan.zhihu.com/p/38076208">Vue 动态创建实例 方应杭</a></li>
</ul>

<hr />

<h4 id="加样式使得-vuetoast-组件出现在页面顶部">加样式使得<code>VueToast</code>组件出现在页面顶部</h4>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="p">...</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-height</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h4 id="添加-toastplugin-d-ts-声明">添加<code>toastPlugin.d.ts</code>声明</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">declare</span> <span class="nx">module</span> <span class="s1">&#39;vue/types/vue&#39;</span> <span class="p">{</span>
  <span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>
    <span class="nx">$toast</span><span class="o">:</span> <span class="p">(</span><span class="nx">message</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>添加后续重启服务，看是否仍提示 type error</li>
</ul>

<blockquote>
<p>参考stackoverflow</p>
</blockquote>

<ul>
<li><a href="https://stackoverflow.com/questions/60572618/vue-typescript-plugin">Vue typescript plugin</a></li>
<li><a href="https://stackoverflow.com/questions/51469620/why-doesnt-typescript-recognize-module-augmentation-for-a-vue-plugin">Why doesn&rsquo;t TypeScript recognize module augmentation for a Vue plugin?</a></li>
<li><a href="https://www.mistergoodcat.com/post/vuejs-plugins-with-typescript">Vue.js-Plugins with TypeScript</a></li>
<li><a href="https://stackoverflow.com/questions/64094727/error-creating-custom-plugin-vuejs-typescript">Error creating custom plugin Vuejs + Typescript</a></li>
</ul>

<h3 id="对比-vue-3-的内置标签-teleport-to-xxx">对比 Vue 3 的内置标签<code>&lt;Teleport to=&quot;xxx&quot;/&gt;</code></h3>

<blockquote>
<p>Vue 3 中官方已经封装好了 teleport组件 用于修改节点的挂载位置</p>
</blockquote>

<ul>
<li>通过 teleport 把模板内容移动到当前组件之外的DOM，防止由于层叠上下文等原因导致的弹出框或模态框被文档中的元素遮盖</li>
<li>模态框（子组件），里面的模态宽度、标题、X按钮显示等都可以通过属性接受定制</li>
</ul>

<blockquote>
<p>子组件<code>Modal.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">teleport</span> <span class="na">to</span><span class="o">=</span><span class="s">&#34;body&#34;</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- &lt;teleport to=&#34;#app&#34;&gt;也可以指定到id选择器上 --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-bg&#34;</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-content&#34;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;close&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;$emit(&#39;close-modal&#39;)&#34;</span><span class="p">&gt;</span>X<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="c">&lt;!-- close-modal为父组件传递方法，关闭弹窗，isVisible=false即可 --&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;model-title&#34;</span><span class="p">&gt;</span>{{title}}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;modal-body&#34;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;</span>第一个对话框<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">teleport</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
    <span class="nx">props</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;visible&#39;</span><span class="p">]</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;less&#34;</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">modal-bg</span><span class="p">{</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#000</span><span class="p">;</span>
    <span class="k">opacity</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">modal-content</span><span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">600</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">min-height</span><span class="p">:</span><span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#eee</span><span class="p">;</span>
    <span class="k">position</span><span class="p">:</span><span class="kc">absolute</span><span class="p">;</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
    <span class="k">background</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="err">.close{</span>
        <span class="k">position</span><span class="p">:</span> <span class="kc">absolute</span><span class="p">;</span>
        <span class="k">right</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">top</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">border</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
        <span class="k">display</span><span class="p">:</span> <span class="kc">inline</span><span class="o">-</span><span class="kc">block</span><span class="p">;</span>
        <span class="k">cursor</span><span class="p">:</span> <span class="kc">pointer</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="nc">model-title</span><span class="p">{</span>
        <span class="k">background</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span>
        <span class="k">color</span><span class="p">:</span> <span class="mh">#000</span><span class="p">;</span>
        <span class="k">height</span><span class="p">:</span> <span class="mi">32</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">line-height</span><span class="p">:</span> <span class="mi">32</span><span class="kt">px</span><span class="p">;</span>
        <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="nc">modal-body</span><span class="p">{</span>
        <span class="k">padding</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>父组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;home&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;isVisible=true&#34;</span><span class="p">&gt;</span>
          弹出一个模态框
        <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Modal</span> <span class="na">:visible</span><span class="o">=</span><span class="s">&#34;isVisible&#34;</span> 
               <span class="na">:title</span><span class="o">=</span><span class="s">&#34;title&#34;</span> 
               <span class="err">@</span><span class="na">close-modal</span><span class="o">=</span><span class="s">&#34;isVisible=false&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">Modal</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Modal</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Modal&#39;</span>
<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">(){</span>
        <span class="k">return</span><span class="p">{</span>
            <span class="nx">title</span><span class="o">:</span><span class="s2">&#34;用户登录&#34;</span><span class="err">，</span>
            <span class="nx">isVisible</span><span class="o">:</span><span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">components</span><span class="o">:</span><span class="p">{</span><span class="nx">Modal</span><span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="完善功能">完善功能</h2>

<h3 id="为-vuetoast-vue-添加过渡动画">为 <code>VueToast.vue</code> 添加过渡动画</h3>

<blockquote>
<p>使用 <code>&lt;transition&gt;&lt;/transition&gt;</code> 包裹组件根标签</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>钩子回调<code>@after-leave=&quot;handleAfterLeave&quot;</code></li>
</ul>

<blockquote>
<p>过渡样式与逻辑</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>
  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
  <span class="nx">closed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-height</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
  <span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-fade-enter</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-to</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-enter-active</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-active</span> <span class="p">{</span>
  <span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="添加自动关闭-与-定时清除功能">添加自动关闭 与 定时清除功能</h3>

<ul>
<li><code>setTimeout</code></li>
<li><code>@Prop({type: Boolean, default: true}) autoClose!: boolean;</code></li>

<li><p><code>@Prop({type: Number, default: 1800}) autoCloseDelay!: number;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;[&#39;toast&#39;,
</span><span class="s">              &#39;customClass&#39;,
</span><span class="s">             ]&#34;</span>
     <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionStyle&#34;</span>
     <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
<span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>

<span class="nx">get</span> <span class="nx">positionStyle</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">verticalOffset</span><span class="si">}</span><span class="sb">px`</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 监听 closed 的状态
</span><span class="c1"></span><span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
<span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span><span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoClose</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<h3 id="添加关闭按钮">添加关闭按钮</h3>

<blockquote>
<p>使用外部数据传入参数，来判断是否出现关闭按钮</p>
</blockquote>

<ul>
<li>外部数据为<strong>对象</strong>时，默认值需要是一个返回此对象的<strong>工厂函数</strong><code>@Prop({ type: Object, default: ()=&gt;(...);</code></li>

<li><p>组件的复用性</p>

<ul>
<li>组件选项为<code>Vue.component('xxx', {...})</code>的第二个参数</li>
<li>每次初始化一个组件的时候，需要保证在内存中产生一个新的选项（不复用内存中同一个选项）</li>

<li><p>保证了同类的组件的<strong>状态改变不会互相影响</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;[&#39;toast&#39;,
</span><span class="s">          &#39;customClass&#39;,
</span><span class="s">         ]&#34;</span>
 <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionStyle&#34;</span>
 <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>{{ closeButton.text }}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
<span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
<span class="k">default</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span>
<span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;关闭&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="o">:</span> <span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">})</span> <span class="nx">closeButton</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>

<span class="nx">get</span> <span class="nx">positionStyle</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span>
<span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">verticalOffset</span><span class="si">}</span><span class="sb">px`</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 监听 closed 的状态
</span><span class="c1"></span><span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
<span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span><span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoClose</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul></li>

<li><p>显示在提示信息里 <code>&lt;span v-if=&quot;closeButton&quot;&gt;{{ closeButton.text }}&lt;/span&gt;</code></p></li>

<li><p>如果用户传了<code>closeButton</code>，就把<code>closeButton.text</code>显示在一个<code>&lt;span&gt;</code>标签中</p></li>

<li><p><code>Debug</code>时可以使用<code>created() {console.log(this.closeButton)}</code>调试</p></li>

<li><p>只有<code>this.$destroy();</code>而未<code>this.$el.remove();</code>，并不会删除节点</p></li>
</ul>

<blockquote>
<p>添加关闭按钮样式</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">...
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-height</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
  <span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>

  <span class="err">.line</span> <span class="err">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>

<span class="err">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>添加类型文件<code>VueToast.d.ts</code> 定义方法类型</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="cm">/** Message Component */</span>
<span class="kr">export</span> <span class="nx">declare</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="cm">/** Close the Loading instance */</span>
  <span class="nx">close</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>

  <span class="nx">popUpToast</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** Options used in Message */</span>
<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">VueToastOptions</span> <span class="p">{</span>
  <span class="cm">/** Callback function when closed with the message instance as the parameter */</span>
  <span class="nx">onClose</span><span class="o">?:</span> <span class="nx">CloseEventHandler</span><span class="p">;</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
      <span class="nx">callback</span><span class="o">:</span> <span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">CloseEventHandler</span> <span class="p">{</span>
  <span class="cm">/**
</span><span class="cm">   * Triggers when a message is being closed
</span><span class="cm">   *
</span><span class="cm">   * @param instance The message component that is being closed
</span><span class="cm">   */</span>
  <span class="p">(</span><span class="nx">instance</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">declare</span> <span class="nx">module</span> <span class="s1">&#39;vue/types/vue&#39;</span> <span class="p">{</span>
  <span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>
    <span class="cm">/**
</span><span class="cm">     * Used to show feedback after an activity.
</span><span class="cm">     * The difference with Notification
</span><span class="cm">     * is that the latter is often
</span><span class="cm">     * used to show a system level passive notification.
</span><span class="cm">     * */</span>
    <span class="nx">$toast</span><span class="o">:</span> <span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>在<code>toastPlugin.ts</code>中的<code>const toast = new Constructor({...});</code>时传递参数

<ul>
<li><code>{propsData: {closeButton: {test: '手动关闭', callback() { ...;}}}}</code></li>
</ul></li>
</ul>

<blockquote>
<p><code>toastPlugin.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span> <span class="o">|</span> <span class="nx">string</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
        <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span><span class="p">.</span><span class="nx">closeButton</span><span class="p">,</span>
          <span class="nx">autoClose</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span><span class="o">?</span><span class="p">.</span><span class="nx">autoClose</span><span class="p">,</span>
          <span class="nx">autoCloseDelay</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span><span class="o">?</span><span class="p">.</span><span class="nx">autoCloseDelay</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>实现功能 <code>src/components/ToastsTips.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueToast</span> <span class="nx">from</span> <span class="s1">&#39;./toast/VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">toastPlugin</span> <span class="nx">from</span> <span class="s1">&#39;./toast/toastPlugin&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">toastPlugin</span><span class="p">);</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VueToast</span><span class="p">,</span>
    <span class="nx">VueButton</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ToastsTips</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;ToastsTips&#39;</span><span class="p">;</span>

  <span class="nx">popUpToasts</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">,</span>  <span class="p">{</span>
      <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
          <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;执行用户的回调&#39;</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>toastPlugin.ts</code>中定义选项<code>toastOptions</code>

<ul>
<li><code>const toast = new Constructor({ propsData: { closeButton: toastOptions.propsData.closeButton } });</code></li>
</ul></li>
<li>用户使用时在<code>ToastsTips.vue</code>中提供选项，传参

<ul>
<li><code>this.$toast('我是一个VueToast组件',  { propsData: { closeButton: { text: '手动关闭', callback() { console.log('执行用户的回调'); } } } });</code></li>
</ul></li>
<li>组件拿到<code>closeButton</code> 用在三处：

<ul>
<li><code>&lt;span class=&quot;closeButton&quot; v-if=&quot;closeButton&quot; @click=&quot;onClickCloseButton&quot;&gt;...</code></li>
<li><code>{{ closeButton.text }}</code></li>
<li><code>onClickCloseButton() { this.isClosed = true; this.closeButton?.callback(); }</code></li>
</ul></li>
<li>需要考虑到用户不传选项中的<code>closeButton</code>时，就不执行回调函数

<ul>
<li><strong>防御性编程</strong></li>
<li><code>onClickCloseButton() { this.isClosed = true; if (typeof (this?.closeButton?.callback) === 'function') { this.closeButton.callback(); }</code></li>
</ul></li>

<li><p>使用TS重载实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="cm">/** Message Component */</span>
<span class="kr">export</span> <span class="nx">declare</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="cm">/** Close the Loading instance */</span>
<span class="nx">close</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>

<span class="nx">popUpToast</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** Options used in Message */</span>
<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">VueToastOptions</span> <span class="p">{</span>
<span class="cm">/** Callback function when closed with the message instance as the parameter */</span>
<span class="nx">onClose</span><span class="o">?:</span> <span class="nx">CloseEventHandler</span><span class="p">;</span>
<span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
<span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nx">callback</span><span class="o">:</span> <span class="p">((</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">...</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ToastCallBack</span> <span class="p">{</span>
<span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">;</span>

<span class="p">}</span>

<span class="nx">declare</span> <span class="nx">module</span> <span class="s1">&#39;vue/types/vue&#39;</span> <span class="p">{</span>
<span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="cm">/**
</span><span class="cm"> * Used to show feedback after an activity.
</span><span class="cm"> * The difference with Notification
</span><span class="cm"> * is that the latter is often
</span><span class="cm"> * used to show a system level passive notification.
</span><span class="cm"> * */</span>
<span class="nx">$toast</span><span class="o">:</span> <span class="nx">ToastCallBack</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<h3 id="在-callback-中传递-this-即实例本身-从而使用实例上的方法">在<code>callback</code>中传递<code>this</code>，即实例本身，从而使用实例上的方法</h3>

<ul>
<li>让<code>callback</code>接受组件回传的方法</li>
</ul>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;[&#39;toast&#39;,
</span><span class="s">                  &#39;customClass&#39;,
</span><span class="s">                 ]&#34;</span>
         <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionStyle&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span>
    <span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
        {{ closeButton.text }}
      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="k">default</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;关闭&#39;</span><span class="p">,</span>
        <span class="nx">callback</span><span class="o">:</span> <span class="kc">undefined</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">closeButton</span><span class="o">!:</span> <span class="nx">closeButton</span><span class="p">;</span>

  <span class="nx">testLog</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;测试&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="k">this</span><span class="o">?</span><span class="p">.</span><span class="nx">closeButton</span><span class="o">?</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeButton</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">get</span> <span class="nx">positionStyle</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="p">{...};}</span>

  <span class="c1">// 监听 closed 的状态
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{...}</span>

  <span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span>  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>测试方法<code>testLog() { console.log('测试'); }</code></li>
<li>传递<code>this</code>实例<code>onClickCloseButton() {... this.closeButton.callback(this); ...}</code></li>
<li>默认不出现关闭按钮

<ul>
<li>将外部数据改为 <strong>默认为空</strong> <code>@Prop({ type: Object, default() { return undefined; } }) closeButton: closeButton | undefined;</code></li>
</ul></li>
</ul>

<blockquote>
<p><code>ToastsTips.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;showToast&#34;</span><span class="p">&gt;</span>点击出现提示框，无回调<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts&#34;</span><span class="p">&gt;</span>点击出现提示框，并执行回调<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueToast</span> <span class="nx">from</span> <span class="s1">&#39;./toast/VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">toastPlugin</span> <span class="nx">from</span> <span class="s1">&#39;./toast/toastPlugin&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">toastPlugin</span><span class="p">);</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VueToast</span><span class="p">,</span>
    <span class="nx">VueButton</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ToastsTips</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;ToastsTips&#39;</span><span class="p">;</span>

  <span class="nx">showToast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">popUpToasts</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">testLog</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>VueToast.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="cm">/** Message Component */</span>
<span class="kr">export</span> <span class="nx">declare</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="cm">/** Close the Loading instance */</span>
  <span class="nx">close</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>

  <span class="nx">popUpToast</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">type</span> <span class="nx">closeButton</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nx">callback</span><span class="o">:</span> <span class="p">(</span><span class="nx">vm</span><span class="o">:</span> <span class="nx">Vue</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** Options used in Message */</span>
<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">VueToastOptions</span> <span class="p">{</span>
  <span class="cm">/** Callback function when closed with the message instance as the parameter */</span>
  <span class="nx">onClose</span><span class="o">?:</span> <span class="nx">CloseEventHandler</span><span class="p">;</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
      <span class="nx">callback</span><span class="o">:</span> <span class="p">((</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">CloseEventHandler</span> <span class="p">{</span>
  <span class="cm">/**
</span><span class="cm">   * Triggers when a message is being closed
</span><span class="cm">   *
</span><span class="cm">   * @param instance The message component that is being closed
</span><span class="cm">   */</span>
  <span class="p">(</span><span class="nx">instance</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ToastCallBack</span> <span class="p">{</span>
  <span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">fn</span><span class="o">:</span> <span class="p">(</span><span class="nx">text</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">;</span>

<span class="p">}</span>

<span class="nx">declare</span> <span class="nx">module</span> <span class="s1">&#39;vue/types/vue&#39;</span> <span class="p">{</span>
  <span class="kr">interface</span> <span class="nx">Vue</span> <span class="p">{</span>
    <span class="cm">/**
</span><span class="cm">     * Used to show feedback after an activity.
</span><span class="cm">     * The difference with Notification
</span><span class="cm">     * is that the latter is often
</span><span class="cm">     * used to show a system level passive notification.
</span><span class="cm">     * */</span>
    <span class="nx">$toast</span><span class="o">:</span> <span class="nx">ToastCallBack</span><span class="p">.</span><span class="nx">fn</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="传递自定义html节点-不安全">传递自定义HTML节点，不安全</h3>

<ul>
<li>由于<code>&lt;slot&gt;</code>不能写任何其他属性比如： <code>&lt;slot v-html=&quot;xxx&quot;&gt;</code></li>
<li>在<code>VueToast.vue</code>组件中使用 <strong><code>&lt;div v-html=&quot;$slots.defalt[0]&quot;&gt;&lt;/div&gt;</code></strong> 代替<code>&lt;slot&gt;</code>

<ul>
<li><code>v-html=&quot;$slots.defalt[0]&quot;</code>读取<code>toastPlugin.ts</code>中传递的值<code>toast.$slots.default = [message];</code></li>
</ul></li>

<li><p>在<code>ToastsTips.vue</code>的<code>demo</code>中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 无关闭按钮 自动关闭<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;showToast&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 点击关闭，无回调<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;showToast2&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 点击关闭，并执行回调<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 传递自定义HTML节点<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts2&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 传递自定义HTML节点<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts3&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueToast</span> <span class="nx">from</span> <span class="s1">&#39;./toast/VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">toastPlugin</span> <span class="nx">from</span> <span class="s1">&#39;./toast/toastPlugin&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">toastPlugin</span><span class="p">);</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
<span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
<span class="nx">VueToast</span><span class="p">,</span>
<span class="nx">VueButton</span>
<span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ToastsTips</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;ToastsTips&#39;</span><span class="p">;</span>

<span class="nx">showToast</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">showToast2</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="nx">popUpToasts</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="nx">popUpToasts2</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="sb">`
</span><span class="sb">    &lt;p&gt;
</span><span class="sb">      我是由一个&lt;i&gt;标签&lt;/i&gt;包裹&lt;strong&gt;文字&lt;/strong&gt;的VueToast组件
</span><span class="sb">    &lt;/p&gt;`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="nx">popUpToasts3</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="sb">`
</span><span class="sb">    &lt;p&gt;
</span><span class="sb">      &lt;a style=&#34;color: seagreen;&#34; href=&#34;https://cn.vuejs.org&#34;&gt;Vue官网链接&lt;/a&gt;
</span><span class="sb">    &lt;/p&gt;`</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>传<code>HTML</code>标签有安全风险，必须加上一个选项加以限制 <code>enableHTML</code></p>
</blockquote>

<h4 id="让ui开发者控制是否开启传-html-标签功能">让UI开发者控制是否开启传<code>HTML</code>标签功能</h4>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;[&#39;toast&#39;,
</span><span class="s">                  &#39;customClass&#39;,
</span><span class="s">                 ]&#34;</span>
         <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionStyle&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableHTML&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;$slots.default[0]&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
          {{ closeButton.text }}
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span> <span class="nx">enableHTML</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="k">default</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">closeButton</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="c1">// 监听 closed 的状态
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{...}</span>

  <span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span>  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span><span class="o">...</span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>toastPlugin.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">HTMLElement</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
        <span class="nx">propsData</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span>
      <span class="p">});</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>ToastsTips.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 无关闭按钮 自动关闭<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 点击关闭，无回调<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 点击关闭，并执行回调<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 传递自定义HTML节点<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts2&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">details</span> <span class="na">open</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">summary</span><span class="p">&gt;</span>ToastsTips 传递自定义HTML节点<span class="p">&lt;/</span><span class="nt">summary</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;popUpToasts3&#34;</span><span class="p">&gt;</span>点击出现提示框<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">details</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueToast</span> <span class="nx">from</span> <span class="s1">&#39;./toast/VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;./button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">toastPlugin</span> <span class="nx">from</span> <span class="s1">&#39;./toast/toastPlugin&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">toastPlugin</span><span class="p">);</span>
<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VueToast</span><span class="p">,</span>
    <span class="nx">VueButton</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">ToastsTips</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;ToastsTips&#39;</span><span class="p">;</span>

  <span class="nx">showToast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="s1">&#39;我是一个VueToast组件&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">showToast2</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">popUpToasts</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">popUpToasts2</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="sb">`
</span><span class="sb">        &lt;p&gt;
</span><span class="sb">          我是由一个&lt;i&gt;标签&lt;/i&gt;包裹&lt;strong&gt;文字&lt;/strong&gt;的VueToast组件
</span><span class="sb">        &lt;/p&gt;`</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enableHTML</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">popUpToasts3</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$toast</span><span class="p">(</span><span class="sb">`
</span><span class="sb">        &lt;p&gt;
</span><span class="sb">          &lt;a style=&#34;color: seagreen;&#34; href=&#34;https://cn.vuejs.org&#34;&gt;Vue官网链接&lt;/a&gt;
</span><span class="sb">        &lt;/p&gt;`</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">propsData</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">autoClose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">enableHTML</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">closeButton</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;手动关闭&#39;</span><span class="p">,</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">toast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">toast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="样式-bug">样式 bug</h3>

<blockquote>
<p>注意关闭文字的样式由于文字溢出而显示竖排</p>
</blockquote>

<ul>
<li>父元素为<code>flex</code>布局，子元素不收缩改变宽度<code>.closeButton {...; min-width: 40px; flex-shrink: 0;}</code></li>
</ul>

<blockquote>
<p>注意文字溢出而高度未做自适应</p>
</blockquote>

<ul>
<li>不写死高度</li>
<li>父元素写了<code>min-height</code>而没写<code>height</code>，会使得

<ul>
<li>子元素即使写了高度<code>100%</code>，也不生效</li>
<li>因而无法获取高度导致<code>&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;</code>的边框高度为<code>0</code>，分隔线消失</li>
</ul></li>
</ul>

<blockquote>
<p>使用JS获取元素的实际高度，再赋值给子元素的高度值</p>
</blockquote>

<ul>
<li>首先给元素添加引用属性<code>ref</code>

<ul>
<li>父元素<code>&lt;div ... ref=&quot;toast&quot;&gt;...&lt;/div&gt;</code></li>
<li>子元素<code>&lt;div ref=&quot;line&quot; class=&quot;line&quot;&gt;&lt;/div&gt;</code></li>
</ul></li>
<li>获取内联样式，可读可写

<ul>
<li>父元素<code>this.$refs.toast.style.height</code> 目前为 <code>0</code>，因为<code>.style.*</code>无法获取实际样式</li>
<li>子元素<code>this.$refs.line.style.height</code> 目前为 <code>0</code></li>
</ul></li>
<li>使用<code>Element.getBoundingClientRec() API</code> 来获取元素尺寸

<ul>
<li><code>this.$refs.toast.getBoundingClientRec()</code>的到描述父组件尺寸与位置的对象</li>
</ul></li>
<li>在生命周期<code>mounted</code>中调用钩子时执行<code>this.$refs.toast.getBoundingClientRec()</code>

<ul>
<li>得到一系列<code>0</code>值</li>
<li>说明还未生成，或者经过时间差内被关闭了</li>
</ul></li>
<li><code>Debug</code>技巧

<ul>
<li>眼睛观察到不为零</li>
<li>JS 获取为零</li>
<li>一般来说时异步的问题</li>
</ul></li>
</ul>

<blockquote>
<p>在<code>toastPlugin.ts</code>中，是先<code>$mount()</code>，再添加节点到<code>body</code>中</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>

      <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
      <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>生命周期<code>mounted</code>的回调触发时，组件还没有添加到页面中</li>
<li>使用<code>this.$nextTick(() =&gt; {...})</code>，等页面渲染完毕，立即执行回调</li>
<li>父子组件嵌套时，所有组件视图都渲染完成后再执行回调操作</li>
</ul>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">:class</span><span class="o">=</span><span class="s">&#34;[&#39;toast&#39;,
</span><span class="s">                  &#39;customClass&#39;,
</span><span class="s">                 ]&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableHTML&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;$slots.default[0]&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
          {{ closeButton.text }}
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span> <span class="nx">enableHTML</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="k">default</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">closeButton</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="c1">// 监听 closed 的状态
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{...}</span>

  <span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span>  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">close</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">line</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="o">!</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span>
        <span class="sb">`</span><span class="si">${</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">toast</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
...</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>回顾bug

<ul>
<li>将父元素的<code>height</code>改为<code>min-height</code>后，子元素的<code>height: 100%</code>无法根据父元素计算出</li>
<li>在渲染完成后，获取父元素高度，赋给子元素</li>
</ul></li>
</ul>

<blockquote>
<p>高度不定的父元素，其中的子元素不能自动撑开高度</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html">...
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;parent&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;div1&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;div2&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;div3&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">.</span><span class="nc">parent</span> <span class="p">{</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">red</span><span class="p">;</span>
    <span class="k">min-height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="err">//</span> <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">parent</span> <span class="o">&gt;</span> <span class="nt">div</span> <span class="p">{</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">green</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>父元素的<code>min-height</code>不是<code>height</code></li>
<li>仅设置了<code>min-height</code>的元素的<code>height</code>值为<code>0</code></li>
<li>子元素设置的百分比相对高度不能撑开</li>
</ul>

<blockquote>
<p>或者提供可省略溢出文字的选项</p>
</blockquote>

<hr />

<h3 id="重构代码-样式分离">重构代码 样式分离</h3>

<ul>
<li>增加一层<code>div.message</code>包裹信息部分，即<code>slot</code>或<code>v-html=&quot;$slots.default[0]&quot;</code>部分</li>
</ul>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionOffsetStyle&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;message&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableUnsafeHTML&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;$slots.default[0]&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
          {{ closeButton.text }}
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-min-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">min-height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-min-height</span><span class="p">;</span>
  <span class="k">max-width</span><span class="p">:</span> <span class="mi">288</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
  <span class="err">.message</span> <span class="err">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">line</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">min-width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">flex-shrink</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="更多需求">更多需求</h2>

<h3 id="出现位置-顶部-中部-底部">出现位置 顶部 中部 底部</h3>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="na">:class</span><span class="o">=</span><span class="s">&#34;toastPosition&#34;</span>
         <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionOffsetStyle&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;message&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableUnsafeHTML&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;$slots.default[0]&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
          {{ closeButton.text }}
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span> <span class="nx">enableUnsafeHTML</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;middle&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="k">default</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">closeButton</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="k">this</span><span class="o">?</span><span class="p">.</span><span class="nx">closeButton</span><span class="o">?</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeButton</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 决定提示框出现的位置
</span><span class="c1"></span>  <span class="nx">get</span> <span class="nx">toastPosition</span><span class="p">()</span><span class="o">:</span> <span class="p">{}</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 提供偏移量
</span><span class="c1"></span>  <span class="nx">get</span> <span class="nx">positionOffsetStyle</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="c1">// 监听 closed 的状态 决定visible是否变化
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{...}</span>

  <span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span>  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clearVM</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">//  清除组件
</span><span class="c1"></span>  <span class="nx">clearVM</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 显示提示框
</span><span class="c1"></span>  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 关闭提示框
</span><span class="c1"></span>  <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{...}</span>

  <span class="c1">// 异步 得到渲染后的父元素高度
</span><span class="c1"></span>  <span class="nx">getRenderedHeight</span><span class="p">()</span> <span class="p">{...}</span>
  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{...}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-min-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">min-height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-min-height</span><span class="p">;</span>
  <span class="k">max-width</span><span class="p">:</span> <span class="mi">288</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
  <span class="err">//</span><span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span> <span class="err">//一次有效赋值</span>

  <span class="err">&amp;.position-top</span> <span class="err">{</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-middle</span> <span class="p">{</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-bottom</span> <span class="p">{</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">message</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">line</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">min-width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">flex-shrink</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

<span class="err">}</span>

<span class="p">.</span><span class="nc">eat-toast-fade-enter</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-to</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-enter-active</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-active</span> <span class="p">{</span>
  <span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="只出现一个信息框">只出现一个信息框</h3>

<blockquote>
<p>在<code>toastPlugin.ts</code>里创建实例，也在其中加上限制创建实例的条件</p>
</blockquote>

<h4 id="重构第一步-创建函数">重构第一步：创建函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="c1">// import Vue from &#39;vue&#39;;
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span><span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="cm">/* options: {} = {} */</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">function</span> <span class="nx">x</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
          <span class="nx">propsData</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span>
        <span class="p">});</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">x</span><span class="p">();</span>

    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>创建一个函数，并调用</li>
<li>和原来的代码等价</li>
</ul>

<h4 id="第二步-命名函数">第二步：命名函数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="c1">// import Vue from &#39;vue&#39;;
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span><span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">any</span><span class="p">,</span> <span class="cm">/* options: {} = {} */</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">function</span> <span class="nx">createToast</span><span class="p">()</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
        <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
          <span class="nx">propsData</span><span class="o">:</span> <span class="nx">toastOptions</span><span class="o">?</span><span class="p">.</span><span class="nx">propsData</span>
        <span class="p">});</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
        <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">createToast</span><span class="p">();</span>

    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="第三部-提出参数">第三部：提出参数</h4>

<ul>
<li><p>需要的传参</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VNode</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span> <span class="nx">propsData</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">[</span><span class="s1">&#39;propsData&#39;</span><span class="p">])</span> <span class="p">{</span>
<span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
<span class="nx">propsData</span>
<span class="p">});</span>
<span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
<span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="k">return</span> <span class="nx">toast</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
<span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="cm">/* options: {} = {} */</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">!</span><span class="p">.</span><span class="nx">propsData</span><span class="p">);</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>函数<code>createToast</code>返回一个<code>toast</code>实例</p></li>
</ul>

<blockquote>
<p>使用变量<code>currentToast</code>接收<code>toast</code>实例</p>
</blockquote>

<ul>
<li><p>判断当前是否有<code>currentToast</code>，执行不同逻辑</p>

<ul>
<li>有，就直接关闭</li>

<li><p>无，就创建一个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VNode</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VueToast</span><span class="p">,</span> <span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span>
             <span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span>
             <span class="nx">propsData</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">[</span><span class="s1">&#39;propsData&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">:</span> <span class="nx">VueToast</span> <span class="p">{</span>
<span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
<span class="nx">propsData</span>
<span class="p">});</span>
<span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
<span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="k">return</span> <span class="nx">toast</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">currentToast</span><span class="o">:</span> <span class="nx">VueToast</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
<span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="cm">/* options: {} = {} */</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">currentToast</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">currentToast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">toastOptions</span><span class="p">)</span> <span class="p">{</span>
<span class="kr">const</span> <span class="p">{</span><span class="nx">propsData</span><span class="p">}</span> <span class="o">=</span> <span class="nx">toastOptions</span><span class="p">;</span>
<span class="nx">currentToast</span> <span class="o">=</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">propsData</span><span class="p">);</span>
<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">currentToast</span> <span class="o">=</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
<span class="k">return</span><span class="p">;</span>
<span class="p">};</span>
<span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul></li>
</ul>

<blockquote>
<p>小 bug</p>
</blockquote>

<ul>
<li>只出现一次 VueToast ，<code>if (currentToast) {currentToast.close();}</code></li>
<li>当存在一个实例时，不需要重复关闭</li>
<li><code>currentToast</code>一直存在于内存中，没有赋空值<code>currentToast = null;</code>清除</li>
<li>需要在<code>this.close()</code>里发布<code>emit</code>一个回调，使得监听到这个回调时清除<code>currentToast</code></li>
<li><code>onClose: () =&gt; {currentToast = null;}</code></li>
<li>注意<code>emit</code>在<code>this.$destroy();</code>之前，否则失效</li>
</ul>

<blockquote>
<p><code>VueToast.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">transition</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;eat-toast-fade&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="na">:class</span><span class="o">=</span><span class="s">&#34;toastPosition&#34;</span>
         <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionOffsetStyle&#34;</span>
         <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span>
         <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
         <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
         <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;message&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableUnsafeHTML&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;$slots.default[0]&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
          {{ closeButton.text }}
        <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Emit</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>

  <span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span> <span class="nx">enableUnsafeHTML</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">enableEscapeKey</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;middle&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">autoClose</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
    <span class="k">default</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span> <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">closeButton</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

  <span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="k">this</span><span class="o">?</span><span class="p">.</span><span class="nx">closeButton</span><span class="o">?</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">closeButton</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 决定提示框出现的位置
</span><span class="c1"></span>  <span class="nx">get</span> <span class="nx">toastPosition</span><span class="p">()</span><span class="o">:</span> <span class="p">{}</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 提供偏移量
</span><span class="c1"></span>  <span class="nx">get</span> <span class="nx">positionOffsetStyle</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">verticalOffset</span><span class="si">}</span><span class="sb">px`</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 监听 closed 的状态 决定visible是否变化
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
  <span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span>  <span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clearVM</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">//  清除组件
</span><span class="c1"></span>  <span class="nx">clearVM</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 显示提示框
</span><span class="c1"></span>  <span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 关闭提示框
</span><span class="c1"></span>  <span class="err">@</span><span class="nx">Emit</span><span class="p">(</span><span class="s1">&#39;beforeClose&#39;</span><span class="p">)</span>
  <span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoClose</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 异步 得到渲染后的父元素高度
</span><span class="c1"></span>  <span class="nx">getRenderedHeight</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">line</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span>
          <span class="sb">`</span><span class="si">${</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">toast</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// 按Escape键关闭消息
</span><span class="c1"></span>  <span class="nx">keydown</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">KeyboardEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">enableEscapeKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="sb">`Escape`</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">keydown</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getRenderedHeight</span><span class="p">();</span> <span class="c1">// 注意顺序 必须放在 this.popUpToast() 之后
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$once</span><span class="p">(</span><span class="s1">&#39;hook:beforeDestroy&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">keydown</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">clearVM</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-min-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>
<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
  <span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
  <span class="k">min-height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-min-height</span><span class="p">;</span>
  <span class="k">max-width</span><span class="p">:</span> <span class="mi">288</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
  <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span><span class="p">;</span>
  <span class="err">//</span><span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
  <span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
  <span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>

  <span class="err">&amp;.position-top</span> <span class="err">{</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-middle</span> <span class="p">{</span>
    <span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
    <span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="o">&amp;</span><span class="p">.</span><span class="nc">position-bottom</span> <span class="p">{</span>
    <span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">message</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">line</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
    <span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
    <span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
    <span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">min-width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">flex-shrink</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

<span class="err">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>toastPlugin.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Toast</span> <span class="nx">from</span> <span class="s1">&#39;./VueToast.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VNode</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VueToast</span><span class="p">,</span> <span class="nx">VueToastOptions</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">currentToast</span><span class="o">:</span> <span class="nx">VueToast</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span>
                     <span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span>
                     <span class="nx">propsData</span><span class="o">:</span> <span class="nx">VueToastOptions</span><span class="p">[</span><span class="s1">&#39;propsData&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">,</span>
                     <span class="nx">onClose</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">void</span><span class="p">)</span><span class="o">:</span> <span class="nx">VueToast</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">Constructor</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Toast</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Constructor</span><span class="p">({</span>
    <span class="nx">propsData</span>
  <span class="p">});</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="nx">message</span><span class="p">];</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">$mount</span><span class="p">();</span>
  <span class="nx">toast</span><span class="p">.</span><span class="nx">$once</span><span class="p">(</span><span class="s1">&#39;beforeClose&#39;</span><span class="p">,</span> <span class="nx">onClose</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toast</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">toast</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">install</span><span class="p">(</span><span class="nx">Vue</span><span class="o">:</span> <span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="cm">/* options: {} = {} */</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$toast</span> <span class="o">=</span> <span class="p">(</span><span class="nx">message</span><span class="o">:</span> <span class="nx">string</span> <span class="o">|</span> <span class="nx">VNode</span><span class="p">,</span> <span class="nx">toastOptions</span><span class="o">:</span> <span class="nx">VueToastOptions</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">currentToast</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">currentToast</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">toastOptions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="p">{</span><span class="nx">propsData</span><span class="p">}</span> <span class="o">=</span> <span class="nx">toastOptions</span><span class="p">;</span>
        <span class="nx">currentToast</span> <span class="o">=</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">propsData</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">currentToast</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;});</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">currentToast</span> <span class="o">=</span> <span class="nx">createToast</span><span class="p">(</span><span class="nx">Vue</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">currentToast</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;});</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>重构 方法 <code>createToast</code>

<ul>
<li>增加一个参数为回调 <code>onClose: () =&gt; void</code></li>
<li><code>function createToast(Vue: Record&lt;string, any&gt;, message: string | VNode, propsData: VueToastOptions['propsData'] | undefined, onClose: () =&gt; void): VueToast {...}</code></li>
<li>在调用时主动置空 <code>currentToast = null;</code></li>
<li>监听一次自定义事件 <code>toast.$once('beforeClose', onClose);</code></li>
<li>返回实例 <code>return toast;</code></li>
</ul></li>
<li>重构 <code>Vue.prototype.$toast</code>

<ul>
<li>判断当前是否已存在实例 <code>currentToast</code></li>
<li>存在即 主动关闭 <code>currentToast.close();</code></li>
<li>得到实例 <code>currentToast = createToast(Vue, message, propsData, () =&gt; {currentToast = null;});</code></li>
</ul></li>
</ul>

<hr />

<h3 id="优化消息动画-vuetoast-vue">优化消息动画 <code>VueToast.vue</code></h3>

<ul>
<li>注意两处的<code>transform</code>属性后一个会覆盖前一个，不管<code>transform</code>的内容是什么，比如

<ul>
<li>默认：<code>transform: tranlateX(-50%)</code></li>
<li>进入 <code>0%</code>：<code>transform: tranlateY(100%)</code></li>
</ul></li>
</ul>

<blockquote>
<p>解决方法：分离定位和动画</p>
</blockquote>

<ul>
<li><p>增加一层<code>div.wrapper</code>负责居中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">transition</span> <span class="na">:name</span><span class="o">=</span><span class="s">&#34;fadeAnimationName&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wrapper&#34;</span>
     <span class="na">:class</span><span class="o">=</span><span class="s">&#34;toastPosition&#34;</span>
     <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
       <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionOffsetStyle&#34;</span>
       <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
       <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
       <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;message&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableUnsafeHTML&#34;</span><span class="p">&gt;</span>{{ message }}<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;ifSlots/*$slots.default[0]*/&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
        {{ closeButton.text }}
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="p">...</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-min-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">slide-up</span> <span class="p">{</span>
<span class="nt">0</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">100</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">slide-down</span> <span class="p">{</span>
<span class="nt">0</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">100</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-fade-enter-active</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-active</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-top-enter-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-down</span> <span class="mf">.5</span><span class="kt">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-top-leave-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-down</span> <span class="mf">.5</span><span class="kt">s</span> <span class="kc">reverse</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-bottom-enter-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-up</span> <span class="mf">.5</span><span class="kt">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-bottom-leave-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-up</span> <span class="mf">.5</span><span class="kt">s</span> <span class="kc">reverse</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">wrapper</span> <span class="p">{</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
<span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
<span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">;</span>

<span class="err">&amp;.position-top</span> <span class="err">{</span>
<span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

<span class="err">.toast</span> <span class="err">{</span>
  <span class="k">border-top-left-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-top-right-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">}</span>

<span class="o">&amp;</span><span class="p">.</span><span class="nc">position-middle</span> <span class="p">{</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
<span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">&amp;</span><span class="p">.</span><span class="nc">position-bottom</span> <span class="p">{</span>
<span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

<span class="err">.toast</span> <span class="err">{</span>
  <span class="k">border-bottom-left-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-bottom-right-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">}</span>
<span class="err">}</span>

<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
<span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
<span class="k">min-height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-min-height</span><span class="p">;</span>
<span class="k">max-width</span><span class="p">:</span> <span class="mi">288</span><span class="kt">px</span><span class="p">;</span>
<span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
<span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
<span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
<span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>

<span class="err">.message</span> <span class="err">{</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">line</span> <span class="p">{</span>
<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
<span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
<span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="k">min-width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
<span class="k">flex-shrink</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<h3 id="可以出现多个信息框">可以出现多个信息框</h3>

<hr />

<h3 id="添加-按-escape-键关闭-功能">添加 按<code>Escape</code>键关闭 功能</h3>

<ul>
<li>键盘事件 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/KeyboardEvent">KeyboardEvent() MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/key">KeyboardEvent.key</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/key/Key_Values">Key Values</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent">KeyboardEvent 用户与键盘的交互</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/dispatchEvent">代码触发事件 EventTarget.dispatchEvent MDN</a></li>
</ul>

<hr />

<h2 id="重构">重构</h2>

<h3 id="重构-vuetoast-vue">重构<code>VueToast.vue</code></h3>

<ul>
<li>使用计算属性<code>ifSlots</code> 将<code>message</code>传给<code>$slots.default</code>

<ul>
<li><code>&lt;div v-else v-html=&quot;ifSlots&quot;&gt;&lt;/div&gt;</code></li>
<li><code>get ifSlots() {return (this.$slots.default ? this.$slots.default[0] : this.message);}</code></li>
</ul></li>

<li><p>提出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">transition</span> <span class="na">:name</span><span class="o">=</span><span class="s">&#34;fadeAnimationName&#34;</span> <span class="err">@</span><span class="na">after-leave</span><span class="o">=</span><span class="s">&#34;handleAfterLeave&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;wrapper&#34;</span>
     <span class="na">:class</span><span class="o">=</span><span class="s">&#34;toastPosition&#34;</span>
     <span class="na">v-show</span><span class="o">=</span><span class="s">&#34;visible&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
       <span class="na">:style</span><span class="o">=</span><span class="s">&#34;positionOffsetStyle&#34;</span>
       <span class="na">ref</span><span class="o">=</span><span class="s">&#34;toast&#34;</span>
       <span class="err">@</span><span class="na">mouseenter</span><span class="o">=</span><span class="s">&#34;clearTimer&#34;</span>
       <span class="err">@</span><span class="na">mouseleave</span><span class="o">=</span><span class="s">&#34;startTimer&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;message&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">slot</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;!enableUnsafeHTML&#34;</span><span class="p">&gt;</span>{{ message }}<span class="p">&lt;/</span><span class="nt">slot</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">v-else</span> <span class="na">v-html</span><span class="o">=</span><span class="s">&#34;ifSlots/*$slots.default[0]*/&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">template</span> <span class="na">v-if</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;line&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;line&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;closeButton&#34;</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onClickCloseButton&#34;</span><span class="p">&gt;</span>
        {{ closeButton.text }}
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">transition</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Emit</span><span class="p">,</span> <span class="nx">Prop</span><span class="p">,</span> <span class="nx">Ref</span><span class="p">,</span> <span class="nx">Vue</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">closeButton</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/types/VueToast&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">VNode</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue/types/vnode&#39;</span><span class="p">;</span>
<span class="c1">// import {bus} from &#39;../../main&#39;;
</span><span class="c1"></span>
<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">VueToast</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;VueToast&#39;</span><span class="p">;</span>
<span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nx">timer</span><span class="o">:</span> <span class="nx">number</span> <span class="o">|</span> <span class="kc">null</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">verticalOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">onClose</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span> <span class="nx">enableUnsafeHTML</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="k">default</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span> <span class="nx">enableEscapeKey</span><span class="o">!:</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
<span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="k">default</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
<span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">})</span> <span class="nx">position</span><span class="o">!:</span> <span class="s1">&#39;top&#39;</span> <span class="o">|</span> <span class="s1">&#39;middle&#39;</span> <span class="o">|</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
<span class="nx">type</span><span class="o">:</span> <span class="p">[</span><span class="nb">Number</span><span class="p">,</span> <span class="nb">Boolean</span><span class="p">],</span> <span class="k">default</span><span class="o">:</span> <span class="mi">1800</span><span class="p">,</span> <span class="nx">validator</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="kc">false</span> <span class="o">|</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="kr">boolean</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">})</span> <span class="nx">autoCloseDelay</span><span class="o">!:</span> <span class="kc">false</span> <span class="o">|</span> <span class="nx">number</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Prop</span><span class="p">({</span>
<span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
<span class="k">default</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">})</span> <span class="nx">closeButton</span><span class="o">:</span> <span class="nx">closeButton</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>

<span class="nx">onClickCloseButton</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="k">this</span><span class="o">?</span><span class="p">.</span><span class="nx">closeButton</span><span class="o">?</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">closeButton</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 决定提示框出现的位置
</span><span class="c1"></span><span class="nx">get</span> <span class="nx">toastPosition</span><span class="p">()</span><span class="o">:</span> <span class="p">{}</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="p">[</span><span class="sb">`position-</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 根据提示框出现的位置 应用不同类样式进入动画
</span><span class="c1"></span><span class="nx">get</span> <span class="nx">fadeAnimationName</span><span class="p">()</span> <span class="p">{</span>
<span class="kr">const</span> <span class="nx">map</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;position-top&#39;</span><span class="o">:</span> <span class="s1">&#39;eat-toast-from-top&#39;</span><span class="p">,</span>
  <span class="s1">&#39;position-middle&#39;</span><span class="o">:</span> <span class="s1">&#39;eat-toast-fade&#39;</span><span class="p">,</span>
  <span class="s1">&#39;position-bottom&#39;</span><span class="o">:</span> <span class="s1">&#39;eat-toast-from-bottom&#39;</span><span class="p">,</span>
<span class="p">};</span>
<span class="nx">type</span> <span class="nx">mapKey</span> <span class="o">=</span> <span class="s1">&#39;position-top&#39;</span> <span class="o">|</span> <span class="s1">&#39;position-middle&#39;</span> <span class="o">|</span> <span class="s1">&#39;position-bottom&#39;</span><span class="p">;</span>
<span class="k">return</span> <span class="nx">map</span><span class="p">[</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toastPosition</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="nx">as</span> <span class="nx">mapKey</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// 提供偏移量
</span><span class="c1"></span><span class="nx">get</span> <span class="nx">positionOffsetStyle</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">{</span>
  <span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="si">}</span><span class="sb">`</span><span class="p">]</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">verticalOffset</span><span class="si">}</span><span class="sb">px`</span>
<span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 监听 closed 的状态 决定visible是否变化
</span><span class="c1"></span><span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;isClosed&#39;</span><span class="p">)</span>
<span class="nx">onClosedChange</span><span class="p">(</span><span class="nx">newVal</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 元素离开后执行钩子
</span><span class="c1"></span><span class="nx">handleAfterLeave</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">clearVM</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//  清除组件
</span><span class="c1"></span><span class="nx">clearVM</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$destroy</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 显示提示框
</span><span class="c1"></span><span class="nx">popUpToast</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 关闭提示框
</span><span class="c1"></span><span class="err">@</span><span class="nx">Emit</span><span class="p">(</span><span class="s1">&#39;beforeClose&#39;</span><span class="p">)</span>
<span class="nx">close</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">clearTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">startTimer</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">autoCloseDelay</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 异步 得到渲染后的父元素高度
</span><span class="c1"></span><span class="err">@</span><span class="nx">Ref</span><span class="p">()</span> <span class="nx">readonly</span> <span class="nx">line</span><span class="o">!:</span> <span class="nx">HTMLElement</span><span class="p">;</span>
<span class="err">@</span><span class="nx">Ref</span><span class="p">()</span> <span class="nx">readonly</span> <span class="nx">toast</span><span class="o">!:</span> <span class="nx">HTMLElement</span><span class="p">;</span>

<span class="nx">getRenderedHeight</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">toast</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span>
      <span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">toast</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="c1">// 按Escape键关闭消息
</span><span class="c1"></span><span class="nx">keydown</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">KeyboardEvent</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">enableEscapeKey</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="sb">`Escape`</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isClosed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">get</span> <span class="nx">ifSlots</span><span class="p">()</span> <span class="p">{</span>
<span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">haveSlots</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$slots</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">[</span><span class="sb">`&lt;slot&gt;&lt;/slot&gt;`</span> <span class="nx">as</span> <span class="nx">unknown</span> <span class="nx">as</span> <span class="nx">VNode</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
<span class="k">this</span><span class="p">.</span><span class="nx">haveSlots</span><span class="p">();</span>
<span class="c1">// bus.$on(&#39;pushSlot&#39;, (value: VNode) =&gt; {this.haveSlots(value);});
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">popUpToast</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">keydown</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">getRenderedHeight</span><span class="p">();</span> <span class="c1">// 注意顺序 必须放在 this.popUpToast() 之后
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">startTimer</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">$once</span><span class="p">(</span><span class="s1">&#39;hook:beforeDestroy&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// bus.$off(&#39;pushSlot&#39;);
</span><span class="c1"></span>  <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">keydown</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">clearVM</span><span class="p">();</span>
<span class="p">});</span>
<span class="p">}</span>

<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">$</span><span class="nt">font-size</span><span class="o">:</span> <span class="nt">14px</span><span class="o">;</span>
<span class="o">$</span><span class="nt">toast-min-height</span><span class="o">:</span> <span class="nt">40px</span><span class="o">;</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">slide-up</span> <span class="p">{</span>
<span class="nt">0</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">100</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">keyframes</span> <span class="nt">slide-down</span> <span class="p">{</span>
<span class="nt">0</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">100</span><span class="o">%</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">0</span><span class="kt">%</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-fade-enter-active</span><span class="o">,</span>
<span class="p">.</span><span class="nc">eat-toast-fade-leave-active</span> <span class="p">{</span>
<span class="k">opacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-top-enter-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-down</span> <span class="mf">.5</span><span class="kt">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-top-leave-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-down</span> <span class="mf">.5</span><span class="kt">s</span> <span class="kc">reverse</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-bottom-enter-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-up</span> <span class="mf">.5</span><span class="kt">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">eat-toast-from-bottom-leave-active</span> <span class="p">{</span>
<span class="k">animation</span><span class="p">:</span> <span class="n">slide-up</span> <span class="mf">.5</span><span class="kt">s</span> <span class="kc">reverse</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">wrapper</span> <span class="p">{</span>
<span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
<span class="k">left</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translateX</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
<span class="k">transition</span><span class="p">:</span> <span class="k">opacity</span> <span class="mf">0.3</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">,</span> <span class="k">transform</span> <span class="mf">.4</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">,</span> <span class="kc">top</span> <span class="mf">0.4</span><span class="kt">s</span> <span class="kc">ease</span><span class="p">;</span>

<span class="err">&amp;.position-top</span> <span class="err">{</span>
<span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

<span class="err">.toast</span> <span class="err">{</span>
  <span class="k">border-top-left-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-top-right-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">}</span>

<span class="o">&amp;</span><span class="p">.</span><span class="nc">position-middle</span> <span class="p">{</span>
<span class="k">transform</span><span class="p">:</span> <span class="nb">translate</span><span class="p">(</span><span class="mi">-50</span><span class="kt">%</span><span class="p">,</span> <span class="mi">-50</span><span class="kt">%</span><span class="p">);</span>
<span class="k">top</span><span class="p">:</span> <span class="mi">50</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">&amp;</span><span class="p">.</span><span class="nc">position-bottom</span> <span class="p">{</span>
<span class="k">bottom</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

<span class="err">.toast</span> <span class="err">{</span>
  <span class="k">border-bottom-left-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">border-bottom-right-radius</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="err">}</span>
<span class="err">}</span>

<span class="p">.</span><span class="nc">toast</span> <span class="p">{</span>
<span class="k">font-size</span><span class="p">:</span> <span class="err">$</span><span class="k">font</span><span class="o">-</span><span class="k">size</span><span class="p">;</span>
<span class="k">min-height</span><span class="p">:</span> <span class="err">$</span><span class="n">toast-min-height</span><span class="p">;</span>
<span class="k">max-width</span><span class="p">:</span> <span class="mi">288</span><span class="kt">px</span><span class="p">;</span>
<span class="k">background-color</span><span class="p">:</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.74</span><span class="p">);</span>
<span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
<span class="k">box-shadow</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">3</span><span class="kt">px</span> <span class="mi">0</span> <span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">.5</span><span class="p">);</span>
<span class="k">color</span><span class="p">:</span> <span class="kc">ghostwhite</span><span class="p">;</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>
<span class="k">align-items</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>

<span class="err">.message</span> <span class="err">{</span>
<span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">line</span> <span class="p">{</span>
<span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
<span class="k">border-left</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#666</span><span class="p">;</span>
<span class="k">margin-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">closeButton</span> <span class="p">{</span>
<span class="k">padding-left</span><span class="p">:</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
<span class="k">min-width</span><span class="p">:</span> <span class="mi">40</span><span class="kt">px</span><span class="p">;</span>
<span class="k">flex-shrink</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">}</span>

<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>取消使用<code>eventbus</code> 监听触发 <code>$slots.default</code>变更</p>
</blockquote>

<h3 id="重构-toastplugin-ts">重构<code>toastPlugin.ts</code></h3>

<ul>
<li><p>提出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<h3 id="重构-toastplugin-ts-1">重构<code>toastPlugin.ts</code></h3>

<ul>
<li><p>提出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-js" data-lang="js">
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<h2 id="测试用例">测试用例</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ts" data-lang="ts">
</code></pre></td></tr></table>
</div>
</div>
<hr />

<blockquote>
<p>参考</p>
</blockquote>

<ul>
<li><a href="https://github.com/framework7io/framework7/">Framework7 UI github</a></li>
<li><a href="https://framework7.io/">Framework7 UI</a></li>
<li><a href="https://github.com/FrankFang/frank-test-1/blob/toast/src/toast.vue">代码仓库</a></li>
<li><a href="https://yuque.com/u29422/gulu/244946">UI 设计稿</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38076208">Vue 动态创建实例 方应杭</a></li>
<li><a href="http://www.woshipm.com/pd/429007.html">四种App弹窗设计：Toast、Dialog、Actionbar 和 Snackbar</a></li>
<li><a href="https://element.eleme.cn/#/zh-CN/component/message">elementUI Message 消息提示</a></li>
</ul>

<hr />

<hr />

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-07-06
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/project/">Project</a>
          <a href="http://xmasuhai.xyz/tags/vueel/">vueel</a>
          <a href="http://xmasuhai.xyz/tags/vue2/">vue2</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%907.1-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuepopover%E7%BB%84%E4%BB%B6-%E4%B9%8B-scrolly/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">【项目 Vue2 轮子】7.1 简单轮子：VuePopover组件 之 ScrollY</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/project/vueel2/%E9%A1%B9%E7%9B%AE-vue2-%E8%BD%AE%E5%AD%905.2-%E7%AE%80%E5%8D%95%E8%BD%AE%E5%AD%90-vuetab-%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
            <span class="next-text nav-default">【项目 Vue2 轮子】5.2 简单轮子：VueTab 组件单元测试</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2026
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
