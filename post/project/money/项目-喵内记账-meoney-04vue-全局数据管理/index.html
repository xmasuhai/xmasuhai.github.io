<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【项目 喵内记账 Meoney 04】Vue 全局数据管理 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="【项目-喵内记账-meoney-04】Vue 全局数据管理 大纲链接§ [toc] 知识点 代码 组件间数据同步/共享 全局数据管理/全局状态管理是啥 store 是啥 store 怎么" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.91.2" />


<link rel="canonical" href="http://xmasuhai.xyz/post/project/money/%E9%A1%B9%E7%9B%AE-%E5%96%B5%E5%86%85%E8%AE%B0%E8%B4%A6-meoney-04vue-%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【项目 喵内记账 Meoney 04】Vue 全局数据管理" />
<meta property="og:description" content="【项目-喵内记账-meoney-04】Vue 全局数据管理 大纲链接§ [toc] 知识点 代码 组件间数据同步/共享 全局数据管理/全局状态管理是啥 store 是啥 store 怎么" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/project/money/%E9%A1%B9%E7%9B%AE-%E5%96%B5%E5%86%85%E8%AE%B0%E8%B4%A6-meoney-04vue-%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-07T12:06:21+08:00" />
<meta property="article:modified_time" content="2022-03-29T23:35:42+08:00" />

<meta itemprop="name" content="【项目 喵内记账 Meoney 04】Vue 全局数据管理">
<meta itemprop="description" content="【项目-喵内记账-meoney-04】Vue 全局数据管理 大纲链接§ [toc] 知识点 代码 组件间数据同步/共享 全局数据管理/全局状态管理是啥 store 是啥 store 怎么"><meta itemprop="datePublished" content="2021-11-07T12:06:21+08:00" />
<meta itemprop="dateModified" content="2022-03-29T23:35:42+08:00" />
<meta itemprop="wordCount" content="11510">
<meta itemprop="keywords" content="FrontEnd,Project,money," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【项目 喵内记账 Meoney 04】Vue 全局数据管理"/>
<meta name="twitter:description" content="【项目-喵内记账-meoney-04】Vue 全局数据管理 大纲链接§ [toc] 知识点 代码 组件间数据同步/共享 全局数据管理/全局状态管理是啥 store 是啥 store 怎么"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          <div class="mobile-menu-parent">
            <span class="mobile-submenu-open"></span>
            <a href="http://xmasuhai.xyz/">
              docs
            </a>
          </div>
          <ul class="mobile-submenu-list">
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/syntax-highlighting/">Syntax Highlighting</a>
              </li>
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/mytest/">my Syntax Highlighting &amp; ShortCode Test</a>
              </li>
            
          </ul>
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          <a class="menu-item-link menu-parent" href="http://xmasuhai.xyz/">docs</a>
          <ul class="submenu">
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/syntax-highlighting/">Syntax Highlighting</a>
              </li>
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/mytest/">my Syntax Highlighting &amp; ShortCode Test</a>
              </li>
            
          </ul>

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【项目 喵内记账 Meoney 04】Vue 全局数据管理</h1>
      
      <div class="post-meta">
        <time datetime="2021-11-07" class="post-time">
          2021-11-07
        </time>
        <div class="post-category">
            <a href="http://xmasuhai.xyz/categories/frontend/"> FrontEnd </a>
            <a href="http://xmasuhai.xyz/categories/project/"> Project </a>
            <a href="http://xmasuhai.xyz/categories/money/"> money </a>
            
          </div>
        <span class="more-meta"> 约 11510 字 </span>
          <span class="more-meta"> 预计阅读 23 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#再次封装-recordlistmodelts">再次封装 <code>recordListModel.ts</code></a></li>
    <li><a href="#用-window-来容纳数据">用 window 来容纳数据</a></li>
    <li><a href="#用-window-来封装-api-1">用 window 来封装 API 1</a></li>
    <li><a href="#用-window-来封装-api-2">用 window 来封装 API 2</a></li>
    <li><a href="#消除对-window-的依赖">消除对 <code>window</code> 的依赖</a></li>
    <li><a href="#将-model-融合进-store">将 <code>model</code> 融合进 <code>store</code></a></li>
    <li><a href="#修改tagsvue-统一处理数据">修改<code>Tags.vue</code> 统一处理数据</a></li>
    <li><a href="#store-的-bug-之值与地址"><code>store</code> 的 <code>bug</code> 之值与地址</a></li>
    <li><a href="#小技巧可以把-store2-变成-thisstore2进行全局访问">小技巧：可以把 <code>store2</code> 变成 <code>this.$store2</code>进行全局访问</a></li>
    <li><a href="#全局状态管理的优点">全局状态管理的优点</a></li>
    <li><a href="#vuex-初体验---数据读写"><code>Vuex</code> 初体验 - 数据读写</a></li>
    <li><a href="#在-moneyvue-中使用-vuex">在 <code>Money.vue</code> 中使用 <code>Vuex</code></a>
      <ul>
        <li><a href="#重构moneyvue">重构<code>Money.vue</code></a></li>
        <li><a href="#重构-tagsvue-和-labelsvue">重构 <code>Tags.vue</code> 和 <code>Labels.vue</code></a></li>
      </ul>
    </li>
    <li><a href="#在-ts-里使用-mixin">在 TS 里使用 <code>mixin</code></a></li>
    <li><a href="#重构-editlabelvue">重构 <code>EditLabel.vue</code></a></li>
    <li><a href="#在-ts-里使用-computed-要用-getter-语法">在 TS 里使用 <code>computed</code> 要用 <code>getter</code> 语法</a></li>
    <li><a href="#继续重构-editlabelvue">继续重构 <code>EditLabel.vue</code></a></li>
    <li><a href="#vuex-小结">Vuex 小结</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="项目-喵内记账-meoney-04vue-全局数据管理">【项目-喵内记账-meoney-04】Vue 全局数据管理</h1>
<blockquote>
<p>大纲链接<!-- raw HTML omitted --> § <!-- raw HTML omitted --></p>
</blockquote>
<p>[toc]</p>
<hr>
<blockquote>
<p>知识点 <a href="%E6%89%80%E6%9C%89%E4%BB%A3%E7%A0%81%EF%BC%9Ahttps://github.com/FrankFang/morney-live-store-1">代码</a></p>
</blockquote>
<ul>
<li>组件间数据同步/共享</li>
<li>全局数据管理/全局状态管理是啥</li>
<li>store 是啥</li>
<li>store 怎么模块化</li>
<li>如何封装</li>
<li><a href="https://cn.vuejs.org/v2/guide/state-management.html#%E7%AE%80%E5%8D%95%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%B7%E6%AD%A5%E4%BD%BF%E7%94%A8">简单状态管理起步使用</a></li>
<li><a href="https://vuex.vuejs.org/zh/">Vuex</a></li>
</ul>
<blockquote>
<p>过程</p>
</blockquote>
<ul>
<li>再次封装 <code>recordListModel</code></li>
<li>用 window 来容纳数据</li>
<li>用 window 来封装 API</li>
<li>消除对 window 的依赖</li>
<li>将 model 融合进 store</li>
<li>修复 <code>Tags.vue</code> 的 bug</li>
<li>store 的 bug 之值与地址</li>
<li>小技巧：把 <code>store2</code> 变成 <code>this.$store2</code>（不用跟着做）</li>
<li>全局状态管理的优点</li>
<li>再次封装 <code>recordListModel</code></li>
</ul>
<blockquote>
<p>解决bug</p>
</blockquote>
<ul>
<li>标签组件和记账组件不共享标签数据
<ul>
<li>在记账组件中新增标签的数据不会同步到标签组件中</li>
<li>切换标签组件和记账组件时，新增标签的数据丢失</li>
</ul>
</li>
</ul>
<blockquote>
<p>Vuex 初体验 - 数据读写</p>
</blockquote>
<ul>
<li>在 Money.vue 中使用 Vuex</li>
<li>重构 Tags.vue 和 Labels.vue</li>
<li>在 TS 里使用 mixin（重新上传）</li>
<li>重构 EditLabel.vue</li>
<li>在 TS 里使用 computed 要用 getter 语法</li>
<li>继续重构 EditLabel.vue</li>
<li>Vuex 小结</li>
</ul>
<hr>
<blockquote>
<p>抽象一个克隆函数模块<code>src/lib/clone.ts</code></p>
</blockquote>
<ul>
<li><code>recordListModel.clone()</code>功能可复用</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kd">function</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">data</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">clone</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="再次封装-recordlistmodelts">再次封装 <code>recordListModel.ts</code></h2>
<ul>
<li>数据变量<code>data: [] as RecordItem[]</code></li>
<li>获取数据<code>fetchRecord() {... return this.data}</code></li>
<li>保存数据<code>saveRecord(){window.localStorage.setItem(localStorageKeyName, JSON.stringify(this.data));}</code></li>
<li>创建一个数据项目<code>createItem(record: RecordItem) {...}</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">clone</span> <span class="kr">from</span> <span class="s1">&#39;@/lib/clone&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">localStorageKeyName</span> <span class="o">=</span> <span class="s1">&#39;recordList&#39;</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">recordListModel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">[]</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">[],</span>
  <span class="nx">createItem</span><span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">clonedRecord</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
    <span class="nx">clonedRecord</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">clonedRecord</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">fetchRecord() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span>
        <span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">)</span> <span class="o">??</span> <span class="s1">&#39;[]&#39;</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">[];</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">saveRecord() {</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">,</span>
      <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">recordListModel</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>对应修改<code>Money.vue</code>的 API</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Layout</span> <span class="na">class</span><span class="nt">-prefix</span><span class="err">=&#34;</span><span class="na">layout</span><span class="err">&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Tags</span> <span class="nt">:data-source.sync</span><span class="s">=&#34;tags&#34;</span>
          <span class="nt">@update:selectedTags</span><span class="s">=&#34;pickTags&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">FormItem</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-item&#34;</span>
              <span class="na">field</span><span class="nt">-name</span><span class="err">=&#34;</span><span class="na">备注</span><span class="err">&#34;</span>
              <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;在这里输入备注&#34;</span>
              <span class="nt">@update:inputValue</span><span class="s">=&#34;onUpdateTips&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">Types</span> <span class="nt">:type.sync</span><span class="s">=&#34;record.type&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">Numpad</span> <span class="nt">:value.sync</span><span class="s">=&#34;record.amount&#34;</span>
            <span class="nt">@submit</span><span class="s">=&#34;saveRecord&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Layout</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Tags</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Tags.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">FormItem</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/FormItem.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Types</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Types.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Numpad</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Numpad.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">,</span> <span class="nx">Watch</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">recordListModel</span> <span class="nx">from</span> <span class="s1">&#39;@/models/recordListModel.ts&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagListModel</span> <span class="nx">from</span> <span class="s1">&#39;@/models/tagListModel&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Numpad</span><span class="p">,</span> <span class="nx">Types</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">,</span> <span class="nx">Tags</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Money</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
  <span class="nx">recordList</span> <span class="o">=</span> <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">fetchRecord</span><span class="p">();</span>
  <span class="nx">record</span><span class="o">:</span> <span class="nx">RecordItem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">tags</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">tips</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="nx">amount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">createdAt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
  <span class="p">};</span>

  <span class="nx">pickTags</span><span class="p">(</span><span class="nx">selectedTags</span><span class="o">:</span> <span class="nx">string</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">selectedTags</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onUpdateTips</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tips</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">saveRecord</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">createItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="nx">Watch</span><span class="p">(</span><span class="s1">&#39;recordList&#39;</span><span class="p">)</span>
  <span class="nx">onRecordeChange</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">saveRecord</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<blockquote>
<p>如何解决<code>Money.vue</code>中对于数据<code>tags</code>和<code>recordList</code>各自获取数据时重复调用相同功能的API，同样地，<code>Labels.vue</code>和<code>EditLabel.vue</code>中也如此</p>
<p>每次都<code>fetch</code>，就<code>clone</code>(<code>JSON.parse</code>)一次数据</p>
</blockquote>
<h2 id="用-window-来容纳数据">用 window 来容纳数据</h2>
<blockquote>
<p>在<code>Money.vue</code>、<code>Labels.vue</code>和<code>EditLabel.vue</code>的 入口层<code>main.ts</code>中，统管数据</p>
</blockquote>
<ul>
<li><code>window.tagList = tagListModel.fetch();</code> TS中未声明类型</li>
<li>在<code>custom.ts</code>中统一声明全局类型
<ul>
<li>将原本在<code>tagListModel.ts</code>中声明的类型一并移至<code>custom.d.ts</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><code>custom.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">type</span> <span class="nx">RecordItem</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tags</span>: <span class="kt">string</span><span class="p">[];</span>
  <span class="nx">tips</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="kr">type</span><span class="o">:</span> <span class="kt">string</span><span class="p">;</span>
  <span class="nx">amount</span>: <span class="kt">number</span><span class="p">;</span>
  <span class="nx">createdAt?</span>: <span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">type</span> <span class="nx">Tag</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">type</span> <span class="nx">TagListModel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">data</span>: <span class="kt">Tag</span><span class="p">[];</span>
  <span class="nx">fetch</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">Tag</span><span class="p">[];</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">save</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;not found&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">remove</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Window</span> <span class="p">{</span>
  <span class="nx">tagList</span>: <span class="kt">Tag</span><span class="p">[]</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>main.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">Vue</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="kr">from</span> <span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s1">&#39;./registerServiceWorker&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">router</span> <span class="kr">from</span> <span class="s1">&#39;./router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="kr">from</span> <span class="s1">&#39;./store&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Nav</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Nav.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Layout</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Layout.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Icon</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Icon.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/tagListModel.ts&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Nav&#39;</span><span class="p">,</span> <span class="nx">Nav</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Layout&#39;</span><span class="p">,</span> <span class="nx">Layout</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Icon&#39;</span><span class="p">,</span> <span class="nx">Icon</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">tagList</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span>
  <span class="nx">store</span><span class="p">,</span>
  <span class="nx">render</span>: <span class="kt">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>这样做的好处是，今后不管是属性还是值的类型写错，都可以得到TS报错的提示</li>
<li>TS的本质就是用类型去检查代码</li>
</ul>
<hr>
<h2 id="用-window-来封装-api-1">用 window 来封装 API 1</h2>
<ul>
<li><code>Money.vue</code>中<code>tags = window.tagList;</code>代替<code>tags = tagListModel.fetch();</code></li>
<li><code>Labels.vue</code>中<code>tags = window.tagList;</code>代替 <code>tagListModel.fetch();</code>  和 <code>tags = tagListModel.data;</code></li>
<li>读取<code>window.tagList</code></li>
<li>写入<code>tagListModel.create(name) {...}</code></li>
<li>统一读取和写入，符合最小知识原则</li>
<li>封装“增” <code>window.createTag = (name: string) =&gt; {...};</code></li>
<li>封装“改” <code>window.updateTag = (id: string, object: Exclude&lt;Tag, 'id'&gt;) =&gt; {...};</code></li>
<li>返回值和之前声明类型相同<code>updateTag: (id: string, name: string) =&gt; 'success' | 'not found' | 'duplicated';</code> 简写为<code>updateTag: TagListModel['update']</code></li>
<li>封装“查” <code>window.findTag = (id: string) =&gt; {...}</code></li>
</ul>
<blockquote>
<p><code>main.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">Vue</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">App</span> <span class="kr">from</span> <span class="s1">&#39;./App.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s1">&#39;./registerServiceWorker&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">router</span> <span class="kr">from</span> <span class="s1">&#39;./router&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="kr">from</span> <span class="s1">&#39;./store&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Nav</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Nav.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Layout</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Layout.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Icon</span> <span class="kr">from</span> <span class="s1">&#39;@/components/Icon.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/tagListModel.ts&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Nav&#39;</span><span class="p">,</span> <span class="nx">Nav</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Layout&#39;</span><span class="p">,</span> <span class="nx">Layout</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Icon&#39;</span><span class="p">,</span> <span class="nx">Icon</span><span class="p">);</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">tagList</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">findTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// return window.tagList.filter(t =&gt; t.id === id)[0] || undefined;
</span><span class="c1"></span>  <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">createTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名重复了&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;添加成功&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">removeTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">updateTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span>
  <span class="nx">store</span><span class="p">,</span>
  <span class="nx">render</span>: <span class="kt">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>custom.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">type</span> <span class="nx">RecordItem</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tags</span>: <span class="kt">string</span><span class="p">[];</span>
  <span class="nx">tips</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="kr">type</span><span class="o">:</span> <span class="kt">string</span><span class="p">;</span>
  <span class="nx">amount</span>: <span class="kt">number</span><span class="p">;</span>
  <span class="nx">createdAt?</span>: <span class="kt">Date</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">type</span> <span class="nx">Tag</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">id</span>: <span class="kt">string</span><span class="p">;</span>
  <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">type</span> <span class="nx">TagListModel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">data</span>: <span class="kt">Tag</span><span class="p">[];</span>
  <span class="nx">fetch</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">Tag</span><span class="p">[];</span>
  <span class="nx">create</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">save</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;not found&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">remove</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Window</span> <span class="p">{</span>
  <span class="nx">tagList</span>: <span class="kt">Tag</span><span class="p">[];</span>
  <span class="nx">findTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Tag</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">createTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">removeTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">;</span>
  <span class="nx">updateTag</span>: <span class="kt">TagListModel</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">];</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Labels.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Layout</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;labels&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tags&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="nt">v-for</span><span class="s">=&#34;tag in tags&#34; :key=&#34;tag.id&#34;&gt;
</span><span class="s">        &lt;router-link class=&#34;tag&#34; :to=&#34;`/labels/edit/${tag.id}`&#34;&gt;
</span><span class="s">          &lt;span class=&#34;tag-text&#34;&gt;{{ tag.name }}&lt;/span&gt;
</span><span class="s">          &lt;Icon class=&#34;tag-icon&#34; name=&#34;money_right&#34;/&gt;
</span><span class="s">        &lt;/router-link&gt;
</span><span class="s">      &lt;/li&gt;
</span><span class="s">    &lt;/ul&gt;
</span><span class="s">    &lt;div class=&#34;createTag-wrapper&#34;&gt;
</span><span class="s">      &lt;Button class=&#34;createTag&#34; @click.native=&#34;createTag&#34;&gt;新建标签&lt;/Button&gt;
</span><span class="s">    &lt;/div&gt;
</span><span class="s">  &lt;/Layout&gt;
</span><span class="s">&lt;/template&gt;
</span><span class="s">
</span><span class="s">&lt;script lang=&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="na">import</span> <span class="na">Vue</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="p">{</span><span class="na">Component</span><span class="p">}</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="nt">-property-decorator</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="na">Button</span> <span class="na">from</span> <span class="err">&#39;@/</span><span class="na">components</span><span class="err">/</span><span class="na">Button.vue</span><span class="err">&#39;;</span>

<span class="err">@</span><span class="na">Component</span><span class="err">(</span><span class="p">{</span>
  <span class="na">components</span><span class="o">:</span> <span class="p">{</span><span class="na">Button</span><span class="p">}</span>
<span class="p">}</span><span class="err">)</span>

<span class="na">export</span> <span class="na">default</span> <span class="na">class</span> <span class="na">Labels</span> <span class="na">extends</span> <span class="na">Vue</span> <span class="p">{</span>
  <span class="na">tags </span><span class="o">=</span> <span class="na">window.tagList</span><span class="err">;</span> <span class="err">//</span> <span class="err">[</span><span class="p">{</span><span class="na">id</span><span class="o">:</span> <span class="err">&#39;</span><span class="na">1</span><span class="err">&#39;,</span> <span class="na">name</span><span class="o">:</span> <span class="err">&#39;</span><span class="na">1</span><span class="err">&#39;</span><span class="p">}</span><span class="err">,</span> <span class="p">{</span><span class="na">id</span><span class="o">:</span> <span class="err">&#39;</span><span class="na">2</span><span class="err">&#39;,</span> <span class="na">name</span><span class="o">:</span> <span class="err">&#39;</span><span class="na">2</span><span class="err">&#39;</span><span class="p">}</span><span class="err">]</span>

  <span class="na">createTag</span><span class="err">()</span> <span class="p">{</span>
    <span class="na">const</span> <span class="na">name </span><span class="o">=</span> <span class="na">window.prompt</span><span class="err">(&#39;</span><span class="na">请输入标签名</span><span class="err">&#39;);</span>
    <span class="na">if</span> <span class="err">(</span><span class="na">name</span><span class="err">)</span> <span class="p">{</span>
      <span class="na">window.createTag</span><span class="err">(</span><span class="na">name</span><span class="err">);</span>
    <span class="p">}</span> <span class="na">else</span> <span class="p">{</span>
      <span class="na">window.alert</span><span class="err">(&#39;</span><span class="na">没有输入内容</span><span class="err">，</span><span class="na">请重新创建标签</span><span class="err">&#39;);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="na">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>EditLabel.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Layout</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;headerBar&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Icon</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;left-icon&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;money_right&#34;</span> <span class="nt">@click.native</span><span class="s">=&#34;goBack&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;title&#34;</span><span class="p">&gt;</span><span class="nx">编辑标签</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">FormItem</span> <span class="nt">:inputValue</span><span class="s">=&#34;tag.name&#34;</span>
              <span class="nt">@update:inputValue</span><span class="s">=&#34;update&#34;</span>
              <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-item&#34;</span> <span class="na">field</span><span class="nt">-name</span><span class="err">=&#34;</span><span class="na">标签名</span><span class="err">&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;在这里输入标签名&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;button-wrapper&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Button</span> <span class="nt">@click</span><span class="s">=&#34;remove&#34;</span><span class="p">&gt;</span><span class="na">删除标签</span><span class="p">&lt;/</span><span class="nt">Button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Layout</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">FormItem</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/FormItem.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Button</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Button.vue&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">EditLabel</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">tag</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">findTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">update</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">updateTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">remove</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="sb">`成功删除标签：</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">goBack</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="用-window-来封装-api-2">用 window 来封装 API 2</h2>
<blockquote>
<p>同样思路重构<code>main.ts</code> <code>Money.vue</code> <code>recordListModel.ts</code> <code>custom.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="c1">// import ...
</span><span class="c1"></span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Nav&#39;</span><span class="p">,</span> <span class="nx">Nav</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Layout&#39;</span><span class="p">,</span> <span class="nx">Layout</span><span class="p">);</span>
<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;Icon&#39;</span><span class="p">,</span> <span class="nx">Icon</span><span class="p">);</span>

<span class="c1">// record store
</span><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">recordList</span> <span class="o">=</span> <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">fetchRecord</span><span class="p">();</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">createRecord</span> <span class="o">=</span> <span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">createItem</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// tag store
</span><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">tagList</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">findTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{...};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">createTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{...};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">removeTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{...};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">updateTag</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{...};</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span>
  <span class="nx">store</span><span class="p">,</span>
  <span class="nx">render</span>: <span class="kt">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><hr>
<blockquote>
<p>缺点</p>
</blockquote>
<ul>
<li>全局变量太多，变量可能互相覆盖</li>
<li>对 window 的依赖</li>
</ul>
<h2 id="消除对-window-的依赖">消除对 <code>window</code> 的依赖</h2>
<ul>
<li>将变量方法都挂在<code>window.store</code>上</li>
<li>在<code>custom.d.ts</code>中声明<code>window.store</code>类型</li>
</ul>
<blockquote>
<p><code>custom.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kr">interface</span> <span class="nx">Window</span> <span class="p">{</span>
  <span class="nx">store</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tagList</span>: <span class="kt">Tag</span><span class="p">[];</span>
    <span class="nx">findTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Tag</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nx">createTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
    <span class="nx">removeTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">;</span>
    <span class="nx">updateTag</span>: <span class="kt">TagListModel</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">];</span>
    <span class="nx">recordList</span>: <span class="kt">RecordItem</span><span class="p">[];</span>
    <span class="nx">createRecord</span><span class="o">:</span> <span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>main.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="p">...</span>
<span class="p">...</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// record store
</span><span class="c1"></span>  <span class="nx">recordList</span>: <span class="kt">recordListModel.fetchRecord</span><span class="p">(),</span>
  <span class="nx">createRecord</span><span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="p">{...},</span>
  <span class="c1">// tag store
</span><span class="c1"></span>  <span class="nx">tagList</span>: <span class="kt">tagListModel.fetch</span><span class="p">(),</span>
  <span class="nx">findTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{...},</span>
  <span class="nx">createTag</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{...},</span>
  <span class="nx">removeTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{...},</span>
  <span class="nx">updateTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{...},</span>
<span class="p">};</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="nx">router</span><span class="p">,</span>
  <span class="nx">store</span><span class="p">,</span>
  <span class="nx">render</span>: <span class="kt">h</span> <span class="o">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">$mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意改掉箭头函数和<code>this</code>指向</li>
</ul>
<blockquote>
<p>解决依赖 window 将变量挂在<code>src/store/index2.ts</code>上</p>
</blockquote>
<ul>
<li>将整个<code>store2</code>对象放到<code>index2.ts</code>里导出</li>
<li>可同一处引用数据</li>
<li>TS自动推测<code>store2</code>类型</li>
</ul>
<blockquote>
<p><code>src/store/index2.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">recordListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/recordListModel&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/tagListModel&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">store2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// record store
</span><span class="c1"></span>  <span class="nx">recordList</span>: <span class="kt">recordListModel.fetchRecord</span><span class="p">(),</span>
  <span class="nx">createRecord</span><span class="o">:</span> <span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">createItem</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="c1">// tag store
</span><span class="c1"></span>  <span class="nx">tagList</span>: <span class="kt">tagListModel.fetch</span><span class="p">(),</span>
  <span class="nx">findTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">createTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名重复了&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;添加成功&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">removeTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">updateTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">store2</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>重构<code>Money.vue</code>、<code>Labels.vue</code>和<code>EditLabel.vue</code>对应的方法</p>
</blockquote>
<ul>
<li>将<code>window.</code>相关自定义方法改为<code>store2.</code></li>
</ul>
<blockquote>
<p><code>Money.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="c1">// import ...;
</span><span class="c1">// import store2 from &#39;@/store/index2&#39;;
</span><span class="c1"></span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Numpad</span><span class="p">,</span> <span class="nx">Types</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">,</span> <span class="nx">Tags</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Money</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">store2</span><span class="p">.</span><span class="nx">tagList</span><span class="p">;</span>
  <span class="nx">recordList</span> <span class="o">=</span> <span class="nx">store2</span><span class="p">.</span><span class="nx">recordList</span><span class="p">;</span>
  <span class="nx">record</span>: <span class="kt">RecordItem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">tags</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">tips</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="kr">type</span><span class="o">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="nx">amount</span>: <span class="kt">0</span><span class="p">,</span>
    <span class="nx">createdAt</span>: <span class="kt">new</span> <span class="nb">Date</span><span class="p">(),</span>
  <span class="p">};</span>

  <span class="nx">pickTags</span><span class="p">(</span><span class="nx">selectedTags</span>: <span class="kt">string</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">selectedTags</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">onUpdateTips</span><span class="p">(</span><span class="nx">value</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tips</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">saveRecord() {</span>
    <span class="nx">store2</span><span class="p">.</span><span class="nx">createRecord</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Labels.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="c1">// import ...;
</span><span class="c1"></span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Labels</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">store2</span><span class="p">.</span><span class="nx">tagList</span><span class="p">;</span> 
  <span class="nx">createTag() {</span>
    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;请输入标签名&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">store2</span><span class="p">.</span><span class="nx">createTag</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;没有输入内容，请重新创建标签&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>EditLabel.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="c1">// import...;
</span><span class="c1"></span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">EditLabel</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">tag</span> <span class="o">=</span> <span class="nx">store2</span><span class="p">.</span><span class="nx">findTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

  <span class="nx">created() {</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">update</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">store2</span><span class="p">.</span><span class="nx">updateTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">remove() {</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">store2</span><span class="p">.</span><span class="nx">removeTag</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="sb">`成功删除标签：</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">goBack() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>拆分<code>src/store/index2.ts</code>中的<code>store2</code>为<code>recordStore.ts</code>和<code>tagListStore.ts</code></p>
</blockquote>
<ul>
<li><code>...</code>扩展原算符 浅拷贝<code>...recordStore,</code></li>
<li>注意合并话的同名屏蔽问题，重构重命名</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">recordStore</span> <span class="kr">from</span> <span class="s1">&#39;@/store/recordStore.ts&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagStore</span> <span class="kr">from</span> <span class="s1">&#39;@/store/tagStore.ts&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">store2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">recordStore</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">tagStore</span><span class="p">,</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">store2</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>recordStore.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">recordListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/recordListModel.ts&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">recordList</span>: <span class="kt">recordListModel.fetchRecord</span><span class="p">(),</span>
  <span class="nx">createRecord</span><span class="o">:</span> <span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">recordListModel</span><span class="p">.</span><span class="nx">createItem</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>tagListStore.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">tagListModel</span> <span class="kr">from</span> <span class="s1">&#39;@/models/tagListModel.ts&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">tagList</span>: <span class="kt">tagListModel.fetch</span><span class="p">(),</span>
  <span class="nx">findTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">createTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名重复了&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span> <span class="o">===</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;添加成功&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">removeTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">updateTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">tagListModel</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">};</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>声明<code>tagListModel</code>类型 <code>custom.d.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kr">type</span> <span class="nx">TagListModel</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tagList</span>: <span class="kt">Tag</span><span class="p">[];</span>
  <span class="nx">fetchTags</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">Tag</span><span class="p">[];</span>
  <span class="nx">findTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Tag</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="nx">createTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">saveTags</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">updateTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="s1">&#39;success&#39;</span> <span class="o">|</span> <span class="s1">&#39;not found&#39;</span> <span class="o">|</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
  <span class="nx">removeTag</span><span class="o">:</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">boolean</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>import store2...</code>两次是同一个<code>store2</code>吗？</p>
</blockquote>
<ul>
<li>可尝试<code>import</code>两次<code>store</code> 测试<code>console.log(store === store2)</code>，结果为<code>true</code></li>
</ul>
<blockquote>
<p>那<code>import</code>中的代码执行了几次</p>
</blockquote>
<ul>
<li>在<code>index2.ts</code>测试<code>console.log(&quot;index2 执行了一次&quot;)</code>，查看控制台打印的次数</li>
<li>结果为只执行一次</li>
<li>即<code>import</code>多处的代码只执行一次</li>
</ul>
<hr>
<h2 id="将-model-融合进-store">将 <code>model</code> 融合进 <code>store</code></h2>
<blockquote>
<p><code>model</code>和<code>store</code>功能重合</p>
</blockquote>
<ul>
<li><code>store</code>多了没必要的中转，比如<code>createRecord: (record: RecordItem) =&gt; { recordListModel.createItem(record); }</code></li>
<li><code>model</code>合并到<code>store</code></li>
</ul>
<blockquote>
<p><code>recordStore.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">clone</span> <span class="kr">from</span> <span class="s1">&#39;@/lib/clone&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">localStorageKeyName</span> <span class="o">=</span> <span class="s1">&#39;recordList&#39;</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">data</span>: <span class="kt">RecordItem</span><span class="p">[]</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">recordStore</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">recordList</span>: <span class="kt">data</span><span class="p">,</span>
  <span class="nx">fetchRecords() {</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">)</span> <span class="o">??</span> <span class="s1">&#39;[]&#39;</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">[];</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">saveRecords() {</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="nx">createRecord</span><span class="o">:</span> <span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">clonedRecord</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
    <span class="nx">clonedRecord</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="nx">data</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">clonedRecord</span><span class="p">);</span>
    <span class="nx">recordStore</span><span class="p">.</span><span class="nx">saveRecords</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">recordStore</span><span class="p">.</span><span class="nx">fetchRecords</span><span class="p">();</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">recordStore</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>判断是否存在<code>data &amp;&amp; data.push(clonedRecord);</code>改为新语法：可选链<code>data?.push(clonedRecord);</code></li>
<li>在默认导出的匿名对象中<code>export default </code>不可用<code>this.***()</code>比如<code>this.saveRecord()</code> 在定义对象的过程中立即来使用该对象</li>
<li>需改为具名对象，然后导出改对象</li>
<li>在对象外部指向对象的方法，初始化<code>recordStore.fetchRecord();</code></li>
<li><code>let data: RecordItem[] | undefined = undefined;</code>在<code>recordStore</code>内使用了闭包：函数使用了外部变量</li>
<li>可以消除闭包，直接内部定义<code>recordList: [] as RecordItem[],</code>，不用箭头函数</li>
</ul>
<blockquote>
<p><code>recordStore.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">clone</span> <span class="kr">from</span> <span class="s1">&#39;@/lib/clone&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">localStorageKeyName</span> <span class="o">=</span> <span class="s1">&#39;recordList&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">recordStore</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">recordList</span><span class="o">:</span> <span class="p">[]</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">[],</span>
  <span class="nx">fetchRecords() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">recordList</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">)</span> <span class="o">??</span> <span class="s1">&#39;[]&#39;</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">RecordItem</span><span class="p">[];</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">recordList</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">saveRecords() {</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">recordList</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="nx">createRecord</span><span class="p">(</span><span class="nx">record</span>: <span class="kt">RecordItem</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">clonedRecord</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">(</span><span class="nx">record</span><span class="p">);</span>
    <span class="nx">clonedRecord</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">recordList</span><span class="o">?</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">clonedRecord</span><span class="p">);</span>
    <span class="nx">recordStore</span><span class="p">.</span><span class="nx">saveRecords</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">recordStore</span><span class="p">.</span><span class="nx">fetchRecords</span><span class="p">();</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">recordStore</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>tagListStore.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">createId</span> <span class="kr">from</span> <span class="s1">&#39;@/lib/createId&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">localStorageKeyName</span> <span class="o">=</span> <span class="s1">&#39;recordList&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">tagStore</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tagList</span><span class="o">:</span> <span class="p">[]</span> <span class="kr">as</span> <span class="nx">Tag</span><span class="p">[],</span>
  <span class="nx">findTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">saveTags() {</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKeyName</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="nx">createTag</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">names</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">d</span> <span class="o">=&gt;</span> <span class="nx">d</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">names</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名重复了&#39;</span><span class="p">);</span>
      <span class="k">return</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">createId</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">saveTags</span><span class="p">();</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;添加成功&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">removeTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">saveTags</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">updateTag</span><span class="p">(</span><span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">idList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">idList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">nameList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nameList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;duplicated&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">tag</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">saveTags</span><span class="p">();</span>
        <span class="k">return</span> <span class="s1">&#39;success&#39;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;not found&#39;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">tagStore</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>在定义变量时无法调用正在定义的方法</li>
<li>需在对象外部调用方法</li>
<li>对象的方法可调用对象内部的方法</li>
</ul>
<blockquote>
<p>可以删除<code>src/model</code>，直接用<code>src/store</code>代替</p>
</blockquote>
<hr>
<h2 id="修改tagsvue-统一处理数据">修改<code>Tags.vue</code> 统一处理数据</h2>
<ul>
<li><code>Tags.vue</code>中<code>this.$emit('update:dataSource', [...this.dataSource, name];</code>的<code>name</code>产生的<code>bug</code></li>
<li><code>this.dataSource</code>，即子组件传递事件所必要的外部数据<code>@Prop({required: true}) readonly dataSource!: string[];</code></li>
<li>来自父组件<code>Money.vue</code>中<code>:data-source.sync=&quot;tags&quot;</code></li>
<li><code>Tags.vue</code>新传来的数据<code>[...this.dataSource, name];</code>不能赋值给原来的<code>tags</code></li>
<li>因为<code>tags = store2.tagList;</code> 传的数据不够精确，不是更新整个数组，而是更新<code>name</code>这一项</li>
</ul>
<blockquote>
<p>修改<code>Tag.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tags&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;current&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="nt">v-for</span><span class="s">=&#34;tag in tagList&#34;
</span><span class="s">          :key=&#34;tag.id&#34;
</span><span class="s">          @click=&#34;toggle(tag)&#34;
</span><span class="s">          :class=&#34;{selected: selectedTags.indexOf(tag)&gt;=0 }&#34;&gt;
</span><span class="s">        {{ tag.name }}
</span><span class="s">      &lt;/li&gt;
</span><span class="s">    &lt;/ul&gt;
</span><span class="s">    &lt;div class=&#34;new&#34;&gt;
</span><span class="s">      &lt;button @click=&#34;createTag&#34;&gt;添加新标签&lt;/button&gt;
</span><span class="s">    &lt;/div&gt;
</span><span class="s">  &lt;/div&gt;
</span><span class="s">&lt;/template&gt;
</span><span class="s">&lt;script lang=&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="na">import</span> <span class="na">Vue</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="p">{</span><span class="na">Component</span><span class="p">}</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="nt">-property-decorator</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="na">store2</span> <span class="na">from</span> <span class="err">&#39;@/</span><span class="na">store</span><span class="err">/</span><span class="na">index2</span><span class="err">&#39;;</span>

<span class="err">@</span><span class="na">Component</span>
<span class="na">export</span> <span class="na">default</span> <span class="na">class</span> <span class="na">Tags</span> <span class="na">extends</span> <span class="na">Vue</span> <span class="p">{</span>
  <span class="na">tagList </span><span class="o">=</span> <span class="na">store2.fetchTags</span><span class="err">();</span> <span class="err">//</span> <span class="na">Tag</span><span class="err">[]</span>
  <span class="na">selectedTags</span><span class="o">:</span> <span class="na">string</span><span class="err">[]</span> <span class="err">=</span> <span class="err">[];</span>

  <span class="na">toggle</span><span class="err">(</span><span class="na">tag</span><span class="o">:</span> <span class="na">Tag</span><span class="err">)</span> <span class="p">{</span>
    <span class="na">const</span> <span class="na">index </span><span class="o">=</span> <span class="na">this.selectedTags.map</span><span class="err">(</span><span class="na">tag </span><span class="o">=</span><span class="p">&gt;</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;update:selectedTags&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">createTag</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;请输入标签名&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空&#39;</span><span class="p">);}</span>
    <span class="nx">store2</span><span class="p">.</span><span class="nx">createTag</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>将<code>Tag.vue</code>组件中的<code>this.dataSource</code>通知给父组件的事件改为直接操作<code>store2.ts</code>，使用<code>store2.createTag(name);</code></li>
<li>把用户输入的<code>name</code>传给<code>store2.ts</code>，做到全局管理数据</li>
<li>无需<code>@Prop({required: true}) readonly dataSource!: string[];</code></li>
<li>而使用<code>tagList = store2.fetchTags();</code></li>
<li>原来所有的<code>dataSource</code>改为<code>tagList</code>
<ul>
<li>比如<code>&lt;li v-for=&quot;tag in tagList&quot; :key=&quot;tag.id&quot; @click=&quot;toggle(tag)&quot; :class=&quot;{selected: selectedTags.indexOf(tag) &gt;= 0}&quot;&gt; {{ tag.name }}&lt;/li&gt;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>而在<code>Money.vue</code>中自己到全局<code>store2.ts</code>里取数据</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tags&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;current&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="nt">v-for</span><span class="s">=&#34;tag in tagList&#34;
</span><span class="s">          :key=&#34;tag.id&#34;
</span><span class="s">          @click=&#34;toggle(tag)&#34;
</span><span class="s">          :class=&#34;{selected: selectedTags.indexOf(tag)&gt;=0 }&#34;&gt;
</span><span class="s">        {{ tag.name }}
</span><span class="s">      &lt;/li&gt;
</span><span class="s">    &lt;/ul&gt;
</span><span class="s">    &lt;div class=&#34;new&#34;&gt;
</span><span class="s">      &lt;button @click=&#34;createTag&#34;&gt;添加新标签&lt;/button&gt;
</span><span class="s">    &lt;/div&gt;
</span><span class="s">  &lt;/div&gt;
</span><span class="s">&lt;/template&gt;
</span><span class="s">&lt;script lang=&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="na">import</span> <span class="na">Vue</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="p">{</span><span class="na">Component</span><span class="p">}</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="nt">-property-decorator</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="na">store2</span> <span class="na">from</span> <span class="err">&#39;@/</span><span class="na">store</span><span class="err">/</span><span class="na">index2</span><span class="err">&#39;;</span>

<span class="err">@</span><span class="na">Component</span>
<span class="na">export</span> <span class="na">default</span> <span class="na">class</span> <span class="na">Tags</span> <span class="na">extends</span> <span class="na">Vue</span> <span class="p">{</span>
  <span class="na">tagList </span><span class="o">=</span> <span class="na">store2.fetchTags</span><span class="err">();</span> <span class="err">//</span> <span class="na">Tag</span><span class="err">[]</span>
  <span class="na">selectedTags</span><span class="o">:</span> <span class="na">string</span><span class="err">[]</span> <span class="err">=</span> <span class="err">[];</span>

  <span class="na">toggle</span><span class="err">(</span><span class="na">tag</span><span class="o">:</span> <span class="na">Tag</span><span class="err">)</span> <span class="p">{</span>
    <span class="na">const</span> <span class="na">index </span><span class="o">=</span> <span class="na">this.selectedTags.map</span><span class="err">(</span><span class="na">tag </span><span class="o">=</span><span class="p">&gt;</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;update:selectedTags&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">createTag</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;请输入标签名&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空&#39;</span><span class="p">);}</span>
    <span class="nx">store2</span><span class="p">.</span><span class="nx">createTag</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>&lt;Tags @update:selectedTags=&quot;pickTags&quot;/&gt;</code>无需再绑定<code>:data-source=&quot;tags&quot;</code></li>
<li>因此无需数据<code>tags = store2.tagList;</code></li>
<li>而在<code>Tags.vue</code>中让<code>tagList = store2.fetchTags(); </code>自己获取数据</li>
</ul>
<blockquote>
<p>数据无需一层一层传递，统一集中处理<code>tagStore.ts</code>中的数据</p>
</blockquote>
<hr>
<h2 id="store-的-bug-之值与地址"><code>store</code> 的 <code>bug</code> 之值与地址</h2>
<ul>
<li>原始值类型与引用类型的地址</li>
<li>引用类型变化，个引用其地址的变量也变化</li>
<li>原始值类型赋值的变量，值改变不会影响（同步到）改变量</li>
<li>用<code>data</code>获取数据<code>store</code>只会获取一遍</li>
</ul>
<blockquote>
<p>改为使用<code>computed</code></p>
</blockquote>
<ul>
<li>同时将声明变量为内部数据，挂在<code>App.vue</code>的<code>data</code>函数上，给<code>vue</code>监听到</li>
<li>可以将值和引用类型的变量都放到<code>computed</code>里<code>getter</code>和<code>setter</code></li>
<li>自定义的<code>store2.ts</code>并没有在一开始就被<code>vue</code>监听到</li>
<li>而使用<code>Vuex</code>即<code>src/store/index.ts</code>则可以被<code>vue</code>监听到</li>
</ul>
<hr>
<h2 id="小技巧可以把-store2-变成-thisstore2进行全局访问">小技巧：可以把 <code>store2</code> 变成 <code>this.$store2</code>进行全局访问</h2>
<ul>
<li>在<code>main.ts</code>中引入<code>store2</code>: <code>import store2 from '@/store/index2.ts'</code></li>
<li>放到<code>Vue</code>的原型上<code>Vue.prototype.$store2 = store2</code></li>
<li>在<code>shims-vue.d.ts</code>中声明接口类型<code>interface Vue {$store: any;}</code></li>
<li><a href="https://cn.vuejs.org/v2/guide/typescript.html#%E5%A2%9E%E5%BC%BA%E7%B1%BB%E5%9E%8B%E4%BB%A5%E9%85%8D%E5%90%88%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8"><code>TypeScript</code>增强类型以配合插件使用</a></li>
<li>在<code>custom.d.ts</code>中声明模块<code>declare module 'vue/types/vue' {interface Vue {$store2: any;}}</code></li>
<li>可以全局使用<code>this.$store</code></li>
<li>将<code>custom.d.ts</code>中的类型声明（比如<code>type RecordItem</code>）之外的其他（<code>store2</code>）拆分到<code>global.d.ts</code></li>
<li><code>Vuex</code>就使用了该技巧<code>Vue.use(Vuex);</code></li>
</ul>
<hr>
<h2 id="全局状态管理的优点">全局状态管理的优点</h2>
<blockquote>
<p>全局状态管理（也叫全局数据管理）的好处是什么？</p>
</blockquote>
<ul>
<li>解耦：将所有数据相关的逻辑放入 store（也就是 MVC 中的 Model，换了个名字而已）</li>
<li>数据读写更方便：任何组件不管在哪里，都可以直接读写数据</li>
<li>控制力更强：组件对数据的读写只能使用 store 提供的 API 进行（当然也不排除有猪队友直接对 tagList 和 recordList 进行 push 等操作，这是没有办法禁止的）</li>
</ul>
<blockquote>
<p>Vuex 跟我们手写的 store 没有本质区别。</p>
</blockquote>
<hr>
<h2 id="vuex-初体验---数据读写"><code>Vuex</code> 初体验 - 数据读写</h2>
<ul>
<li><a href="https://vuex.vuejs.org/zh/">Vuex</a> 是一个专为 Vue.js 应用程序开发的状态管理模式</li>
<li>多个组件共享状态时，单向数据流的简洁性很容易被破坏</li>
<li>多个视图依赖于同一状态</li>
<li>来自不同视图的行为需要变更同一状态</li>
<li><code>Vuex</code>就是一个用于管理数据的工具（对象），提供了读/写（增删改查）数据的<code>API</code></li>
</ul>
<blockquote>
<p>核心概念</p>
</blockquote>
<ul>
<li><code>State</code> 对应<code>data</code>，用于存放数据</li>
<li><code>Getters</code></li>
<li><strong><code>Mutations</code></strong> 对应<code>methods</code>，意为改动、变更，用于写数据，调用同步方法，实时更改数据</li>
<li><code>Actions</code>对应 调用<code>methods</code>，必须用于异步操作，调用<code>Mutations</code>的方法</li>
<li><code>Modules</code> 对应<code>components</code> 将 <code>store</code> 分割成模块<code>module</code>，每个模块拥有自己的 <code>state</code>、<code>mutation</code>、<code>action</code>、<code>getter</code>、<code>module</code></li>
</ul>
<blockquote>
<p>在 <code>Money.vue</code> 中目前主要使用 <code>Vuex</code>的<code>State</code> 和 <code>Mutations</code></p>
</blockquote>
<hr>
<h2 id="在-moneyvue-中使用-vuex">在 <code>Money.vue</code> 中使用 <code>Vuex</code></h2>
<ul>
<li>使用<code>vue/cli</code>项目初始化时已选</li>
<li>操作<code>src/store/index.ts</code></li>
</ul>
<blockquote>
<p><code>state</code>属性</p>
</blockquote>
<ul>
<li>单一状态树：树型结构数据的对象</li>
<li>唯一数据源</li>
<li>处处使用数据</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">Vue</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Vuex</span> <span class="kr">from</span> <span class="s1">&#39;vuex&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">count</span>: <span class="kt">0</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">mutations</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">actions</span><span class="o">:</span> <span class="p">{},</span>
  <span class="kr">module</span><span class="nx">s</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">store</span><span class="p">;</span>

<span class="c1">// console.log(store.state.count);
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>可以全局使用<code>store.state.count</code></li>
<li><code>main.ts</code>引用了<code>src/store/index.ts</code></li>
<li><code>state</code>中不必写方法返回一个值，和<code>data</code>的用法不同</li>
<li>注意<code>store</code>不是<code>{state:{...}, mutations: {...}}</code>选项，而是由这个选项构造出的对象，拷贝了所有选项的属性</li>
</ul>
<blockquote>
<p><code>mutations</code>属性</p>
</blockquote>
<ul>
<li>其中的方法不传改对象本身为<code>this</code></li>
<li>而将<code>state</code>作为第一个形参<code>this</code>传给方法，显式地传递</li>
<li>在方法中使用数据直接访问<code>state.***</code></li>
<li>在调用方法时，使用 <strong><code>store.commit('xxx')</code></strong>，以字符串方式将变更的方法名 提交一个操作，并自动传之前定义时传入的<code>state</code>给方法</li>
<li>给<code>mutations</code>中的方法传第二个参数以及之后传的参数
<ul>
<li>在 TS 中需声明之后传参的类型</li>
<li><code>store.commit(type, [payload...]);</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">Vue</span> <span class="kr">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Vuex</span> <span class="kr">from</span> <span class="s1">&#39;vuex&#39;</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">Vuex</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">count</span>: <span class="kt">0</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">mutations</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">increaseCount</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">increaseN</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+=</span> <span class="nx">n</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="nx">actions</span><span class="o">:</span> <span class="p">{},</span>
  <span class="kr">module</span><span class="nx">s</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">store</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="c1">// 0
</span><span class="c1"></span><span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;increaseCount&#39;</span><span class="p">);</span> <span class="c1">// +1 操作
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="c1">// 1
</span><span class="c1"></span><span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;increaseN&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// +10 操作
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span> <span class="c1">// 11
</span><span class="c1"></span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>使用<code>computed: {}</code></p>
</blockquote>
<ul>
<li>不使用只在初始化创建时使用一次的<code>data</code>，不会自动计算属性的变化，无法更新 UI</li>
<li>TS 在装饰器中使用<code>@Compnent({ components: {...}, computed: {...})</code></li>
<li>在<code>template</code>中无法直接访问<code>store</code></li>
<li>需要<code>methods</code>中的方法执行<code>store.commit('increaseCount');</code>作为中转</li>
<li>或者使用<code>$store</code>（<code>template</code>中），方法中使用<code>this.$store</code>
<ul>
<li>原理是<code>Vue.use(Vuex);</code>在<code>Vue.prototype</code>(原型)，把<code>store</code>绑定到共用属性上 <code>Vue.prototype.$store = userStore</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="nx">count</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">count</span> <span class="p">}}</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="nt">@click</span><span class="s">=&#34;add&#34;</span><span class="p">&gt;</span><span class="err">+</span><span class="na">1</span> <span class="err">+</span><span class="na">5</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;$store.commit(&#39;increaseN&#39;, -10)&#34;</span><span class="p">&gt;</span>
      <span class="nx">使用$store</span><span class="err">：</span> <span class="p">{{</span><span class="nx">count</span><span class="p">}}</span> <span class="o">-</span> <span class="mi">10</span>
    <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="nx">dataCount不变</span><span class="o">:</span> <span class="p">{{</span> <span class="nx">dataCount</span> <span class="p">}}</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span>
<span class="kr">import</span> <span class="nx">store</span> <span class="nx">from</span> <span class="s1">&#39;@/store/index.ts&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{...},</span>
  <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">count</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Money</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">dataCount</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
  <span class="p">...</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 对应 import store from &#39;@/store/index.ts&#39;;
</span><span class="c1"></span>    <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;increaseCount&#39;</span><span class="p">);</span> <span class="c1">// +1
</span><span class="c1"></span>    
    <span class="c1">// 对应 `Vue.use(Vuex);`
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;increaseN&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// +5
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>读数据 <strong><code>@Component({..., computed: {xxx() {return ...}, ...}, ...</code></strong> 计算属性</li>
<li>写数据
<ul>
<li>全局使用：<code>@eventName=&quot;$store.commit(...)&quot;</code>/ <strong><code>this.$store.xxx</code></strong></li>
<li>局部使用：引用<code>store</code>来使用<code>import store from '@/store/index.ts';</code></li>
</ul>
</li>
<li>注意<code>mutations</code>中的方法可以调用其中的其他方法<code>fn1() {store.commit('fn2');}</code>
<ul>
<li><code>store</code>代替了<code>this</code></li>
</ul>
</li>
</ul>
<hr>
<h3 id="重构moneyvue">重构<code>Money.vue</code></h3>
<blockquote>
<p>将数据分模块写入<code>index.ts</code>，替换所有<code>store2.ts</code>的代码</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Layout</span> <span class="na">class</span><span class="nt">-prefix</span><span class="err">=&#34;</span><span class="na">layout</span><span class="err">&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">Tags</span> <span class="nt">@update:selectedTags</span><span class="s">=&#34;pickTags&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">FormItem</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-item&#34;</span> <span class="na">field</span><span class="nt">-name</span><span class="err">=&#34;</span><span class="na">备注</span><span class="err">&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;在这里输入备注&#34;</span>
              <span class="nt">@update:inputValue</span><span class="s">=&#34;onUpdateTips&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">Types</span> <span class="nt">:type.sync</span><span class="s">=&#34;record.type&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">Numpad</span> <span class="nt">:value.sync</span><span class="s">=&#34;record.amount&#34;</span>
            <span class="nt">@submit</span><span class="s">=&#34;saveRecord&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">Layout</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Tags</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Tags.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">FormItem</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/FormItem.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Types</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Types.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Numpad</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Money/Numpad.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Numpad</span><span class="p">,</span> <span class="nx">Types</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">,</span> <span class="nx">Tags</span><span class="p">},</span>
  <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">recordList</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">recordList</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Money</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">record</span><span class="o">:</span> <span class="nx">RecordItem</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">tags</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">tips</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="nx">amount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">createdAt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
  <span class="p">};</span>

  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;fetchRecords&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">onUpdateTips</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tips</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">pickTags</span><span class="p">(</span><span class="nx">selectedTags</span><span class="o">:</span> <span class="nx">string</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">selectedTags</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">saveRecord</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;createRecord&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">record</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>模块的局部状态:对于模块内部的 <code>mutation</code> 和 <code>getter</code>，接收的第一个参数是  <code>state</code> <strong>模块的局部状态对象</strong></li>
</ul>
<hr>
<h3 id="重构-tagsvue-和-labelsvue">重构 <code>Tags.vue</code> 和 <code>Labels.vue</code></h3>
<blockquote>
<p><code>Tags.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tags&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;current&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="nt">v-for</span><span class="s">=&#34;tag in tagList&#34;
</span><span class="s">          :key=&#34;tag.id&#34;
</span><span class="s">          @click=&#34;toggle(tag)&#34;
</span><span class="s">          :class=&#34;{selected: selectedTags.indexOf(tag)&gt;=0 }&#34;&gt;
</span><span class="s">        {{ tag.name }}
</span><span class="s">      &lt;/li&gt;
</span><span class="s">    &lt;/ul&gt;
</span><span class="s">    &lt;div class=&#34;new&#34;&gt;
</span><span class="s">      &lt;button @click=&#34;createTag&#34;&gt;添加新标签&lt;/button&gt;
</span><span class="s">    &lt;/div&gt;
</span><span class="s">  &lt;/div&gt;
</span><span class="s">&lt;/template&gt;
</span><span class="s">&lt;script lang=&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="na">import</span> <span class="na">Vue</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="p">{</span><span class="na">Component</span><span class="p">}</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="nt">-property-decorator</span><span class="err">&#39;;</span>

<span class="err">@</span><span class="na">Component</span><span class="err">(</span><span class="p">{</span>
  <span class="na">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="na">tagList</span><span class="err">()</span> <span class="p">{</span>
      <span class="na">return</span> <span class="na">this.</span><span class="err">$</span><span class="na">store.state.tagList</span><span class="err">;</span>
    <span class="p">}</span><span class="err">,</span>
  <span class="p">}</span>
<span class="p">}</span><span class="err">)</span>

<span class="na">export</span> <span class="na">default</span> <span class="na">class</span> <span class="na">Tags</span> <span class="na">extends</span> <span class="na">mixins</span><span class="err">(</span><span class="na">tagHelper</span><span class="err">)</span> <span class="p">{</span>
  <span class="na">selectedTags</span><span class="o">:</span> <span class="na">Tag</span><span class="err">[]</span> <span class="err">=</span> <span class="err">[];</span>

  <span class="na">created</span><span class="err">()</span> <span class="p">{</span>
    <span class="na">this.</span><span class="err">$</span><span class="na">store.commit</span><span class="err">(&#39;</span><span class="na">fetchTags</span><span class="err">&#39;);</span>
  <span class="p">}</span>

  <span class="na">toggle</span><span class="err">(</span><span class="na">tag</span><span class="o">:</span> <span class="na">Tag</span><span class="err">)</span> <span class="p">{</span>
    <span class="na">const</span> <span class="na">index </span><span class="o">=</span> <span class="na">this.selectedTags.map</span><span class="err">(</span><span class="na">i </span><span class="o">=</span><span class="p">&gt;</span> <span class="nx">i</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;update:selectedTags&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">createTag</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;请输入标签名&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;没有输入内容，请重新创建标签&#39;</span><span class="p">);}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;createTag&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Labels.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">Layout</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;labels&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tags&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">li</span> <span class="nt">v-for</span><span class="s">=&#34;tag in tags&#34; :key=&#34;tag.id&#34;&gt;
</span><span class="s">        &lt;router-link class=&#34;tag&#34; :to=&#34;`/labels/edit/${tag.id}`&#34;&gt;
</span><span class="s">          &lt;span class=&#34;tag-text&#34;&gt;{{ tag.name }}&lt;/span&gt;
</span><span class="s">          &lt;Icon class=&#34;tag-icon&#34; name=&#34;money_right&#34;/&gt;
</span><span class="s">        &lt;/router-link&gt;
</span><span class="s">      &lt;/li&gt;
</span><span class="s">    &lt;/ul&gt;
</span><span class="s">    &lt;div class=&#34;createTag-wrapper&#34;&gt;
</span><span class="s">      &lt;Button class=&#34;createTag&#34; @click.native=&#34;createTag&#34;&gt;新建标签&lt;/Button&gt;
</span><span class="s">    &lt;/div&gt;
</span><span class="s">  &lt;/Layout&gt;
</span><span class="s">&lt;/template&gt;
</span><span class="s">
</span><span class="s">&lt;script lang=&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="na">import</span> <span class="na">Vue</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="p">{</span><span class="na">Component</span><span class="p">}</span> <span class="na">from</span> <span class="err">&#39;</span><span class="na">vue</span><span class="nt">-property-decorator</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="na">Button</span> <span class="na">from</span> <span class="err">&#39;@/</span><span class="na">components</span><span class="err">/</span><span class="na">Button.vue</span><span class="err">&#39;;</span>
<span class="na">import</span> <span class="na">tagHelper</span> <span class="na">from</span> <span class="err">&#39;@/</span><span class="na">mixins</span><span class="err">/</span><span class="na">tagHelper.ts</span><span class="err">&#39;;</span>

<span class="err">@</span><span class="na">Component</span><span class="err">(</span><span class="p">{</span>
  <span class="na">components</span><span class="o">:</span> <span class="p">{</span><span class="na">Button</span><span class="p">}</span><span class="err">,</span>
  <span class="na">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="na">tags</span><span class="err">()</span> <span class="p">{</span>
      <span class="na">return</span> <span class="na">this.</span><span class="err">$</span><span class="na">store.state.tagList</span><span class="err">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span><span class="err">)</span>

<span class="na">export</span> <span class="na">default</span> <span class="na">class</span> <span class="na">Labels</span> <span class="na">extends</span> <span class="na">mixins</span><span class="err">(</span><span class="na">tagHelper</span><span class="err">)</span> <span class="p">{</span>
  <span class="na">beforeCreate</span><span class="err">()</span> <span class="p">{</span>
    <span class="na">this.</span><span class="err">$</span><span class="na">store.commit</span><span class="err">(&#39;</span><span class="na">fetchTags</span><span class="err">&#39;);</span>
  <span class="p">}</span>

  <span class="na">createTag</span><span class="err">()</span> <span class="p">{</span>
    <span class="na">const</span> <span class="na">name </span><span class="o">=</span> <span class="na">window.prompt</span><span class="err">(&#39;</span><span class="na">请输入标签名</span><span class="err">&#39;);</span>
    <span class="na">if</span> <span class="err">(!</span><span class="na">name</span><span class="err">)</span> <span class="p">{</span><span class="na">return</span> <span class="na">window.alert</span><span class="err">(&#39;</span><span class="na">没有输入内容</span><span class="err">，</span><span class="na">请重新创建标签</span><span class="err">&#39;);</span><span class="p">}</span>
    <span class="na">this.</span><span class="err">$</span><span class="na">store.commit</span><span class="err">(&#39;</span><span class="na">createTag</span><span class="err">&#39;,</span> <span class="na">name</span><span class="err">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="na">...</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>创建前 钩子<code>beforeCreate() {this.$store.commit('fetchTags');}</code> 获取数据，每次切换标签都触发这个钩子</li>
<li>组件中都有相同的<code>createTag(){...}</code> ，可用<code>mixin</code>来复用代码</li>
</ul>
<hr>
<h2 id="在-ts-里使用-mixin">在 TS 里使用 <code>mixin</code></h2>
<ul>
<li><a href="https://class-component.vuejs.org/guide/extend-and-mixins.html#extend">Extend and Mixins
</a></li>
</ul>
<blockquote>
<p><code>src/mixins/tagHelper.ts</code> 引入 <code>mixin</code>的实例</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Component</span> <span class="nx">from</span> <span class="s1">&#39;vue-class-component&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">TagHelper</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">createTag</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;请输入标签名&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;没有输入内容，请重新创建标签&#39;</span><span class="p">);}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;createTag&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Tags.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">...</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">mixins</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-class-component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagHelper</span> <span class="nx">from</span> <span class="s1">&#39;@/mixins/tagHelper.ts&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tagList</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Tags</span> <span class="kr">extends</span> <span class="nx">mixins</span><span class="p">(</span><span class="nx">tagHelper</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">selectedTags</span><span class="o">:</span> <span class="nx">Tag</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;fetchTags&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">toggle</span><span class="p">(</span><span class="nx">tag</span><span class="o">:</span> <span class="nx">Tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;update:selectedTags&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">selectedTags</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Labels.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">...</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Component</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-property-decorator&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">mixins</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue-class-component&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Button</span> <span class="nx">from</span> <span class="s1">&#39;@/components/Button.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tagHelper</span> <span class="nx">from</span> <span class="s1">&#39;@/mixins/tagHelper.ts&#39;</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">},</span>
  <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tags</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">Labels</span> <span class="kr">extends</span> <span class="nx">mixins</span><span class="p">(</span><span class="nx">tagHelper</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">beforeCreate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;fetchTags&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>一处JS 处处JS</li>
<li>注意必须写全后缀 <code>import tagHelper from '@/mixins/tagHelper.ts';</code></li>
</ul>
<hr>
<h2 id="重构-editlabelvue">重构 <code>EditLabel.vue</code></h2>
<blockquote>
<p><strong>注意 <code>store.commit</code> 没有返回值</strong></p>
</blockquote>
<ul>
<li>无法通过<code>this.$store.commit('fn')</code>来获取返回值，即使在回调函数<code>fn</code>写了<code>return</code></li>
<li>因为源码中<code>export interface Commit {(type: string, payload?: any, options?: CommitOptions): void;&lt;P extends Payload&gt;(payloadWithType: P, options?: CommitOptions): void;}</code>，所有最后的无返回：<code>void</code></li>
<li>在所有<code>mutations</code>中的方法都不能写<code>return</code>，写了无意义</li>
</ul>
<blockquote>
<p>在<code>state</code>中新增一个数据<code>currentTag: undefined,</code></p>
</blockquote>
<ul>
<li>通过 <code>currenTag</code> 来获取<code>store.commit('setCurrentTag')</code>的返回值</li>
</ul>
<blockquote>
<p>在<code>custom.d.ts</code>中声明所有状态的类型<code>RootState</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-TypeScript" data-lang="TypeScript"><span class="p">...</span>
<span class="kr">type</span> <span class="nx">RootState</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">tagList</span>: <span class="kt">Tag</span><span class="p">[],</span>
  <span class="nx">recordList</span>: <span class="kt">RecordItem</span><span class="p">[],</span>
  <span class="nx">currentTag?</span>: <span class="kt">Tag</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>src/store/index.ts</code>中断言状态类型</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tagList</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">recordList</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">currentTag</span>: <span class="kt">undefined</span><span class="p">,</span>
  <span class="p">}</span> <span class="kr">as</span> <span class="nx">RootState</span><span class="p">,</span>
<span class="p">...</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>EditLabel.vue</code>中预想提交<code>'setCurrenTag'</code>方法，获取<code>this.$store.state.currentTag;</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">},</span>
  <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tag() {</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentTag</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">EditLabel</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="nx">created() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;setCurrentTag&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>src/store/index.ts</code>中<code>mutations</code>实现<code>'setCurrenTag'</code>方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
    <span class="nx">mutations</span><span class="o">:</span> <span class="p">{</span>
<span class="p">...</span>
 <span class="cm">/**
</span><span class="cm">  * 设置当前标签
</span><span class="cm">  * @param state: RootState
</span><span class="cm">  * @param id: string
</span><span class="cm">  */</span>
    <span class="nx">setCurrentTag</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">id</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// state.currentTag = state.tagList.find(t =&gt; t.id === id);
</span><span class="c1"></span>      <span class="nx">state</span><span class="p">.</span><span class="nx">currentTag</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">t</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">},</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在<code>src/store/index.ts</code>中，无法获取<code>this.$route.params.id</code></li>
<li>需有<code>this.$route.params.id</code>的页面（<code>view</code>）中的方法通过<code>commit</code>第二个参数<code>payload</code>传递而得到</li>
<li><code>setCurrentTag</code>方法代替原来的<code>findTag</code></li>
</ul>
<hr>
<h2 id="在-ts-里使用-computed-要用-getter-语法">在 TS 里使用 <code>computed</code> 要用 <code>getter</code> 语法</h2>
<blockquote>
<p>存在<code>console.log(this.tag)</code>，但会报错提示未设置<code>getter</code> <code>setter</code></p>
</blockquote>
<ul>
<li>在<code>EditLabel.vue</code>中之前使用<code>@component({...tag() {...}})</code>错了</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">EditLabel</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="kr">get</span> <span class="nx">tag() {</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentTag</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">created() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;setCurrentTag&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>将之前所有的写法更改</p>
</blockquote>
<hr>
<h2 id="继续重构-editlabelvue">继续重构 <code>EditLabel.vue</code></h2>
<blockquote>
<p>在<code>src/store/index.ts</code>中<code>mutations</code>里面的方法<strong>只能接受两个参数</strong></p>
</blockquote>
<ul>
<li><code>Muation</code> 函数<strong>不可为 async函数</strong>, 也不能<strong>使用箭头函数来定义</strong>, 因为代码需要运行在重新绑定执行的上下文</li>
<li>重构<code>updateTag()</code></li>
<li>重构<code>removeTag()</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vuex</span><span class="p">.</span><span class="nx">Store</span><span class="p">({</span>
  <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">tagList</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">recordList</span><span class="o">:</span> <span class="p">[],</span>
    <span class="nx">currentTag</span>: <span class="kt">undefined</span><span class="p">,</span>
  <span class="p">}</span> <span class="kr">as</span> <span class="nx">RootState</span><span class="p">,</span>
  <span class="nx">mutations</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="nx">updateTag</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span>: <span class="kt">string</span><span class="p">,</span> <span class="nx">name</span>: <span class="kt">string</span> <span class="p">})</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">}</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">idList</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">idList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">nameList</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nameList</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名重复类&#39;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="nx">tagItem</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">tagList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="o">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
          <span class="nx">tagItem</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
          <span class="nx">store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;saveTags&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    
    <span class="p">...</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>EditLabel.vue</code>中</p>
</blockquote>
<ul>
<li>注意输入时会触发<code>input</code></li>
<li>在<code>FormItem.vue</code>组件中不可同时写<code>@Watch</code>和<code>onValueChanged</code>方法监听变化，会触发两遍</li>
<li>重构<code>created</code>
<ul>
<li>注意<code>setCurrentTag</code>默认<code>tagList</code>是存在的 直接赋值<code>state.currentTag = state.tagList.filter(t =&gt; t.id === id)[0];</code></li>
<li>取到后需要获取当前新的<code>tagList</code>，需要<code>this.$store.commit('fetchTags');</code></li>
</ul>
</li>
<li>重构<code>update</code></li>
<li>重构<code>remove</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="p">...</span>
<span class="kd">@Component</span><span class="p">({</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">Button</span><span class="p">,</span> <span class="nx">FormItem</span><span class="p">}</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="k">default</span> <span class="kr">class</span> <span class="nx">EditLabel</span> <span class="kr">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="kr">get</span> <span class="nx">tag() {</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">currentTag</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">created() {</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;fetchTags&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;setCurrentTag&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$route</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;/404&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">update</span><span class="p">(</span><span class="nx">name</span>: <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;标签名不能为空&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;updateTag&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">id</span>: <span class="kt">this.tag.id</span><span class="p">,</span> <span class="nx">name</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">remove() {</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// TODO : if (store2.removeTag(this.tag.id))
</span><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="s1">&#39;removeTag&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="sb">`成功删除标签：</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$router</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">...</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意如果<code>this.$router.back();</code>放在数据中<code>index.ts</code></li>
<li>引入<code>router</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="nx">router</span> <span class="kr">from</span> <span class="s1">&#39;@/router
</span><span class="s1">...
</span><span class="s1">    removeTag(state, id: string) {
</span><span class="s1">      let index = -1;
</span><span class="s1">      for (let i = 0; i &lt; state.tagList.length; i++) {
</span><span class="s1">        if (state.tagList[i].id === id) {
</span><span class="s1">          index = i;
</span><span class="s1">          break;
</span><span class="s1">        }
</span><span class="s1">      }
</span><span class="s1">      if (index &gt;= 0) {
</span><span class="s1">        state.tagList.splice(index, 1);
</span><span class="s1">        store.commit(&#39;</span><span class="nx">saveTags</span><span class="s1">&#39;);
</span><span class="s1">        router.back();
</span><span class="s1">      } else {
</span><span class="s1">        window.alert(&#39;</span><span class="err">删除失败&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>原来的数据<code>index2.ts</code>姐可以删除了</p>
</blockquote>
<hr>
<h2 id="vuex-小结">Vuex 小结</h2>
<ul>
<li>所有<a href="https://github.com/FrankFang/morney-live-vuex-1">代码</a></li>
<li>所有 <a href="https://github.com/FrankFang/morney-live-vuex-1/commits/master">commits</a></li>
<li>Vuex 依赖 <code>Promise</code>，特别是<code>action</code>异步接口</li>
</ul>
<blockquote>
<p>你是怎么使用 Vuex 的（常用使用套路）</p>
</blockquote>
<ul>
<li>声明<code>const store = new Vuex.Store({options...})</code></li>
<li><code>{options...}</code>包括<code>{state: {...}, mutations: {...}, ...}</code>等</li>
<li><code>state</code>中写表示状态的数据变量</li>
<li><code>mutations</code>中写表示状态变动的方法
<ul>
<li><code>mutations</code>中的方法通过传参<code>state</code>作为代替<code>this</code>指向本状态实例</li>
<li>通过<code>state</code>可访问本实例的状态数据变量进行操作</li>
<li>传且仅可传第二个参数<code>payload</code>表示接受其余参数</li>
<li><code>Muation</code> 函数<strong>不可为 async函数</strong>, 也不能<strong>使用箭头函数来定义</strong>, 因为代码需要运行在重新绑定执行的上下文</li>
</ul>
</li>
<li>在组件中调用状态数据的方法（读数据）<code>this.$store.state</code>
<ul>
<li>在入口<code>main.js/ts</code>中注册了全局可访问的<code>new Vue({router, store, render...}).$mount(...)</code></li>
<li>在<code>src/store/index.ts</code>中<code>Vue.use(Vuex);</code></li>
</ul>
</li>
<li>在组件中调用状态变更的方法（写数据）<code>this.$store.commit('methodInMutations')</code>
<ul>
<li>传且仅可传第二个参数<code>payload</code>表示其他参数（可用对象存多个变量，）类似<code>Array.prototype.apply</code></li>
</ul>
</li>
<li>导出默认<code>export default store</code></li>
</ul>
<blockquote>
<p>其他注意</p>
</blockquote>
<ul>
<li>使用TS的<code>computed</code>是使用<code>getter</code>和<code>setter</code>函数</li>
</ul>
<blockquote>
<p>扩展功能 保存 vue-router 数据</p>
</blockquote>
<ul>
<li><a href="https://github.com/vuejs/vuex-router-sync">vuejs/vuex-router-sync</a></li>
</ul>
<hr>
<hr>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-03-29
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/project/">Project</a>
          <a href="http://xmasuhai.xyz/tags/money/">money</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/ajax/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB0%E6%89%8B%E5%86%99%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AEmock%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">【前后端分离0】手写服务器、数据Mock、前后端联调</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/project/money/%E9%A1%B9%E7%9B%AE-%E5%96%B5%E5%86%85%E8%AE%B0%E8%B4%A6-meoney-02money%E7%BB%84%E4%BB%B6/">
            <span class="next-text nav-default">【项目 喵内记账 Meoney 02】Money组件</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
