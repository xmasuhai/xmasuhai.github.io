<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【React非全解 1】React 类组件和函数组件 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="React 类组件和函数组件 大纲链接§ [toc] 1. 元素 v.s. 组件 ⇧ Element v.s. Component 元素与组件 这是一个 React 元素（d小写）：const div = React.createEkement(&#39;div&#39;, ...) 这是一个 React 组件（d大写）：const" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.91.2" />


<link rel="canonical" href="http://xmasuhai.xyz/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-1react-%E7%B1%BB%E7%BB%84%E4%BB%B6%E5%92%8C%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【React非全解 1】React 类组件和函数组件" />
<meta property="og:description" content="React 类组件和函数组件 大纲链接§ [toc] 1. 元素 v.s. 组件 ⇧ Element v.s. Component 元素与组件 这是一个 React 元素（d小写）：const div = React.createEkement(&#39;div&#39;, ...) 这是一个 React 组件（d大写）：const" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-1react-%E7%B1%BB%E7%BB%84%E4%BB%B6%E5%92%8C%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-10-01T23:51:43+08:00" />
<meta property="article:modified_time" content="2022-10-02T22:47:34+08:00" />

<meta itemprop="name" content="【React非全解 1】React 类组件和函数组件">
<meta itemprop="description" content="React 类组件和函数组件 大纲链接§ [toc] 1. 元素 v.s. 组件 ⇧ Element v.s. Component 元素与组件 这是一个 React 元素（d小写）：const div = React.createEkement(&#39;div&#39;, ...) 这是一个 React 组件（d大写）：const"><meta itemprop="datePublished" content="2022-10-01T23:51:43+08:00" />
<meta itemprop="dateModified" content="2022-10-02T22:47:34+08:00" />
<meta itemprop="wordCount" content="9965">
<meta itemprop="keywords" content="FrontEnd,React," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【React非全解 1】React 类组件和函数组件"/>
<meta name="twitter:description" content="React 类组件和函数组件 大纲链接§ [toc] 1. 元素 v.s. 组件 ⇧ Element v.s. Component 元素与组件 这是一个 React 元素（d小写）：const div = React.createEkement(&#39;div&#39;, ...) 这是一个 React 组件（d大写）：const"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【React非全解 1】React 类组件和函数组件</h1>
      
      <div class="post-meta">
        <time datetime="2022-10-01" class="post-time">
          2022-10-01
        </time>
        <div class="post-category">
            <a href="http://xmasuhai.xyz/categories/react/"> React </a>
            
          </div>
        <span class="more-meta"> 约 9965 字 </span>
          <span class="more-meta"> 预计阅读 20 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-元素-vs-组件-a-hrefcatalogue--a">1. 元素 v.s. 组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#react中不同风格的两种组件类组件-vs-函数组件-a-hrefcatalogue--a"><code>React</code>中不同风格的两种组件：类组件 v.s. 函数组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#2-在react中写标签会被翻译为-reactcreateelement-a-hrefcatalogue--a">2. 在<code>React</code>中写标签会被翻译为 <code>React.createElement</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#reactcreateelement-的处理逻辑-a-hrefcatalogue--a"><code>React.createElement</code> 的处理逻辑 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#3-小试牛刀动手尝试两种组件-a-hrefcatalogue--a">3. 小试牛刀，动手尝试两种组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#4-类组件-vs-函数组件使用-props-a-hrefcatalogue--a">4. 类组件 v.s. 函数组件使用 <code>props</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#5-类组件-vs-函数组件使用-state-a-hrefcatalogue--a">5. 类组件 v.s. 函数组件使用 <code>state</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#6-类组件-注意事项很多坑a-hrefcatalogue--a">6. 类组件 注意事项（很多坑）<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#7-函数组件-注意事项-a-hrefcatalogue--a">7. 函数组件 注意事项 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#两种编程模型的浅层对比-a-hrefcatalogue--a">两种编程模型的浅层对比 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#react-编程模型-a-hrefcatalogue--a"><code>React</code> 编程模型 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#vue-编程模型-a-hrefcatalogue--a"><code>Vue</code> 编程模型 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#8-复杂-state-多个数据深层级怎么处理-a-hrefcatalogue--a">8. 复杂 <code>state</code> (多个数据/深层级)怎么处理 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#类组件里有-n-和-m-a-hrefcatalogue--a">类组件里有 <code>n</code> 和 <code>m</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#函数组件里有-n-和-m-a-hrefcatalogue--a">函数组件里有 <code>n</code> 和 <code>m</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#函数组件另一种-不推荐的写法-a-hrefcatalogue--a">函数组件另一种 <strong>不推荐的写法</strong> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#类组件不会合并第二层属性-a-hrefcatalogue--a">类组件不会合并第二层属性 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#可以使用-objectassign-拷贝一次第二层对象-a-hrefcatalogue--a">可以使用 <code>Object.assign</code> 拷贝一次第二层对象 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#也可以使用--展开运算符-拷贝一次第二层对象a-hrefcatalogue--a">也可以使用 <code>...</code> 展开运算符 拷贝一次第二层对象<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#复杂-state-小结">复杂 <code>state</code> 小结</a></li>
      </ul>
    </li>
    <li><a href="#9-react-事件绑定的各种写法-a-hrefcatalogue--a">9. <code>React</code> 事件绑定的各种写法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#类组件事件绑定-a-hrefcatalogue--a">类组件事件绑定 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#类组件的事件绑定最终写法-a-hrefcatalogue--a">类组件的事件绑定最终写法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#函数组件事件绑定-a-hrefcatalogue--a">函数组件事件绑定 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#10-复习-this与两个面试题-a-hrefcatalogue--a">10. 复习 <code>this</code>，与两个面试题 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#11-总结-a-hrefcatalogue--a">11. 总结 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#12-课后习题react-组件-a-hrefcatalogue--a">12. 课后习题：<code>React</code> 组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#react与this指向丢失的问题-a-hrefcatalogue--a"><code>React</code>与<code>this</code>指向丢失的问题 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#参考文章-a-hrefcatalogue--a">参考文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#相关文章-a-hrefcatalogue--a">相关文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="react-类组件和函数组件"><code>React</code> 类组件和函数组件</h1>
<blockquote>
<p>大纲链接<!-- raw HTML omitted --> § <!-- raw HTML omitted --></p>
</blockquote>
<p>[toc]</p>
<hr>
<h2 id="1-元素-vs-组件-a-hrefcatalogue--a">1. 元素 v.s. 组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p><code>Element</code> v.s. <code>Component</code></p>
</blockquote>
<ul>
<li>元素与组件
<ul>
<li>这是一个 <code>React</code> <strong>元素</strong>（<code>d</code>小写）：<code>const div = React.createEkement('div', ...)</code></li>
<li>这是一个 <code>React</code> <strong>组件</strong>（<code>d</code>大写）：<code>const Div = () =&gt; React.createElement('div', ...)</code></li>
<li>这样的写法是约定俗成</li>
</ul>
</li>
</ul>
<blockquote>
<p>什么是组件</p>
</blockquote>
<ul>
<li>能跟其他物件 <strong>组合</strong> 起来的物件，就是组件</li>
<li>组件并没有明确的定义，靠感觉理解就行</li>
<li>就目前而言，一个返回 <code>React</code> 元素的 <strong>函数</strong> 就是组件</li>
<li>在 <code>Vue</code> 中，一个 <strong>构造选项</strong> 就可以表示一个组件</li>
</ul>
<hr>
<h3 id="react中不同风格的两种组件类组件-vs-函数组件-a-hrefcatalogue--a"><code>React</code>中不同风格的两种组件：类组件 v.s. 函数组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>一、类组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Welcome</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>extends React.Component</code> 是固定写法</li>
<li>注意：使用外部数据 <code>{this.props.name}</code>
<ul>
<li>从 <code>this</code> 中获取 <code>props</code></li>
</ul>
</li>
<li>使用组件 <code>&lt;Welcome name=&quot;xxx&quot; /&gt;</code>
<ul>
<li>当做标签使用</li>
<li>在标签中传属性，自动挂载到 <code>props</code> 上，以<code>key: value</code>的形式</li>
</ul>
</li>
</ul>
<blockquote>
<p>二、<strong>函数组件</strong> （更推荐）</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">Welcome</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意：使用外部数据 <code>{props.name}</code>
<ul>
<li>从函数的参数中获取 <code>props</code></li>
</ul>
</li>
<li>使用组件 <code>&lt;Welcome name=&quot;xxx&quot; /&gt;</code>
<ul>
<li>当做标签使用</li>
<li>在标签中传属性，自动挂载到 <code>props</code> 上，以<code>key: value</code>的形式</li>
</ul>
</li>
</ul>
<blockquote>
<p>两种写法等价，其中函数组件也可以写成箭头函数组件</p>
</blockquote>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB814a4299ec5e810f97b38b63b4eed711?method=download&amp;shareKey=3596e1b2d214c529d427f3dc06d5f0ee" alt="三种风格的组件"></p>
<hr>
<h2 id="2-在react中写标签会被翻译为-reactcreateelement-a-hrefcatalogue--a">2. 在<code>React</code>中写标签会被翻译为 <code>React.createElement</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>在<code>React</code>中写标签是在写什么？</p>
</blockquote>
<ul>
<li>绝对不是在写 <code>HTML</code>，其实是将 <code>XML</code> 标签编译为 <code>JS</code> 代码</li>
<li><code>React</code> 同时支持接受 字符串 和 函数 作为参数，即可自动根据参数的类型 做不同的操作
<ul>
<li><code>&lt;div /&gt;</code> 会被翻译成 <code>React.createElement('div')</code> 原生 变成 标签名的字符串</li>
<li><code>&lt;Welcome /&gt;</code> 会被翻译成 <code>React.createElement(Welcome)</code> 组件变成 函数名 传入</li>
</ul>
</li>
<li>可以用 <a href="https://babeljs.io/en/repl#?browsers=&amp;build=&amp;builtIns=false&amp;corejs=3.21&amp;spec=false&amp;loose=false&amp;code_lz=DwEwlgbgBAxgNgQwM5IHIILYFMC8AiAJyxDwD4oA7KYAenAlIChGAzAVwpgBcwB7KgOpY4MXtgAUASgDeAX2bAhIsVijYUCAOa48ACzBkAYgQQUA1rSWjs5IA&amp;debug=false&amp;forceAllTransforms=false&amp;shippedProposals=false&amp;circleciRepo=&amp;evaluate=true&amp;fileSize=false&amp;timeTravel=false&amp;sourceType=module&amp;lineWrap=false&amp;presets=es2015%2Creact%2Cstage-0%2Cstage-1%2Cstage-2%2Cstage-3&amp;prettier=false&amp;targets=&amp;version=7.19.2&amp;externalPlugins=&amp;assumptions=%7B%7D"><code>babel online</code></a> 查看直接翻译 结果来验证</li>
</ul>
<hr>
<h3 id="reactcreateelement-的处理逻辑-a-hrefcatalogue--a"><code>React.createElement</code> 的处理逻辑 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>如果传入一个 <strong>字符串</strong> <code>'div'</code>，则会创建一个 <code>div</code>标签 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;red&#34;</span> <span class="na">title</span><span class="o">=</span><span class="s">&#34;hi&#34;</span><span class="p">&gt;</span><span class="nx">xxx</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果传入一个 <strong>类</strong>，则会在类前面加上 <code>new</code>操作符 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>这会导致执行 <code>constructor</code></li>
<li>获取一个组件 <strong>对象</strong></li>
<li>然后调用对象的 <strong><code>render</code> 方法</strong>，<strong>获取其返回值</strong>，代替原来组件标签的位置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Welcome</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">hi</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Welcome</span><span class="p">()</span>

<span class="p">&lt;</span><span class="nt">Welcome</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;hi&#34;</span> <span class="p">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>如果传入一个 <strong>函数</strong>，则会调用该函数，并 <strong>获取其返回值</strong>，代替原来组件标签的位置 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">Welcome</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">(&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">hi</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;)</span>
<span class="p">&lt;</span><span class="nt">Welcome</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;hi&#34;</span> <span class="p">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="3-小试牛刀动手尝试两种组件-a-hrefcatalogue--a">3. 小试牛刀，动手尝试两种组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// 相同的开头 之后略
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./styles.css&#39;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="nx">爸爸</span> <span class="p">&lt;</span><span class="nt">Son</span> <span class="p">/&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">)</span> <span class="p">}</span>

<span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">ReactComponent</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{}</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>代码示例：<a href="https://codesandbox.io/s/gallant-framework-t8m3w">链接</a></p>
</blockquote>
<ul>
<li>入口：<code>App</code>（<code>ReactDOM.render(&lt;App /&gt;, rootElement)</code>）调用函数组件 <code>App</code> （<code>React</code> 17）
<ul>
<li><code>ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render( &lt;App /&gt; );</code>（<code>React</code> 18+）</li>
</ul>
</li>
<li><code>App</code> 返回 根组件 <code>&lt;div&gt;&lt;/div&gt;</code>
<ul>
<li>根组件 包含 <code>Son</code> 组件
<ul>
<li><code>Son</code> 组件 使用类组件 <code>class Son extends React.Component {}</code></li>
<li><code>Son</code> 组件 实现显示数据 <code>n</code> 功能
<ul>
<li><code>constructor() {}</code>
<ul>
<li><code>super()</code> 继承属性，必写，不写报错</li>
<li><code>this.state = {n: 0}</code> 声明内部数据 初始化数据</li>
</ul>
</li>
</ul>
</li>
<li><code>Son</code> 组件 实现点击按钮 <code>n + 1</code> 功能
<ul>
<li><code>add() { this.setState({ n: this.state.n + 1 }); }</code> 方法操作内部数据</li>
<li><code>render() {}</code>
<ul>
<li><code>儿子 n: {this.state.n}</code></li>
<li><code>&lt;button onClick={() =&gt; this.add()}&gt;+1&lt;/button&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>Son</code> 组件 包含 <code>GrandSon</code> 组件
<ul>
<li><code>GrandSon</code> 组件 使用函数组件 <code>const Grandson = () =&gt; {}</code></li>
<li><code>GrandSon</code> 组件 实现显示数据 <code>n</code> 功能
<ul>
<li><code>const [n, setN] = React.useState(0)</code> 解构出内部数据 和 数据更新方法 初始化</li>
<li><code>return ()</code>
<ul>
<li><code>孙子 n:{n}</code></li>
</ul>
</li>
</ul>
</li>
<li><code>GrandSon</code> 组件 实现点击按钮 <code>n + 1</code> 功能
<ul>
<li><code>return ()</code>
<ul>
<li><code>&lt;button onClick={() =&gt; setN(n + 1)}&gt;+1&lt;/button&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">ReactComponent</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this.state.n += 1 // 直接改为何不行
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
      <span class="nx">儿子</span> <span class="nx">n</span><span class="err">：</span><span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">()</span> <span class="p">}&gt;</span> <span class="o">+</span><span class="mi">1</span> <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">GrandSon</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;GrandSon&#34;</span><span class="p">&gt;</span>
      <span class="nx">孙子</span> <span class="nx">n</span><span class="err">：</span><span class="p">{</span> <span class="nx">n</span> <span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}&gt;</span> <span class="o">+</span><span class="mi">1</span> <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>子组件，使用类组件
<ul>
<li>在 <code>constructor</code>中
<ul>
<li>继承属性 <code>super()</code></li>
<li>初始化内部数据 <code>this.state = {n: 0}</code></li>
</ul>
</li>
<li>显示数据：<code>儿子 n：{ this.state.n }</code></li>
<li>变更数据：
<ul>
<li><code>this.state.n += 1</code> 直接改内部数据为何不行</li>
<li>必须使用 <code>this.setState({ n: this.state.n + 1 })</code></li>
</ul>
</li>
<li>用户交互：点击按钮，执行加一操作 <code>onClick={ () =&gt; this.add() }</code></li>
</ul>
</li>
<li>孙代组件：使用函数组件
<ul>
<li>初始化内部数据 <code>React.useState(0)</code></li>
<li>解构出 内部数据 和 数据变更的方法 <code>const [n, setN] = React.useState(0)</code></li>
<li>显示数据：<code>儿子 n：{ n }</code></li>
<li>变更数据：<code>onClick={ () =&gt; setN(n + 1)</code> 得到一个新的<code>n</code> 而不是原有的<code>n</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-类组件-vs-函数组件使用-props-a-hrefcatalogue--a">4. 类组件 v.s. 函数组件使用 <code>props</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>添加 <code>props</code> （外部数据） 父组件传值给子组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>代码示例：<a href="https://codesandbox.io/s/wild-currying-y6t17">链接</a></li>
<li>父组件传递数据给子组件
<ul>
<li><code>&lt;Son msgToSon=&quot;儿子你好&quot;/&gt;</code></li>
<li><code>&lt;Son msgToSon={variable}/&gt;</code></li>
<li>可使用字符串或者表达式（变量）</li>
</ul>
</li>
<li><strong>类组件</strong> 直接读取 <strong>属性</strong> <code>this.props.msgToSon</code></li>
<li><strong>函数组件</strong> 直接读取 <strong>参数</strong> <code>props.msgToSon</code>
<ul>
<li>接收参数（一般命名为<code>props</code>），将组件外部属性挂载到第一个参数对象上</li>
</ul>
</li>
<li>外部数据只关心 <strong>读</strong>，不可写（符合单向数据流原则）</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">calssName</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">我是儿子</span><span class="err">，</span> <span class="nx">我爸对我说</span><span class="err">「</span><span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">msgToSon</span> <span class="p">}</span><span class="err">」</span>
        <span class="p">&lt;</span><span class="nt">Grandson</span> <span class="na">msgToGrandson</span><span class="o">=</span><span class="s">&#34;孙子你好&#34;</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="nx">props</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">calssName</span><span class="o">=</span><span class="s">&#34;GrandSon&#34;</span><span class="p">&gt;</span>
      <span class="nx">我是儿子</span><span class="err">，</span> <span class="nx">我爸对我说</span><span class="err">「</span><span class="p">{</span> <span class="nx">props</span><span class="p">.</span><span class="nx">msgToGrandson</span> <span class="p">}</span><span class="err">」</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="5-类组件-vs-函数组件使用-state-a-hrefcatalogue--a">5. 类组件 v.s. 函数组件使用 <code>state</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>添加 <code>state</code> （内部数据类似于<code>Vue</code>的<code>data</code>） <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>代码示例：<a href="https://codesandbox.io/s/gallant-framework-t8m3w">链接</a></li>
<li>关注数据时的三个条件：
<ul>
<li><strong>初始化</strong> 内部数据</li>
<li><strong>读取</strong> 内部数据</li>
<li><strong>写入</strong> 内部数据</li>
</ul>
</li>
<li><strong>类组件</strong>
<ul>
<li>在 <code>constructor</code> 方法中的 <code>super()</code>之后 初始化内部数据
<ul>
<li><code>this.state = { xxx: 0 } </code></li>
</ul>
</li>
<li>使用 <code>this.state.xxx</code> 来读</li>
<li>使用 <code>this.setState(???, fn)</code> 来写，两种写法
<ul>
<li>使用 <code>this.setState({xxx: this.state.xxx + 1}, fn)</code> 来写，可以再传回调函数作为第二个参数</li>
<li><em><strong>更推荐使用 <code>this.setState( (state, props) =&gt; ({xxx: state.xxx + 1}), fn)</code> 工厂函数 更清晰地表明改变后的数据</strong></em></li>
</ul>
</li>
</ul>
</li>
<li><strong>函数组件</strong> 使用 <code>useState</code> 返回一个数组，第一项 <strong>读</strong>，第二项 <strong>写</strong>
<ul>
<li>语法含义 <code>const [读值, 写值方法] = React.useState(初始值)</code></li>
<li>命名约定 <code>const [x, setX] = useState('xxx')</code></li>
<li>当调用了 <code>setX</code> 并不会改变 <code>x</code> 本身，且永远不会改变 <code>x</code></li>
<li>而是产生了一个新的 <code>x</code> 返回</li>
</ul>
</li>
<li>内部数据关心：
<ul>
<li><strong>初始化</strong></li>
<li><strong>读</strong></li>
<li><strong>写</strong></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span> <span class="c1">// 初始化
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this.state.n += 1 // 为什么不能更新视图？错误的写法
</span><span class="c1"></span>    <span class="c1">// 因为 react 没有监听属性（属性劫持）
</span><span class="c1"></span>
     <span class="c1">// 写
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span> <span class="c1">// 不推荐的写法 易混淆
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="c1">// 推荐的写法 更好理解区分新旧 state，避免异步造成的误解
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">儿子</span> <span class="nx">n</span><span class="err">：</span><span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="p">}</span> <span class="p">{</span><span class="cm">/* 读 */</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">()}&gt;</span> <span class="o">+</span><span class="mi">1</span> <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Grandson</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Grandson&#34;</span><span class="p">&gt;</span>
      <span class="nx">孙子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}&gt;</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>类组件中 <strong>不推荐</strong> 的 写入方法</p>
</blockquote>
<ul>
<li>先<code>this.state.n += 1</code></li>
<li>后<code>this.setState( this.state )</code></li>
<li>虽然可以生效，但是一般推荐 <strong>重新产生一个新的对象</strong>，而不是在原有的对象中修改</li>
<li>这遵循了 「数据不可变的原则」</li>
</ul>
<blockquote>
<p>更推荐向 <code>setState()</code> 中传 <strong>一个返回对象的工厂函数</strong> 作为 参数，代替 传新的对象</p>
</blockquote>
<ul>
<li><code>setState( (state, /* props */) =&gt; ({n: state.n + 1 }) )</code></li>
<li>因为 <code>setState</code> 不会马上去改变 <code>this.state.n</code> 的值，会等一会儿更新，内部更新UI机制是异步的</li>
<li>可以在 <code>setSatate</code> 之后验证，打印出 <code>console.log(this.state.n)</code>
<ul>
<li>事实上，<code>setSatate</code>会在紧跟之后的同步代码结束后执行</li>
</ul>
</li>
<li>为了避免混淆新旧 <code>this.state</code> ，必须传工厂函数</li>
<li>工厂函数能够明确显示 n <strong>新的值</strong>，帮助更好地理解，防止误解出错</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// ...
</span><span class="c1"></span>  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">})</span> <span class="c1">// 写
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 视图改变 但打印的是 0 旧的n值
</span><span class="c1"></span>    <span class="c1">// this.state.n 仍是旧的值
</span><span class="c1"></span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">// 可以很清楚地分辨 新旧 n 的值
</span><span class="c1"></span>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="c1">// ...
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>props</code> v.s. <code>state</code> 类组件 v.s.函数组件</p>
</blockquote>
<ul>
<li>分别和<code>Vue</code>中的 <code>props</code> 与 <code>data</code> 对应</li>
<li>函数组件的写法更简洁、不用考虑<code>this</code>，数据不可变</li>
</ul>
<hr>
<h2 id="6-类组件-注意事项很多坑a-hrefcatalogue--a">6. 类组件 注意事项（很多坑）<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p><code>this.state.n += 1</code> 无效？</p>
</blockquote>
<ul>
<li>其实 <code>n</code> 已经变了，只不过 <code>UI</code> 不会自动更新而已</li>
<li>调用 <code>setState</code> 才会触发 <code>UI</code> 更新（异步更新）</li>
<li>因为 <code>React</code> 没有像 <code>Vue</code> 监听 <code>data</code> 一样监听 <code>state</code></li>
</ul>
<blockquote>
<p><code>setState</code> 会异步更新 <code>UI</code></p>
</blockquote>
<ul>
<li><code>setState</code> 之后，<code>state</code> 不会马上改变，立马读 <code>state</code> 仍是旧值</li>
<li>更推荐的方式是 <code>setState(工厂函数)</code></li>
</ul>
<blockquote>
<p><code>this.setState(this.state)</code> 不推荐？</p>
</blockquote>
<ul>
<li><code>React</code> 希望我们不要修改旧 <code>state</code>（不可变数据）</li>
<li>常用代码：<code>setState( {n: state.n + 1 } )</code></li>
</ul>
<blockquote>
<p>小结</p>
</blockquote>
<ul>
<li><code>React</code> 函数式是一种理念。不适就用 <code>Vue</code></li>
</ul>
<h2 id="7-函数组件-注意事项-a-hrefcatalogue--a">7. 函数组件 注意事项 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>与类组件相似的地方</p>
</blockquote>
<ul>
<li>也要通过 <code>setX(新值)</code> 来更新 <code>UI</code></li>
</ul>
<blockquote>
<p>和类组件不同的地方</p>
</blockquote>
<ul>
<li>没有 <code>this</code>，一律用参数和变量</li>
</ul>
<hr>
<h2 id="两种编程模型的浅层对比-a-hrefcatalogue--a">两种编程模型的浅层对比 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB8f1690cf250c50103835cf3114a9549e?method=download&amp;shareKey=7293728f3a102ab630ae6726ab7d6a6d" alt="两种编程模型的浅层对比"></p>
<h3 id="react-编程模型-a-hrefcatalogue--a"><code>React</code> 编程模型 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>一个对象，对应一个虚拟 <code>DOM</code></li>
<li>另一个对象，对应另一个虚拟 <code>DOM</code></li>
<li>对比两个虚拟 <code>DOM</code>，找到不同处（<code>DOM diff</code>），最够局部更新 <code>DOM</code></li>
</ul>
<hr>
<h3 id="vue-编程模型-a-hrefcatalogue--a"><code>Vue</code> 编程模型 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>一个对象，对应一个虚拟 <code>DOM</code></li>
<li>当属性改变时，把属性相关 <code>DOM</code> 节点全部更新</li>
<li>注：<code>Vue</code> 为了其他考量，也引入了虚拟 <code>DOM</code> 和 <code>DOM diff</code></li>
<li><code>Vue</code> 劫持数据，修改数据会直接映射到UI上，更易理解</li>
</ul>
<hr>
<h2 id="8-复杂-state-多个数据深层级怎么处理-a-hrefcatalogue--a">8. 复杂 <code>state</code> (多个数据/深层级)怎么处理 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li>公共代码</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./styles.css&#39;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="nx">爸爸</span>
      <span class="p">&lt;</span><span class="nt">Son</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="类组件里有-n-和-m-a-hrefcatalogue--a">类组件里有 <code>n</code> 和 <code>m</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">addN</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span> <span class="p">)</span>
    <span class="c1">// m未传值 会被覆盖为 undefined 吗？
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">addM</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="nx">state</span> <span class="p">=&gt;</span> <span class="p">(</span> <span class="p">{</span><span class="nx">m</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span> <span class="p">)</span>
    <span class="c1">// n未传值 会被覆盖为 undefined 吗？
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">儿子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">}&gt;</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addM</span><span class="p">}&gt;</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">GrandSon</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>类组件中<code>setState</code>，如果只对一部分进行修改，其他部分自动沿用上一次的值，而不会被<code>undefined</code>覆盖
<ul>
<li>可以了理解为类组件中，会自动合并未修改的数据，而用手动写 <code>this.setState( {...this.state, n: this.state.n + 1} )</code></li>
</ul>
</li>
<li>可是，这种合并只会合并第一层数据</li>
<li><a href="https://codesandbox.io/s/friendly-aryabhata-eq24y">代码示例</a></li>
</ul>
<hr>
<h3 id="函数组件里有-n-和-m-a-hrefcatalogue--a">函数组件里有 <code>n</code> 和 <code>m</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">setM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;GrandSon&#34;</span><span class="p">&gt;</span>
      <span class="nx">孙子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}&gt;</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="nx">m</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">setM</span><span class="p">(</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}&gt;</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://codesandbox.io/s/funny-montalcini-wszxe">代码示例</a></li>
</ul>
<hr>
<h3 id="函数组件另一种-不推荐的写法-a-hrefcatalogue--a">函数组件另一种 <strong>不推荐的写法</strong> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>你会发现 <code>m</code> 被置空 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">GrandSon</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setState</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span> <span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;GrandSon&#34;</span><span class="p">&gt;</span>
      <span class="nx">孙子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">setState</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})}&gt;</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">setState</span><span class="p">({</span><span class="nx">m</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})}&gt;</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>函数组件的 <code>setState</code> 不会自动合并没有更新设置的数据，会用 <code>undefined</code> 覆盖没有传入的数据属性</li>
<li>要实现类组件同样的合并效果，需要使用 展开运算符 <code>...state</code> 来拷贝原先的数据属性，手动合并：
<ul>
<li><code>&lt;button onClick={ () =&gt; setState({...state, n: state.n + 1})}&gt;n + 1&lt;/button&gt;</code></li>
<li><code>&lt;button onClick={ () =&gt; setState({...state, m: state.m + 1})}&gt;m + 1&lt;/button&gt;</code></li>
</ul>
</li>
<li><a href="https://codesandbox.io/s/distracted-taussig-dmkjz">代码示例</a></li>
</ul>
<hr>
<h3 id="类组件不会合并第二层属性-a-hrefcatalogue--a">类组件不会合并第二层属性 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">changeUser</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="c1">// m 和 n 不会被置空
</span><span class="c1"></span>      <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;yyy&#34;</span>
        <span class="c1">// 第二层的 age 被置空 undefined
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">儿子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">()}&gt;</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addM</span><span class="p">()}&gt;</span><span class="nx">m</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeUser</span><span class="p">()}&gt;</span><span class="nx">change</span> <span class="nx">user</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">GrandSon</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://codesandbox.io/s/dreamy-pike-w9je2">代码示例</a></li>
</ul>
<hr>
<h3 id="可以使用-objectassign-拷贝一次第二层对象-a-hrefcatalogue--a">可以使用 <code>Object.assign</code> 拷贝一次第二层对象 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">addN</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
    <span class="c1">// 对象第一层属性 m 不会被覆盖为 undefined
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">addM</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">m</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
    <span class="c1">// 对象第一层属性 n 不会被覆盖为 undefined
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">changeUser</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// 手动复制一遍之前的所有属性
</span><span class="c1"></span>    <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;jack&#34;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="c1">// m 和 n 不会被置空
</span><span class="c1"></span>      <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">儿子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">()}&gt;</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addM</span><span class="p">()}&gt;</span><span class="nx">m</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeUser</span><span class="p">()}&gt;</span><span class="nx">change</span> <span class="nx">user</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Grandson</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://codesandbox.io/s/dreamy-pike-w9je2">代码示例</a></li>
</ul>
<hr>
<h3 id="也可以使用--展开运算符-拷贝一次第二层对象a-hrefcatalogue--a">也可以使用 <code>...</code> 展开运算符 拷贝一次第二层对象<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span>
        <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">addN</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">addM</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">m</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">changeUser</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
      <span class="c1">// 对象第一层属性 m 和 n 不会被置空
</span><span class="c1"></span>      <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="c1">// 手动复制一遍之前的所有属性
</span><span class="c1"></span>        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;jack&#34;</span>
        <span class="c1">// 复制后第二层属性 age 不被置空
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;Son&#34;</span><span class="p">&gt;</span>
        <span class="nx">儿子</span> <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">()}&gt;</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="nx">m</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">m</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">addM</span><span class="p">()}&gt;</span><span class="nx">m</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">changeUser</span><span class="p">()}&gt;</span><span class="nx">change</span> <span class="nx">user</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Grandson</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://codesandbox.io/s/dawn-sound-rwyxv">代码示例</a></li>
</ul>
<hr>
<h3 id="复杂-state-小结">复杂 <code>state</code> 小结</h3>
<ul>
<li>类组件的 <code>setState</code> 会自动合并第一层属性
<ul>
<li>但是类组件不会合并第二层属性，<a href="https://codesandbox.io/s/dreamy-pike-w9je2">举例</a></li>
<li>可以使用 <code>Object.assign</code>，<a href="https://codesandbox.io/s/zen-margulis-gjr7t">举例</a></li>
<li>可以使用 <code>...</code> 展开运算符，<a href="https://codesandbox.io/s/dawn-sound-rwyxv">举例</a></li>
<li>更深层数据仍然不会自动合并，除非使用深拷贝</li>
</ul>
</li>
<li>函数组件的 <code>setX</code> 则完全不会合并</li>
</ul>
<blockquote>
<p>对比<code>Vue</code></p>
</blockquote>
<ul>
<li><code>Vue</code>对数据做了属性劫持操作
<ul>
<li><code>Vue2</code>使用<code>Object.defineProperty</code>给所有嵌套属性添加<code>getter</code>和<code>setter</code>，初始开销大，非惰性监听，无法直接在初始化后，再添加或删除的属性，需要另外的<code>API</code></li>
<li><code>Vue3</code>使用<code>Proxy</code>代理原对象，转换所有嵌套属性，可以在真正用到深层数据的时候再做响应式（惰性响应式），改善 初始化性能 和 内存消耗
<ul>
<li><code>const state = reactive({ count: 0 })</code></li>
</ul>
</li>
</ul>
</li>
<li>在 <code>Vue3</code> 中，状态都是默认深层响应式的。这意味着即使在更改深层次的对象或数组，你的改动也能被检测到。</li>
<li>只有代理对象是响应式的，更改原始对象不会触发更新，<code>Vue</code>仅使用你声明对象的代理版本</li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">MDN Proxy</a></li>
<li><a href="https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html#reactivity-fundamentals">Vue 响应式基础</a></li>
</ul>
<hr>
<h2 id="9-react-事件绑定的各种写法-a-hrefcatalogue--a">9. <code>React</code> 事件绑定的各种写法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>注意大小写 <code>onClick</code>、<code>onKeyPress</code></p>
</blockquote>
<h3 id="类组件事件绑定-a-hrefcatalogue--a">类组件事件绑定 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li><code>React</code> 事件绑定<code>&lt;button onClick={this.addN}&gt; n + 1 &lt;/button&gt;</code></li>
<li>用户点击按钮，<code>React</code>会做什么
<ul>
<li>a. <code>(×)</code>会执行 <code>this.addN()</code></li>
<li>b. <code>(×)</code>会执行 <code>button.onClick</code></li>
<li>c. <code>(√)</code>会执行 <code>button.onClick.call(null, event)</code>
<ul>
<li>其中 <code>onClick</code> 的 <code>this === null</code></li>
<li>在浏览器中这里的 <code>this</code> 会被 <code>window</code> 补位</li>
<li>导致 <code>&lt;button onClick={this.addN}&gt; n + 1 &lt;/button&gt;</code> 里的 <code>this</code> 指向 <code>window</code></li>
</ul>
</li>
</ul>
</li>
<li>所以 <code>React</code> 事件绑定 <strong>不该使用</strong> <code>&lt;button onClick={this.addN}&gt; n + 1 &lt;/button&gt;</code> 会让<code>this</code>变<code>window</code></li>
<li>参考 <a href="https://zhuanlan.zhihu.com/p/23804247">this 教程</a></li>
</ul>
<blockquote>
<p>对比四种写法</p>
</blockquote>
<ol>
<li><code>&lt;button onClick={ () =&gt; this.addN() }&gt; n + 1 &lt;/button&gt;</code> 传一个箭头函数包裹方法，返回函数 （最稳妥的写法，没有任何问题）</li>
</ol>
<ul>
<li>因为箭头函数无法改变内部 <code>this</code> 指向</li>
</ul>
<ol start="2">
<li><code>&lt;button onClick={ this.addN }&gt; n + 1 &lt;/button&gt;</code> 存在问题：这样会使 <code>this.addN</code> 方法里的 <code>this</code> 变成 <code>window</code>或<code>undefiend</code>（外部 <code>this</code> 仍是正常的）</li>
</ol>
<ul>
<li><code>addN() {this.setState({n: this.state.n + 1}) }</code>里面的<code>this</code>指向丢失，变为<code>window</code></li>
</ul>
<ol start="3">
<li><code>&lt;button onClick={ this.addN.bind(this) }&gt; n + 1 &lt;/button&gt;</code> 可以这样写，它返回一个 绑定了当前<code>this</code> 的新函数，但较麻烦</li>
<li>给箭头函数取个名字，写成 <code>&lt;button onClick={ this._addN }&gt; n + 1 &lt;/button&gt;</code> 然后添加实例上的方法 <code>this._addN = () =&gt; { this.addN() }</code>（在<code>constructor</code>中声明）</li>
</ol>
<ul>
<li>多了一个变量名，不够优雅</li>
</ul>
<ol start="5">
<li>可合并写在<code>constructor</code>方法中，减少一个变量名</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">//...
</span><span class="c1"></span><span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">super</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">addN</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">}&gt;</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>但这样写不如直接在原型上声明 <code>addN</code> 为箭头函数 结构简洁清晰</li>
<li><code>React</code> 会内部做判断处理，无论是否返回函数，都可以
<ul>
<li><code>this.addN = () =&gt; {this.setState( {n: this.state.n + 1} )}</code></li>
<li><code>this.addN = () =&gt; this.setState( {n: this.state.n + 1} )</code></li>
</ul>
</li>
</ul>
<hr>
<h3 id="类组件的事件绑定最终写法-a-hrefcatalogue--a">类组件的事件绑定最终写法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><a href="https://codesandbox.io/s/fancy-fog-v71lm">最终写法代码示例</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">addN</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">// addN = () =&gt; this.setState({n: this.state.n + 1}) // 也可
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addN</span><span class="p">}&gt;</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在<code>class</code>内部直接声明变量为箭头函数：<code>addN = () =&gt; {}</code> 相当于 <code>constructor</code> 中的 <code>this.addN</code></li>
<li>使用时直接写 <code>&lt;button onClick={this.addN}&gt; n + 1 &lt;/button&gt;</code></li>
</ul>
<blockquote>
<p>两种<code>addN</code>写法的区别 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">addN</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})}</span>
  <span class="c1">// addN() {this.setState({n: this.state.n + 1})}
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>等价写法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">Son</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="c1">// 等价写法一
</span><span class="c1"></span>  <span class="nx">addN</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">)</span> <span class="c1">// 语法糖
</span><span class="c1"></span>  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="c1">// ...
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">addN</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">}</span> <span class="c1">// 两个写法完全等价
</span><span class="c1"></span>
  <span class="c1">// 等价写法二
</span><span class="c1"></span>  <span class="nx">addN</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})}</span>
  <span class="nx">addN</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})}</span>
  <span class="c1">// 两个写法完全等价
</span><span class="c1"></span>
  <span class="c1">// 等价写法二 改变 this 使用时直接写this.addN会运行报错 Uncaught TypeError: Cannot read properties of undefined (reading &#39;setState&#39;)
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>等价写法一 两种写法在实例对象上，等价写法二在原型上</li>
<li>等价写法二中<code>addN</code>的 <code>this</code> 变成 <code>window</code>；等价写法一中<code>addN</code>的 <code>this</code> 不会改变</li>
</ul>
<blockquote>
<p>小结  <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>等价写法一是 实例对象 本身的属性，这意味着每个 <code>Son</code> 组件都有自己独立的 <code>addN</code>，如果有两个<code>Son</code>，就有两个<code>addN</code></li>
<li>等价写法二是 对象的共有属性（即原型上的属性），这意味着所有 <code>Son</code> 组件共用一个 <code>addN</code></li>
<li>实例上的方法，优先级高于原型上的类方法</li>
</ul>
<blockquote>
<p>代码证明：</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sayHi_instance1</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sayHi_instance2</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">}</span>
  <span class="nx">sayHi_instance3</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{}</span> <span class="c1">// 实例化对象上的方法
</span><span class="c1"></span>  <span class="nx">sayHi_instance4</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span> <span class="c1">// 实例化对象上的方法
</span><span class="c1"></span>
  <span class="nx">sayHi_proto</span><span class="p">()</span> <span class="p">{}</span> <span class="c1">// 原型上的方法 Person.prototype
</span><span class="c1"></span><span class="p">}</span>
<span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>为什么 <code>this</code> 会变/不会变</p>
</blockquote>
<ul>
<li>所有普通函数的<code>this</code>都是参数，由调用决定，所以可变</li>
<li>唯独箭头函数的<code>this</code>不变，因为箭头函数不接受<code>this</code>，由声明时的外部作用域<code>this</code></li>
<li><code>React</code>的特点：能不做的，我都不做</li>
<li><code>Vue</code>的特点：能帮你做的，都帮你做了</li>
</ul>
<blockquote>
<p>结论</p>
</blockquote>
<ul>
<li>直接使用写法一的<code>addN</code>即可</li>
<li>或者使用函数组件，它完全不用<code>this</code>，以后的趋势也是优先采用函数组件</li>
<li>但维护老项目时，必须看懂类组件事件绑定的正确写法</li>
</ul>
<hr>
<h3 id="函数组件事件绑定-a-hrefcatalogue--a">函数组件事件绑定 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="10-复习-this与两个面试题-a-hrefcatalogue--a">10. 复习 <code>this</code>，与两个面试题 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>this的指向有哪几种情况，简要回答：大概分四种（<code>4 + 1</code>种后面可以补充） <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>严格模式下 全局环境 普通函数中 <code>undefined</code></li>
<li>对象中函数，即对象的方法 对象本身</li>
<li>用 <code>call/apply/bind</code> 显示绑定<code>this</code>指向</li>
<li>构造函数 <code>new</code> 绑定生成实例对象</li>
<li>箭头函数 声明时作用域链上一层 <code>this</code></li>
</ul>
<blockquote>
<p>要判断一个运行中的函数的this绑定，就需要找到这个函数的直接调用位置，并按顺序应用下面这四条规则来判断this的绑定对象 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ol>
<li>由<code>new</code>调用？绑定到新创建的对象。</li>
<li>由<code>call</code>或者<code>apply</code>（或者<code>bind</code>）调用？绑定到指定的对象。</li>
<li>由上下文对象调用？绑定到那个上下文对象。</li>
<li>默认：在严格模式下绑定到<code>undefined</code>，否则绑定到全局对象。</li>
</ol>
<ul>
<li>箭头函数不适用this的四种标准规则，而是根据外层（函数或全局）作用域来决定this</li>
<li><code>this</code>指向优先级：箭头函数 &gt; new绑定 &gt; 显示绑定 &gt; 隐式绑定 &gt; 默认绑定</li>
</ul>
<blockquote>
<p>详细说明<code>this</code>的指向 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>全局环境下分为
<ul>
<li>两种宿主环境：
<ul>
<li>浏览器环境 <code>globalThis</code> 指向window对象</li>
<li><code>node.js</code>环境 <code>globalThis</code> 指向global对象</li>
</ul>
</li>
<li>两种模式：
<ul>
<li>非严格模式</li>
<li>严格模式（ <strong>模块环境</strong> 和 <strong>class类内部</strong> 都是严格模式）</li>
</ul>
</li>
</ul>
</li>
<li>全局环境下 普通函数 <strong>隐式调用</strong> 中的<code>this</code>
<ul>
<li>非严格模式 <code>fn this -&gt; globalThis</code>为<code>window</code> 或者 <code>global</code></li>
<li>严格模式 <code>fn this -&gt; undefined</code></li>
<li>函数 <strong>调用时</strong> 由调用主体决定，谁调用，<code>this</code>就指向谁
<ul>
<li>全局环境下 不写<code>window</code> 声明变量自动挂载到<code>window</code>下，即<code>window</code>调用方法</li>
</ul>
</li>
</ul>
</li>
<li>函数 <strong>显示调用</strong> <code>this</code>
<ul>
<li><code>fn.call(obj) this -&gt; obj</code></li>
<li><code>fn.apply(obj) this -&gt; obj</code></li>
<li><code>fn.bind(obj) this -&gt; obj</code></li>
</ul>
</li>
<li><strong>构造函数</strong>中 <code>this</code>指向实例化对象<code>instance = new Fn()</code> this -&gt; instance 实例对象
<ul>
<li>class类内部 严格模式 但使用类必须实例化 指向实例对象 this -&gt; instance</li>
</ul>
</li>
<li>箭头函数不会创建自己this 函数内部的this -&gt; 自己作用域链的上一层 <code>this</code>
<ul>
<li>即取决于 <strong>声明时</strong> 该箭头函数作用域链的上一层 <code>this</code></li>
<li>声明在全局环境中 指向<code>window/global</code></li>
<li>声明在对象方法中 指向对象作用域的上一层 <code>this</code></li>
</ul>
</li>
<li><strong>对象中的this</strong> （所有模式 全局环境下）
<ul>
<li>注意必须按照 <strong><code>对象.方法()</code></strong> 的形式调用 隐式绑定<code>this</code>为该对象</li>
<li>而不是重新声明变量，引用赋值为 <code>对象.方法</code>，再执行该变量</li>
<li><code>obj.Fn</code> 属性为 普通函数 内部 this -&gt; obj</li>
<li><code>obj.Fn</code> 属性为 箭头函数 内部 this -&gt; 对象外部的this</li>
<li>普通函数 取决于 <strong>运行时</strong> 的 this指向
<ul>
<li>定时器回调 会丢失 this 而指向全局</li>
<li>存在多层调用，<strong>就近原则</strong>：对象属性引用链只有一层或者说 <strong>最后一层</strong> 在调用位置中起作用</li>
</ul>
</li>
<li>箭头函数 保存下 声明时的 对象外部this指向
<ul>
<li>定时器回调 会记录 this 仍指向声明时上一层作用域this</li>
</ul>
</li>
<li>隐式丢失<code>this</code>指向
<ul>
<li>声明变量 指向对象的方法时，会丢失this</li>
<li>传入普通函数作为参数时，会丢失this
<ul>
<li>参数传递其实就是一种隐式赋值，传入函数时也会被隐式赋值</li>
<li>异步方法通常需要传递回调函数，传普通函数，会丢失this指向</li>
</ul>
</li>
<li>除非使用箭头函数作为参数</li>
</ul>
</li>
</ul>
</li>
<li>严谨的代码中会用<code>call/apply/bind</code>显示地指定this指向</li>
</ul>
<blockquote>
<p>this是什么？ <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li><code>this</code>是<code>fn.call/apply/bind</code>的第一个参数</li>
<li>调用<code>fn()</code>就是调用<code>fn.call(this)</code></li>
<li>所有函数调用<code>fn()</code>都可以改写为<code>fn.call/apply(undefined)</code>的形式，可以显式地看出<code>this</code>
<ul>
<li>在 <strong>浏览器/Node.js （非严格模式或模块环境）</strong> 宿主环境下，函数调用中的<code>this</code>会被改成<code>globalThis</code> (分别指向<code>window</code> 和 <code>global</code> 对象)</li>
</ul>
</li>
<li>对象方法调用<code>obj.move()</code>可以改写成<code>obj.move.call(obj)</code>
<ul>
<li>其中<code>move</code>只是对象的属性，键值，指向内存中一块存储函数的地址（此函数不属于对象）</li>
<li>另一个例子<code>obj.child.say()</code>可改写成<code>obj.child.say.call(obj.child)</code></li>
<li>其它函数参数续写在后面</li>
</ul>
</li>
<li>开启严格模式，在函数内部的首行写<code>'use strict'</code>，则<code>this</code>指向不会被更改，值为<code>undefined</code></li>
</ul>
<blockquote>
<p>辨析题：为什么箭头函数不能用作构造函数 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<ul>
<li>没有自己的 <code>this</code> 上下文</li>
<li>不绑定 <code>arguments</code></li>
<li>箭头函数不能用作构造器 和 <code>new</code>一起使用会抛出错误</li>
<li>箭头函数没有<code>prototype</code>属性</li>
<li>用作构造函数 直接报错</li>
</ul>
<blockquote>
<p>总结，设定在严格模式下 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center"><code>this</code> \ 运行时条件</th>
<th style="text-align:center">全局环境</th>
<th style="text-align:center">上下文对象<code>obj.fn</code>调用</th>
<th style="text-align:center">显示调用<code>call/apply/bind</code></th>
<th style="text-align:center">构造函数<code>new</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">普通函数<code>this</code></td>
<td style="text-align:center"><code>undefined</code></td>
<td style="text-align:center"><code>obj</code></td>
<td style="text-align:center">指定的<code>this</code></td>
<td style="text-align:center">指向实例对象</td>
</tr>
<tr>
<td style="text-align:center">箭头函数<code>this</code></td>
<td style="text-align:center"><code>*globaThis</code></td>
<td style="text-align:center"><code>*globaThis</code></td>
<td style="text-align:center"><code>*globaThis</code>（忽略指定的<code>this</code>）</td>
<td style="text-align:center">报错</td>
</tr>
</tbody>
</table>
<ul>
<li>箭头函数<code>this</code>为定义时确定，更加符合预期
<ul>
<li><code>*globaThis</code> 声明时外部作用域中<code>this</code></li>
</ul>
</li>
<li>普通函数<code>this</code>为运行时确定，会根据运行时改变</li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://juejin.cn/post/6844903729624252424">彻底理解JavaScript中的this</a></li>
<li><a href="https://zh.javascript.info/object-methods">Javascript.info 对象方法，&ldquo;this&rdquo;</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/arrow_functions">MDN 箭头函数</a></li>
<li><a href="https://zh.javascript.info/arrow-functions">Javascript.info深入理解箭头函数</a></li>
<li><a href="https://www.cnblogs.com/mindsbook/archive/2009/09/27/javascriptYouMustKnow-this-scope.html">javascript必知必会之this关键字及scope</a></li>
</ul>
<blockquote>
<p>第一题</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;里面的name&#34;</span><span class="p">,</span>
  <span class="nx">sayName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`this.name = </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;外面的name&#34;</span>

<span class="kd">function</span> <span class="nx">sayName</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sss</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span>
  <span class="nx">sss</span><span class="p">()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">)()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">)()</span> <span class="c1">// this.name
</span><span class="c1"></span><span class="p">}</span>

<span class="nx">sayName</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>必须使用转换代码来改写程序
<ul>
<li>将所有的函数调用改为 <code>fn.call()</code> 的形式</li>
</ul>
</li>
</ul>
<blockquote>
<p>改写代码</p>
</blockquote>
<ul>
<li>改顺序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">sayName</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sss</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span>
  <span class="nx">sss</span><span class="p">()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">)()</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">)()</span> <span class="c1">// this.name
</span><span class="c1"></span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span>
<span class="kd">var</span> <span class="nx">name</span>
<span class="nx">a</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;里面的name&#34;</span><span class="p">,</span>
  <span class="nx">sayName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`this.name = </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;外面的name&#34;</span>
<span class="nx">sayName</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>改成 <code>.call</code> 的形式</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">sayName</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">sss</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span>
  <span class="nx">sss</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="c1">// this.name
</span><span class="c1"></span>  <span class="p">;(</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">sayName</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="c1">// this.name
</span><span class="c1"></span><span class="p">}</span>
<span class="kd">var</span> <span class="nx">a</span>
<span class="kd">var</span> <span class="nx">name</span>
<span class="nx">a</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;里面的name&#34;</span><span class="p">,</span>
  <span class="nx">sayName</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`this.name = </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;外面的name&#34;</span>
<span class="nx">sayName</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<blockquote>
<p>第二题</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">length</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fn</span><span class="p">()</span>
    <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]()</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">method</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>改写代码</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">length</span>
<span class="kd">var</span> <span class="nx">obj</span>
<span class="nx">length</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">length</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
    <span class="c1">// 错误 arguments[0].call(arguments[0])
</span><span class="c1"></span>    <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span> <span class="c1">// arguments.length 即 [fn, 1].length
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">fn</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 错误 obj.method.call(obj.method, fn, 1) // arguments = [fn, 1]
</span><span class="c1"></span><span class="nx">obj</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// arguments = [fn, 1]
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/23804247">this 的值到底是什么？一次说清楚</a> 给this定性</li>
<li><a href="https://zhuanlan.zhihu.com/p/25991271">你怎么还没搞懂 this？</a> 如何确定this</li>
<li><a href="https://zhuanlan.zhihu.com/p/30164164">JS 里为什么会有 this</a> 为什么要设计this</li>
</ul>
<hr>
<h2 id="11-总结-a-hrefcatalogue--a">11. 总结 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>关于<code>React</code>的知识点</p>
</blockquote>
<ul>
<li>两种方式引入 <code>React</code> 和 <code>ReactDOM</code></li>
<li><code>React.createElement('div' | 函数 | 类)</code></li>
<li>类组件、函数组件如何获取外部数据<code>props</code></li>
<li>类组件、函数组件如何获取外部数据<code>state</code></li>
<li>类组件如何绑定事件，<code>this</code>很麻烦，记忆正确写法</li>
<li>不想记忆<code>this</code>的写法，可以直接使用函数组件，没有<code>this</code>问题，一律用参数和变量</li>
<li><code>React</code>特点：尽量使用<code>JS</code>本身语法特点，能不帮你做，就不做</li>
</ul>
<blockquote>
<p>其他知识点</p>
</blockquote>
<ul>
<li><code>Vue</code>的特点：能帮你做的， 都帮你做</li>
<li><code>this</code>的复习</li>
</ul>
<blockquote>
<p><code>React</code> V.S. <code>Vue</code></p>
</blockquote>
<ul>
<li>相同点
<ul>
<li>都是对视图的封装
<ul>
<li><code>React</code>使用类和函数表示一个组件</li>
<li><code>Vue</code>通过构造选项构造一个组件（也可用<code>compostion api</code>）</li>
</ul>
</li>
<li>通过编译，都提供了<code>createElement</code>的<code>XML</code>简写
<ul>
<li><code>React</code>提供<code>JSX/TSX</code>语法</li>
<li><code>Vue</code>提供 模板语法（语法巨多）、装饰器类组件（实验或弃用）和 <code>JSX/TSX</code> 语法</li>
</ul>
</li>
</ul>
</li>
<li>不同点
<ul>
<li><code>React</code>是把<code>HTML</code>放在<code>JS</code>里写，即 <code>HTML in JS</code></li>
<li><code>Vue</code> 将 <code>JS</code> 放在 <code>HTML</code>，即 <code>JS in HTML</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="12-课后习题react-组件-a-hrefcatalogue--a">12. 课后习题：<code>React</code> 组件 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>用 React 类组件写出一个 n+1 的 demo，要求：</p>
</blockquote>
<ul>
<li>n 一开始为 0</li>
<li>每次点击 +1，n 的值增加1</li>
<li><a href="https://codesandbox.io/s/agitated-jang-92yk9">代码参考</a></li>
<li><a href="https://codesandbox.io/s/stupefied-cookies-oiydcd?file=/src/index.js">代码链接</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s2">&#34;./styles.css&#34;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">n</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>
  <span class="p">}</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">n</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
        <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">()}&gt;</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;root&#34;</span><span class="p">);</span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>用 React 函数组件写出一个 n+1 的 demo，要求：</p>
</blockquote>
<ul>
<li>n 一开始为 0</li>
<li>每次点击 +1，n 的值增加1</li>
<li><a href="https://codesandbox.io/s/wild-cloud-4s8q7">代码参考</a></li>
<li><a href="https://codesandbox.io/s/suspicious-wind-grxb55?file=/src/index.js">代码链接</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>

<span class="kr">import</span> <span class="s2">&#34;./styles.css&#34;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()=&gt;</span><span class="nx">setN</span><span class="p">(</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)}&gt;</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;root&#34;</span><span class="p">);</span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="react与this指向丢失的问题-a-hrefcatalogue--a"><code>React</code>与<code>this</code>指向丢失的问题 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>首先搭建一个环境</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">npx create-react-app hello-react
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在<code>index.js</code>文件中编写一个基础代码</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="c1">// this 值为 undefined
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}&gt;</span>
        <span class="nx">Click</span> <span class="nx">Me</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="p">&lt;</span><span class="nt">React.StrictMode</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">App</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">React.StrictMode</span><span class="p">&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementByid</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>handleClick</code>中的<code>this</code>指向预期为 <code>App</code> 组件的实例</li>
<li>但实际指向 <code>undefined</code>，发生了<code>this</code>指向丢失</li>
</ul>
<blockquote>
<p>加断点来调试</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// debugger
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="c1">// this 值为 undefined
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}&gt;</span>
        <span class="nx">Click</span> <span class="nx">Me</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// JSX =&gt; VDom =&gt; diff =&gt; render抽象 =&gt; renderDom
</span><span class="c1"></span>  <span class="c1">// 模拟最终产物
</span><span class="c1"></span>  <span class="nx">renderDom</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Click Me Dom&#39;</span><span class="p">)</span>
    <span class="kd">function</span> <span class="nx">createCallback</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="kc">undefined</span>
      <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="c1">// 忽略参数
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">createCallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">))</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root2&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// ...
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">App</span><span class="p">()</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">renderDom</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>绑定<code>this</code>指向的方法
<ul>
<li><code>.call(app)</code></li>
<li><code>app.handleClick</code></li>
</ul>
</li>
<li><code>ReactDOM</code>的 <code>callCallback()</code> 中调用 <code>func.apply(context, funcArgs)</code>
<ul>
<li><code>context</code>里的指向为空 <code>null</code></li>
</ul>
</li>
<li><code>btn.addEventListener('click', createCallback(this.handleClick))</code>套了一层<code>createCallback</code>
<ul>
<li><code>() =&gt; fn.apply(context)</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>破解之道1：在构造函数上<code>bind</code></p>
</blockquote>
<ul>
<li>用<code>bind</code>改写<code>constructor</code>中实例的方法</li>
<li>实例上的方法，优先级高 于原型上的类方法，将原型上的类方法绑定实例对象后返回新的函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">class</span> <span class="nx">App</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="c1">// 实例方法，优先级高于原型上的类方法，将原型上的类方法绑定实例对象后返回新的函数
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="c1">// 原型上的类方法
</span><span class="c1"></span>  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// debugger
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="c1">// this 值为 undefined
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}&gt;</span>
        <span class="nx">Click</span> <span class="nx">Me</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">//...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>破解之道2：在<code>render</code>方法上<code>bind</code></p>
</blockquote>
<ul>
<li>在使用<code>handleClick</code>时用<code>bind</code>绑定<code>this</code></li>
<li><code>render</code>方法的作用域也是指向实例对象的</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">//...
</span><span class="c1"></span><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}&gt;</span><span class="nx">Click</span> <span class="nx">Me</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 模拟最终产物
</span><span class="c1"></span><span class="nx">renderDom</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Click Me Dom&#39;</span><span class="p">)</span>
  <span class="kd">function</span> <span class="nx">createCallback</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="kc">undefined</span>
    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="c1">// 忽略参数
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">createCallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)))</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root2&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span>
  <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>破解之道3：<code>handle</code>函数使用箭头函数</p>
</blockquote>
<ul>
<li>利用词法作用域，箭头函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// ...
</span><span class="c1">// 实例上的方法
</span><span class="c1"></span>  <span class="nx">handleClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="c1">// 外层的词法作用域，即指向app实例对象
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}&gt;</span>
        <span class="nx">Click</span> <span class="nx">Me</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>

<span class="c1">// 模拟最终产物
</span><span class="c1"></span><span class="nx">renderDom</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Click Me Dom&#39;</span><span class="p">)</span>
  <span class="kd">function</span> <span class="nx">createCallback</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="kc">undefined</span>
    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="c1">// 忽略参数
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">createCallback</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">))</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root2&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span>
  <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>破解之道4：在<code>render</code>方法中绑定事件函数使用箭头函数</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// ...
</span><span class="c1">// 实例上的方法
</span><span class="c1"></span>  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span> <span class="c1">// 外层的词法作用域，即指向app实例对象
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">()}&gt;</span>
        <span class="nx">Click</span> <span class="nx">Me</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>

<span class="c1">// 模拟最终产物
</span><span class="c1"></span><span class="nx">renderDom</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;Click Me Dom&#39;</span><span class="p">)</span>
  <span class="kd">function</span> <span class="nx">createCallback</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="kc">undefined</span>
    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="c1">// 忽略参数
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">createCallback</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">()))</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root2&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">btn</span><span class="p">)</span>
  <span class="k">return</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>都可以
<ul>
<li><code>&lt;button onClick={() =&gt; this.handleClick()}&gt;</code></li>
<li><code>&lt;button onClick={() =&gt; {this.handleClick()}}&gt;</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><code>React</code>的<code>this</code>丢失问题，丢失的原因和解决之道涉及了<code>this</code>指向</p>
</blockquote>
<hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h2 id="参考文章-a-hrefcatalogue--a">参考文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><a href="https://static.xiedaimala.com/xdml/file/3ac7c224-c23d-491f-84b5-4fabfbeab9b8/2020-1-12-20-18-45.pdf">React 组件.pdf</a></li>
</ul>
<h2 id="相关文章-a-hrefcatalogue--a">相关文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><a href="https://beta.reactjs.org/apis/react-dom/client/createRoot#create-root">React18 createRoot</a></li>
<li><a href="https://www.cnblogs.com/lovewhatIlove/p/16211045.html/"><code>React 18</code>，不再支持 <code>render</code> 绑定根元素节点，否则降版本到 <code>react 17</code></a></li>
<li><a href="https://juejin.cn/post/6992435557456412709">React 18 用 createRoot 替换 render，保留 Legacy Root API 平滑升级  </a></li>
<li><a href="https://juejin.cn/post/7022178828684361736">React18 为什么要用 createRoot 取代 render</a></li>
<li><a href="https://note.youdao.com/">React18 我帮一朋友重构了点代码，他直呼牛批，但基操勿六</a></li>
<li><a href="https://www.bilibili.com/video/BV1gr4y1U7pY/?p=19&amp;vd_source=b70cfbdcfa9b2af1a3a6623f4af21158">全站然叔 2022年前端面试题汇总 <code>React</code>与<code>this</code>指向丢失的问题</a></li>
</ul>
<hr>
<ul>
<li>作者： Joel</li>
<li>文章链接：</li>
<li><a href="http://xmasuhai.xyz/posts/%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%E9%93%BE%E6%8E%A5/">版权声明</a></li>
<li>非自由转载-非商用-非衍生-保持署名</li>
</ul>
<hr>
<hr>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-10-02
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/react/">React</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-2class-%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">【React非全解 2】Class 组件详解</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-0react%E8%B5%B7%E6%89%8B%E5%BC%8F/">
            <span class="next-text nav-default">【React非全解 0】React起手式</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
