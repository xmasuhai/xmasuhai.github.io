<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【React非全解 5】React 内置 Hooks 各个击破 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="Hooks 各个击破 大纲链接§ [toc] React 内置的 Hooks 主要有以下几个： useState 组件状态 useEffect 副作用 useLayoutEffect useContext 上下文 useMemo 缓存 useCallback 回调 useReducer 统一状态管理（替代Redux） useRef 引用 useImperativeHandle useDebugValue 自定义 1. useState" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.91.2" />


<link rel="canonical" href="http://xmasuhai.xyz/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-5hooks-%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【React非全解 5】React 内置 Hooks 各个击破" />
<meta property="og:description" content="Hooks 各个击破 大纲链接§ [toc] React 内置的 Hooks 主要有以下几个： useState 组件状态 useEffect 副作用 useLayoutEffect useContext 上下文 useMemo 缓存 useCallback 回调 useReducer 统一状态管理（替代Redux） useRef 引用 useImperativeHandle useDebugValue 自定义 1. useState" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-5hooks-%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-10-07T01:31:17+08:00" />
<meta property="article:modified_time" content="2022-10-07T01:36:52+08:00" />

<meta itemprop="name" content="【React非全解 5】React 内置 Hooks 各个击破">
<meta itemprop="description" content="Hooks 各个击破 大纲链接§ [toc] React 内置的 Hooks 主要有以下几个： useState 组件状态 useEffect 副作用 useLayoutEffect useContext 上下文 useMemo 缓存 useCallback 回调 useReducer 统一状态管理（替代Redux） useRef 引用 useImperativeHandle useDebugValue 自定义 1. useState"><meta itemprop="datePublished" content="2022-10-07T01:31:17+08:00" />
<meta itemprop="dateModified" content="2022-10-07T01:36:52+08:00" />
<meta itemprop="wordCount" content="12395">
<meta itemprop="keywords" content="FrontEnd,React," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【React非全解 5】React 内置 Hooks 各个击破"/>
<meta name="twitter:description" content="Hooks 各个击破 大纲链接§ [toc] React 内置的 Hooks 主要有以下几个： useState 组件状态 useEffect 副作用 useLayoutEffect useContext 上下文 useMemo 缓存 useCallback 回调 useReducer 统一状态管理（替代Redux） useRef 引用 useImperativeHandle useDebugValue 自定义 1. useState"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【React非全解 5】React 内置 Hooks 各个击破</h1>
      
      <div class="post-meta">
        <time datetime="2022-10-07" class="post-time">
          2022-10-07
        </time>
        <div class="post-category">
            <a href="http://xmasuhai.xyz/categories/react/"> React </a>
            
          </div>
        <span class="more-meta"> 约 12395 字 </span>
          <span class="more-meta"> 预计阅读 25 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-usestate-a-hrefcatalogue--a">1. <code>useState</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#注意事项1不可局部更新属性不自动合并-a-hrefcatalogue--a">注意事项1：不可局部更新属性，不自动合并 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#注意事项2地址要变-a-hrefcatalogue--a">注意事项2：地址要变 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#注意事项3-接受函数-a-hrefcatalogue--a">注意事项3 接受函数 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#2-usereducer-a-hrefcatalogue--a">2. <code>useReducer</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#3-用-usereducer-代替-redux-a-hrefcatalogue--a">3. 用 <code>useReducer</code> 代替 <code>redux</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#辅助函数和基本结构-a-hrefcatalogue--a">辅助函数和基本结构 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#复杂usereducer使用步骤-a-hrefcatalogue--a">复杂<code>useReducer</code>使用步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#模块化处理-a-hrefcatalogue--a">模块化处理 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#4-usecontext-a-hrefcatalogue--a">4. <code>useContext</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#使用usecontext注意事项-a-hrefcatalogue--a">使用<code>useContext</code>注意事项 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#5-useeffect--uselayouteffect-a-hrefcatalogue--a">5. <code>useEffect</code> &amp; <code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#useeffect-a-hrefcatalogue--a"><code>useEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#uselayouteffect-a-hrefcatalogue--a"><code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#useeffect-vs-uselayouteffect-a-hrefcatalogue--a"><code>useEffect</code> V.S. <code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#6-usememo-a-hrefcatalogue--a">6. <code>useMemo</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#使用usememo前先需要理解-reactmemo-a-hrefcatalogue--a">使用<code>useMemo</code>前，先需要理解 <code>React.memo</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#reactmemo的bug-a-hrefcatalogue--a"><code>React.memo</code>的<code>bug</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#配合使用usememo解决reactmemo的问题">配合使用<code>useMemo</code>解决<code>React.memo</code>的问题</a></li>
        <li><a href="#usecallback是usememo的语法糖"><code>useCallback</code>是<code>useMemo</code>的语法糖</a></li>
      </ul>
    </li>
    <li><a href="#7-useref-a-hrefcatalogue--a">7. <code>useRef</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#useref用途a-hrefcatalogue--a"><code>useRef</code>用途：<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#useref读取值为什么需要currenta-hrefcatalogue--a"><code>useRef</code>读取值为什么需要<code>.current</code>？<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#useref不能做到变化时自动render刷新ui需要额外步骤-a-hrefcatalogue--a"><code>useRef</code>不能做到变化时自动<code>render</code>刷新<code>UI</code>，需要额外步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#8-useref配合forwardref用在函数组件中-a-hrefcatalogue--a">8. <code>useRef</code>配合<code>forwardRef</code>用在函数组件中 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#9-useimperativehandle-a-hrefcatalogue--a">9. <code>useImperativeHandle</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#10-自定义-hook-a-hrefcatalogue--a">10. 自定义 <code>Hook</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#11-stale-closure过时的闭包-a-hrefcatalogue--a">11. <code>Stale Closure</code>过时的闭包 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#12-总结-a-hrefcatalogue--a">12. 总结 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#参考文章-a-hrefcatalogue--a">参考文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#相关文章-a-hrefcatalogue--a">相关文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="hooks-各个击破">Hooks 各个击破</h1>
<blockquote>
<p>大纲链接<!-- raw HTML omitted --> § <!-- raw HTML omitted --></p>
</blockquote>
<p>[toc]</p>
<hr>
<blockquote>
<p><code>React</code> 内置的 <code>Hooks</code> 主要有以下几个：</p>
</blockquote>
<ul>
<li><code>useState</code> 组件状态</li>
<li><code>useEffect</code> 副作用
<ul>
<li><code>useLayoutEffect</code></li>
</ul>
</li>
<li><code>useContext</code> 上下文</li>
<li><code>useMemo</code> 缓存
<ul>
<li><code>useCallback</code> 回调</li>
</ul>
</li>
<li><code>useReducer</code> 统一状态管理（替代<code>Redux</code>）</li>
<li><code>useRef</code> 引用
<ul>
<li><code>useImperativeHandle</code></li>
</ul>
</li>
<li><code>useDebugValue</code> 自定义</li>
</ul>
<hr>
<h2 id="1-usestate-a-hrefcatalogue--a">1. <code>useState</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>使用组件状态</p>
</blockquote>
<ul>
<li><code>const [n, setN] = React.useState(0)</code> 原始类型</li>
<li><code>const [user, setUser] = React.useState({name: 'F'})</code> 复杂类型</li>
</ul>
<h3 id="注意事项1不可局部更新属性不自动合并-a-hrefcatalogue--a">注意事项1：不可局部更新属性，不自动合并 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>如果<code>state</code>是一个复杂类型（对象等），禁止部分<code>setState</code>，<a href="https://codesandbox.io/s/snowy-pine-7gdw2">示例代码</a>
<ul>
<li>因为<code>setState</code>不会自动合并属性，缺失没有写入的属性</li>
<li><code>useReducer</code>也不会自动合并</li>
</ul>
</li>
<li>解决方法：使用 <code>...</code>，在对象中拷贝原状态的属性，再局部覆盖同名属性</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">useState</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="nx">setUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Franche&#39;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">})</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setUser</span><span class="p">({</span>
    <span class="p">...</span><span class="nx">user</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Jack&#39;</span> <span class="c1">// 同名覆盖原先的name属性
</span><span class="c1"></span>    <span class="p">})</span>

    <span class="cm">/*
</span><span class="cm">    setUser({
</span><span class="cm">      name: &#39;Jack&#39; // 缺失 age 属性
</span><span class="cm">    })
</span><span class="cm">    */</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">Click</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;root&#34;</span><span class="p">);</span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="注意事项2地址要变-a-hrefcatalogue--a">注意事项2：地址要变 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li><code>setState(obj)</code> 如果<code>obj</code>不变，那么<code>React</code>中数据不变</li>
<li><code>React</code> 只侦测对象地址变化，不侦测同对象的属性变化</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">useState</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">user</span><span class="p">,</span><span class="nx">setUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="s1">&#39;Franche&#39;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">})</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 错误的演示：地址不变，React中数据不变
</span><span class="c1"></span>    <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;Mick&#39;</span>
    <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="c1">// 不会更新UI
</span><span class="c1"></span>    <span class="cm">/*
</span><span class="cm">    setUser({
</span><span class="cm">      ...user,
</span><span class="cm">      name: &#39;Jack&#39;
</span><span class="cm">    }) // 传入的是一个新对象
</span><span class="cm">
</span><span class="cm">    */</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;{</span><span class="nx">user</span><span class="p">.</span><span class="nx">age</span><span class="p">}&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">Click</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;root&#34;</span><span class="p">);</span>
<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="注意事项3-接受函数-a-hrefcatalogue--a">注意事项3 接受函数 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><code>useState</code>接受函数：<code>const [x, setX] = useState(()=&gt;{})</code></p>
</blockquote>
<ul>
<li><code>const [state, setState] = useState( () =&gt; {return initialValue} )</code></li>
<li><code>const [state, setState] = useState( () =&gt; ({/*initialValue*/}) )</code></li>
<li>该函数返回初始<code>state</code>，且只执行一次
<ul>
<li>区别于<code>useState</code>传对象，<code>JS</code>每次会解析该对象</li>
<li><code>useState</code>传工厂函数，减少内部多余的计算过程</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>setState</code>接受函数：<code>setState(()=&gt;{})</code></p>
</blockquote>
<ul>
<li><code>setN(i =&gt; i + 1)</code></li>
<li><a href="https://note.youdao.com/">代码示例</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="p">{</span><span class="nx">useState</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kr">import</span> <span class="nx">ReacDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// n 不会变
</span><span class="c1"></span>    <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// 只有最后一次有效
</span><span class="c1"></span>    <span class="cm">/* 发现 n 不能 +1 再 +2 */</span>

    <span class="c1">// 改为传函数则符合预期
</span><span class="c1"></span>    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="o">+</span><span class="mi">2</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="nx">reactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>setN(i =&gt; i + 1)</code>并不直接传值，而是传一个函数来操作，形参占位符<code>i</code>命名随便</li>
<li>如果需要对<code>setN</code>多次操作，更推荐使用函数</li>
</ul>
<hr>
<h2 id="2-usereducer-a-hrefcatalogue--a">2. <code>useReducer</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>用来践行 <code>Flux/Redux</code> 的思想</p>
</blockquote>
<ul>
<li>代码示例，共分4步走
<ul>
<li>1.创建初始值<code>initialValue</code></li>
<li>2.创建所有操作<code>reducer(state, action)</code></li>
<li>3.传给<code>useReducer(所有操作, 初始数据)</code>，获取 <strong>读</strong> 和 <strong>写</strong> 的 <code>API</code></li>
<li>4.调用 <strong>写</strong><code>dispatch({type: '操作类型'})</code>，不是直接操作<code>state</code>，而是通过<code>reducer</code>来操作</li>
</ul>
</li>
<li>总的来说<code>useReducer</code>就是<code>useState</code>的复杂版</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="p">{</span><span class="nx">useReducer</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">&#39;react-dom&#39;</span>

<span class="c1">// 1. 创建初始值 initialValue
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">initialValue</span> <span class="o">=</span> <span class="p">{</span><span class="nx">n</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">m</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1">// 2. 创建所有操作 reducer(state旧的状态, action操作含有自定义的属性)
</span><span class="c1"></span><span class="cm">/*
</span><span class="cm">* @params({}) state
</span><span class="cm">* @params({type: string}) action
</span><span class="cm">* @return newState
</span><span class="cm">*/</span>
<span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 不可以直接操作属性 state.n += 1; return state 同useState的规则
</span><span class="c1"></span>    <span class="c1">// return {...state, n: state.n + 1}
</span><span class="c1"></span>    <span class="k">return</span> <span class="p">{...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">n</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">+</span> <span class="nx">action</span><span class="p">.</span><span class="nx">number</span><span class="p">}</span> <span class="c1">// 还可以传额外属性参数
</span><span class="c1"></span>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;multi2&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">n</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;unknown type&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 3. 传给 useReducer，获取 读 和 写 的 API
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">initialValue</span><span class="p">)</span>
  <span class="c1">// 也可以直接解构出属性 const {n} = state
</span><span class="c1"></span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 4. 调用 写dispatch({type: &#39;操作类型&#39;})
</span><span class="c1"></span>    <span class="c1">// dispatch({type: &#39;add&#39;}) // 调用`add`分支操作
</span><span class="c1"></span>    <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">number</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span> <span class="c1">// 还可以传额外属性参数
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">onClickAdd2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="nx">number</span><span class="o">:</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">onClickMulti2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;multi2&#39;</span><span class="p">})</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickAdd2</span><span class="p">}&gt;</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickMulti2</span><span class="p">}&gt;</span><span class="nx">n</span> <span class="o">*</span> <span class="mi">2</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">rootElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">)</span>
<span class="nx">reactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(&lt;</span><span class="nt">App</span> <span class="p">/&gt;,</span> <span class="nx">rootElement</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>不可以直接操作属性 <code>state.n += 1; return state</code> 同<code>useState</code>的规则</li>
<li>对多个状态做整体操作</li>
<li>将所有操作聚拢在函数<code>const reducer = (state, action) =&gt; {}</code>中
<ul>
<li>通过<code>action</code>的不同属性，来调用对应不同的分支操作</li>
<li>通过<code>action</code>还可以传额外属性</li>
</ul>
</li>
<li>每次用户操作更新数据，<code>App</code>就重新<code>render</code>一遍</li>
</ul>
<blockquote>
<p>如何判断使用<code>useReducer</code>还是<code>useState</code></p>
</blockquote>
<ul>
<li>事不过三原则：有多个数据可以在一起放入同一个对象里，就适用<code>useReducer</code>，对这个对象做整体操作</li>
<li>例如表单中的数据，见 <a href="https://codesandbox.io/s/sweet-worker-zw6zzo">用<code>useReducer</code>表单代码示例</a>：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// import...
</span><span class="c1"></span>
<span class="kr">const</span> <span class="nx">initFormData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
  <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="nx">nationality</span><span class="o">:</span> <span class="s1">&#39;泰伦&#39;</span>
<span class="p">}</span>

<span class="c1">// 汇总操作
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">reducer</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&#34;patch&#34;</span><span class="o">:</span> <span class="c1">// 更新 合并新旧属性
</span><span class="c1"></span>      <span class="k">return</span> <span class="p">{...</span><span class="nx">state</span><span class="p">,</span> <span class="p">...</span><span class="nx">action</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="k">case</span> <span class="s2">&#34;reset&#34;</span><span class="o">:</span> <span class="c1">// 重置
</span><span class="c1"></span>      <span class="k">return</span> <span class="nx">initFormData</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;type传错了&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 生成表单数据
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">formDataGenerator</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">cb</span> <span class="p">})</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;App执行了一遍&#39;</span><span class="p">)</span>

  <span class="c1">// 获取读写接口
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">formData</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">initFormData</span><span class="p">)</span>

  <span class="c1">// 表单操作
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">onReset</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;reset&#39;</span><span class="p">})</span> <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">onSubmit</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;提交了&#39;</span><span class="p">);</span> <span class="nx">onReset</span><span class="p">()}</span>

  <span class="c1">// 提取patch公共方法
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">patch</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;patch&#39;</span><span class="p">,</span> <span class="nx">formData</span><span class="o">:</span> <span class="p">{[</span><span class="nx">key</span><span class="p">]</span><span class="o">:</span> <span class="nx">value</span><span class="p">}</span> <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// 表单汇总数据
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">formContentList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">formDataGenerator</span><span class="p">(</span> <span class="s1">&#39;姓名&#39;</span><span class="p">,</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">),</span>
    <span class="nx">formDataGenerator</span><span class="p">(</span> <span class="s1">&#39;年龄&#39;</span><span class="p">,</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">age</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">),</span>
    <span class="nx">formDataGenerator</span><span class="p">(</span> <span class="s1">&#39;名族&#39;</span><span class="p">,</span> <span class="nx">formData</span><span class="p">.</span><span class="nx">nationality</span><span class="p">,</span> <span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">patch</span><span class="p">(</span><span class="s1">&#39;nationality&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">]</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit</span><span class="o">=</span><span class="p">{</span><span class="nx">onSubmit</span><span class="p">}</span> <span class="na">onReset</span><span class="o">=</span><span class="p">{</span><span class="nx">onReset</span><span class="p">}&gt;</span>
      <span class="p">{</span>
        <span class="nx">formContentList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">}&gt;</span>
              <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>
                <span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span> <span class="na">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">cb</span><span class="p">}</span> <span class="p">/&gt;</span>
              <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
          <span class="p">)</span>
        <span class="p">})</span>
      <span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span><span class="nx">提交</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;reset&#34;</span><span class="p">&gt;</span><span class="nx">重置</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span><span class="p">/&gt;</span>
      <span class="p">{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">formData</span><span class="p">)}</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// render...
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="3-用-usereducer-代替-redux-a-hrefcatalogue--a">3. 用 <code>useReducer</code> 代替 <code>redux</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="辅助函数和基本结构-a-hrefcatalogue--a">辅助函数和基本结构 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>辅助函数，假的<code>AJAX</code>获取数据，调用时传入参数 <code>url</code>，返回对应数据</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 辅助函数
</span><span class="c1">// 假 ajax
</span><span class="c1">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ajax</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/user&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span>
          <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Frank&#34;</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/books&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">([</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;JavaScript 高级程序设计&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;JavaScript 精粹&#34;</span>
          <span class="p">}</span>
        <span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/movies&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">([</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;爱在黎明破晓前&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;恋恋笔记本&#34;</span>
          <span class="p">}</span>
        <span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>基本结构</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useReducer</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">createContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>

<span class="c1">// 统一的数据储存
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">user</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">books</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">movies</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">}</span>

<span class="c1">// 统一的操作
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{}</span>

<span class="c1">// 统一的上下文 数据提供 组件
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Context</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">User</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span> <span class="c1">// 注意是获取对象使用花括号
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">个人信息</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Books</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">书籍信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Movies</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">电影信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 创建对数据的读写API
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">store</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">{</span><span class="cm">/* 统一的上下文 数据提供 */</span><span class="p">}</span> <span class="p">{</span><span class="cm">/* 提供数据对象 {state, dispatch} ES6对象语法缩写 */</span><span class="p">}</span>
    <span class="p">&lt;</span><span class="nt">Context.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}}&gt;</span>
      <span class="p">&lt;</span><span class="nt">User</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Books</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Movies</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Context.Provider</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// render...
</span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="复杂usereducer使用步骤-a-hrefcatalogue--a">复杂<code>useReducer</code>使用步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ol>
<li>将数据几种在一个<code>store</code>对象中</li>
<li>将所有操作集中在<code>reducer</code>方法中</li>
<li>创建一个<code>Context</code></li>
<li>创建对数据的读写<code>API</code></li>
<li>将第四步的内容<code>{state, dispatch}</code>放到第三步的上下文数据提供组件中</li>
<li>用<code>Context.Provider</code>将<code>Context</code>提供给所有子组件</li>
</ol>
<ul>
<li><code>&lt;Context.Provider value={{state, dispatch}}&gt;{/* 里面是各个子组件 */}&lt;/Context.Provider&gt;</code></li>
</ul>
<ol start="7">
<li>各个组件用<code>useContext</code>获取读写<code>API</code>：<code>const {state, dispatch} = useContext(Context)</code>（注意是获取对象使用花括号）</li>
</ol>
<blockquote>
<p><a href="https://codesandbox.io/s/wizardly-allen-e6mylh">当前示例代码</a></p>
</blockquote>
<ul>
<li>请求获取<code>mock</code>数据，<code>ajax('/user').then（user =&gt; {dispatch({type: 'setUser', user})}</code>（ES6对象属性简写）</li>
<li>每次刷新组件时，都会再去请求一次<code>AJAX</code>，为了防止每次渲染就请求一次，可以使用<code>useEffect</code>只在进入页面时请求一次
<ul>
<li><code>useEffect(() =&gt; {}, [])</code>，第二个参数传一个空数组，那么只会在第一次进入页面时运行，之后永远不会再执行（之后有更好的方式）</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// import...
</span><span class="c1"></span>
<span class="c1">// 统一的数据储存
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">user</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">books</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">movies</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">}</span>

<span class="c1">// 统一的操作
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&#34;setUser&#34;</span><span class="o">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">user</span> <span class="p">};</span>
    <span class="k">case</span> <span class="s2">&#34;setBooks&#34;</span><span class="o">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">books</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span> <span class="p">};</span>
    <span class="k">case</span> <span class="s2">&#34;setMovies&#34;</span><span class="o">:</span>
      <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">movies</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">movies</span> <span class="p">};</span>
    <span class="k">default</span><span class="o">:</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 统一的上下文 数据提供 组件
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Context</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">User</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求用户数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setUser&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span> <span class="c1">// 模拟 componentDidMount
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">个人信息</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">:</span> <span class="s2">&#34;加载中&#34;</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Books</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求书籍数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/books&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">books</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setBooks&#39;</span><span class="p">,</span> <span class="nx">books</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">书籍信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
        <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span>
          <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">book</span> <span class="p">=&gt;</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">book</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;)</span>
          <span class="o">:</span> <span class="s1">&#39;加载中&#39;</span>
        <span class="p">}</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Movies</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求电影数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/movies&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setMovies&#39;</span><span class="p">,</span> <span class="nx">movies</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">电影信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
        <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">movies</span>
          <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">movie</span> <span class="p">=&gt;</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">movie</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;)</span>
          <span class="o">:</span> <span class="s1">&#39;加载中&#39;</span>
        <span class="p">}</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 创建对数据的读写API
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">store</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">Context.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}}&gt;</span>
    <span class="p">{</span><span class="cm">/* 统一的上下文 数据提供 */</span><span class="p">}</span> <span class="p">{</span><span class="cm">/* 提供数据对象 {state, dispatch} ES6对象语法缩写 */</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">User</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Books</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Movies</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Context.Provider</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// render...
</span></code></pre></td></tr></table>
</div>
</div><h3 id="模块化处理-a-hrefcatalogue--a">模块化处理 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>目录</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">src
┣ component
   ┣ User.jsx
   ┣ Books.jsx
   ┗ Movies.jsx
┣ reducers
   ┣ use_reducer.js
   ┣ books_reducer.jsx
   ┗ movies_reducer.jsx
┣ context.js
┣ ajax.js
┣ main.jsx
┗ ...
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>main.jsx</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useReducer</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">createContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s2">&#34;react-dom&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">User</span> <span class="nx">from</span> <span class="s1">&#39;./component/User&#39;</span>
<span class="kr">import</span> <span class="nx">Books</span> <span class="nx">from</span> <span class="s1">&#39;./component/Books&#39;</span>
<span class="kr">import</span> <span class="nx">Movies</span> <span class="nx">from</span> <span class="s1">&#39;./component/Movies&#39;</span>
<span class="kr">import</span> <span class="nx">Context</span> <span class="nx">from</span> <span class="s1">&#39;./Context&#39;</span>
<span class="kr">import</span> <span class="nx">ajax</span> <span class="nx">from</span> <span class="s1">&#39;./ajax&#39;</span>
<span class="kr">import</span> <span class="nx">userReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/use_reducer&#39;</span>
<span class="kr">import</span> <span class="nx">booksReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/books_reducer&#39;</span>
<span class="kr">import</span> <span class="nx">moviesReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/movies_reducer&#39;</span>

<span class="c1">// 统一的数据储存
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">user</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">books</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">movies</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">}</span>

<span class="c1">// 引入reducer操作表
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">reducerHash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">userReducer</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">booksReducer</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">moviesReducer</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">// 统一的reducer操作 查找reducer操作表
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">reducerHash</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">reducerHash</span><span class="p">[</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">](</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;type错误&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 创建对数据的读写API
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="nx">store</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">Context.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}}&gt;</span>
    <span class="p">{</span><span class="cm">/* 统一的上下文 数据提供 */</span><span class="p">}</span> <span class="p">{</span><span class="cm">/* 提供数据对象 {state, dispatch} ES6对象语法缩写 */</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">User</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">hr</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Books</span> <span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">Movies</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Context.Provider</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意使用策略模式（表驱动）重构<code>reducer</code>代码。如下，之后可拆分为模块文件，分别导入，方便增加其他接口</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">reducerHash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;setUser&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">user</span><span class="p">}),</span>
  <span class="s1">&#39;setBooks&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">books</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">}),</span>
  <span class="s1">&#39;setMovies&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">movies</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">movies</span><span class="p">}),</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 改为引入模块
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">userReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/use_reducer&#39;</span>
<span class="kr">import</span> <span class="nx">booksReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/books_reducer&#39;</span>
<span class="kr">import</span> <span class="nx">moviesReducer</span> <span class="nx">from</span> <span class="s1">&#39;./reducers/movies_reducer&#39;</span>
<span class="c1">// 引入reducer操作表
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">reducerHash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">userReducer</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">booksReducer</span><span class="p">,</span>
  <span class="p">...</span><span class="nx">moviesReducer</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>use_reducer</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="s1">&#39;setUser&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">user</span><span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>books_reducer</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="s1">&#39;setBooks&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">books</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">books</span><span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>movies_reducer</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="s1">&#39;setMovies&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({...</span><span class="nx">state</span><span class="p">,</span> <span class="nx">movies</span><span class="o">:</span> <span class="nx">action</span><span class="p">.</span><span class="nx">movies</span><span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>User.jsx</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Context</span> <span class="nx">from</span> <span class="s1">&#39;./Context&#39;</span>
<span class="kr">import</span> <span class="nx">ajax</span> <span class="nx">from</span> <span class="s1">&#39;./ajax&#39;</span>

<span class="kd">function</span> <span class="nx">User</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求用户数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setUser&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span> <span class="c1">// 模拟 componentDidMount
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">个人信息</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">name</span><span class="o">:</span> <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">user</span> <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">:</span> <span class="s2">&#34;加载中...&#34;</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">User</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Books.jsx</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Context</span> <span class="nx">from</span> <span class="s1">&#39;./Context&#39;</span>
<span class="kr">import</span> <span class="nx">ajax</span> <span class="nx">from</span> <span class="s1">&#39;./ajax&#39;</span>

<span class="kd">function</span> <span class="nx">Books</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求书籍数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/books&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">books</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setBooks&#39;</span><span class="p">,</span> <span class="nx">books</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">书籍信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
        <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">books</span>
          <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">books</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">book</span> <span class="p">=&gt;</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">book</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;)</span>
          <span class="o">:</span> <span class="s1">&#39;加载中...&#39;</span>
        <span class="p">}</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">Books</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Movies.jsx</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span><span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Context</span> <span class="nx">from</span> <span class="s1">&#39;./Context&#39;</span>
<span class="kr">import</span> <span class="nx">ajax</span> <span class="nx">from</span> <span class="s1">&#39;./ajax&#39;</span>

<span class="kd">function</span> <span class="nx">Movies</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">state</span><span class="p">,</span> <span class="nx">dispatch</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Context</span><span class="p">)</span>
  <span class="c1">// 模拟请求电影数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s1">&#39;/movies&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">movies</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">dispatch</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;setMovies&#39;</span><span class="p">,</span> <span class="nx">movies</span><span class="p">})})</span>
  <span class="p">},</span> <span class="p">[])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span><span class="nx">电影信息</span><span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
        <span class="p">{</span><span class="nx">state</span><span class="p">.</span><span class="nx">movies</span>
          <span class="o">?</span> <span class="nx">state</span><span class="p">.</span><span class="nx">movies</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">movie</span> <span class="p">=&gt;</span> <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">movie</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">movie</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;)</span>
          <span class="o">:</span> <span class="s1">&#39;加载中...&#39;</span>
        <span class="p">}</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">Movies</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Context.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 统一的上下文 数据提供 组件
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Context</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">Context</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>ajax.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 假 ajax
</span><span class="c1">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">ajax</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/user&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">({</span>
          <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Frank&#34;</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/books&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">([</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;JavaScript 高级程序设计&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;JavaScript 精粹&#34;</span>
          <span class="p">}</span>
        <span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s2">&#34;/movies&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">([</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;爱在黎明破晓前&#34;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;恋恋笔记本&#34;</span>
          <span class="p">}</span>
        <span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">ajax</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>小结：使用<code>useReduce</code>和<code>useContext/createContext</code>就可以代替<code>Redux</code></li>
<li>但更复杂的场景，可使用<code>Redux-Saga</code>等</li>
<li>在自定义hooks中可实现完全代替</li>
</ul>
<hr>
<h2 id="4-usecontext-a-hrefcatalogue--a">4. <code>useContext</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>上下文</p>
</blockquote>
<ul>
<li>全局变量 是 全局的 上下文</li>
<li>上下文 是 局部的 全局变量</li>
</ul>
<blockquote>
<p>使用方法，可分为三步</p>
</blockquote>
<ul>
<li>使用<code>const Ctx = createContext(initialValue)</code> 创建上下文
<ul>
<li>初始值<code>initialValue</code>可以为<code>null</code></li>
</ul>
</li>
<li>使用<code>&lt;Context.Provider&gt;&lt;/Context.Provider&gt;</code>圈定作用域范围，在标签内部写子组件
<ul>
<li>在此标签上添加需要传入的初始属性<code>value</code>，一般是一个包含读和写接口的对象</li>
<li><code>&lt;Context.Provider value={{state, dispatch}}&gt;&lt;/Context.Provider&gt;</code></li>
</ul>
</li>
<li>在作用域内，使用<code>useContext(Ctx)</code>，来使用上下文
<ul>
<li>获取读和写的接口<code>const {state, dispatch} = useContext(Ctx)</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">Ctx</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">Ctx.Provider</span> <span class="na">value</span><span class="o">=</span><span class="p">{{</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">}}&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Baba</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">Ctx.Provider</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Baba</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Ctx</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="nx">爸爸</span> <span class="nx">得到的n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">Child</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">Child</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">}</span> <span class="o">=</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">Ctx</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="nx">儿子</span> <span class="nx">得到的n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>useContext</code>将数据传递给圈定的作用域内所有子孙代组件</li>
<li>可以配合<code>useState</code>或者<code>useReducer</code>来获取读写接口</li>
</ul>
<hr>
<h3 id="使用usecontext注意事项-a-hrefcatalogue--a">使用<code>useContext</code>注意事项 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>区别于<code>Vue</code>，数据更新不是响应式的，而只是一个重新渲染的过程（从上而下逐级通知<code>setN</code>重新渲染）</p>
</blockquote>
<ul>
<li>在一个模块中，将<code>Ctx</code>里的值改变（动态<code>Context</code>）</li>
<li>在另一个模块不会感知到这个变化</li>
<li>在某个子组件中触发<code>setN</code>变更数据，通知根组件<code>&lt;App /&gt;</code>变更，然后 <strong>自顶向下，逐级</strong> 通知使用到数据的组件去更新数据</li>
<li>数据流向始终是单向的</li>
</ul>
<hr>
<h2 id="5-useeffect--uselayouteffect-a-hrefcatalogue--a">5. <code>useEffect</code> &amp; <code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="useeffect-a-hrefcatalogue--a"><code>useEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>副作用（函数式概念）</p>
</blockquote>
<ul>
<li>对环境的改变即为 <strong>副作用</strong>，例如修改 <code>document.title</code></li>
<li>但不一定非要把副作用放在<code>useEffect</code>里</li>
<li>实际上，称为 <code>useAfterRender</code> 更好，即每次<code>render</code>后运行</li>
</ul>
<blockquote>
<p>用途</p>
</blockquote>
<ul>
<li>模拟组件生命周期的三个钩子函数
<ul>
<li>作为<code>componentDidMount</code>使用，将空数组<code>[]</code>作为第二个参数</li>
<li>作为<code>componentDidUpdate</code>使用，第二个参数指定依赖 <code>[n]</code> 放在数组中</li>
<li>作为<code>componentWillUnmount</code>使用，通过<code>return () =&gt; {}</code>
<ul>
<li>路由中常用，在此钩子中做清理工作，防止内存泄漏</li>
<li>对回京做的任何变动，组件卸载时都需要清理</li>
</ul>
</li>
</ul>
</li>
<li>第二个参数 和 返回的回调 决定了回调函数什么时候再次执行</li>
<li>以上三种用途可同时存在</li>
</ul>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li>如果同时存在多个<code>useEffect</code>，会按照 <strong>出现次序</strong> 执行</li>
</ul>
<blockquote>
<p><a href="https://codesandbox.io/s/small-star-r0qg9h">代码示例</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// App第一次渲染 mount
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;第一次渲染之后执行&#39;</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[])</span> <span class="c1">// 表示 [] 里的状态变化后再次执行，没有变量就不会再次执行
</span><span class="c1"></span>
  <span class="c1">// App 任何数据更新后渲染 update
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;任何一个state状态变化时，即每次渲染之后都执行&#39;</span><span class="p">)</span>
  <span class="p">})</span> <span class="c1">// 不写第二个参数表示 任何依赖变化时都执行
</span><span class="c1"></span>
  <span class="c1">// 具体到某个数据更新后渲染 update
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`当依赖n变化，渲染后执行，第</span><span class="si">${</span><span class="nx">n</span><span class="si">}</span><span class="sb">次也变化了`</span><span class="p">)</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">n</span><span class="p">])</span> <span class="c1">// 依赖n变化时执行
</span><span class="c1"></span>
  <span class="c1">// 排除第一次初始化数据的更新 具体到某个数据更新后渲染 update
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`当依赖n变化，渲染后执行，不算初始化的那次`</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">n</span><span class="p">])</span>

  <span class="c1">// App第一次渲染 实现 setInterval
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">)</span>
    <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="c1">// 防止内存泄漏
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[])</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="o">+</span><span class="mi">1</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="uselayouteffect-a-hrefcatalogue--a"><code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><code>useEffect</code>在浏览器渲染完成后执行，<a href="https://codesandbox.io/s/useeffect-flash-on-render-3ggq3">代码示例</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">BlinkyRender</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">v</span><span class="p">,</span> <span class="nx">setV</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#x&#39;</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="s1">&#39;value: 1000&#39;</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">v</span><span class="p">])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;x&#34;</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}}&gt;</span>
      <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">v</span><span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>页面渲染时有一个闪烁，<code>value</code>从<code>0</code>迅速变为<code>1000</code></li>
</ul>
<blockquote>
<p><code>useLayoutEffect</code>称为 “布局副作用”， 在浏览器渲染前执行</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">BlinkyRender</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">v</span><span class="p">,</span> <span class="nx">setV</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="nx">useLayoutEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#x&#39;</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="s1">&#39;value: 1000&#39;</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">v</span><span class="p">])</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;x&#34;</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}}&gt;</span>
      <span class="nx">value</span><span class="o">:</span> <span class="p">{</span><span class="nx">v</span><span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>页面没有出现闪烁问题</li>
<li>有很多<code>DOM</code>操作，浏览器会等<code>DOM</code>操作完了再渲染
<ul>
<li><code>useEffect</code>在浏览器渲染改变屏幕像素之后</li>
<li><code>useLayoutEffect</code>在<code>DOM</code>操作完了，紧接着执行回调（对 <code>Layout</code>有影响的操作），然后再去渲染（改变屏幕像素之前）</li>
</ul>
</li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBc2e9b5db7a035d18f10d1f538e64d9d3?method=download&amp;shareKey=2cbd0b55b21ea725c10744175c3b267a" alt="useLayoutEffect"></p>
<hr>
<h3 id="useeffect-vs-uselayouteffect-a-hrefcatalogue--a"><code>useEffect</code> V.S. <code>useLayoutEffect</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>通过时间点来侧面证明，<a href="https://codesandbox.io/s/charming-sammet-xcwkr">代码示例</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="c1">// beforeRender
</span><span class="c1"></span>  <span class="p">}</span>

  <span class="nx">useLayoutEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// afterRender
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">time</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// afterRender
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">time</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">n</span><span class="o">:</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">Click</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>全局API <code>performance.now()</code>可以记录当前时间</li>
<li>从第二次点击开始计算</li>
<li><code>useEffect</code>总是比<code>useLayoutEffect</code>慢，是因为<code>useEffect</code>在改变外观之后执行，而<code>useLayoutEffect</code>在改变外观之前执行</li>
</ul>
<blockquote>
<p>特点</p>
</blockquote>
<ul>
<li><code>useLayoutEffect</code>总是比<code>useEffect</code>先执行，<a href="https://codesandbox.io/s/beautiful-hill-1or8e">代码示例</a></li>
<li><code>useLayoutEffect</code>里的回调最好时改变 <code>Layout</code>，否则没有意义</li>
</ul>
<blockquote>
<p>经验</p>
</blockquote>
<ul>
<li>虽然可以避免屏幕闪烁，但大部分时候不会去改变<code>DOM</code>，所以并不是总是使用<code>useLayoutEffect</code>更好</li>
<li>为了用户体验，优先使用 <code>useEffect</code> （优先渲染）
<ul>
<li><code>useLayoutEffect</code>操作的优先级，但会影响（延长）用户看到画面变化的时间</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-usememo-a-hrefcatalogue--a">6. <code>useMemo</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="使用usememo前先需要理解-reactmemo-a-hrefcatalogue--a">使用<code>useMemo</code>前，先需要理解 <code>React.memo</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li><code>React</code>默认总是有多余的<code>render</code>，即使渲染的数据没有发生改变，<a href="https://codesandbox.io/s/dawn-sun-00023">代码示例</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">setM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Child</span> <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">m</span><span class="p">}/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Child</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;child 执行了&#34;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;假设这里有大量代码&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">child</span><span class="o">:</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Child</code>只依赖了<code>{m}</code>，而当数据<code>{n}</code>改变了，重新渲染<code>App</code>，连带着也会重新渲染<code>Child</code>，即使<code>{m}</code>未发生改变</li>
<li>如果<code>props</code>不变，就没有必要再次执行一个函数组件</li>
<li>代码中的<code>Child</code>用<code>React.memo(Child)</code>代替，封装一层</li>
</ul>
<blockquote>
<p>变更后的效果，见<a href="https://codesandbox.io/s/bold-framework-idvntb">示例代码</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">setM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClick2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setM</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick2</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">m</span> <span class="p">{</span><span class="nx">m</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Child2</span> <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">m</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Child</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;child 执行了&#34;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;假设这里有大量代码&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">child</span><span class="o">:</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Child2</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Child</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>React.memo(Child)</code>使得一个组件只有在依赖（例如<code>props</code>）变化时，才会再次执行渲染</li>
</ul>
<blockquote>
<p>简化代码</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">setM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClick2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setM</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick2</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">m</span> <span class="p">{</span><span class="nx">m</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Child1</span> <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">m</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Child</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 封装一层 React.memo
</span><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;child 执行了&#34;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;假设这里有大量代码&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span><span class="nx">child</span><span class="o">:</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;;</span>
  <span class="p">}</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="reactmemo的bug-a-hrefcatalogue--a"><code>React.memo</code>的<code>bug</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><a href="https://codesandbox.io/s/blissful-wilbur-5tw75">示例代码</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;App执行了&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">]</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClickChild</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 每次App运行，生成新的函数
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Child2</span> <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">m</span><span class="p">}</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickChild</span><span class="p">}</span> <span class="p">/&gt;</span>
      <span class="p">{</span><span class="cm">/* Child2 居然又执行了 */</span><span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Child</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;child 执行了&#34;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;假设这里有大量代码&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">child</span><span class="o">:</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Child2</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Child</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在监听了函数之后，一秒破功，<code>Child2</code> 居然又执行了</li>
<li>因为<code>App</code>每次重新运行时，都会在执行<code>const onClickChild  = () =&gt; {}</code>处，生成新的函数</li>
<li>新旧函数虽然功能一样，但是内存地址不一样</li>
</ul>
<hr>
<h3 id="配合使用usememo解决reactmemo的问题">配合使用<code>useMemo</code>解决<code>React.memo</code>的问题</h3>
<ul>
<li><code>useMemo</code>可以实现函数的缓存，比对函数内容，相同的话使用之前的缓存的函数</li>
<li><code>useMemo</code>的返回值就是需要缓存的函数</li>
<li>使用<code>useMemo</code>来返回出需要传入子组件的函数，并给定依赖作为第二个参数</li>
</ul>
<blockquote>
<p><a href="https://codesandbox.io/s/blissful-wilbur-5tw75">示例代码</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">setM</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClick2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setM</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClickChild</span> <span class="o">=</span> <span class="nx">useMemo</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">div</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;on click child, m: &#34;</span> <span class="o">+</span> <span class="nx">m</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">fn</span><span class="p">;</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">m</span><span class="p">]);</span> <span class="c1">// 这里把 [m] 改成 [n] 就会打印出旧的 m
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick2</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">m</span> <span class="p">{</span><span class="nx">m</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Child2</span> <span class="na">data</span><span class="o">=</span><span class="p">{</span><span class="nx">m</span><span class="p">}</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClickChild</span><span class="p">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Child</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;child 执行了&#34;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;假设这里有大量代码&#34;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="p">=&gt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">onClick</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">)}&gt;</span>
      <span class="nx">child</span><span class="o">:</span> <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Child2</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">memo</span><span class="p">(</span><span class="nx">Child</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>useMemo</code>特点</p>
</blockquote>
<ul>
<li>第一个参数是<code>() =&gt; value</code>，见<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts#L1091">源码<code>useMemo</code> 的TS类型声明</a></li>
<li>第二个参数是依赖 <code>[m, n]</code></li>
<li>只有当依赖变化时，才会计算出新的<code>value</code></li>
<li>如果依赖不变，那么就重用之前的<code>value</code></li>
<li>这与<code>Vue</code>的<code>computed</code>相类似，用来缓存依赖一些不变化的数据</li>
</ul>
<blockquote>
<p><code>useMemo</code>注意事项</p>
</blockquote>
<ul>
<li>如果<code>value</code>传的是函数，那么就要写成 <code>useMemo(() =&gt; (x) =&gt; {})</code>，这是一个返回函数的函数（高阶函数/组件）</li>
</ul>
<blockquote>
<p>形式上复杂难用，于是就有了<code>useCallback</code></p>
</blockquote>
<hr>
<h3 id="usecallback是usememo的语法糖"><code>useCallback</code>是<code>useMemo</code>的语法糖</h3>
<blockquote>
<p>用法</p>
</blockquote>
<ul>
<li>使用 <code>useCallback(x =&gt; consolog(x), [m])</code></li>
<li>等价于 <code>useMemo(() =&gt; x =&gt; console.log(x), [m])</code></li>
</ul>
<hr>
<h2 id="7-useref-a-hrefcatalogue--a">7. <code>useRef</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="useref用途a-hrefcatalogue--a"><code>useRef</code>用途：<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>如果需要一个值，在组件不断<code>render</code>时保持不变，可以使用<code>useRef</code>
<ul>
<li>初始化：<code>const count = useRef(0)</code></li>
<li>读取值：<code>count.current</code></li>
</ul>
</li>
<li>区别于<code>setN</code>，<code>n</code> 每次渲染都会变更</li>
</ul>
<blockquote>
<p>需求：要知道组件渲染了几次，使用一个变量记录（全局变量会污染命名环境）</p>
</blockquote>
<ul>
<li>使用<code>useRef</code>，每次渲染时更新<code>useEffect(() =&gt; {count.current += 1})</code>，得到一个新的<code>count</code>，而<code>count.value</code>在内存中的引用不变</li>
<li>渲染 <code>count</code>对象地址不变，其中的<code>current</code>值被记录在<code>useRef</code>对应的一个<code>fiberNode</code>上，<a href="https://codesandbox.io/s/priceless-sound-rtdw68">示例代码</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;App 执行&#39;</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">(</span><span class="nx">i</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">9</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">// DidUpdate
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">count</span><span class="p">.</span><span class="nx">current</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;count.current&#39;</span><span class="p">,</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://note.youdao.com/yws/api/personal/file/WEB2909e1b6adc6b65eb3a1da02051f2da6?method=download&amp;shareKey=1a4f5d816b41fb1271048c91b734d695" alt="useRef"></p>
<hr>
<h3 id="useref读取值为什么需要currenta-hrefcatalogue--a"><code>useRef</code>读取值为什么需要<code>.current</code>？<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>为了保持新旧组件更新前后两次<code>useRef</code>是同一个引用对象（只有引用能做到，保持引用地址不变）</li>
</ul>
<blockquote>
<p>对比三个数据变化的钩子函数</p>
</blockquote>
<ul>
<li><code>useState/useReducer</code>：<code>n</code>每次都变</li>
<li><code>usememo/useCallback</code>：在依赖<code>[n]</code>变更时，对应的函数<code>fn</code>改变，有条件地变</li>
<li><code>useRef</code>：<code>n</code>永远不变</li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6ca008fbfd6b39ab335c7eab63979a21?method=download&amp;shareKey=716ea6af63e8455b67b1be70d264ccdf" alt="useHooks_state"></p>
<blockquote>
<p>延伸</p>
</blockquote>
<ul>
<li><code>Vue3</code>的 <a href="hhttps://vuejs.org/api/reactivity-core.html#ref"><code>ref()</code></a>
<ul>
<li>初始化：<code>const count = ref(0)</code></li>
<li>读取值：<code>count.value</code></li>
</ul>
</li>
<li>不同点：
<ul>
<li>当<code>count.value</code>变化时，<code>Vue3</code>会自动<code>render</code>，帮你实现了<code>UI</code>更新</li>
<li>而<code>React</code>中使用<code>useRef</code>不会自动更新<code>UI</code>，<a href="https://codesandbox.io/s/zealous-scooby-00zsze">代码示例</a></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;App 执行&#34;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">((</span><span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClick2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 并不会触发UI更新
</span><span class="c1"></span>    <span class="nx">count</span><span class="p">.</span><span class="nx">current</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;count.current onClick&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;count.current update&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick2</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span> <span class="p">{</span><span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="useref不能做到变化时自动render刷新ui需要额外步骤-a-hrefcatalogue--a"><code>useRef</code>不能做到变化时自动<code>render</code>刷新<code>UI</code>，需要额外步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>因为不符合<code>React</code>的函数式理念：<code>UI = render(data)</code>
<ul>
<li>每次<code>data</code>变化时，使用函数（例如<code>setState</code>）去渲染成新的虚拟<code>DOM</code></li>
<li>将新的虚拟<code>DOM</code>与页面上旧的虚拟<code>DOM</code>做<code>DOM Diff</code>，得到一个<code>patch</code>补丁</li>
<li>根据这个<code>patch</code>补丁去重渲染<code>DOM</code></li>
</ul>
</li>
<li>如果想要变化时自动<code>render</code>，可以自定义去实现（使用<code>setN</code>），<code>React</code>不管</li>
<li>监听<code>ref</code>，当<code>ref.current</code>变化时，再加一个依赖，调用<code>setX</code>即可，<a href="https://codesandbox.io/s/brave-feather-bd6onb">示例代码</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;App 执行&#34;</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">n</span><span class="p">,</span> <span class="nx">setN</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">_</span><span class="p">,</span> <span class="nx">set_</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">onClick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setN</span><span class="p">((</span><span class="nx">i</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">onClick2</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">count</span><span class="p">.</span><span class="nx">current</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">set_</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">());</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;count.current onClick&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;count.current update&#34;</span><span class="p">,</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;--------------------&#34;</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">n</span> <span class="p">{</span><span class="nx">n</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick2</span><span class="p">}&gt;</span><span class="nx">update</span> <span class="nx">count</span><span class="p">.</span><span class="nx">current</span> <span class="p">{</span><span class="nx">count</span><span class="p">.</span><span class="nx">current</span><span class="p">}&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="8-useref配合forwardref用在函数组件中-a-hrefcatalogue--a">8. <code>useRef</code>配合<code>forwardRef</code>用在函数组件中 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>基本用法：让函数组件 <code>&lt;Button2 /&gt;</code> 支持 <code>ref</code>，获取其虚拟<code>DOM</code>的引用</p>
</blockquote>
<ul>
<li>代替原生使用<code>id</code>，和<code>document.getElementById</code>来获取元素</li>
</ul>
<blockquote>
<p>函数组件中会警告无法直接使用<code>useRef</code> <a href="https://codesandbox.io/s/sad-gagarin-r8whox">代码示例1</a>：<code>props</code>无法传递<code>ref</code>属性</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">buttonRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;app&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">Button2</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonRef</span><span class="p">}&gt;</span><span class="nx">按钮</span><span class="p">&lt;/</span><span class="nt">Button2</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Button2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;props&#34;</span><span class="p">,</span> <span class="nx">props</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">button</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;red&#34;</span> <span class="p">{</span><span class="na">...props</span><span class="p">}&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>报警告<code>Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?</code></li>
<li><code>useRef</code>作为元素的引用是在类组件中使用的，即只有类组件可以直接接受<code>ref</code>元素引用</li>
<li>提示函数组件去使用<code>forwardRef</code></li>
<li>组件内打印<code>console.log(&quot;props&quot;, props);</code>得到<code>object {children: &quot;按钮&quot;}</code>，只把按钮传过去了，其他属性都忽略了</li>
</ul>
<hr>
<blockquote>
<p><a href="https://codesandbox.io/s/sleepy-morning-wjp7p7">代码示例2</a>：函数组件中使用<code>React.forwardRef</code>包裹一层组件，可声明第二个形参<code>ref</code>，实现函数组件<code>ref</code>的组件间传递</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">buttonRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Button3</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonRef</span><span class="p">}&gt;</span><span class="nx">按钮</span><span class="p">&lt;/</span><span class="nt">Button3</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*
</span><span class="cm">const Button2 = (props, ref) =&gt; {
</span><span class="cm">  console.log(&#34;props: &#34;, props);
</span><span class="cm">  console.log(&#34;ref:&#34;, ref);
</span><span class="cm">  return &lt;button className=&#34;red&#34; ref={ref} {...props} /&gt;;
</span><span class="cm">};
</span><span class="cm">const Button3 = forwardRef(Button2);
</span><span class="cm">*/</span>

<span class="kr">const</span> <span class="nx">Button3</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">forwardRef</span><span class="p">((</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">button</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;red&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span> <span class="p">{</span><span class="na">...props</span><span class="p">}</span> <span class="p">/&gt;;</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>函数组件需要接受外部传来的<code>ref</code>参数，必须用<code>React.forwardRef</code>包起来
<ul>
<li><code>&lt;Button ref={buttonRef}&gt;...&lt;/Button&gt;</code></li>
<li><code>const Button = React.forwardRef((props, ref) =&gt; (&lt;button ref={ref} {...props} /&gt;))</code></li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p><a href="https://codesandbox.io/s/practical-ride-xumesc">代码示例3</a>：两次<code>ref</code>传递得到<code>button</code>的引用，实现可移动的按钮（高阶组件封装）（仍有bug，待修复）</p>
</blockquote>
<ul>
<li>功能包装：<code>const MovableButton = movable(Button2)</code></li>
<li>通过<code>ref</code>引用到<code>Button2</code>里面的按钮：<code>const buttonRef = useRef(null)</code>，需要做两次传递
<ul>
<li>第一次 将 <code>&lt;MovableButton name=&quot;email&quot; ref={buttonRef}&gt;</code> 传给 <code>movable(Component)</code> 中返回的 <code>&lt;Component ref={ref} {...props} /&gt;</code>
<ul>
<li>即<code>movable(Button2)</code> 中返回的 <code>&lt;Button2 ref={ref} {...props} /&gt;</code></li>
</ul>
</li>
<li>第二次 <code>Button2</code> 组件声明时传递 <code>React.forwardRef((props, ref) =&gt; { return &lt;button ref={ref} {...props} /&gt;; });</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 赋上 可拖拽的 功能
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">MovableButton</span> <span class="o">=</span> <span class="nx">movable</span><span class="p">(</span><span class="nx">Button2</span><span class="p">);</span>
  <span class="c1">// 获取引用
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">buttonRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="c1">// update
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buttonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">MovableButton</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonRef</span><span class="p">}&gt;</span>
        <span class="nx">按钮</span>
      <span class="p">&lt;/</span><span class="nt">MovableButton</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 函数组件 forwardRef 引用包装
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">Button2</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">forwardRef</span><span class="p">((</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">button</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span> <span class="p">{</span><span class="na">...props</span><span class="p">}</span> <span class="p">/&gt;;</span>
<span class="p">});</span>

<span class="c1">// 仅用于实验目的，不要在公司代码中使用
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">movable</span><span class="p">(</span><span class="nx">Component</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">Component2</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">);</span>

    <span class="c1">// 初始化
</span><span class="c1"></span>    <span class="kr">const</span> <span class="p">[</span><span class="nx">position</span><span class="p">,</span> <span class="nx">setPosition</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>
    <span class="kr">const</span> <span class="nx">lastPosition</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

    <span class="c1">// 方法
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">onMouseDown</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">];</span>
    <span class="p">};</span>
    <span class="kr">const</span> <span class="nx">onMouseMove</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// e.nativeEvent.stopImmediatePropagation(); //阻止冒泡
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kr">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nx">setPosition</span><span class="p">([</span><span class="nx">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">y</span><span class="p">]);</span>
        <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="kr">const</span> <span class="nx">onMouseUp</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">lastPosition</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">(</span>
      <span class="p">&lt;&gt;</span>
        <span class="p">{</span><span class="cm">/*套一层 div */</span><span class="p">}</span>
        <span class="p">&lt;</span><span class="nt">div</span>
          <span class="na">className</span><span class="o">=</span><span class="s">&#34;movable&#34;</span>
          <span class="na">onMouseDown</span><span class="o">=</span><span class="p">{</span><span class="nx">onMouseDown</span><span class="p">}</span>
          <span class="na">onMouseMove</span><span class="o">=</span><span class="p">{</span><span class="nx">onMouseMove</span><span class="p">}</span>
          <span class="na">onMouseUp</span><span class="o">=</span><span class="p">{</span><span class="nx">onMouseUp</span><span class="p">}</span>
          <span class="na">style</span><span class="o">=</span><span class="p">{{</span>
            <span class="nx">left</span><span class="o">:</span> <span class="nx">position</span> <span class="o">&amp;&amp;</span> <span class="nx">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">top</span><span class="o">:</span> <span class="nx">position</span> <span class="o">&amp;&amp;</span> <span class="nx">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="p">}}</span>
        <span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">Component</span> <span class="p">{</span><span class="na">...props</span><span class="p">}</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">ref</span><span class="p">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;/&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">React</span><span class="p">.</span><span class="nx">forwardRef</span><span class="p">(</span><span class="nx">Component2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>useRef</code> V.S. <code>forwardRef</code></p>
</blockquote>
<ul>
<li>由于大部分时候不需要，所以<code>props</code>不包含<code>ref</code></li>
<li>由于函数组件的参数 <code>props</code>不包含<code>ref</code>，所以需要<code>React.forwardRef</code>包裹一层，才可以传递 <code>ref</code></li>
<li><code>React.forwardRef</code>就是在函数组件中用来转发<code>ref</code>的</li>
</ul>
<hr>
<h2 id="9-useimperativehandle-a-hrefcatalogue--a">9. <code>useImperativeHandle</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><code>Imperative</code> 重要的</li>
<li>命名太长：其实意思就是<code>setRef</code>：用来变更<code>ref</code></li>
<li>作用是自定义<code>ref</code>的属性</li>
</ul>
<blockquote>
<p>不用<code>useImperativeHandle</code>的 <a href="https://codesandbox.io/s/awesome-goldwasser-v7vsp">代码示例</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">buttonRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buttonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span> <span class="c1">// 打印出 &lt;button&gt;按钮&lt;/button&gt;
</span><span class="c1"></span>  <span class="p">});</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Button2</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonRef</span><span class="p">}&gt;</span><span class="nx">按钮</span><span class="p">&lt;/</span><span class="nt">Button2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">className</span><span class="o">=</span><span class="s">&#34;close&#34;</span>
        <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buttonRef</span><span class="p">);</span>
          <span class="nx">buttonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="p">}}</span>
      <span class="p">&gt;</span>
        <span class="nx">x</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>如果希望得到的<code>ref</code>是一个对<code>button</code>的自定义封装对象，则需要使用<code>useImperativeHandle</code></li>
</ul>
<blockquote>
<p>使用<code>useImperativeHandle</code>的 <a href="https://codesandbox.io/s/elegant-poitras-mxoym">代码示例</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">buttonRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buttonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">);</span> <span class="c1">// 打印出 {x: ƒ x(), realButton: Object}
</span><span class="c1"></span>  <span class="p">});</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">Button2</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">buttonRef</span><span class="p">}&gt;</span><span class="nx">按钮</span><span class="p">&lt;/</span><span class="nt">Button2</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">button</span>
        <span class="na">className</span><span class="o">=</span><span class="s">&#34;close&#34;</span>
        <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">buttonRef</span><span class="p">);</span>
          <span class="nx">buttonRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">x</span><span class="p">();</span>
        <span class="p">}}</span>
      <span class="p">&gt;</span>
        <span class="nx">x</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">Button2</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">forwardRef</span><span class="p">((</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ref</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">realButton</span> <span class="o">=</span> <span class="nx">createRef</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">setRef</span> <span class="o">=</span> <span class="nx">useImperativeHandle</span><span class="p">;</span>
  <span class="nx">setRef</span><span class="p">(</span><span class="nx">ref</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">x</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">realButton</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">realButton</span><span class="o">:</span> <span class="nx">realButton</span>
    <span class="p">};</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="p">&lt;</span><span class="nt">button</span> <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">realButton</span><span class="p">}</span> <span class="p">{</span><span class="na">...props</span><span class="p">}</span> <span class="p">/&gt;;</span>
<span class="p">});</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="10-自定义-hook-a-hrefcatalogue--a">10. 自定义 <code>Hook</code> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li>使用自定义 <code>Hook</code> 来封装数据操作</li>
</ul>
<blockquote>
<p>简单<a href="https://codesandbox.io/s/wizardly-tesla-sy077">代码示例</a></p>
</blockquote>
<ul>
<li>直接获取处理过的数据 <code>const { list /*, setList */ } = useList();</code></li>
<li>处理数据的逻辑封装在自定义<code>Hook</code>中，只暴露读和写的接口</li>
<li>初始化状态 <code>const [list, setList] = useState(null)</code></li>
<li><code>DidMount</code>时 请求数据</li>
<li>返回出读和写的接口</li>
<li>处理相关的逻辑都写在一个钩子函数中，运行时暴露出读和写的接口</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// import...
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">useList</span> <span class="nx">from</span> <span class="s2">&#34;./hooks/useList&#34;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">list</span> <span class="cm">/*, setList */</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useList</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">List</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">{</span><span class="nx">list</span> <span class="o">?</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
          <span class="p">{</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;{</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">))}</span>
        <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
      <span class="p">)</span> <span class="o">:</span> <span class="p">(</span>
        <span class="s2">&#34;加载中...&#34;</span>
      <span class="p">)}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>useList.js</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">useList</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 初始化 state
</span><span class="c1"></span>  <span class="kr">const</span> <span class="p">[</span><span class="nx">list</span><span class="p">,</span> <span class="nx">setList</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="c1">// mounted时 请求数据
</span><span class="c1"></span>  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s2">&#34;/list&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">list</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setList</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span> <span class="p">[]);</span> <span class="c1">// [] 确保只在第一次运行
</span><span class="c1"></span>
  <span class="c1">// 暴露读和写的接口
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">list</span><span class="o">:</span> <span class="nx">list</span><span class="p">,</span>
    <span class="nx">setList</span><span class="o">:</span> <span class="nx">setList</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">useList</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">ajax</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">resolve</span><span class="p">([</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Frank&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Jack&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Alice&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Bob&#34;</span> <span class="p">}</span>
      <span class="p">]);</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>功能更全的<a href="https://codesandbox.io/s/recursing-darkness-zuo4b">代码示例</a></p>
</blockquote>
<ul>
<li>不仅提供了读和写的借口，增删改查等其他功能</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="c1">// import...
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">useList</span> <span class="nx">from</span> <span class="s2">&#34;./hooks/useList&#34;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">App</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">list</span><span class="p">,</span> <span class="nx">deleteIndex</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useList</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;App&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span><span class="nx">List</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
      <span class="p">{</span><span class="nx">list</span> <span class="o">?</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nt">ol</span><span class="p">&gt;</span>
          <span class="p">{</span><span class="nx">list</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span>
            <span class="p">&lt;</span><span class="nt">li</span> <span class="na">key</span><span class="o">=</span><span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">}&gt;</span>
              <span class="p">{</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span>
              <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">deleteIndex</span><span class="p">(</span><span class="nx">index</span><span class="p">);}}&gt;</span>
                <span class="nx">x</span>
              <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
          <span class="p">))}</span>
        <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
      <span class="p">)</span> <span class="o">:</span> <span class="p">(</span>
        <span class="s2">&#34;加载中...&#34;</span>
      <span class="p">)}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>useList.js</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kr">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;react&#34;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">useList</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">list</span><span class="p">,</span> <span class="nx">setList</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">ajax</span><span class="p">(</span><span class="s2">&#34;/list&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">list</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">setList</span><span class="p">(</span><span class="nx">list</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span> <span class="p">[]);</span> <span class="c1">// [] 确保只在第一次运行
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">list</span><span class="o">:</span> <span class="nx">list</span><span class="p">,</span> <span class="c1">// 查
</span><span class="c1"></span>    <span class="nx">addItem</span><span class="o">:</span> <span class="nx">name</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 增
</span><span class="c1"></span>      <span class="nx">setList</span><span class="p">([...</span><span class="nx">list</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span> <span class="p">}]);</span>
    <span class="p">},</span>
    <span class="nx">deleteIndex</span><span class="o">:</span> <span class="nx">index</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 删
</span><span class="c1"></span>      <span class="nx">setList</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">index</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)));</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">useList</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">ajax</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">resolve</span><span class="p">([</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Frank&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Jack&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;3&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Alice&#34;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&#34;4&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;Bob&#34;</span> <span class="p">}</span>
      <span class="p">]);</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>分析</p>
</blockquote>
<ul>
<li>还可以在自定义<code>Hook</code>里使用<code>Context</code></li>
<li><code>useState</code>只说了不能在<code>if</code>里，没说不能在函数里运行
<ul>
<li>只要这个函数在函数组件里运行即可</li>
</ul>
</li>
<li>实际业务中，使用良好的组件封装，更抽象的自定义<code>Hook</code>封装，来代替页面组件中直接使用<code>useState</code>、<code>uesEffect</code>等钩子</li>
<li>使用函数组件，就没有必要使用<code>Redux</code>了</li>
</ul>
<hr>
<h2 id="11-stale-closure过时的闭包-a-hrefcatalogue--a">11. <code>Stale Closure</code>过时的闭包 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><a href="https://dmitripavlutin.com/react-hooks-stale-closures/">Be Aware of Stale Closures when Using React Hooks</a></li>
</ul>
<blockquote>
<p><a href="https://codesandbox.io/s/stale-closure-use-effect-broken-2-gyhzk">代码示例</a></p>
</blockquote>
<ul>
<li>期待打印自增的<code>count</code></li>
<li>结果每次打印都是相同的<code>count</code></li>
<li>打印的<code>count</code>是过时的闭包，而不是后续操作产生的新的<code>count</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">WatchCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="nx">log</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Count is: </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[]);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">{</span><span class="nx">count</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}&gt;</span>
        <span class="nx">Increase</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>把依赖<code>[count]</code>放入<code>useEffect</code>，更新<code>DidUpdate</code>时同时更新闭包</li>
<li>同时卸载<code>WillUnmount</code>时（<code>return () =&gt; {}</code>） 清除上一次组件卸载时的 <code>id</code>，来干掉旧的闭包</li>
<li>代码中的两处<code>id</code>调用时机不同</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="kd">function</span> <span class="nx">WatchCount</span><span class="p">()</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">[</span><span class="nx">count</span><span class="p">,</span> <span class="nx">setCount</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="nx">log</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// 每次更新时创建新的id
</span><span class="c1"></span>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Count is: </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// 清除上一次组件卸载时的id，调用时机不同
</span><span class="c1"></span>    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">count</span><span class="p">]);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">{</span><span class="nx">count</span><span class="p">}</span>
      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{()</span> <span class="p">=&gt;</span> <span class="nx">setCount</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}&gt;</span>
        <span class="nx">Increase</span>
      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>避免保留下过时的闭包，每次更新前需要重新获取新的闭包</li>
<li>或者在返回的函数中 读取最新的闭包，而不是在返回的函数外</li>
</ul>
<hr>
<blockquote>
<p>题外话</p>
</blockquote>
<ul>
<li><code>JS</code>中有许多需要避免的<code>bug</code>或者反模式
<ul>
<li>隐式类型转换，用<code>===</code></li>
<li>过时的闭包</li>
<li>空值判断，用<code>??</code></li>
<li>异步</li>
<li>过长的条件分支，用策略模式（表驱动）</li>
</ul>
</li>
</ul>
<hr>
<h2 id="12-总结-a-hrefcatalogue--a">12. 总结 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">flowchart LR
    React_Builtin_Hooks --&gt; 状态...useState
    React_Builtin_Hooks --&gt; 副作用...useEffect --&gt; useLayoutEffect
    React_Builtin_Hooks --&gt; 上下文...useContext
    React_Builtin_Hooks --&gt; Redux...useReducer
    React_Builtin_Hooks --&gt; 记忆...useMemo...配合React.memo --&gt; 回调...useCallback
    React_Builtin_Hooks --&gt; 引用...useRef --&gt; forwardRef
    引用...useRef --&gt; useImperativeHandle
    React_Builtin_Hooks --&gt; 自定义...Hook --&gt; useDebugValue
</code></pre></td></tr></table>
</div>
</div><hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h2 id="参考文章-a-hrefcatalogue--a">参考文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><a href="https://static.xiedaimala.com/xdml/file/3ac7c224-c23d-491f-84b5-4fabfbeab9b8/2020-2-20-20-8-24.pdf">React Hooks 详解.pdf</a></li>
<li><a href="https://xiedaimala.com/tasks/52050dd9-bbc4-4c94-9d62-f04f78d830d0">Hooks 各个击破</a></li>
</ul>
<h2 id="相关文章-a-hrefcatalogue--a">相关文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li><a href="https://juejin.cn/post/7149932569331499039#heading-12">react指北：你真的会用hooks吗-上篇</a></li>
</ul>
<hr>
<ul>
<li>作者： Joel</li>
<li>文章链接：</li>
<li><a href="http://xmasuhai.xyz/posts/%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%E9%93%BE%E6%8E%A5/">版权声明</a></li>
<li>非自由转载-非商用-非衍生-保持署名</li>
</ul>
<hr>
<hr>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-10-07
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/react/">React</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/react/react%E9%9D%9E%E5%85%A8%E8%A7%A3-4hooks-%E4%B9%8B-usestate-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">
            <span class="next-text nav-default">【React非全解 4】Hooks 之 UseState 原理解析</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
