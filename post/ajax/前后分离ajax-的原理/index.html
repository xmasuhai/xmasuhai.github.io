<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>【前后分离】AJAX 的原理 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="AJAX 的原理与应用 AJAX的全称： Asynchronous JavaScript And XML 测试代码地址 请求接口测试代码地址 黑马免费教学接口API：http://www.liulongbin.t" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.91.2" />


<link rel="canonical" href="http://xmasuhai.xyz/post/ajax/%E5%89%8D%E5%90%8E%E5%88%86%E7%A6%BBajax-%E7%9A%84%E5%8E%9F%E7%90%86/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="【前后分离】AJAX 的原理" />
<meta property="og:description" content="AJAX 的原理与应用 AJAX的全称： Asynchronous JavaScript And XML 测试代码地址 请求接口测试代码地址 黑马免费教学接口API：http://www.liulongbin.t" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/ajax/%E5%89%8D%E5%90%8E%E5%88%86%E7%A6%BBajax-%E7%9A%84%E5%8E%9F%E7%90%86/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-05-16T01:40:20+08:00" />
<meta property="article:modified_time" content="2022-01-26T16:46:09+08:00" />

<meta itemprop="name" content="【前后分离】AJAX 的原理">
<meta itemprop="description" content="AJAX 的原理与应用 AJAX的全称： Asynchronous JavaScript And XML 测试代码地址 请求接口测试代码地址 黑马免费教学接口API：http://www.liulongbin.t"><meta itemprop="datePublished" content="2020-05-16T01:40:20+08:00" />
<meta itemprop="dateModified" content="2022-01-26T16:46:09+08:00" />
<meta itemprop="wordCount" content="23870">
<meta itemprop="keywords" content="FrontEnd,AJAX," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="【前后分离】AJAX 的原理"/>
<meta name="twitter:description" content="AJAX 的原理与应用 AJAX的全称： Asynchronous JavaScript And XML 测试代码地址 请求接口测试代码地址 黑马免费教学接口API：http://www.liulongbin.t"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          <div class="mobile-menu-parent">
            <span class="mobile-submenu-open"></span>
            <a href="http://xmasuhai.xyz/">
              docs
            </a>
          </div>
          <ul class="mobile-submenu-list">
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/syntax-highlighting/">Syntax Highlighting</a>
              </li>
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/mytest/">my Syntax Highlighting &amp; ShortCode Test</a>
              </li>
            
          </ul>
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          <a class="menu-item-link menu-parent" href="http://xmasuhai.xyz/">docs</a>
          <ul class="submenu">
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/syntax-highlighting/">Syntax Highlighting</a>
              </li>
            
              <li>
                <a href="http://xmasuhai.xyz/post/test/mytest/">my Syntax Highlighting &amp; ShortCode Test</a>
              </li>
            
          </ul>

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">【前后分离】AJAX 的原理</h1>
      
      <div class="post-meta">
        <time datetime="2020-05-16" class="post-time">
          2020-05-16
        </time>
        <div class="post-category">
            <a href="http://xmasuhai.xyz/categories/2020/"> 2020 </a>
            
          </div>
        <span class="more-meta"> 约 23870 字 </span>
          <span class="more-meta"> 预计阅读 48 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#大纲链接a-idcatalogue-hrefcatalogue---a">大纲链接<!-- raw HTML omitted --> § <!-- raw HTML omitted --></a></li>
    <li><a href="#0-服务器的基本概念与初识ajax-a-hrefcatalogue--a">0. 服务器的基本概念与初识Ajax <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#01-客户端和服务器-a-hrefcatalogue--a">0.1 客户端和服务器 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#02-url地址-a-hrefcatalogue--a">0.2 URL地址 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#03-网页打开的过程-a-hrefcatalogue--a">0.3 网页打开的过程 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#04-服务器对外提供的资源-a-hrefcatalogue--a">0.4 服务器对外提供的资源 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#05-网页中如何请求数据-a-hrefcatalogue--a">0.5 网页中如何请求数据 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#06-资源的请求方式请求动词-a-hrefcatalogue--a">0.6 资源的请求方式（请求动词） <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#06-ajax概念和应用场景-a-hrefcatalogue--a">0.6 Ajax概念和应用场景 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#07-代替过时的jquery发起ajax请求数据-a-hrefcatalogue--a">0.7 代替过时的jQuery发起Ajax请求数据 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#08-接口和接口文档-a-hrefcatalogue--a">0.8 接口和接口文档 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#09-案例以vue为例-a-hrefcatalogue--a">0.9 案例，以<code>vue</code>为例 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#010-form表单的现代用法-a-hrefcatalogue--a">0.10 form表单的现代用法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#1-ajax原理和应用a-idajax原理-hrefajax原理--aa-hrefcatalogue--a">1. AJAX原理和应用<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#11-ajax是浏览器上的功能-a-hrefcatalogue--a">1.1 AJAX是浏览器上的功能 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#12-准备服务器-a-hrefcatalogue--a">1.2 准备服务器 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#13-复习-a-hrefcatalogue--a">1.3 复习 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#14-如何使用js原生xmlhttprequest发起-ajax-请求a-hrefcatalogue--a">1.4 如何使用JS原生<code>XMLHttpRequest</code>发起 <code>Ajax</code> 请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#15-封装-ajax-函数a-hrefcatalogue--a">1.5 封装 <code>Ajax</code> 函数<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#16-如何使用xmlhttprequest-level2中提供的新特性a-hrefcatalogue--a">1.6 如何使用<code>XMLHttpRequest Level2</code>中提供的新特性<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#17-复习使用axios发起-ajax-请求a-hrefcatalogue--a">1.7 复习使用<code>axios</code>发起 <code>Ajax</code> 请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#18-实现文件上传与loading效果-a-hrefcatalogue--a">1.8 实现文件上传与<code>loading</code>效果 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#2-ajax应用-a-hrefcatalogue--a">2 AJAX应用 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li><a href="#21-ajax加载cssa-idajax加载css-hrefajax加载css--aa-hrefcatalogue--a">2.1 AJAX加载CSS<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#22-ajax加载jsa-idajax加载js-hrefajax加载js--aa-hrefcatalogue--a">2.2 AJAX加载JS<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#23-ajax加载htmla-idajax加载html-hrefajax加载html--aa-hrefcatalogue--a">2.3 AJAX加载HTML<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#24-ajax加载xmla-idajax加载xml-hrefajax加载xml--a-a-hrefcatalogue--a">2.4 AJAX加载XML<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#25-ajax应用小结a-idajax小结-hrefajax小结--aa-hrefcatalogue--a">2.5 AJAX应用小结<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#26-回顾复习jsona-idjson-hrefjson--aa-hrefcatalogue--a">2.6 回顾复习JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#27-ajax加载jsona-idajax加载json-hrefajax加载json--aa-hrefcatalogue--a">2.7 AJAX加载JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#28-js内置对象-windowjsona-idwindowjson-hrefwindowjson--aa-hrefcatalogue--a">2.8 JS内置对象 window.JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
        <li><a href="#29-ajax综合应用加载分页a-idajax综合应用-hrefajax综合应用--aa-hrefcatalogue--a">2.9 AJAX综合应用：加载分页<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
      </ul>
    </li>
    <li><a href="#3-手写ajaxa-id手写ajax-href手写ajax--aa-hrefcatalogue--a">3. 手写AJAX<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#4-ajax-的简陋封装a-idajax的简陋封装-hrefajax的简陋封装--a-a-hrefcatalogue--a">4. <code>ajax</code> 的简陋封装<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#5-fetch代替js原生ajax-a-idfetch-hreffetch--a-a-hrefcatalogue--a">5. <code>fetch</code>代替JS原生AJAX <!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#使用githubpagesmock数据a-idgithubpagesmock-hrefgithubpagesmock--a-a-hrefcatalogue--a">使用<code>githubpagesmock</code>数据<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#使用easymock来mock数据a-ideasymock-hrefeasymock--a-a-hrefcatalogue--a">使用<code>easymock</code>来<code>mock</code>数据<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a></li>
    <li><a href="#轮询与长轮询comet聊天室-a-hrefcatalogue--a">轮询与长轮询Comet聊天室 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></a>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h1 id="ajax-的原理与应用">AJAX 的原理与应用</h1>
<blockquote>
<p>AJAX的全称： <strong>A</strong>synchronous <strong>J</strong>avaScript <strong>A</strong>nd <strong>X</strong>ML</p>
</blockquote>
<ul>
<li><a href="https://github.com/xmasuhai/node-demo-1/blob/master/server.js">测试代码地址</a></li>
<li><a href="https://github.com/xmasuhai/test-node-module-promise">请求接口测试代码地址</a></li>
<li>黑马免费教学接口API：<code>http://www.liulongbin.top:3006/api</code></li>
</ul>
<h2 id="大纲链接a-idcatalogue-hrefcatalogue---a">大纲链接<!-- raw HTML omitted --> § <!-- raw HTML omitted --></h2>
<p>[toc]</p>
<hr>
<h2 id="0-服务器的基本概念与初识ajax-a-hrefcatalogue--a">0. 服务器的基本概念与初识Ajax <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<ul>
<li>客户端和服务器
<ul>
<li>客户端和服务器基本概念</li>
<li>客户端和服务器通信过程</li>
</ul>
</li>
<li>URL地址</li>
<li>网页打开的过程</li>
<li>服务器对外提供的资源包括图片以及数据</li>
<li>Ajax概念和应用场景</li>
<li>使用 Axios 代替过时的jQuery发起Ajax请求数据</li>
<li>接口和接口文档</li>
<li>过时的form表单与模板引擎</li>
<li>案例
<ul>
<li>图书管理接口</li>
<li>案例-聊天机器人接口</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>上网的目的：通过互联网的形式来获取和消费网络资源</p>
</blockquote>
<h3 id="01-客户端和服务器-a-hrefcatalogue--a">0.1 客户端和服务器 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>客户端和服务器基本概念：
<ul>
<li>上网过程中，负责存放和对外提供资源的计算机，叫服务器</li>
<li>上网过程中，负责获取和消费资源的计算机，叫客户端</li>
</ul>
</li>
<li>客户端和服务器通信过程</li>
</ul>
<hr>
<h3 id="02-url地址-a-hrefcatalogue--a">0.2 URL地址 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>统一资源定位符，同于标识互联网上每个资源的唯一存放位置（不可重复）</li>
<li>客户端只有通过URL地址，才能正确定位的存放位置，从而成功访问到对应的资源</li>
</ul>
<blockquote>
<p>URL地址一般有三部分组成</p>
</blockquote>
<ul>
<li>客户端与服务器的<strong>通信协议</strong>，<code>https</code>等，在<code>://</code>之前</li>
<li>存有该资源的<strong>服务器名称</strong>，<code>www.xxx.com</code></li>
<li>资源在服务器上的具体<strong>存放路径</strong></li>
</ul>
<h3 id="03-网页打开的过程-a-hrefcatalogue--a">0.3 网页打开的过程 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>即客户端和服务器通信过程，分为：请求-&gt;处理-&gt;响应</li>
<li>在浏览器的地址栏输入网站地址，回车，向服务器发起资源<strong>请求</strong></li>
<li>服务器<strong>处理</strong>这次资源请求</li>
<li>服务器将这次请求的<strong>响应</strong>发送给客户端
<ul>
<li>响应可以是成功或者拒绝</li>
</ul>
</li>
</ul>
<blockquote>
<p>浏览器Network面板简介</p>
</blockquote>
<ul>
<li>资源筛选页签
<ul>
<li>XHR 表示数据请求对象<code>XMLHttpRequest</code>，有的浏览器显示为 <code>Fetch/XHR</code></li>
<li>Doc 表示文档资源，有的浏览器显示为 <code>HTML</code></li>
</ul>
</li>
<li>Headers 页签
<ul>
<li><code>Request URL</code></li>
<li><code>Request Method</code></li>
<li><code>Status Code</code></li>
<li><code>Remote Address</code></li>
<li><code>Referrer Policy</code></li>
</ul>
</li>
<li><code>Response</code> 表示服务器的响应数据，格式为对应数据的格式</li>
</ul>
<h3 id="04-服务器对外提供的资源-a-hrefcatalogue--a">0.4 服务器对外提供的资源 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>文字</li>
<li>脚本</li>
<li>样式</li>
<li>图片</li>
<li>音频</li>
<li>视频</li>
<li><strong>数据</strong></li>
</ul>
<blockquote>
<p>网页中的<strong>数据</strong>也是服务器对外提供的一种资源</p>
</blockquote>
<ul>
<li>网页中 HTML控制骨架、CSS控制样式、JS控制逻辑交互行为、数据则提供主要信息，骨架、样式和交互都<strong>为数据服务</strong></li>
<li>常见的数据传输格式有<code>JSON</code>、<code>XML</code>(前端不常用)</li>
</ul>
<h3 id="05-网页中如何请求数据-a-hrefcatalogue--a">0.5 网页中如何请求数据 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>数据也是服务器对外提供的一种资源，只要是资源，必然通过 请求 -&gt;  响应 -&gt; 的方式获取</p>
</blockquote>
<ul>
<li>如果要在网页中请求服务器上的数据资源，则需要用到 <code>XMLHttpRequest</code> 对象</li>
<li><code>XMLHttpRequest</code> 对象简称<code>xhr</code>，是浏览器提供给JS内建的浏览器对象，属于<code>BOM</code></li>
<li>通过<code>new XMLHttpRequest()</code>方法构造实例对象，可以请求服务器上的数据资源</li>
<li><code>const xhr = new XMLHttpRequest()</code></li>
</ul>
<h3 id="06-资源的请求方式请求动词-a-hrefcatalogue--a">0.6 资源的请求方式（请求动词） <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>客户端请求服务器时，请求的方式有很多种，最常见的两种方式分别为<code>get</code>和<code>post</code>请求</p>
</blockquote>
<ul>
<li><code>get请求</code>用于获取服务端资源
<ul>
<li>根据 URL 地址，从服务器获取 HTML、CSS、JS、图片和数据等文件资源</li>
</ul>
</li>
<li><code>post请求</code>用于向服务器提交数据，即发送资源
<ul>
<li>例如：登录时向服务器提交的登录消息、注册时向服务器提交的注册信息、添加用户时向服务器提交的用户数据信息等给中<strong>数据提交操作</strong></li>
</ul>
</li>
</ul>
<h3 id="06-ajax概念和应用场景-a-hrefcatalogue--a">0.6 Ajax概念和应用场景 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>在网页中利用 XMLHttpRequest 对象和服务器进行数据交互的方式就是 Ajax</li>
<li>页面可以无刷新的请求数据</li>
<li>Ajax 能实现静态网页无法实现的和服务器之间数据交互功能</li>
<li>用户通过和网页或应用这一数据载体交互，实现和服务器进行数据交互</li>
<li>代替过时的 form 表单默认提交（页面强制刷新）和 jQuery 发起 Ajax 请求数据
<ul>
<li>使用 Fetch API</li>
<li>使用 Axios</li>
</ul>
</li>
</ul>
<blockquote>
<p>Ajax的典型应用场景</p>
</blockquote>
<ul>
<li>用户名的检测：注册用户时，通过 Ajax 的形式，动态检测用户名是否被占用，名称查重</li>
<li>搜索提示：当输入关键字时，通过 Ajax 的形式，动态加载搜索提示列表</li>
<li>数据分页显示：点击页码时，通过 Ajax 的形式，根据页码值动态刷新该页页面数据</li>
<li>数据增删改查，实现数据的交互</li>
</ul>
<blockquote>
<p>在现代浏览器上实现一个Ajax请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span> <span class="c1">// 创建XMLHttpRequest对象
</span><span class="c1"></span>
<span class="c1">// 异步ajax，监听readystatechange事件，设置回调函数
</span><span class="c1"></span>    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// 状态发生变化时，函数被回调
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 成功完成
</span><span class="c1"></span>        <span class="c1">// 判断响应状态码
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="k">return</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="c1">// 失败，根据响应码判断失败原因:
</span><span class="c1"></span>        <span class="k">return</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span> <span class="c1">// 成功，通过responseText拿到响应的文本:
</span><span class="c1"></span>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// HTTP请求还在继续...
</span><span class="c1"></span>      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 发送请求:
</span><span class="c1"></span>    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/api/categories&#39;</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span> <span class="c1">// 设置请求头
</span><span class="c1"></span>    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span> <span class="c1">// 到这一步，请求才正式发出
</span><span class="c1"></span>
  <span class="p">})</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="07-代替过时的jquery发起ajax请求数据-a-hrefcatalogue--a">0.7 代替过时的jQuery发起Ajax请求数据 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>使用黑马的免费教学接口API：<code>http://www.liulongbin.top:3006/api</code></li>
</ul>
<blockquote>
<p>jQuery</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 不带参数的请求
</span><span class="c1"></span><span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button1&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
<span class="c1">// 带参数的请求 // http://www.liulongbin.top:3006/api/getbooks?id=1
</span><span class="c1"></span><span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button2&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span> <span class="cm">/* 第二个参数为参数对象 */</span><span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
<span class="c1">// 提交数据的请求
</span><span class="c1">// $.post 功能单一，仅发起post请求向服务器提交数据
</span><span class="c1">// $post(url, [data /*可选 要提交的数据*/], [callback /* 数据提交成功的回调*/])
</span><span class="c1"></span><span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button3&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;http://www.liulongbin.top:3006/api/addbook&#39;</span><span class="p">,</span>
      <span class="cm">/* 第二个参数为提交的数据对象 */</span><span class="p">{</span>
        <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;水浒传&#39;</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;施耐庵&#39;</span><span class="p">,</span>
        <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;上海图书出版社&#39;</span>
      <span class="p">},</span>
      <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
      <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
<span class="cm">/*
</span><span class="cm">// 综合配置
</span><span class="cm">$.ajax({
</span><span class="cm">    type: &#39;&#39;, // 请求的方式
</span><span class="cm">    url: &#39;&#39;, // 请求的 URL 地址
</span><span class="cm">    data: {}, // 此次请求要携带的数据
</span><span class="cm">    success: (res) =&gt; {}, // 请求成功后的回调函数
</span><span class="cm">})
</span><span class="cm">*/</span>
<span class="c1">// Get
</span><span class="c1"></span><span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button4&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span>
      <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">},</span>
      <span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
<span class="c1">// Post
</span><span class="c1"></span><span class="nx">$</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;button4&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/addbook&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;三国演义&#39;</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;罗贯中&#39;</span><span class="p">,</span>
        <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;重庆图书出版社&#39;</span>
      <span class="p">},</span>
      <span class="nx">success</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="axios-a-hrefcatalogue--a">Axios <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>易用、简洁且高效的http库</li>
<li>支持node端和浏览器端</li>
<li>基于 Promise 管理异步，是对原生XHR的封装，用Promise的实现版本，符合最新的ES规范</li>
<li>支持HTTP拦截器等高级配置，拦截请求和响应</li>
<li>取消请求</li>
<li>自动转换 JSON 数据，转换请求数据和响应数据</li>
<li>响应超时</li>
<li>同时请求</li>
<li>客户端支持防御 XSRF</li>
</ul>
<blockquote>
<p>安装</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">yarn add axios
<span class="c1"># pnpm add axios</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>引入</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>基本用法</p>
</blockquote>
<ul>
<li><code>axios.get(url[, config])</code>
<ul>
<li>代替 jQuery 的 <code>$.get(url: string, [data: object /*请求参数*/], [callback: function /*成功回调*/])</code></li>
</ul>
</li>
<li><code>axios.post(url[, data[, config]])</code>
<ul>
<li>代替 jQuery 的 <code>$.post(url: string, [data: object /*要提交的数据*/], [callback: function /*数据提交成功回调*/])</code></li>
</ul>
</li>
<li><code>axios({...})</code>代替 jQuery 的 <code>$.ajax()</code></li>
<li>为其他支持的请求方法提供的别名
<ul>
<li><code>axios.request(config)</code></li>
<li><code>axios.delete(url[, config])</code></li>
<li><code>axios.head(url[, config])</code></li>
<li><code>axios.options(url[, config])</code></li>
<li><code>axios.put(url[, data[, config]])</code></li>
<li><code>axios.patch(url[, data[, config]])</code></li>
<li>在使用别名方法时， url、method、data 这些属性都不必在配置中指定</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p><code>axios-get.js</code>，语法：<code>axios.get(url[, config])</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>

<span class="c1">// 直接发起不带参数的请求
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/getbooks&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/&#39;</span><span class="p">,</span>
    <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;直接发起不带参数的请求&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">)</span>

<span class="c1">// 先配置，后发起请求
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/&#39;</span><span class="p">,</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span>
<span class="p">})</span>

<span class="kr">const</span> <span class="nx">instance2</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/&#39;</span><span class="p">,</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/getbooks&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;// 先配置，后发起不带参请求&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">)</span>

<span class="nx">instance2</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/getbooks&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;// 先配置，后发起带参请求&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>成功返回的数据</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"> <span class="p">{</span>                                                                           
  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>                                                                   
  <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;获取图书列表成功&#34;</span><span class="p">,</span>                                                       
  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>                                                                        
    <span class="p">{</span> <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nt">&#34;bookname&#34;</span><span class="p">:</span> <span class="s2">&#34;西游记&#34;</span><span class="p">,</span> <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;吴承恩&#34;</span><span class="p">,</span> <span class="nt">&#34;publisher&#34;</span><span class="p">:</span> <span class="s2">&#34;北京图书出版社&#34;</span><span class="p">},</span>
    <span class="p">{</span> <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nt">&#34;bookname&#34;</span><span class="p">:</span> <span class="s2">&#34;三国演义&#34;</span><span class="p">,</span> <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;罗贯中&#34;</span><span class="p">,</span> <span class="nt">&#34;publisher&#34;</span><span class="p">:</span> <span class="s2">&#34;重庆图书出版社&#34;</span><span class="p">},</span>
    <span class="p">{</span> <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nt">&#34;bookname&#34;</span><span class="p">:</span> <span class="s2">&#34;红楼梦&#34;</span><span class="p">,</span> <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;曹雪芹&#34;</span><span class="p">,</span> <span class="nt">&#34;publisher&#34;</span><span class="p">:</span> <span class="s2">&#34;上海图书出版社&#34;</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>使用 APIFox 配置好接口 直接生成代码，以 <code>Fetch API</code> 为例</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// pnpm add node-fetch // 在Node环境中使用 Fetch API 安装 pnpm add node-fetch
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">fetch</span><span class="p">,</span> <span class="p">{</span><span class="nx">Headers</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;node-fetch&#39;</span>

<span class="kr">const</span> <span class="nx">myHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">()</span>
<span class="nx">myHeaders</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="s1">&#39;apifox/1.0.0 (https://www.apifox.cn)&#39;</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">requestOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="nx">myHeaders</span><span class="p">,</span>
  <span class="nx">redirect</span><span class="o">:</span> <span class="s1">&#39;follow&#39;</span>
<span class="p">}</span>

<span class="cm">/*
</span><span class="cm">fetch(&#39;http://www.liulongbin.top:3006/api/getbooks&#39;, requestOptions)
</span><span class="cm">  .then(response =&gt; response.text())
</span><span class="cm">  .then(result =&gt; console.log(result))
</span><span class="cm">  .catch(error =&gt; console.log(&#39;error&#39;, error))
</span><span class="cm">*/</span>

<span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span> <span class="nx">requestOptions</span><span class="p">)</span>
<span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">response2</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/users/github&#39;</span><span class="p">,</span> <span class="nx">requestOptions</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">data2</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">response2</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data2</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://github.com/node-fetch/node-fetch">node-fetch/node-fetch github</a></li>
<li>在浏览器的network面板中查看所有 Ajax 请求，点击 Fetch/XHR 过滤 Ajax 请求</li>
</ul>
<blockquote>
<p><code>axios-post.js</code>，语法：<code>axios.post(url[, data[, config]])</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>
<span class="c1">// 直接发起
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/addbook&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;金瓶梅&#39;</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;兰陵笑笑生&#39;</span><span class="p">,</span>
    <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;上海图书出版社&#39;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/&#39;</span><span class="p">,</span>
    <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span>
  <span class="p">}</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>
<span class="cm">/* 不允许重复添加 */</span>

<span class="c1">// 先配置，后发起请求
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">baseURL</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/&#39;</span><span class="p">,</span>
  <span class="nx">timeout</span><span class="o">:</span> <span class="mi">1000</span>
<span class="p">})</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/addbook&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;三国演义&#39;</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;罗贯中&#39;</span><span class="p">,</span>
    <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;重庆图书出版社&#39;</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
    <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;// 先配置，后发起不带参请求&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="nx">status</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">)</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
  <span class="p">})</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>axios-axios.js</code>，语法：<code>axios(config: object)</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span>
<span class="c1">// 默认Get 读取全部数据
</span><span class="c1"></span><span class="nx">axios</span><span class="p">(</span><span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="nx">dataObject</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;默认Get 读取全部数据&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dataObject.data: &#39;</span><span class="p">,</span> <span class="nx">dataObject</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">)</span>
  <span class="p">})</span>
<span class="c1">// 配置选项，读取全部数据
</span><span class="c1"></span><span class="nx">axios</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span>
<span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="nx">dataObject</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;配置选项，读取全部数据&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dataObject.data: &#39;</span><span class="p">,</span> <span class="nx">dataObject</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">)</span>
  <span class="p">})</span>
<span class="c1">// 配置params选项，读取部分数据
</span><span class="c1"></span><span class="nx">axios</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span>
  <span class="nx">params</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="nx">dataObject</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;配置params选项，读取部分数据&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dataObject: &#39;</span><span class="p">,</span> <span class="nx">dataObject</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">)</span>
  <span class="p">})</span>

<span class="c1">// 发起提交请求
</span><span class="c1"></span><span class="nx">axios</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/addbook&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;哈利波特&#39;</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;JK罗琳&#39;</span><span class="p">,</span>
    <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;上海译文图书出版社&#39;</span>
  <span class="p">}</span>
<span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="o">:</span> <span class="nx">dataObject</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;发起提交请求&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;dataObject: &#39;</span><span class="p">,</span> <span class="nx">dataObject</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;--------------&#39;</span><span class="p">)</span>
  <span class="p">})</span>

</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="08-接口和接口文档-a-hrefcatalogue--a">0.8 接口和接口文档 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>使用 Ajax 请求数据时，被请求的 URL 地址，就叫做<strong>后端数据接口</strong>（简称接口），同时，每个接口必须有请求方式，例如：</p>
</blockquote>
<ul>
<li><code>GET</code> 请求 <code>http://www.liulongbin.top:3006/api/getbooks</code> 获取图书列表的接口</li>
<li><code>POST</code> 请求 <code>http://www.liulongbin.top:3006/api/addbook</code> 添加图书的接口</li>
</ul>
<blockquote>
<p>分析接口的请求过程</p>
</blockquote>
<ul>
<li><code>GET</code> 请求过程：用户希望获取数据 -&gt; 浏览器网页（数据载体）通过 Ajax 发起 GET 数据请求 -&gt; 服务器 处理请求 -&gt; 服务器发送响应给 浏览器 Ajax -&gt; 浏览器网页展现结果</li>
<li><code>POST</code> 请求过程：用户希望提交数据 -&gt; 浏览器网页（数据载体）通过 Ajax 发起 POST 数据请求 -&gt; 服务器 处理请求 -&gt; 服务器发送响应给 浏览器 Ajax -&gt; 浏览器网页展现结果</li>
</ul>
<blockquote>
<p>接口测试工具</p>
</blockquote>
<ul>
<li>为了验证接口能否被正常访问，常常需要使用接口测试工具，来对后端数据接口进行检测</li>
<li>接口测试工具能在不写任何代码的情况下，对接口进行调用和测试</li>
<li>一般有如下几种方式
<ul>
<li>命令行<code>curl</code></li>
<li>IDE比如WebStorm自带的 工具 &gt; HTTP客户端</li>
<li>国外 Postman</li>
<li>国内 apifox 和 apipost</li>
</ul>
</li>
</ul>
<blockquote>
<p>使用 Postman 和 apifox 和 apipost</p>
</blockquote>
<ul>
<li><a href="https://www.apifox.cn/help/">Apifox 使用文档</a></li>
<li>Postman 添加标签 Tab
<ul>
<li>选择 请求类型</li>
<li>填写 URL地址</li>
<li>在请求参数区域，填写参数和数据
<ul>
<li>GET 需要在 Params 中填写</li>
<li>POST 主要在 <strong><code>Body</code></strong> 中填写
<ul>
<li>一般点选 <code>x-www-form-urlencoded</code> 后填写</li>
</ul>
</li>
</ul>
</li>
<li>发送请求按钮 Send</li>
<li>查看服务器响应结果</li>
</ul>
</li>
</ul>
<blockquote>
<p>使用 <a href="http://rap2.taobao.org/">rap2 接口平台</a></p>
</blockquote>
<ul>
<li>可以自动生成文档，导入导出给中格式文档数据</li>
</ul>
<hr>
<h3 id="09-案例以vue为例-a-hrefcatalogue--a">0.9 案例，以<code>vue</code>为例 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>案例
<ul>
<li>图书管理接口（Vue + Axios）</li>
<li>聊天机器人接口</li>
</ul>
</li>
</ul>
<hr>
<h4 id="091-图书管理接口vue--axios-a-hrefcatalogue--a">0.9.1 图书管理接口（Vue + Axios） <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p><code>BooksInfo.vue</code> 页面组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;books-info-demo&#34;</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- 添加图书的Panel面板 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">AddBookInfo</span><span class="p">&gt;&lt;/</span><span class="nt">AddBookInfo</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- 展示图书的表格 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">ShowBookInfo</span><span class="p">&gt;&lt;/</span><span class="nt">ShowBookInfo</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">AddBookInfo</span> <span class="nx">from</span> <span class="s1">&#39;@/components/ajax-demo/book-demo/AddBookInfo.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ShowBookInfo</span> <span class="nx">from</span> <span class="s1">&#39;@/components/ajax-demo/book-demo/ShowBookInfo.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">provide</span><span class="p">,</span> <span class="nx">reactive</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;BooksInfo&#34;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AddBookInfo</span><span class="p">,</span>
    <span class="nx">ShowBookInfo</span>
  <span class="p">},</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">eventbus</span> <span class="o">=</span> <span class="nx">reactive</span><span class="p">(</span><span class="k">new</span> <span class="nx">Vue</span><span class="p">());</span>
    <span class="nx">provide</span><span class="o">&lt;</span><span class="nx">Vue</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;eventbus&#39;</span><span class="p">,</span> <span class="nx">eventbus</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">eventbus</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实现 <code>AddBookInfo.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;add-book card&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;card-header&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">h3</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;card-title&#34;</span><span class="p">&gt;</span>添加新图书<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;card-body form-inline&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">labelName</span><span class="o">=</span><span class="s">&#34;书名&#34;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span>
                <span class="na">ref</span><span class="o">=</span><span class="s">&#34;iptBookname&#34;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入书名&#34;</span>
                <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;msgBook&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">labelName</span><span class="o">=</span><span class="s">&#34;作者&#34;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span>
                <span class="na">ref</span><span class="o">=</span><span class="s">&#34;iptAuthor&#34;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入作者&#34;</span>
                <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;msgAuthor&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">labelName</span><span class="o">=</span><span class="s">&#34;出版社&#34;</span>
                <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span>
                <span class="na">ref</span><span class="o">=</span><span class="s">&#34;iptPublisher&#34;</span>
                <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;请输入出版社&#34;</span>
                <span class="na">v-model</span><span class="o">=</span><span class="s">&#34;msgPublisher&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;addBookInfo&#34;</span>
                 <span class="na">ref</span><span class="o">=</span><span class="s">&#34;btnAdd&#34;</span><span class="p">&gt;</span>添加
      <span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">inject</span><span class="p">,</span> <span class="nx">Ref</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;@/components/button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueInput</span> <span class="nx">from</span> <span class="s1">&#39;@/components/input/VueInput.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">addBook</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/components/ajax-demo/http-request/addbook&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;AddBookInfo&#39;</span><span class="p">,</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">VueButton</span><span class="p">,</span>
    <span class="nx">VueInput</span>
  <span class="p">},</span>
  <span class="nx">setup</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">eventbus</span> <span class="o">=</span> <span class="nx">inject</span><span class="o">&lt;</span><span class="nx">Vue</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;eventbus&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">msgBook</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">msgAuthor</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">msgPublisher</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">addBookInfo</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">msgBook</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">iptBookname</span> <span class="nx">as</span> <span class="nx">unknown</span> <span class="nx">as</span> <span class="nx">Ref</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
      <span class="nx">msgAuthor</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">iptAuthor</span> <span class="nx">as</span> <span class="nx">unknown</span> <span class="nx">as</span> <span class="nx">Ref</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
      <span class="nx">msgPublisher</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">iptPublisher</span> <span class="nx">as</span> <span class="nx">unknown</span> <span class="nx">as</span> <span class="nx">Ref</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">).</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">msgBook</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nx">msgAuthor</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="nx">msgPublisher</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;请填写完整的图书信息！&#39;</span><span class="p">);}</span>

      <span class="c1">// 发送添加书本信息请求
</span><span class="c1"></span>      <span class="nx">addBook</span><span class="p">({</span>
        <span class="nx">bookname</span><span class="o">:</span> <span class="nx">msgBook</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="nx">author</span><span class="o">:</span> <span class="nx">msgAuthor</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="nx">publisher</span><span class="o">:</span> <span class="nx">msgPublisher</span><span class="p">.</span><span class="nx">value</span>
      <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">502</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);}</span>
          <span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
          <span class="c1">// 通知兄弟组件 ShowBookInfo.vue 更新渲染图书列表
</span><span class="c1"></span>          <span class="nx">eventbus</span><span class="o">?</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;renderBookList&#39;</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="p">};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">msgBook</span><span class="p">,</span>
      <span class="nx">msgAuthor</span><span class="p">,</span>
      <span class="nx">msgPublisher</span><span class="p">,</span>
      <span class="nx">addBookInfo</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="o">...</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实现 <code>ShowBookInfo.vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;table table-bordered table-striped&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;col&#34;</span><span class="p">&gt;</span><span class="nx">Id</span><span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;col&#34;</span><span class="p">&gt;</span><span class="nx">书名</span><span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;col&#34;</span><span class="p">&gt;</span><span class="nx">作者</span><span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;col&#34;</span><span class="p">&gt;</span><span class="nx">出版社</span><span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;col&#34;</span><span class="p">&gt;</span><span class="nx">操作</span><span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tbody</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;tb&#34;</span> <span class="nt">@click</span><span class="s">=&#34;handleClick&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">tr</span> <span class="nt">v-for</span><span class="s">=&#34;{id, bookname, author, publisher} in rowsData&#34; </span><span class="nt">:key</span><span class="s">=&#34;id&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">scope</span><span class="o">=</span><span class="s">&#34;row&#34;</span><span class="p">&gt;{{</span> <span class="nx">id</span> <span class="p">}}&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;{{</span> <span class="nx">bookname</span> <span class="p">}}&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;{{</span> <span class="nx">author</span> <span class="p">}}&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;{{</span> <span class="nx">publisher</span> <span class="p">}}&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;javascript:null;&#34;</span>
           <span class="na">class</span><span class="o">=</span><span class="s">&#34;del&#34;</span>
           <span class="nt">:data-id</span><span class="s">=&#34;id&#34;</span><span class="p">&gt;</span><span class="nx">删除</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">inject</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">getBookList</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/components/ajax-demo/http-request/getBookList&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">delBook</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/components/ajax-demo/http-request/delBook&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;ShowBookInfo&#39;</span><span class="p">,</span>
  <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">eventbus</span> <span class="o">=</span> <span class="nx">inject</span><span class="p">&lt;</span><span class="nt">Vue</span><span class="p">&gt;(</span><span class="s1">&#39;eventbus&#39;</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">rowsData</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">&lt;</span><span class="nt">string</span><span class="err">[]</span><span class="p">&gt;([</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
    <span class="kr">const</span> <span class="nx">getBookInfo</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">getBookList</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
            <span class="nx">rowsData</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="k">return</span> <span class="sb">`获取数据失败！</span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">getBookInfo</span><span class="p">();</span>

    <span class="c1">// 通过代理的方式为动态添加的元素绑定点击事件 删除图书
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">handleClick</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="o">:</span> <span class="nx">MouseEvent</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">((</span><span class="nx">e</span><span class="o">?</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">dataset</span><span class="p">).</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">bookId</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="o">?</span><span class="p">.</span><span class="nx">target</span> <span class="nx">as</span> <span class="nx">HTMLElement</span><span class="p">).</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="p">(</span><span class="nx">bookId</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">+</span><span class="nx">bookId</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>
          <span class="o">?</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;请勿删除原始数据&#39;</span><span class="p">)</span>
          <span class="o">:</span> <span class="nx">bookId</span> <span class="o">&amp;&amp;</span> <span class="nx">delBook</span><span class="p">(</span>
          <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="nx">bookId</span><span class="p">}</span>
        <span class="p">)</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
              <span class="c1">// const {data} = res.data;
</span><span class="c1"></span>              <span class="nx">getBookInfo</span><span class="p">();</span>
              <span class="k">return</span> <span class="s1">&#39;删除图书成功！&#39;</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="sb">`删除图书失败！</span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
          <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">eventbus</span><span class="o">?</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">&#39;renderBookList&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">getBookInfo</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">rowsData</span><span class="p">,</span>
      <span class="nx">getBookInfo</span><span class="p">,</span>
      <span class="nx">handleClick</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span> <span class="na">scoped</span><span class="p">&gt;</span>
<span class="p">...</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实现 <code>addbook.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">import axios from &#39;axios&#39;;

export const addBook = (paramsData: Record<span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span> <span class="na">string</span><span class="p">&gt;</span>) =&gt; {
  // 发送添加书本信息请求
  return axios.post(&#39;/api/addbook&#39;,
    paramsData,
    {
      baseURL: &#39;http://www.liulongbin.top:3006/&#39;,
      timeout: 0
    }
  );
};
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实现 <code>delBook.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">import axios from &#39;axios&#39;;

export const delBook = (paramsData: Record<span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span> <span class="na">string</span><span class="p">&gt;</span>) =&gt; {
  return axios.get(
    &#39;/api/delbook&#39;,
    {
      baseURL: &#39;http://www.liulongbin.top:3006&#39;,
      params: paramsData
    });
};
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>实现 <code>getBookList.ts</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">import axios from &#39;axios&#39;;

export const getBookList = () =&gt; {
  return axios.get(
    &#39;/api/getbooks&#39;,
    {
      baseURL: &#39;http://www.liulongbin.top:3006&#39;
    });
};

</code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="092-聊天机器人接口-a-hrefcatalogue--a">0.9.2 聊天机器人接口 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>头铁聊天AI机器人</p>
</blockquote>
<ul>
<li>文字<code>http://www.liulongbin.top:3006/api/robot?spoken=</code></li>
<li>语音<code>http://www.liulongbin.top:3006/api/synthesize?text=</code></li>
</ul>
<hr>
<h3 id="010-form表单的现代用法-a-hrefcatalogue--a">0.10 form表单的现代用法 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li><code>&lt;form&gt;&lt;/form&gt;</code> 表单的常用属性</li>
<li>通过 Ajax 提交表单数据
<ul>
<li>阻止表单的默认提交行为</li>
</ul>
</li>
<li>案例 评论列表</li>
<li>快速获取表单的数据</li>
<li>使用表单库<code>formily</code></li>
</ul>
<hr>
<blockquote>
<p>表单在网页中主要负责 <strong>数据采集</strong> 的功能，即用于采集用户输入的信息，并通过 <code>&lt;form&gt;</code>标签的提交操作，将采集的信息提交对服务端进行处理</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;info&#34;</span><span class="p">&gt;</span>Enter info: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;info&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;info&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;password&#34;</span><span class="p">&gt;</span>Enter password: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;checkbox&#34;</span><span class="p">&gt;</span>记住我<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>表单由三个基本部分组成：
<ul>
<li>表单标签 <code>&lt;form&gt;&lt;/form&gt;</code></li>
<li>表单域可以包含以下常用元素：
<ul>
<li>文本框</li>
<li>密码框</li>
<li>隐藏域</li>
<li>多行文本框</li>
<li>复选框</li>
<li>单选框</li>
<li>下拉选择框</li>
</ul>
</li>
<li>表单按钮 <code>&lt;button type=&quot;submit&quot;&gt;&lt;/button&gt;</code></li>
</ul>
</li>
</ul>
<h4 id="0101-表单标签的属性">0.10.1 表单标签的属性</h4>
<blockquote>
<p><code>&lt;form&gt;&lt;/form&gt;</code>标签用来采集数据，<code>&lt;form&gt;&lt;/form&gt;</code>标签的属性则是用来规定 <strong>如何将采集到的数据发送到服务器</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>属性</th>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>action</code></td>
<td>URL地址</td>
<td>规定当提交表单时，向何处发送表单数据</td>
</tr>
<tr>
<td><code>method</code></td>
<td>GET(/POST)</td>
<td>规定以何种方式将表单数据提交到 <code>action URL</code></td>
</tr>
<tr>
<td><code>enctype</code></td>
<td><code>*1</code> 默认<code>application/x-www-form-urluncoded</code></td>
<td>规定在发送表单数据之前，如何对其进行编码的格式</td>
</tr>
<tr>
<td><code>target</code></td>
<td><code>*2</code> 默认<code>_self</code></td>
<td>规定在浏览器何处打开 <code>action URL</code></td>
</tr>
</tbody>
</table>
<ul>
<li><code>*1</code> 编码格式有：
<ul>
<li><code>application/x-www-form-urluncoded</code></li>
<li><code>multipart/form-data</code></li>
<li><code>text/plain</code></li>
</ul>
</li>
<li><code>*2</code> 打开方式有：
<ul>
<li><code>_blank</code></li>
<li><code>_self</code></li>
<li><code>_parent</code></li>
<li><code>_top</code></li>
<li><code>framename</code></li>
</ul>
</li>
</ul>
<h5 id="action"><code>action</code></h5>
<ul>
<li><code>action</code>规定当提交表单时，向何处发送表单数据</li>
<li><code>action</code>属性的值应该是 <strong>后端提供的</strong> 一个 URL 地址，这个 URL 地址专门负责接受表单提交过来的数据（即表单的数据最终提交到 <code>action</code> 属性所指向的 URL 地址来进行处理）</li>
<li>当<code>&lt;form&gt;&lt;/form&gt;</code>表单在未指定 <code>action</code> 属性值得情况下，<code>action</code> 的默认值为当前页面的 URL 地址</li>
<li>当提交表单后，页面会立即跳转到 <code>action</code> 属性指定的 URL 地址，同时将表单的数据以查询参数字符传的形式放在 URL 后</li>
</ul>
<h5 id="target"><code>target</code></h5>
<ul>
<li>和<code>&lt;a&gt;&lt;/a&gt;</code>标签的属性相同，规定在浏览器何处打开 <code>action URL</code></li>
<li>可选值有5个，默认情况下，<code>target</code>的值为<code>_self</code>，表示在相同的框架或窗口中打开，一般为在当前页面中打开 <code>action URL</code></li>
</ul>
<table>
<thead>
<tr>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_blank</code></td>
<td>在新标签页打开</td>
</tr>
<tr>
<td><code>_self</code></td>
<td>默认值，在相同的框架或窗口中打开</td>
</tr>
<tr>
<td><code>_parent</code></td>
<td>在父框架集中打开（很少用）</td>
</tr>
<tr>
<td><code>_top</code></td>
<td>在整个窗口中打开（很少用）</td>
</tr>
<tr>
<td><code>framename</code></td>
<td>在指定的框架中打开（很少用）</td>
</tr>
</tbody>
</table>
<h5 id="method"><code>method</code></h5>
<ul>
<li>规定以何种方式将表单数据提交到 <code>action URL</code></li>
<li>可选值只有两个，分别是 <code>GET</code> 和 <code>POST</code>，不支持其他方式（请求动词）
<ul>
<li>大小写不敏感</li>
</ul>
</li>
<li>默认情况下，<code>method</code>的值为<code>GET</code>，表示通过 URL 的形式，把表单数据提交到 <code>action URL</code>
<ul>
<li>数据为以 <code>?</code> 开头，<code>数据名=数据值</code>的形式，并以<code>&amp;</code>连接不同的数据，一般称为查询字符串参数 <code>Query String Parameters</code></li>
</ul>
</li>
<li>发出<code>POST</code>请求时，提交的数据并不会显示在地址栏 URL 中</li>
</ul>
<blockquote>
<p>发出请求后，查看浏览器<code>Network</code>面板中请求相关信息</p>
</blockquote>
<ul>
<li>请求地址 <code>Request URL</code> 完整地址</li>
<li>发出<code>GET</code>请求时，查询字符串参数 <code>Query String Parameters</code> 被单独取出，并分别显示数据</li>
<li>发出<code>POST</code>请求时，<code>Request URL</code>只包含<code>action URL</code>
<ul>
<li>数据是通过 <code>Form Data</code>的形式提交</li>
<li>数据相对更隐蔽，但不使用 <code>https</code> 协议的话，仍为明文传输数据，不安全</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意</p>
</blockquote>
<ul>
<li><code>GET</code>的语义为<strong>获取数据</strong>，提交的数据为查询参数，目的为查询并获取服务器上的数据，在表单中较少使用</li>
<li><code>POST</code>的语义为<strong>提交数据</strong>，适合用来在表单提交数据给服务器，包括文件上传
<ul>
<li>登录。注册或添加数据等表单操作，都只使用<code>POST</code>方式来提交表单</li>
</ul>
</li>
</ul>
<h5 id="enctype"><code>enctype</code></h5>
<ul>
<li>规定在发送表单数据之前，如何对其进行 <strong>编码的格式</strong></li>
<li>可选值有三个，默认值为 <code>application/x-www.form-urlencoded</code>，表示在发送前编码所有的字符</li>
</ul>
<table>
<thead>
<tr>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>application/x-www.form-urlencoded</code></td>
<td>默认值，表示在发送前编码所有的字符，一般字符串数据</td>
</tr>
<tr>
<td><code>mutipart/form-data</code></td>
<td>表示不对字符编码，在使用包含 <strong>文件上传空间的表单</strong> 时，必须使用该值</td>
</tr>
<tr>
<td><code>text/plain</code></td>
<td>三空格转换为 <code>+</code> 号，但不对特殊字符编码，极少用</td>
</tr>
</tbody>
</table>
<blockquote>
<p>表单提交注意</p>
</blockquote>
<ul>
<li>在涉及 <strong>文件上传</strong> 操作时，必须将 <code>enctype</code> 的值设置为 <strong><code>mutipart/form-data</code></strong></li>
<li>不涉及 <strong>文件上传</strong> 操作时，则将 <code>enctype</code> 的值设置为 <strong><code>application/x-www.form-urlencoded</code></strong></li>
</ul>
<h4 id="0102-表单的同步提交及缺点">0.10.2 表单的同步提交及缺点</h4>
<ul>
<li>通过 <code>submit</code> 按钮，触发表单提交的操作，从而使页面跳转到 <code>action URL</code>的行为，叫做表单的同步提交</li>
</ul>
<blockquote>
<p>表单同步提交的缺点</p>
</blockquote>
<ul>
<li><code>&lt;form&gt;&lt;/form&gt;</code>表单同步提交后，整个页面会发生跳转，跳转到 <code>action URL</code> 所指向的地址，用户体验相对不好</li>
<li><code>&lt;form&gt;&lt;/form&gt;</code>表单同步提交后，回退到页面之前的状态和填写的数据会丢失</li>
</ul>
<h4 id="0103-通过-ajax-提交表单">0.10.3 通过 <code>Ajax</code> 提交表单</h4>
<blockquote>
<p>可以解决表单同步提交的两个缺点</p>
</blockquote>
<ul>
<li>页面发生跳转</li>
<li>页面状态和数据丢失</li>
</ul>
<blockquote>
<p>表单 <strong>只负责采集数据</strong>， <code>Ajax</code>负责将数据提交到服务器</p>
</blockquote>
<ul>
<li>监听表单的提交事件<code>submit</code></li>
<li>阻止表单默认提交行为 <code>event.preventDefault()</code></li>
<li>快速获取表单中的数据</li>
<li>使用 Ajax 异步提交数据</li>
</ul>
<h5 id="监听表单的提交事件-submit">监听表单的提交事件 <code>submit</code></h5>
<ul>
<li>当表单提交的时候触发submit事件</li>
<li>注意submit事件只能作用于<code>form</code>元素中，不能单独作用于<code>button</code>或者<code>&lt;input type=&quot;submit&quot;&gt;</code>，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLFormElement/submit_event">查看MDN -&gt;</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/GlobalEventHandlers/onsubmit"><code>submit</code> <code>onsubmit</code></a></li>
</ul>
<h5 id="阻止表单默认提交行为"><strong>阻止表单默认提交行为</strong></h5>
<blockquote>
<p>即阻止默认表单提交后的跳转行为</p>
</blockquote>
<ul>
<li>当监听到表单的提交事件后，可以在回调函数中调用事件对象<code>e</code>的 <code>e.preventDefault()</code> 函数，来阻止表单的提交和页面的跳转</li>
</ul>
<h4 id="0104-获取表单中的数据">0.10.4 获取表单中的数据</h4>
<ul>
<li><a href="https://blog.csdn.net/chenshanqiang/article/details/103934308">通过ajax提交form表单数据的几种方式</a></li>
</ul>
<blockquote>
<p>在发送请求之前，需要获取用户填写表单的数据</p>
</blockquote>
<ul>
<li>在获取表单数据时，必须为每个表单域中需要获取数据的元素添加 <code>name</code> 属性，而且值不能重复</li>
<li>封装类似于JQ中的<code>serialize()</code>，将表单所有输入框的信息，按照 <code>name</code> = 用户填写的 <code>value</code> ，以及连接符 <code>&amp;</code>，进行拼接</li>
<li><a href="https://www.cnblogs.com/goloving/p/7417577.html">jQuery序列化表单数据 serialize()、serializeArray()及使用</a></li>
</ul>
<hr>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://zhuanlan.zhihu.com/uform/">Formily&ndash;阿里统一表单解决方案 知乎</a></li>
<li><a href="https://www.zhihu.com/question/469405625/answer/1973516177">如何评价Formily2.0？ 知乎</a></li>
<li><a href="https://www.icode9.com/content-4-1072036.html">Formily教程 | formily是中后台复杂场景的表单解决方案</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/142237587">Formily实践</a></li>
<li><a href="https://github.com/alibaba/formily">alibaba/formily github</a></li>
<li><a href="https://v2.formilyjs.org/zh-CN">Alibaba Formily 中文官网</a></li>
</ul>
<hr>
<h2 id="1-ajax原理和应用a-idajax原理-hrefajax原理--aa-hrefcatalogue--a">1. AJAX原理和应用<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="11-ajax是浏览器上的功能-a-hrefcatalogue--a">1.1 AJAX是浏览器上的功能 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>通过JS发请求和收响应实现前后端交互</li>
<li>浏览器可以<strong>发请求</strong>，<strong>收响应</strong></li>
<li>浏览器在<code>window</code>上加一个 <code>XMLHttpRequest</code>构造函数</li>
<li><a href="https://wangdoc.com/javascript/bom/xmlhttprequest.html#xmlhttprequestsend"><code>XMLHttpRequest</code> 属于 BOM 浏览器模型 * MDN</a></li>
<li><code>XMLHttpRequest</code>对象实例可以发出HTTP请求与接收HTTP响应</li>
<li>使用浏览器内置的<code>XMLHttpRequest</code>和<code>fetch API</code>(ES6)， 实现在页面不刷新的情况下和服务端进行数据交互</li>
<li>优点：交互数据时<strong>不需要刷新整个页面</strong>，只需<strong>局部刷新</strong>，页面不发生用跳转
<ul>
<li>一旦拿到服务器返回的数据，AJAX 不会刷新整个网页，而是只更新网页里面的相关部分，从而不打断用户正在做的事情，体验较好</li>
</ul>
</li>
<li>注意，AJAX 只能向 <strong>同源网址</strong> （协议、域名、端口都相同）发出 HTTP 请求，如果发出跨域请求，就会报错</li>
<li>支持所有 HTTP 请求方法(请求动词)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span>
<span class="c1">// function
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>用这个构造函数（类）可以构造出一个对象</li>
<li>JS通过它实现<strong>发请求</strong>，<strong>收响应</strong></li>
</ul>
<h3 id="12-准备服务器-a-hrefcatalogue--a">1.2 准备服务器 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>使用 <a href="https://github.com/xmasuhai/node-demo-1/blob/master/server.js">server.js</a> 作为服务器</li>
<li>下载或复制代码即可用 <code>node sever.js 8888</code>启动</li>
<li>使用<code>node-dev</code>工具 ，安装</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">yarn global add node-dev

<span class="c1"># 或者用</span>
npm install -g node-dev
</code></pre></td></tr></table>
</div>
</div><ul>
<li>用<code>node-dev</code>代替<code>node</code>，实现自动重启服务器</li>
<li>但不能监听页面自动刷新</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">node-dev server.js <span class="m">8888</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>添加<code>index.html /  main.js</code>两个路由</li>
<li>路由就是<code>if..else</code></li>
<li>在<code>index.html</code>中加载路由读取的<code>main.js</code></li>
<li>加载的文件中引用到的路径，必须和路由的<code>if..else</code>中的路径<code>path</code>一致，<code>server.js</code>才会加载</li>
<li>而<code>response.write(fs.readFileSync('src/xxx'))</code>中的是相对路径，和<code>path</code>的不同</li>
</ul>
<hr>
<h3 id="13-复习-a-hrefcatalogue--a">1.3 复习 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<ul>
<li>在<code>server.js</code>中添加路由（条件），访问文件</li>
<li>添加<code>response.statusCode = 200</code></li>
<li>设置<code>Content-Type</code>为对应的类型<code>response.setHeader('Content-Type', 'text/javascript;charset=utf-8')</code></li>
<li>把文件读成字符串，再传入<code>response.write</code></li>
<li>结束，关闭 <code>response.end()</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/index.html&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>文件实际上对于<code>node</code>服务器来说就是字符串，只不过把字符串写到文件里而已</p>
</blockquote>
<p><a href="http://xmasuhai.xyz/post/http/http%E9%9D%9E%E5%85%A8%E8%A7%A3%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94-node.js-server/">【HTTP非全解】请求和响应 &amp; Node.Js Server</a></p>
<hr>
<h3 id="14-如何使用js原生xmlhttprequest发起-ajax-请求a-hrefcatalogue--a">1.4 如何使用JS原生<code>XMLHttpRequest</code>发起 <code>Ajax</code> 请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h4 id="141-xmlhttprequest的基本使用a-hrefcatalogue--a">1.4.1 <code>XMLHttpRequest</code>的基本使用<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li><code>XMLHttpRequest</code>（简称xhr）时浏览器提供的JS内置对象，通过它，可以 <strong>请求服务器上的数据源</strong>
<ul>
<li>JQ中的<code>.ajax</code>函数和<code>axios</code>是库基于xhr对象封装</li>
</ul>
</li>
<li>和它同一等级的底层接口，功能相同的ES6 API是<code>Fetch API</code></li>
</ul>
<blockquote>
<p>以发送GET请求为例：</p>
</blockquote>
<ul>
<li>创建对象 <code>new XMLHttpRequest()</code> 一般使用命名为 xhr 的变量接收</li>
<li>配置参数 <code>.open('GET', url)</code> 指定 请求方式 和 URL地址</li>
<li>绑定事件 <code>.onreadystatechange = () =&gt; {}</code>
<ul>
<li>异步监听响应函数，判断响应状态</li>
<li><code>.readyState === 4</code> xhr 对象的请求状态</li>
<li><code>.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) || xhr.status === 304</code> 服务器响应状态</li>
<li>使用服务器响应回来的数据 <code>xhr.responseText</code></li>
</ul>
</li>
<li>发送请求 <code>.send()</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>

<span class="c1">// console.log(&#39;readyState&#39;, xhr.readyState) // readyState 0
</span><span class="c1"></span>
<span class="c1">// xhr.open(&#39;GET&#39;, url, true)
</span><span class="c1">// xhr.open(&#39;GET&#39;, &#39;/login?username=john&amp;password=123&#39;, true)
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>

<span class="c1">// console.log(&#39;readyState&#39;, xhr.readyState) // readyState 1
</span><span class="c1"></span>
<span class="cm">/* 异步代码 */</span>
<span class="c1">// xhr.onload = () =&gt; {} // 老方法
</span><span class="c1">// xhr.addEventListener(&#39;load&#39;, () =&gt; {}) // 老方法
</span><span class="c1">// 触发`load`事件表示 readyState已经是 4 了
</span><span class="c1">// xhr.error = () =&gt; {} // 浏览器控制台模拟断网
</span><span class="c1">// xhr.status === 304 重定向 缓存
</span><span class="c1"></span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// console.log(&#39;readyState&#39;, xhr.readyState)
</span><span class="c1"></span>    <span class="c1">// readyState 2
</span><span class="c1"></span>    <span class="c1">// readyState 3
</span><span class="c1"></span>    <span class="c1">// readyState 4
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">((</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;xhr.status&#39;</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="c1">// 200
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="p">}</span>
            
    <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 异步代码 */</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>区别<code>xhr.readyState</code>加载状态和<code>xhr.status</code>服务器HTTP响应状态</li>
</ul>
<blockquote>
<p>实例，以黑马的免费教学API为例：</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">)</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readystate</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="142-xhr-对象的-readystate-属性a-hrefcatalogue--a">1.4.2 xhr 对象的 readyState 属性<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p><code>XMLHttpRequest</code> 对象的 <code>readyState</code> 属性，用来表示 <strong>当前 Ajax 请求所处的状态</strong></p>
<p>每个 Ajax 请求必然处于以下5个状态中的一个</p>
</blockquote>
<table>
<thead>
<tr>
<th>值</th>
<th>状态</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><code>UNSENT</code></td>
<td><code>XMLHttpRequest</code>对象已被创建，但尚未调用 open 方法</td>
</tr>
<tr>
<td>1</td>
<td><code>OPENED</code></td>
<td><code>open</code>方法已被调用</td>
</tr>
<tr>
<td>2</td>
<td><code>HEADERS_RECIEVED</code></td>
<td><code>send()</code>方法已被调用，响应头页已被接收</td>
</tr>
<tr>
<td>3</td>
<td><code>LOADING</code></td>
<td>数据接收中，此时<code>response</code>属性中已经包含部分数据</td>
</tr>
<tr>
<td>4</td>
<td><code>DONE</code></td>
<td><code>Ajax</code>请求完成，数据传输已经完成或者失败</td>
</tr>
</tbody>
</table>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/onreadystatechange">XMLHttpRequest.onreadystatechange MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState">XMLHttpRequest.readyState</a>相关状态，4 表示下载完成</li>
</ul>
<hr>
<h4 id="143-使用-xhr-发起带参数的get请求a-hrefcatalogue--a">1.4.3 使用 xhr 发起带参数的GET请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>使用 xhr 发起带参数的GET请求时，需要在调用 <code>xhr.open()</code>期间，为 URL 地址指定参数即可</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>

<span class="c1">// 查询查询字符串 ?id=1
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks?id=1&#39;</span><span class="p">)</span>


<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readystate</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在URL地址后面拼接的参数 <code>?id=1</code>，称为 <strong>查询字符串</strong></li>
<li>查询字符串（URL参数）是指在 URL 末尾加上 <strong>用于向服务器发送信息</strong> 的字符串（变量）</li>
<li>格式为：
<ul>
<li>将英文的 <code>?</code> 放在 URL 的末尾，然后再加上 <strong><code>参数=值</code></strong></li>
<li>加上多个参数，使用 <strong><code>&amp;</code></strong> 符号进行分隔</li>
</ul>
</li>
<li>一般只在 <code>GET</code>请求中添加使用，将所需发送给服务器的数据添加到 URL 中</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">// 不带参数的 URL 地址
http://www.liulongbin.top:3006/api/getbooks
// 带参数的 URL 地址
http://www.liulongbin.top:3006/api/getbooks?id<span class="o">=</span><span class="m">1</span>
// 带两个参数的 URL 地址
http://www.liulongbin.top:3006/api/getbooks?id<span class="o">=</span>1<span class="p">&amp;</span><span class="nv">bookname</span><span class="o">=</span>西游记
</code></pre></td></tr></table>
</div>
</div><h4 id="144-get请求携带参数的本质a-hrefcatalogue--a">1.4.4 GET请求携带参数的本质<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>发起 GET 请求时，当 URL 需要携带参数的时候，本质上，都是直接将参数以查询字符串的形式，追加到 URL 地址的后面，发送到服务器</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 为给定 ID 的 user 创建请求
</span><span class="c1">// 发送 GET 请求（默认的方法）
</span><span class="c1"></span><span class="nx">axios</span><span class="p">(</span><span class="s1">&#39;/user/12345&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(...);</span>

<span class="c1">// 等价于
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user?ID=12345&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(...);</span>

<span class="c1">// 等价于
</span><span class="c1"></span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
     <span class="nx">ID</span><span class="o">:</span> <span class="mi">12345</span>
  <span class="p">}</span>
<span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(...);</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>打开浏览器控制面板查看GET请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">getBook</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span>: <span class="kt">number</span><span class="p">,</span> <span class="nx">bookname?</span>: <span class="kt">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span>
    <span class="s1">&#39;/api/getbooks&#39;</span><span class="p">,</span>
    <span class="p">{</span>
      <span class="nx">params</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
        <span class="nx">bookname</span>: <span class="kt">bookname</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">getBook</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;西游记&#39;</span><span class="p">);</span>

</code></pre></td></tr></table>
</div>
</div><ul>
<li>URL地址编码
<ul>
<li><code>请求 URL: http://www.liulongbin.top:3006/api/getbooks?id=1&amp;bookname=%E8%A5%BF%E6%B8%B8%E8%AE%B0</code></li>
</ul>
</li>
</ul>
<hr>
<h4 id="url编码">URL编码</h4>
<ul>
<li>URL地址中，只允许出现英文相关的字母、标点符号、数字</li>
<li>URL地址中，不允许出现中文字符</li>
<li>如果 URL 中需要包含中文字符，则必须对中文字符进行编码（转义）</li>
<li>URL 编码原则：使用安全的字符（没有特殊用途或者意义的可打印字符）去表示不安全的字符</li>
<li>通俗理解：使用英文字符表示非英文字符</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">http://www.liulongbin.top:3006/api/getbooks?id<span class="o">=</span>1<span class="p">&amp;</span><span class="nv">bookname</span><span class="o">=</span>西游记
<span class="c1"># 经过 URL 编码之后，URL 地址变为如下格式</span>
http://www.liulongbin.top:3006/api/getbooks?id<span class="o">=</span>1<span class="p">&amp;</span><span class="nv">bookname</span><span class="o">=</span>%E8%A5%BF%E6%B8%B8%E8%AE%B0
</code></pre></td></tr></table>
</div>
</div><h4 id="url编码与解码-api">URL编码与解码 API</h4>
<blockquote>
<p>浏览器提供了 URL 编码与解码的 API，分别是：</p>
</blockquote>
<ul>
<li><code>encodeURI()</code> 编码的函数</li>
<li><code>decodeURI()</code> 解码的函数</li>
<li>属于<a href="https://wangdoc.com/javascript/bom/location.html">浏览器模型 BOM Location 对象，URL 对象，URLSearchParams 对象 MDN</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nb">encodeURI</span><span class="p">(</span><span class="sb">`西游记`</span><span class="p">)</span> <span class="c1">// &#39;%E8%A5%BF%E6%B8%B8%E8%AE%B0&#39;
</span><span class="c1"></span><span class="nb">decodeURI</span><span class="p">(</span><span class="sb">`%E8%A5%BF%E6%B8%B8%E8%AE%B0`</span><span class="p">)</span> <span class="c1">// &#39;西游记&#39;
</span><span class="c1"></span><span class="nb">encodeURI</span><span class="p">(</span><span class="sb">`西`</span><span class="p">)</span> <span class="c1">// &#39;%E8%A5%BF&#39;
</span><span class="c1"></span><span class="nb">decodeURI</span><span class="p">(</span><span class="sb">`%E8%A5%BF`</span><span class="p">)</span> <span class="c1">// &#39;西&#39;
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>浏览器自动对 URL 地址进行编码操作，无需关心 URL 地址的编码与解码操作</p>
</blockquote>
<hr>
<h4 id="145-使用-xhr-发起带参数的post请求a-hrefcatalogue--a">1.4.5 使用 xhr 发起带参数的POST请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>步骤</p>
</blockquote>
<ol>
<li>创建 <code>xhr</code> 对象</li>
<li>调用 <code>xhr.open()</code> 函数 设置请求类型和 URL</li>
<li>调用 <code>xhr.setRequestHeader()</code> 设置 <code>Content-Type</code> 属性（固定写法）</li>
<li>监听 <code>xhr.onreadystatechange</code> 事件</li>
<li>调用 <code>xhr.send()</code>函数，同时要在<code>send()</code>函数的参数中指定要发送的数据</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 1. 创建 `xhr` 对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="c1">// 2. 调用 `xhr.open` 函数
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/addbook&#39;</span><span class="p">)</span>
<span class="c1">// 3. 设置 `Content-Type` 属性（固定写法）
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">)</span>
<span class="c1">// 4. 监听 `xhr.onreadystatechange` 事件
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span><span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span><span class="nx">responseText</span><span class="p">}</span> <span class="o">=</span> <span class="nx">xhr</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">responseText</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="c1">// 5. 调用 `xhr.send()`函数
</span><span class="c1">// 同时要在`send()`函数的参数中指定要发送的数据，以查询字符串的形式，无需以 ? 开头
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;bookname=水浒传&amp;author=施耐庵&amp;publisher=天津出版社&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>send方法的参数就是发送的数据。<a href="https://wangdoc.com/javascript/bom/xmlhttprequest.html#xmlhttprequestsend">多种格式的数据 *mdn</a>，都可以作为它的参数。</li>
</ul>
<hr>
<h4 id="146-数据交换格式a-hrefcatalogue--a">1.4.6 数据交换格式<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>数据交换格式就是 <strong>服务器端与客户端</strong> 之间进行数传输与交换的格式</p>
</blockquote>
<ul>
<li>在涉及网络传输方面，XML 格式已经过时了
<ul>
<li>区别于 HTML (网页内容的载体)，XML 作为数据的载体用来传输和存储数据</li>
<li>XML 格式臃肿，和数据无关的代码多，传输效率低</li>
<li>XML 牺牲了体积，增加冗余大小来实现数据语义化</li>
<li>需要额外的解析器</li>
</ul>
</li>
<li>JSON 是主流的交换格式</li>
</ul>
<h5 id="javascript-object-notationa-hrefcatalogue--a"><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<ul>
<li>中文翻译为 对象表示法</li>
<li>JSON 就是 JavaScript <strong>对象和数组</strong> 的 <strong>字符串表示法</strong></li>
<li>JSON 使用文本表示一个 JS 对象和数组的信息</li>
<li>JSON 的本质可以理解为字符串数据，即用字符串来表示 JS 对象数据或数组数据</li>
<li>JSON 是一种轻量级的文本数据交换格式。</li>
<li>用于在计算机和网络之间存储和传输数据</li>
<li>相较于 XML 优点为 体积更小、更快、更易解析</li>
<li>2.6 回顾复习JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></li>
</ul>
<h5 id="json-的两种结构a-hrefcatalogue--a">JSON 的两种结构<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<blockquote>
<p>JSON是用字符串来表示 JavaScript 的对象和数组</p>
<p>所以，JSON中包含 <strong>对象</strong> 和 <strong>数组</strong> 两种结构，通过这两种结构的互相嵌套，可以表示复杂的数据结构</p>
</blockquote>
<h5 id="json-的对象结构a-hrefcatalogue--a">JSON 的对象结构<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<blockquote>
<p>对象结构在 JSON 中表现为花括号 <code>{}</code> 括起来的内容</p>
</blockquote>
<ul>
<li>数据结构形式为 <code>{key: value, key: value, ...}</code>的键值对结构</li>
<li>其中，key必须是使用 <strong>英文的双括号包裹</strong> 的字符串</li>
<li>value 的数据类型只可以是 <strong>字符串</strong>、<strong>数字</strong>、<strong>布尔值</strong>、<strong>数组</strong>、<strong>对象</strong> 和 <strong>null</strong> 6种</li>
</ul>
<blockquote>
<p>错误范例：</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="err">name:</span> <span class="nt">&#34;zd&#34;</span><span class="p">,</span>
  <span class="err">&#39;age&#39;:</span> <span class="err">20,</span>
  <span class="nt">&#34;gender&#34;</span><span class="p">:</span> <span class="err">&#39;female&#39;</span><span class="p">,</span>
  <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="err">undefined</span><span class="p">,</span>
  <span class="nt">&#34;hobby&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;美食&#34;</span><span class="p">,</span> <span class="s2">&#34;睡觉&#34;</span><span class="p">,</span> <span class="err">&#39;追剧&#39;</span><span class="p">],</span>
  <span class="c1">// 错误的示范
</span><span class="c1"></span>  <span class="nt">&#34;say&#34;</span><span class="p">:</span> <span class="err">function()</span> <span class="p">{},</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>属性名必须由双引号包裹</li>
<li>值为字符串类型时，必须由双引号包裹而不是由单引号或反引号
<ul>
<li>JSON 中不允许由单引号或反引号表示字符串</li>
</ul>
</li>
<li>表示空值时，必须使用<code>null</code>而不是<code>undefined</code></li>
<li>所有含有字符串的值时，必须加双引号而不是单引号或反引号</li>
<li>不允许函数作为值或属性</li>
<li>不允许在末尾数据项后加逗号</li>
<li>JSON 中不可以写注释</li>
<li>JSON 的最外层必须是对象或数组格式</li>
<li>JSON 不允许使用<code>undefined</code>、<code>function() {}</code>函数作为 JSON的属性或值</li>
</ul>
<blockquote>
<p>正确范例：</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;zd&#34;</span><span class="p">,</span>
  <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="nt">&#34;gender&#34;</span><span class="p">:</span> <span class="s2">&#34;female&#34;</span><span class="p">,</span>
  <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&#34;hobby&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;美食&#34;</span><span class="p">,</span> <span class="s2">&#34;睡觉&#34;</span><span class="p">,</span> <span class="s2">&#34;追剧&#34;</span><span class="p">],</span>
  <span class="nt">&#34;isMarried&#34;</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="json-的数组结构a-hrefcatalogue--a">JSON 的数组结构<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<blockquote>
<p>JSON 的数组结构在 JSON 中表现为以 <code>[]</code> 括起来的内容</p>
</blockquote>
<ul>
<li>数据结构为 <code>[&quot;js&quot;, 30, true, {}, [], null]</code></li>
<li>数组中数据类型可以是 <strong>字符串</strong>、<strong>数字</strong>、<strong>布尔值</strong>、<strong>数组</strong>、<strong>对象</strong> 和 <strong>null</strong> 6种</li>
</ul>
<blockquote>
<p>合法的 数组形式的 JSON 数据</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[</span><span class="s2">&#34;js&#34;</span><span class="p">,</span> <span class="s2">&#34;ts&#34;</span><span class="p">,</span> <span class="s2">&#34;go&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mf">300.5</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;zs&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span> <span class="p">{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;ls&#34;</span><span class="p">,</span> <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="p">[[</span><span class="s2">&#34;苹果&#34;</span><span class="p">,</span> <span class="s2">&#34;榴莲&#34;</span><span class="p">,</span> <span class="s2">&#34;椰子&#34;</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意 JSON 中不支持 bigInt 类型的数据</p>
</blockquote>
<ul>
<li>JSON 标准（<a href="https://tools.ietf.org/html/rfc7159">IETF 7159</a>）中定义了 JSON 支持的数据展示类型为 string、number、boolean、null 和这四个基础类型所组成的 object、array 结构</li>
<li>其他 JavaScript 类型在编解码时都会被静默消除或转换
<ul>
<li>比如 <code>undefined</code>、<code>function() {}</code></li>
</ul>
</li>
<li>使用 <a href="https://github.com/sidorares/json-bigint"><code>json-bigint</code></a>：可以像<code>JSON.parse</code>一样方便转换（json-bigint 是一个第三方包，可以很好的处理这个问题。</li>
<li>参考文章：
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1477816">JSON Bigint 大数精度丢失的背后</a></li>
<li><a href="https://juejin.cn/post/6844903604285865998">JavaScript的高精度计算与JSON.parse的BIGINT</a></li>
<li><a href="https://blog.csdn.net/jyn15159/article/details/108882851">json-bigint处理大数字问题</a></li>
<li><a href="https://note.youdao.com/">超大整型数字处理json-bigint的应用</a></li>
<li><a href="https://golb.hplar.ch/2019/01/js-bigint-json.html">JavaScript BigInt and JSON</a></li>
<li><a href="https://stackoverflow.com/questions/18755125/node-js-is-there-any-proper-way-to-parse-json-with-large-numbers-long-bigin">node.js - Is there any proper way to parse JSON with large numbers? (long, bigint, int64) stackoverflow</a></li>
</ul>
</li>
</ul>
<h5 id="json-和-js-对象的关系a-hrefcatalogue--a">JSON 和 JS 对象的关系<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<ul>
<li>JSON 是 JS 对象的字符串表示法，他使用文本表示一个 JS 对象的信息，本质是一个字符串</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 一个对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="s1">&#39;World&#39;</span><span class="p">}</span>
<span class="c1">// 一个 JSON 字符串，本质是一个字符串，遵循了 JSON 的语法规则
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="s1">&#39;{&#34;a&#34;: &#34;Hello&#34;, &#34;b&#34;: &#34;World&#34;}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="json-和-js-对象的互转a-hrefcatalogue--a">JSON 和 JS 对象的互转<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<blockquote>
<p>要实现从 JSON 字符串转换为 JS 对象，使用 <code>JSON.parse()</code> 方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"> <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;{&#34;a&#34;: &#34;Hello&#34;, &#34;b&#34;: &#34;World&#34;}&#39;</span><span class="p">)</span>
 <span class="c1">// {a: &#39;Hello&#39;, b: &#39;World&#39;}
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>要实现从 JS 对象串转换为 JSON 字符，使用 <code>JSON.stringify()</code> 方法</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"> <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">a</span><span class="o">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="s1">&#39;World&#39;</span><span class="p">})</span>
 <span class="c1">// &#39;{&#34;a&#34;: &#34;Hello&#34;, &#34;b&#34;: &#34;World&#34;}&#39;
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>演示 <code>JSON.parse()</code> 在 发送 Ajax 请求时的应用</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">)</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">result</span><span class="p">)</span> <span class="c1">// object
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>JSON.parse()</code>转换为结构化的对象从而在 JS 代码中方便处理数据</li>
<li><code>JSON.stringify()</code>转换为JSON字符串用来传输数据</li>
</ul>
<h5 id="json-的序列化和反序列化a-hrefcatalogue--a">JSON 的序列化和反序列化<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h5>
<blockquote>
<p>把 数据对象 转换为 字符串 的过程，叫序列化</p>
</blockquote>
<ul>
<li>调用 <code>JSON.stringify(JSONObject)</code> 方法的操作，叫 JSON 序列化</li>
</ul>
<blockquote>
<p>把 字符串 转换为 数据对象 的过程，叫反序列化</p>
</blockquote>
<ul>
<li>调用 <code>JSON.parse(JSONString)</code> 方法的操作，叫 JSON 反序列化</li>
</ul>
<hr>
<h3 id="15-封装-ajax-函数a-hrefcatalogue--a">1.5 封装 <code>Ajax</code> 函数<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>导入自己封装的 Ajax 函数</p>
</blockquote>
<ul>
<li>可以实现 调用自定义 myAjax 函数，发起 Ajax 请求</li>
<li>接受一个配置对象作为参数，配置对象中可以配置如下属性：
<ul>
<li>method: 请求类型</li>
<li>url: 请求地址</li>
<li>data: 请求参数对象</li>
<li>successCb: 请求成功后的回调函数</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">myAjax</span> <span class="nx">from</span> <span class="s1">&#39;myAjax.js&#39;</span>
<span class="nx">myAjax</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// 请求类型
</span><span class="c1"></span>  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="c1">// 请求地址
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">// 请求参数对象
</span><span class="c1"></span>  <span class="nx">successCb</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span> <span class="c1">// 请求成功后的回调函数
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>处理 data 参数</p>
</blockquote>
<ul>
<li>用户提交数据时，以对象形式提交参数</li>
<li>需要把 data 对象，转化成查询字符串的格式，提交给服务器</li>
<li>因此需提前定义 <code>resolveData</code> 函数如下：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="cm">/*
</span><span class="cm">* 处理 data 参数
</span><span class="cm">* @param {Record&lt;string, string&gt;} data需要发送到服务器的数据
</span><span class="cm">* @returns {string} 返回拼接好的查询字符串
</span><span class="cm">*/</span>
<span class="kd">function</span> <span class="nx">resolveData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">k</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">k</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>定义 <code>myAjax</code> 函数</p>
</blockquote>
<ul>
<li>需要创建 xhr 对象，并监听 <code>onreadystatechange</code> 事件</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">myAjax</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">data</span><span class="p">,</span> <span class="nx">successCb</span><span class="p">}</span> <span class="o">=</span> <span class="nx">options</span>
  <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="c1">// 拼接查询字符串
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">resolveData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="c1">// 监听请求状态改变事件
</span><span class="c1"></span>  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">res_JSONObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="cm">/* xhr.responseText JSONString*/</span><span class="p">)</span>
      <span class="nx">successCb</span><span class="p">(</span><span class="nx">res_JSONObj</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>判断请求类型</p>
</blockquote>
<ul>
<li>不同的请求类型，对应 xhr 对象的不同操作。因此需要对请求类型进行条件分支的判断</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="p">...</span>
<span class="kr">const</span> <span class="nx">reqMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;GET&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="sb">`</span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">?</span><span class="si">${</span><span class="nx">qs</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="s1">&#39;POST&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">qs</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="s1">&#39;PUT&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;DELETE&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;HEAD&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;OPTION&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
<span class="p">}</span>

<span class="nx">reqMap</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">]()</span>
<span class="p">...</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>完整的 myAjax 函数</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// node 环境 // import {XMLHttpRequest} from &#39;xmlhttprequest&#39;
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">resolveData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">k</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span> <span class="c1">// data[k] 注意 变量名属性
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">reqMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;GET&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="sb">`</span><span class="si">${</span><span class="nx">url</span><span class="si">}</span><span class="sb">?</span><span class="si">${</span><span class="nx">qs</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="s1">&#39;POST&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">qs</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="s1">&#39;PUT&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;DELETE&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;HEAD&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
  <span class="s1">&#39;OPTION&#39;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{},</span>
<span class="p">}</span>
  
<span class="kr">export</span> <span class="kd">function</span> <span class="nx">myAjax</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">successCb</span><span class="p">}</span> <span class="o">=</span> <span class="nx">options</span>
  <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="c1">// 拼接查询字符串
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">resolveData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  
  <span class="c1">// 监听请求状态改变事件
</span><span class="c1"></span>  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">res_JSONObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="cm">/* xhr.responseText JSONString*/</span><span class="p">)</span>
      <span class="nx">successCb</span><span class="p">(</span><span class="nx">res_JSONObj</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">reqMap</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">]()</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>发送请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">myAjax</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./myAjax.js&#39;</span>

<span class="nx">myAjax</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="nx">successCb</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">myAjax</span><span class="p">({</span>
  <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/addbook&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">bookname</span><span class="o">:</span> <span class="s1">&#39;红宝书&#39;</span><span class="p">,</span>
    <span class="nx">author</span><span class="o">:</span> <span class="s1">&#39;红宝书&#39;</span><span class="p">,</span>
    <span class="nx">publisher</span><span class="o">:</span> <span class="s1">&#39;红宝书&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">successCb</span><span class="o">:</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="16-如何使用xmlhttprequest-level2中提供的新特性a-hrefcatalogue--a">1.6 如何使用<code>XMLHttpRequest Level2</code>中提供的新特性<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><code>XMLHttpRequest Level1</code>的缺点</p>
</blockquote>
<ul>
<li>只支持文本数据的传送，无法用来读取和上传二进制文件。</li>
<li>传送和接收数据时，没有进度信息，只能提示有没有完成。</li>
<li>受到&quot;同域限制&quot;（Same Origin Policy），只能向同一域名的服务器请求数据</li>
</ul>
<blockquote>
<p><code>XMLHttpRequest Level2</code>的优点</p>
</blockquote>
<ul>
<li>可以设置 HTTP 请求的时限</li>
<li>可以使用 FormData 对象管理表单数据</li>
<li>可以上传文件</li>
<li>可以请求不同域名下的数据（跨域请求）</li>
<li>可以获取服务器端的二进制数据</li>
<li><code>XMLHttpRequest Level2</code> 可以获得数据传输的进度信息，能实现 <code>fetch API</code> 目前无法做到的事情，例如跟踪上传进度</li>
</ul>
<h4 id="161-使用xmlhttprequest-level2设置-http-请求的时限a-hrefcatalogue--a">1.6.1 使用<code>XMLHttpRequest Level2</code>设置 HTTP 请求的时限<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>有时， Ajax 操作很费时，而且无法预知要花多少时间。如果网速慢（模拟slow 3G）用户等待时间久</p>
</blockquote>
<ul>
<li><code>XMLHttpRequest Level2</code>的 <code>timeout</code> 属性实现可设置 HTTP 请求的时限</li>
<li>超过设置的时限，自动停止 HTTP 请求</li>
<li>监听 timeout 事件 <code>xhr.ontimeout</code>，用来指定时间超限时的回调函数</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1">// 类型为number 单位为毫秒
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">ontimeout</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;请求超时&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在 node 环境下的实现</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// yarn add -D xmlhttprequest-ts
</span><span class="c1"></span><span class="kr">import</span> <span class="p">{</span><span class="nx">XMLHttpRequest</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;xmlhttprequest-ts&#39;</span> <span class="c1">// XMLHttpRequest level2
</span><span class="c1"></span>
<span class="c1">// yarn add -D xhr2
</span><span class="c1">// import XMLHttpRequest from &#39;xhr2&#39; // XMLHttpRequest level2
</span><span class="c1"></span>
<span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

<span class="c1">// timeout
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">ontimeout</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;请求超时了&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/getbooks&#39;</span><span class="p">)</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;-&gt; xhr.responseText&#34;</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="162-使用xmlhttprequest-level2使用-formdata-对象管理表单数据a-hrefcatalogue--a">1.6.2 使用<code>XMLHttpRequest Level2</code>使用 FormData 对象管理表单数据<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>Ajax 操作往往用来提交表单数据，为了方便表单处理，HTML5增加了一个 <code>FormData</code> 内置对象，可以模拟表单操作</p>
</blockquote>
<ul>
<li>新建 <code>FormData</code> 对象实例 <code>fd</code></li>
<li>可多次调用<code>FormData</code>实例<code>fd</code>的 <code>.append(key: string, value: unknown)</code> 方法，为 <code>FormData</code> 添加表单项</li>
<li>创建 <code>xhr</code> 实例对象</li>
<li>调用 <code>xhr.open(method, url)</code> 指定请求类型与地址，<code>method</code>一般为<code>POST</code></li>
<li>监听 <code>onreadystatechange</code> 事件，指定回调函数</li>
<li>调用 <code>xhr.send(fd)</code>，将实例<code>fd</code>作为参数发送请求，直接提交</li>
<li>无需设置 <code>xhr.setHeader</code> 的数据类型，内部自动设置 <code>xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 新建 FormData 对象实例 fd
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
<span class="c1">// 可多次为 FormData 添加表单项
</span><span class="c1"></span><span class="nx">fd</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="s1">&#39;zz&#39;</span><span class="p">)</span>
<span class="nx">fd</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;upwd&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">)</span>
<span class="c1">// 创建 xhr 实例对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="c1">// 指定请求类型与地址
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/formdata&#39;</span><span class="p">)</span>
<span class="c1">// 直接提交 FormData 对象实例，将实例fd作为参数发送请求
</span><span class="c1">// 与提交网页表单的效果一样
</span><span class="c1"></span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span>  <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fd</span><span class="p">)</span>
<span class="c1">// 无需设置 xhr.setHeader 的数据类型
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>FormData</code> 对象也可以用来获取网页表单的值</p>
</blockquote>
<ul>
<li>获取网页中的 <code>&lt;form&gt;</code> 标签元素作为参数传入 <code>new FormData()</code> 实例对象中，发送请求</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 使用 Ajax 的形式提交表单
</span><span class="c1"></span>
<span class="c1">// 获取表单元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#form1&#39;</span><span class="p">)</span>
<span class="c1">// 监听表单元素的 submit 事件
</span><span class="c1"></span><span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span> <span class="c1">// 使用 Ajax 的形式提交表单避险阻止默认提交行为
</span><span class="c1"></span>  <span class="c1">// 根据 form 表单创建 FormData 对象，会自动将表单数据填充到 FormData 对象中，无需手动 调用 .append 方法
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span>
  <span class="c1">// 无需设置 `xhr.setHeader` 的数据类型
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/formdata&#39;</span><span class="p">)</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{}</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fd</span><span class="p">)</span>
<span class="p">})</span>

</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;form1&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;uname&#34;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;upwd&#34;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span><span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>设置输入框标签的<code>autocomplete=&quot;off&quot;</code>，关闭自动填充</li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData">FormData MDN</a></li>
</ul>
<blockquote>
<p>JS原生实现<code>FormData</code>获取表单数据</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html">...
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;form1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;uname&#34;</span> <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;upwd&#34;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c1">// 1. 通过 DOM 操作，获取到 form 表单元素
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#form1&#39;</span><span class="p">)</span>

    <span class="nx">form</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 阻止表单的默认提交行为
</span><span class="c1"></span>      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

      <span class="c1">// 创建 FormData，快速获取到 form 表单中的数据
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span>

      <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/formdata&#39;</span><span class="p">)</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fd</span><span class="p">)</span>

      <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
...
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>简单封装<code>FormData.vue</code> <a href="https://github.com/xmasuhai/vueel-demo">仓库地址</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;form1&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span>
                <span class="na">labelName</span><span class="o">=</span><span class="s">&#34;uname&#34;</span>
                <span class="na">titleName</span><span class="o">=</span><span class="s">&#34;注册名:&#34;</span>
                <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span>
                <span class="na">labelName</span><span class="o">=</span><span class="s">&#34;upwd&#34;</span>
                <span class="na">titleName</span><span class="o">=</span><span class="s">&#34;密码:&#34;</span>
                <span class="na">autocomplete</span><span class="o">=</span><span class="s">&#34;off&#34;</span><span class="p">/&gt;</span>
      <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;onSubmit&#34;</span><span class="p">&gt;</span>提交<span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
      {{ data }}
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">onMounted</span><span class="p">,</span> <span class="nx">ref</span><span class="p">,</span> <span class="nx">reactive</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueInput</span> <span class="nx">from</span> <span class="s1">&#39;@/components/input/VueInput.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;@/components/button/VueButton.vue&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;FormData&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">VueButton</span><span class="p">,</span> <span class="nx">VueInput</span><span class="p">},</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">setup</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">resData</span> <span class="o">=</span> <span class="nx">ref</span><span class="o">&lt;</span><span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;&gt;</span><span class="p">({});</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ref</span><span class="o">&lt;</span><span class="nx">Record</span><span class="o">&lt;</span><span class="nx">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;&gt;</span><span class="p">({});</span>
    <span class="kd">let</span> <span class="nx">form</span><span class="o">:</span> <span class="nx">HTMLFormElement</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">form1</span> <span class="nx">as</span> <span class="nx">HTMLFormElement</span><span class="p">;</span>
    <span class="c1">// 根据 form 表单创建 FormData 对象，会自动将表单数据填充到 FormData 对象中
</span><span class="c1"></span>    <span class="c1">// 无需手动 调用 .append 方法
</span><span class="c1"></span>    <span class="kd">let</span> <span class="nx">formData</span><span class="o">:</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="nx">reactive</span><span class="p">(</span><span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">));</span>

    <span class="kr">const</span> <span class="nx">onSubmit</span> <span class="o">=</span> <span class="p">(</span><span class="cm">/*, e: Event*/</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// e.preventDefault(); // 使用 Ajax 的形式提交表单 避险阻止默认提交行为
</span><span class="c1"></span>      <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>

      <span class="c1">// 无需设置 `xhr.setHeader` 的数据类型
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/formdata&#39;</span><span class="p">);</span>

      <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">resData</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
          <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">value</span> <span class="nx">as</span> <span class="nx">unknown</span><span class="p">)</span> <span class="o">=</span> <span class="nx">resData</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>

    <span class="p">};</span>

    <span class="nx">onMounted</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">form</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">form1</span> <span class="nx">as</span> <span class="nx">HTMLFormElement</span><span class="p">;</span>
      <span class="c1">// 根据 form 表单创建 FormData 对象，会自动将表单数据填充到 FormData 对象中
</span><span class="c1"></span>      <span class="c1">// 无需手动 调用 .append 方法
</span><span class="c1"></span>      <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">resData</span><span class="p">,</span>
      <span class="nx">onSubmit</span><span class="p">,</span>
      <span class="nx">formData</span><span class="p">,</span>
      <span class="nx">form</span><span class="p">,</span>
      <span class="nx">data</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="163-使用xmlhttprequest-level2上传文件a-hrefcatalogue--a">1.6.3 使用<code>XMLHttpRequest Level2</code>上传文件<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>上传图片API
<ul>
<li>接口：<code>http://www.liulongbin.top:3006/api/upload/avatar</code></li>
<li>请求类型：<code>POST</code></li>
<li>请求参数：<code>{'avatar': fileObj}</code></li>
<li>返回值</li>
</ul>
</li>
</ul>
<blockquote>
<p>实现步骤</p>
</blockquote>
<ol>
<li>定义UI结构</li>
<li>验证是否选择了文件</li>
<li>向 <code>FormData</code> 中追加文件</li>
<li>使用 xhr 发起上传文件的请求</li>
<li>监听 <code>onreadystatechange</code> 事件</li>
</ol>
<blockquote>
<ol>
<li>定义UI结构</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- 1. 文件选择框 --&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;file1&#34;</span><span class="p">/&gt;</span>
<span class="c">&lt;!-- 2. 上传按钮 --&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;btnUpload&#34;</span><span class="p">&gt;</span>上传文件<span class="p">&lt;</span><span class="nt">button</span><span class="p">/&gt;</span>
<span class="c">&lt;!-- 3. 向服务器发起请求图片，并显示--&gt;</span>
<span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;img&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;800&#34;</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<ol start="2">
<li>验证是否选择了文件</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js">
<span class="c1">// 1. 获取上传文件按钮
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">btnUpload</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#btnUpload&#39;</span><span class="p">)</span>

<span class="c1">// 2. 为按钮添加点击事件监听
</span><span class="c1"></span><span class="nx">btnUpload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="c1">// 3. 获取选择的文件列表
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#file1&#39;</span><span class="p">).</span><span class="nx">files</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;请选择要上传的文件！&#39;</span><span class="p">)}</span>
<span class="c1">// 上传后续的业务逻辑
</span><span class="c1"></span><span class="p">})</span>

</code></pre></td></tr></table>
</div>
</div><ol>
<li>获取上传文件按钮</li>
<li>为按钮添加点击事件监听</li>
<li>获取选择的文件列表 使用<code>&lt;input type=&quot;file&quot;/&gt;</code>元素的API <code>.files</code></li>
</ol>
<blockquote>
<ol start="3">
<li>向 <code>FormData</code> 中追加文件</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 1. 创建 FormData 对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
<span class="c1">// 2. 向 FormData 中追加文件
</span><span class="c1"></span><span class="nx">fd</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建 FormData 对象</li>
<li>向 FormData 中追加文件 <code>files[0]</code></li>
</ol>
<blockquote>
<ol start="4">
<li>使用 xhr 发起上传文件的请求</li>
</ol>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 1. 创建 xhr 对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="c1">// 2. 调用 open 函数，指定请求类型与 URL 地址，上传文件的请求类型必须为 POST
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.lilongbin.top:3006/api/upload.avtar&#39;</span><span class="p">)</span>
<span class="c1">// 3. 监听 `onreadystatechange` 事件
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span>
      <span class="o">?</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#img&#39;</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="sb">`http://www.lilongbin.top:3006</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span>
      <span class="o">:</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 4. 发起请求
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fd</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建 xhr 对象</li>
<li>调用 open 函数，指定请求类型与 URL 地址，上传文件的请求类型必须为 POST</li>
<li>监听 <code>onreadystatechange</code> 事件</li>
<li>发起请求</li>
</ol>
<blockquote>
<p>封装 <code>Upload.vue</code> 组件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueInput</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;file1&#34;</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">VueButton</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;btnUpload&#34;</span>
               <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;uploadFile&#34;</span><span class="p">&gt;</span>上传图片
    <span class="p">&lt;/</span><span class="nt">VueButton</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;img&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;800&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;ts&#34;</span><span class="p">&gt;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;@/components/button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueInput</span> <span class="nx">from</span> <span class="s1">&#39;@/components/input/VueInput.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">defineComponent</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Vue</span><span class="p">,</span> <span class="p">{</span><span class="nx">VNode</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Upload&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">VueInput</span><span class="p">,</span> <span class="nx">VueButton</span><span class="p">},</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">setup</span><span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">uploadFile</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">file1</span> <span class="nx">as</span> <span class="nx">Vue</span><span class="p">).</span><span class="nx">$el</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">files</span> <span class="o">&amp;&amp;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;请选择要上传的文件&#39;</span><span class="p">);}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">uploadFile</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="164-使用xmlhttprequest-level2获得数据传输的进度信息a-hrefcatalogue--a">1.6.4 使用<code>XMLHttpRequest Level2</code>获得数据传输的进度信息<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>在 <code>XMLHttpRequest 2.0</code>对象中，可以通过监听 <code>xhr.upload.onprogress</code> 事件，来获取到文件上传的进度</p>
</blockquote>
<ul>
<li>监听 xhr.upload 的 onprogress 事件，设置回调函数</li>
<li>事件形参 <code>e</code></li>
<li><code>e.lengthComputable</code> 当前上传的资源是否具有可计算的长度</li>
<li><code>e.loaded</code> 文件已传输的字节</li>
<li><code>e.total</code> 需传输文件的总字节</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 创建 xhr 对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="c1">// 监听 xhr.upload 的 onprogress 事件
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// e.lengthComputable 是一个布尔值，表示当前上传的资源是否具有可计算的长度
</span><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// e.loaded 已传输的字节
</span><span class="c1"></span>    <span class="c1">// e.total 需传输的总字节
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>可以设置浏览器Network面板中slow 3G 查看上传过程</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">-&gt; percentComplete <span class="m">39</span>
-&gt; percentComplete <span class="m">78</span>
-&gt; percentComplete <span class="m">100</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>动态设置进度条</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">VueInput</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;file&#34;</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&#34;file1&#34;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">VueButton</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&#34;btnUpload&#34;</span>
               <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&#34;uploadFile&#34;</span><span class="o">&gt;</span><span class="nx">上传图片</span>
    <span class="o">&lt;</span><span class="err">/VueButton&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;file&#34;</span><span class="o">&gt;</span><span class="nx">文件上传进度</span><span class="o">:</span>
        <span class="o">&lt;</span><span class="nx">progress</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;file&#34;</span> <span class="nx">max</span><span class="o">=</span><span class="s2">&#34;100&#34;</span> <span class="o">:</span><span class="nx">value</span><span class="o">=</span><span class="s2">&#34;`${percentComplete}`&#34;</span>
                  <span class="nx">style</span><span class="o">=</span><span class="s2">&#34;vertical-align: text-bottom;width: 30%;margin: 0 10px;&#34;</span><span class="o">&gt;&lt;</span><span class="err">/progress&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">progressTips</span> <span class="p">}}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
      <span class="o">&lt;</span><span class="err">/label&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="nx">alt</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">&#34;img&#34;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&#34;800&#34;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/template&gt;</span>

<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&#34;ts&#34;</span><span class="o">&gt;</span>
<span class="kr">import</span> <span class="nx">VueButton</span> <span class="nx">from</span> <span class="s1">&#39;@/components/button/VueButton.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">VueInput</span> <span class="nx">from</span> <span class="s1">&#39;@/components/input/VueInput.vue&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">computed</span><span class="p">,</span> <span class="nx">defineComponent</span><span class="p">,</span> <span class="nx">inject</span><span class="p">,</span> <span class="nx">ref</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/composition-api&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineComponent</span><span class="p">({</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Upload&#39;</span><span class="p">,</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span><span class="nx">VueInput</span><span class="p">,</span> <span class="nx">VueButton</span><span class="p">},</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">props</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 动态进度条数值
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">ref</span><span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="c1">// 进度条提示文字
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">progressTips</span> <span class="o">=</span> <span class="nx">computed</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">percentComplete</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="mi">100</span>
        <span class="o">?</span> <span class="s1">&#39;上传完成&#39;</span>
        <span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">percentComplete</span><span class="p">.</span><span class="nx">value</span><span class="si">}</span><span class="sb">%`</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="kr">const</span> <span class="nx">toast</span> <span class="o">=</span> <span class="nx">inject</span><span class="o">&lt;</span><span class="nb">Function</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">&#39;toast&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">uploadFile</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 获取用户选择的文件列表
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">fileList</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">file1</span> <span class="nx">as</span> <span class="nx">Vue</span><span class="p">).</span><span class="nx">$el</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">fileList</span> <span class="o">&amp;&amp;</span> <span class="nx">fileList</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">toast</span> <span class="o">&amp;&amp;</span> <span class="nx">toast</span><span class="p">(</span><span class="s1">&#39;请选择要上传的文件！&#39;</span><span class="p">);}</span>
      <span class="kr">const</span> <span class="nx">fd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
      <span class="c1">// 将用户选择的文件添加到 FormData 中
</span><span class="c1"></span>      <span class="nx">fileList</span> <span class="o">&amp;&amp;</span> <span class="nx">fd</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">,</span> <span class="nx">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

      <span class="c1">// 创建 xhr 对象
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

      <span class="c1">// 监听文件上传的进度
</span><span class="c1"></span>      <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// 计算出上传的进度 动态设置进度条
</span><span class="c1"></span>          <span class="nx">percentComplete</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="c1">// 调用 open 函数，指定请求类型与 URL 地址，上传文件的请求类型必须为 POST
</span><span class="c1"></span>      <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;http://www.liulongbin.top:3006/api/upload/avatar&#39;</span><span class="p">);</span>

      <span class="c1">// 监听 `onreadystatechange` 事件
</span><span class="c1"></span>      <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
          <span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span>
            <span class="o">?</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">refs</span><span class="p">.</span><span class="nx">img</span> <span class="nx">as</span> <span class="nx">HTMLImageElement</span><span class="p">).</span><span class="nx">src</span> <span class="o">=</span> <span class="sb">`http://www.liulongbin.top:3006</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span>
            <span class="o">:</span> <span class="nx">toast</span> <span class="o">&amp;&amp;</span> <span class="nx">toast</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="c1">// 发起请求
</span><span class="c1"></span>      <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fd</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">uploadFile</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="p">,</span>
      <span class="nx">progressTips</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="165-使用xmlhttprequest-level2请求不同域名下的数据跨域请求a-hrefcatalogue--a">1.6.5 使用<code>XMLHttpRequest Level2</code>请求不同域名下的数据（跨域请求）<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>设置严格检查<code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;upgrade-insecure-requests&quot;&gt;</code></p>
</blockquote>
<hr>
<blockquote>
<p>参考</p>
</blockquote>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XMLHttpRequest MDN</a></li>
<li><a href="https://zh.javascript.info/xmlhttprequest">XMLHttpRequest 现代 JavaScript 教程</a></li>
<li><a href="https://ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html"><code>XMLHttpRequest Level 2</code>使用指南 阮一峰 2012</a></li>
<li><a href="https://www.html5rocks.com/en/tutorials/file/xhr2/"><code>New Tricks in XMLHttpRequest2 2011</code></a></li>
</ul>
<hr>
<h3 id="17-复习使用axios发起-ajax-请求a-hrefcatalogue--a">1.7 复习使用<code>axios</code>发起 <code>Ajax</code> 请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h3 id="18-实现文件上传与loading效果-a-hrefcatalogue--a">1.8 实现文件上传与<code>loading</code>效果 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<hr>
<h2 id="2-ajax应用-a-hrefcatalogue--a">2 AJAX应用 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<h3 id="21-ajax加载cssa-idajax加载css-hrefajax加载css--aa-hrefcatalogue--a">2.1 AJAX加载CSS<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>以前使用<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot;&gt;</code>引入</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh-Hans&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge,chrome=1&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/style.css&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>AJAX demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>AJAX demo<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>这里<code>--&lt;link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot;&gt;</code>中的<code>/style.css&quot;</code>是路由<code>path</code>的请求路径</li>
</ul>
<blockquote>
<p><code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// ...
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/index.html&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/index.html&#39;</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">}</span>
<span class="c1">// ...
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>style.css</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-CSS" data-lang="CSS"><span class="nt">body</span> <span class="p">{</span>
  <span class="k">color</span><span class="p">:</span> <span class="kc">red</span><span class="p">;</span>
  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用-ajax-加载-css-的四个步骤a-hrefcatalogue--a">使用 <code>AJAX</code> 加载 <code>CSS</code> 的四个步骤<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>在 <code>server.js</code>里写路由</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// ...
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/index.html&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/index.html&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/main.js&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/javascript;charset=utf-8&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/main.js&#39;</span><span class="p">))</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/style.css&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/css;charset=utf-8&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/style.css&#39;</span><span class="p">))</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">// ...
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>区别路由<code>path</code>的请求路径和<code>fs.readFileSync('src/xxx')</code>的查找文件目录路径</li>
</ul>
<blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTMl" data-lang="HTMl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh-Hans&#34;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge,chrome=1&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span>
    <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover&#34;</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- &lt;link rel=&#34;stylesheet&#34; href=&#34;/style.css&#34;&gt; --&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>AJAX demo 2<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>AJAX demo CSS<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getCSS&#34;</span><span class="p">&gt;</span>请求CSS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/main.js&#34;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>index.html</code>里写的所有路径（<code>/style.css</code>和<code>/main.js</code>），必须和路由的<code>path</code>路径一致，才能生效</li>
<li>创建一个 button 测试</li>
</ul>
<blockquote>
<p>在 <code>main.js</code> 里写</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">getCSS</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/style.css&#39;</span><span class="p">);</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// console.log(&#39;成功了&#39;)
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;request.response&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
    <span class="c1">// 之后将响应的内容，用对应的标签包裹，插入html页面相应位置
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;失败了&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建 <code>HttpRequest</code> 对象 （全称是 <code>XMLHttpRequest</code>）</li>
<li>调用对象的 <code>open</code> 方法</li>
<li>监听对象的 <code>onload</code> 和 <code>onerror</code> 事件</li>
<li>调用对象的 <code>send</code> 方法（发送请求）</li>
<li>获取资源用<code>request.open('GET', '/xxx');</code>，只用两个参数，mdn 中后面的参数不用<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/open">XMLHttpRequest.open() MDN</a></li>
</ol>
<blockquote>
<p>而<code>request.response</code>就是响应得到的文件内容</p>
</blockquote>
<ul>
<li>要使这段内容生效，就在外包裹一层对应的标签</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 将响应的内容，用对应的标签包裹，插入html页面相应位置
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span> <span class="c1">// 创建 style 标签
</span><span class="c1"></span><span class="nx">style</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span> <span class="c1">// 填写 style 内容
</span><span class="c1"></span><span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="c1">// 插入head标签里
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>触发<code>onerror</code>事件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">request</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;失败了&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>server.js</code>路径写错：你输入的路径不存在对应的内容</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1"></span><span class="k">else</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`你输入的路径不存在对应的内容`</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>只会渲染路径错误时的路由，并不触发<code>onerror</code> 事件</li>
<li><code>onerror</code>对AJAX的支持不好</li>
</ul>
<blockquote>
<p>在第3步中，AJAX一般改用 <code>onreadystatechange</code> 事件，不用<code>onload</code>和<code>onerror</code></p>
</blockquote>
<ul>
<li>用对象的<code>status</code>属性，即状态码来判断，响应是否成功</li>
<li>注意<code>onreadystatechange</code>全小写</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">getCSS</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/style.css&#39;</span><span class="p">);</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 监听对象的 readyState属性
</span><span class="c1"></span>    <span class="c1">// console.log(request.readyState) // 2 3 4
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// console.log(&#39;下载完成&#39;)
</span><span class="c1"></span>      <span class="c1">// 下载完成，但不知道下载成功还是失败
</span><span class="c1"></span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 将响应的内容，用对应的标签包裹，插入html页面相应位置
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">)</span> <span class="c1">// 创建 style 标签
</span><span class="c1"></span>        <span class="nx">style</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span> <span class="c1">// 填写 style 内容
</span><span class="c1"></span>        <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">)</span> <span class="c1">// 插入head标签里
</span><span class="c1"></span>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;加载CSS失败&#39;</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在事件处理函数里操作 CSS 文件内容</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/onreadystatechange">XMLHttpRequest.onreadystatechange MDN</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState">XMLHttpRequest.readyState</a>相关状态，4 表示下载完成</li>
</ul>
<h3 id="22-ajax加载jsa-idajax加载js-hrefajax加载js--aa-hrefcatalogue--a">2.2 AJAX加载JS<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>以前使用<code>&lt;script src=&quot;main.js&quot;&gt;&lt;/script&gt;</code>引入</p>
</blockquote>
<h4 id="使用-ajax-加载-js-的四个步骤-a-hrefcatalogue--a">使用 <code>AJAX</code> 加载 <code>JS</code> 的四个步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p><code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// ...
</span><span class="c1"></span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/getJS.js&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/javascript;charset=utf-8&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/getJS.js&#39;</span><span class="p">))</span> <span class="c1">// 在目录中创建一个测试的getJS.js
</span><span class="c1"></span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getCSS&#34;</span><span class="p">&gt;</span>请求CSS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getJS&#34;</span><span class="p">&gt;</span>请求JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建 <code>HttpRequest</code> 对象 （全称是 <code>XMLHttpRequest</code>）</li>
<li>调用 <code>open</code> 方法</li>
<li>监听对象的 <code>onreadystatechange</code> 事件</li>
<li>调用对象的 <code>send</code> 方法（发送请求）</li>
</ol>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1">// AJAX 加载 JS
</span><span class="c1"></span><span class="nx">getJS</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/getJS.js&#39;</span><span class="p">)</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 创建script标签
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)</span>
            <span class="c1">// 填写 script内容
</span><span class="c1"></span>            <span class="nx">script</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span>
            <span class="c1">// 插到body里
</span><span class="c1"></span>            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在事件处理函数里操作 JS 文件内容</li>
<li>将响应的内容，用对应的标签包裹，插入html页面相应位置</li>
<li>AJAX下载并执行响应的内容</li>
</ul>
<h3 id="23-ajax加载htmla-idajax加载html-hrefajax加载html--aa-hrefcatalogue--a">2.3 AJAX加载HTML<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p>以前没有加载过 HTML</p>
</blockquote>
<ul>
<li>在目录<code>src/</code>下创建测试用<code>indexOld.html</code>，不写全，只写个标签</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>AJAX demo 2<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;background-color: bisque;border: 1px solid orange;width:300px;height:300px;&#34;</span><span class="p">&gt;</span>动态内容<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>配置路由<code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1"></span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/indexOld.html&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">)</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/indexOld.html&#39;</span><span class="p">))</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>index.html</code> 加测试按钮</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getCSS&#34;</span><span class="p">&gt;</span>请求CSS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getJS&#34;</span><span class="p">&gt;</span>请求JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getHTML&#34;</span><span class="p">&gt;</span>请求HTML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用-ajax-加载-html-的四个步骤a-hrefcatalogue--a">使用 <code>AJAX</code> 加载 <code>HTML</code> 的四个步骤<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ol>
<li>创建 <code>HttpRequest</code> 对象</li>
<li>调用对象的 <code>open</code> 方法</li>
<li>监听对象的 <code>onreadystatechange</code> 事件</li>
<li>调用对象的 <code>send</code> 方法</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1">// AJAX 加载 HTML
</span><span class="c1"></span><span class="nx">getHTML</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/indexOld.html&#39;</span><span class="p">)</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">onreadyStatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 创建 div 标签
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
            <span class="c1">// 填写 div 内容
</span><span class="c1"></span>            <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">response</span>
            <span class="c1">// 插到body里
</span><span class="c1"></span>            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在事件处理函数里操作 <code>HTML</code> 文件内容</li>
<li>动态展示<code>index.html</code></li>
<li>控制台 <code>Network</code> 查看请求 点<code>Preview</code> 预览请求的页面</li>
<li>点 <code>Response</code> 看源代码</li>
<li>把页面拆成不同的部分，在用户点击时，请求这个部分</li>
<li>可以请求一小块 HTML，而 <code>iframe</code> 是请求整个网页，更加臃肿</li>
<li><code>AJAX</code> 可以做到轻量级的请求，任意 HTTP 支持的文件类型</li>
</ul>
<hr>
<h3 id="24-ajax加载xmla-idajax加载xml-hrefajax加载xml--a-a-hrefcatalogue--a">2.4 AJAX加载XML<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h4 id="使用-ajax-加载-xml-的四个步骤-a-hrefcatalogue--a">使用 <code>AJAX</code> 加载 <code>XML</code> 的四个步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p><code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1"></span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/getXML.xml&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/xml;charset=utf-8&#39;</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/getXML.xml&#39;</span><span class="p">))</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
  <span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getCSS&#34;</span><span class="p">&gt;</span>请求CSS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getJS&#34;</span><span class="p">&gt;</span>请求JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getHTML&#34;</span><span class="p">&gt;</span>请求HTML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getXML&#34;</span><span class="p">&gt;</span>请求XML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>getXML.xml</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-XML" data-lang="XML"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;message&gt;</span>
    <span class="nt">&lt;warning&gt;</span>
         Hello World
    <span class="nt">&lt;/warning&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>创建 <code>HttpRequest</code> 对象（全称是 <code>XMLHttpRequest</code>）</li>
<li>调用对象的 <code>open</code> 方法</li>
<li>监听对象的 <code>onreadystatechange</code> 事件</li>
<li>调用对象的 <code>send</code> 方法（发送请求）</li>
</ol>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// AJAX 加载 XML
</span><span class="c1"></span><span class="nx">getXML</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/getXML.xml&#39;</span><span class="p">)</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// console.log(request.responseXML)
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">dom</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseXML</span>
      <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">dom</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;warning&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">textContent</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在事件处理函数里操作 <code>responseXML</code></li>
<li><code>request.responseXML</code>是 DOM 对象</li>
</ul>
<h3 id="25-ajax应用小结a-idajax小结-hrefajax小结--aa-hrefcatalogue--a">2.5 AJAX应用小结<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h4 id="http-可以请求的类型-a-hrefcatalogue--a">HTTP 可以请求的类型 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>可以请求 <code>HTML</code> <code>CSS</code> <code>JS</code> &hellip;</li>
<li>设置正确的 <code>Content-Type</code></li>
<li>响应的内容，用对应的标签包裹，插入html页面相应位置</li>
<li>知道怎么解析，就可以使用</li>
</ul>
<h4 id="解析方法a-hrefcatalogue--a">解析方法<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>得到 CSS 后生成 <code>style</code></li>
<li>得到 JS 后生成 <code>script</code></li>
<li>得到 HTML 使用 <code>innerHTML</code> 和 <code>DOM API</code></li>
<li>得到 XML 后使用 <code>responseXML</code> 和 <code>DOM API</code></li>
<li>不同类型的数据有不同的解析办法</li>
</ul>
<hr>
<h3 id="26-回顾复习jsona-idjson-hrefjson--aa-hrefcatalogue--a">2.6 回顾复习JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation</p>
</blockquote>
<ul>
<li>JSON 是 轻量级的数据交换格式语言</li>
<li>和HTML CSS JS一样是门独立的语言</li>
<li>和HTML XML Markdown 是 标记语言，用来展示数据</li>
<li><a href="http://json.org/json-zh.html">中文官网</a></li>
<li>一页纸</li>
<li>铁轨图</li>
</ul>
<h4 id="支持的类型a-hrefcatalogue--a">支持的类型<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li><code>string</code> 只支持双引号，不支持单引号、反引号和无引号</li>
<li><code>number</code> 支持科学技术法</li>
<li><code>bool</code> <code>true</code> 和 <code>false</code></li>
<li><code>null</code> 没有 <code>undefined</code></li>
<li><code>object</code></li>
<li><code>array</code></li>
</ul>
<blockquote>
<p>区别于 JS 的类型</p>
</blockquote>
<ul>
<li>不支持函数与变量（即不支持引用）</li>
</ul>
<blockquote>
<p>和JS语法的区别：</p>
</blockquote>
<ul>
<li>JSON 的字符串必须用双引号。</li>
<li>JSON 无法表示 undefined，只能表示 &ldquo;undefined&rdquo;</li>
<li>JSON 无法表示函数</li>
<li>JSON 的对象语法不能有引用</li>
</ul>
<h3 id="27-ajax加载jsona-idajax加载json-hrefajax加载json--aa-hrefcatalogue--a">2.7 AJAX加载JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<blockquote>
<p><code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/getJSON.json&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/json;charset=utf-8&#39;</span><span class="p">)</span> <span class="c1">// &#39;application/json;charset=utf-8&#39;也可
</span><span class="c1"></span>    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/getJSON.json&#39;</span><span class="p">))</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>getJSON.json</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="p">{</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;frank&#34;</span><span class="p">,</span>
  <span class="nt">&#34;gender&#34;</span><span class="p">:</span> <span class="s2">&#34;male&#34;</span><span class="p">,</span>
  <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="nt">&#34;xxx&#34;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getCSS&#34;</span><span class="p">&gt;</span>请求CSS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getJS&#34;</span><span class="p">&gt;</span>请求JS<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getHTML&#34;</span><span class="p">&gt;</span>请求HTML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getXML&#34;</span><span class="p">&gt;</span>请求XML<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;getJSON&#34;</span><span class="p">&gt;</span>请求JSON<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Hello <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;myName&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用-ajax-加载-json-的四个步骤-a-hrefcatalogue--a">使用 <code>AJAX</code> 加载 <code>JSON</code> 的四个步骤 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ol>
<li>创建 <code>HttpRequest</code> 对象（全称是 <code>XMLHttpRequest</code> ）</li>
<li>调用对象的 <code>open</code> 方法</li>
<li>监听对象的 <code>onreadystatechange</code> 事件</li>
<li>调用对象的 <code>send</code> 方法（发送请求）</li>
</ol>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// AJAX 加载 JSON
</span><span class="c1"></span><span class="nx">getJSON</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/getJSON.json&#39;</span><span class="p">)</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
      <span class="nx">myName</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">object</span><span class="p">.</span><span class="nx">name</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在事件函数里使用 <code>JSON.parse</code></li>
<li><code>JSON.parse</code> 把符合 JSON 语法的字符串变成对应的对象或者是<strong>其他东西</strong></li>
</ul>
<h3 id="28-js内置对象-windowjsona-idwindowjson-hrefwindowjson--aa-hrefcatalogue--a">2.8 JS内置对象 window.JSON<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h4 id="jsonparsestringa-hrefcatalogue--a"><code>JSON.parse('string')</code><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>解析字符串</li>
<li>将符合 <code>JSON</code> 语法的字符串转换成 <code>JS</code> 对应类型的数据</li>
<li>返回值 Object 类型, 对应给定 JSON 文本的对象/值</li>
<li><code>JSON</code>字符串 -&gt; JS 数据</li>
<li>转换成的不一定是对象，可以是 JSON 值类型的其他类型（ typeof ）</li>
<li>由于 JSON 只有六种类型，所以转成的数据也只有6种</li>
<li>如果不符合 <code>JSON</code> 语法，则直接抛出一个 <code>Error</code>对象</li>
<li>一般用 <code>try...catch</code>捕获错误</li>
<li>异常 若传入的字符串不符合 JSON 规范，则会抛出 SyntaxError 异常</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">object</span>
<span class="k">try</span><span class="p">{</span>
    <span class="nx">object</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="sb">`{&#39;name&#39;:&#39;frank&#39;}`</span><span class="p">)</span>
<span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error!&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="nx">object</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="o">:</span><span class="s2">&#34;no name&#34;</span><span class="p">}</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="s1">&#39;{&#34;result&#34;:true, &#34;count&#34;:42}&#39;</span>
<span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">count</span><span class="p">)</span>
<span class="c1">// expected output: 42
</span><span class="c1"></span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span>
<span class="c1">// expected output: true
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="p">);</span>              <span class="c1">// {}
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">);</span>            <span class="c1">// true
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;&#34;foo&#34;&#39;</span><span class="p">);</span>           <span class="c1">// &#34;foo&#34;
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;[1, 5, &#34;false&#34;]&#39;</span><span class="p">);</span> <span class="c1">// [1, 5, &#34;false&#34;]
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">);</span>            <span class="c1">// null
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">()</span> <span class="nx">不允许用逗号作为结尾</span>
<span class="c1">// both will throw a SyntaxError
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&#34;[1, 2, 3, 4, ]&#34;</span><span class="p">);</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;{&#34;foo&#34; : 1, }&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse() MDN</a></li>
</ul>
<h4 id="jsonstringifyvalue-序列化-a-hrefcatalogue--a"><code>JSON.stringify(value)</code> 序列化 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>是 <code>JSON.parse()</code>的逆运算</li>
<li>JS 数据 -&gt; <code>JSON</code>字符串</li>
<li>即序列化成 一个 JSON 字符串的值</li>
<li>将值转换为相应的JSON格式</li>
<li>由于 JS 的数据类型比 JSON 多，所以不一定成功</li>
<li>如果失败，则直接抛出一个 <code>Error</code>对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;hi&#34;</span><span class="o">:</span> <span class="s2">&#34;Ho&#34;</span><span class="p">,</span> <span class="s2">&#34;fn&#34;</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{}}</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="c1">// 不报错 直接忽略不合法的类型
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({});</span>                        <span class="c1">// &#34;{}&#34;
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>                      <span class="c1">// &#34;true&#34;
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">);</span>                     <span class="c1">// &#34;&#34;foo&#34;&#34;
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;false&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">]);</span>       <span class="c1">// &#34;[1,&#34;false&#34;,false]&#34;
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">x</span><span class="o">:</span> <span class="mi">5</span> <span class="p">});</span>                  <span class="c1">// &#34;{&#34;x&#34;:5}&#34;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="mi">6</span><span class="p">});</span>              
<span class="c1">// &#34;{&#34;x&#34;:5,&#34;y&#34;:6}&#34;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="s2">&#34;false&#34;</span><span class="p">),</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">)]);</span> 
<span class="c1">// &#39;[1,&#34;false&#34;,false]&#39;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">y</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">z</span><span class="o">:</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)});</span> 
<span class="c1">// &#39;{}&#39;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="kc">undefined</span><span class="p">,</span> <span class="nb">Object</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)]);</span>          
<span class="c1">// &#39;[null,null,null]&#39; 
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({[</span><span class="nx">Symbol</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">)]</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">});</span>                 
<span class="c1">// &#39;{}&#39;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({[</span><span class="nx">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">)]</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">},</span> <span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">)]);</span>
<span class="c1">// &#39;{}&#39;
</span><span class="c1"></span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span>
    <span class="p">{[</span><span class="nx">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">)]</span><span class="o">:</span> <span class="s2">&#34;foo&#34;</span><span class="p">},</span> 
    <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">k</span> <span class="o">===</span> <span class="s2">&#34;symbol&#34;</span><span class="p">){</span>
            <span class="k">return</span> <span class="s2">&#34;a symbol&#34;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">);</span>


<span class="c1">// undefined 
</span><span class="c1"></span>
<span class="c1">// 不可枚举的属性默认会被忽略：
</span><span class="c1"></span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span> 
    <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
        <span class="kc">null</span><span class="p">,</span> 
        <span class="p">{</span> 
            <span class="nx">x</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span> <span class="p">},</span> 
            <span class="nx">y</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}</span> 
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">);</span>

<span class="c1">// &#34;{&#34;y&#34;:&#34;y&#34;}&#34;
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify() MDN</a></li>
</ul>
<h3 id="29-ajax综合应用加载分页a-idajax综合应用-hrefajax综合应用--aa-hrefcatalogue--a">2.9 AJAX综合应用：加载分页<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h3>
<h4 id="291-加载列表a-hrefcatalogue--a">2.9.1 加载列表<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>用户打开页面，开到第一页数据</li>
<li>用户点击下一页，看到第二页数据</li>
<li>用户点击下一页，看到第三页数据</li>
<li>用户点击下一页，提示没有更多了</li>
</ul>
<blockquote>
<p><code>/db/page1.json page2.json page3.json</code></p>
</blockquote>
<ul>
<li>前后端不分离的渲染</li>
</ul>
<blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
  <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Hello <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;myName&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    {{page1}}
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>server.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/index.html&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;src/index.html&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">()</span> <span class="c1">// 调用toString()前 是buffer
</span><span class="c1"></span>
    <span class="c1">// AJAX分页
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">page1</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;db/page1.json&#39;</span><span class="p">)</span>
    <span class="c1">// li
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">page1</span><span class="p">)</span> <span class="c1">// [{ &#34;id&#34;: 1 }, { &#34;id&#34;: 2 }, { &#34;id&#34;: 3 }, { &#34;id&#34;: 4 }, { &#34;id&#34;: 5 }, { &#34;id&#34;: 6 }, { &#34;id&#34;: 7 }, { &#34;id&#34;: 8 }, { &#34;id&#34;: 9 }, { &#34;id&#34;: 10 }]
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="sb">`&lt;li&gt;</span><span class="si">${</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">&lt;/li&gt;`</span>
    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{page1}}&#39;</span><span class="p">,</span> <span class="sb">`&lt;ul&gt;</span><span class="si">${</span><span class="nx">result</span><span class="si">}</span><span class="sb">&lt;/ul&gt;`</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>从数据库中拿出，拼接字符串</li>
</ul>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">pageCount</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">// AJAX 加载 分页
</span><span class="c1"></span><span class="nx">getPage</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="sb">`/page</span><span class="si">${</span><span class="nx">pageCount</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
      <span class="nx">array</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span>
        <span class="nx">xxx</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span>
      <span class="p">});</span>

      <span class="c1">// console.log(request.response)
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
      <span class="c1">// console.log(object)
</span><span class="c1"></span>      <span class="nx">myName</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">object</span><span class="p">.</span><span class="nx">name</span>

      <span class="nx">pageCount</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="292-优化点-a-hrefcatalogue--a">2.9.2 优化点 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li>在点击第三页的时候就禁用下一页按钮</li>
</ul>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">//...
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="kd">let</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="nx">page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">// AJAX 加载 分页
</span><span class="c1"></span><span class="nx">getPage</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">currentPage</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="sb">`/page</span><span class="si">${</span><span class="nx">currentPage</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
        <span class="nx">array</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
          <span class="nx">li</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span>
          <span class="nx">xxx</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">)</span>
        <span class="p">});</span>
        <span class="c1">// console.log(request.response)
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
        <span class="c1">// console.log(object)
</span><span class="c1"></span>        <span class="nx">myName</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">object</span><span class="p">.</span><span class="nx">name</span>
        <span class="nx">currentPage</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// console.log(&#34;Ban&#34;)
</span><span class="c1"></span>    <span class="nx">getPage</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//...
</span></code></pre></td></tr></table>
</div>
</div><h4 id="293-请求天气数据-a-hrefcatalogue--a">2.9.3 请求天气数据 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// mock 接口 GET 方法 查询参数直接跟url在后面
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://rap2api.taobao.org/mock/244238/weather?city=北京&#39;</span>
<span class="kd">let</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// xhr.DONE === 4
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">){</span>
        
        <span class="c1">// 将xhr.responseText的JSON格式转换为对象
</span><span class="c1"></span>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
            
        <span class="c1">// xhr.responseType = &#39;json&#39; // 兼容性注意
</span><span class="c1"></span>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;服务器异常&#39;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span> <span class="c1">// 兼容性注意
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;服务器异常&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="294-发送post请求a-hrefcatalogue--a">2.9.4 发送POST请求<!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>应用场景：涉及到登录、注册、用户填写信息（调查问卷）需提交，而不是查询的场合时，要用POST请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://rap2api.taobao.org/app/mock/24238/login&#39;</span>
<span class="kd">let</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>

<span class="c1">// 设置xhr请求超时时间
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span>

<span class="c1">// 设置请求头 告诉服务器请求参数的编码方式
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;Content-type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">)</span> <span class="c1">// post 方法 用xhr.send()接受发送的数据，区别于get方法中写在url里
</span><span class="c1"></span>
<span class="c1">// 封装 url
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">makeUrl</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">){</span>
        <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">testUser</span> <span class="o">=</span> <span class="nx">makeUrl</span><span class="p">({</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;123456&#39;</span>
<span class="p">})</span>

<span class="c1">// xhr.send(&#39;username=John&amp;password=123456&#39;)
</span><span class="c1">// 将参数变成 `key1=value1&amp;key2=value2` 的形式，传给xhr.send()
</span><span class="c1"></span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">testUser</span><span class="p">)</span>

<span class="c1">// 如果要上传文件（图片）
</span><span class="c1">// xhr.setRequestHeader(&#39;Content-type&#39;, &#39;multipart/form-data&#39;) 
</span><span class="c1">//
</span><span class="c1"></span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span> <span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;响应异常&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">ontimeout</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;请求超时&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;服务器异常&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="293-注册登录发送post请求-a-hrefcatalogue--a">2.9.3 注册登录发送POST请求 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<blockquote>
<p>默认的<code>Content-type</code>，是<code>multipart/form-data</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
<span class="c1">// 添加参数
</span><span class="c1"></span><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;jzm&#39;</span><span class="p">)</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;132456&#39;</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://rap2api.taobao.org/app/mock/244238/register&#39;</span>

<span class="kd">let</span> <span class="nx">xhr</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>

<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span><span class="mi">200</span> <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;接口异常&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="294-post-a-hrefcatalogue--a">2.9.4 POST <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;用户名&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;密码&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>
    
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;msg&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">string</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">string</span><span class="p">)}</span>
<span class="kr">const</span> <span class="nx">$submit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[type = submit]&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#form&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$msg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#msg&#39;</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://rap2api.taobao.org.app/mock/244238/register&#39;</span>
<span class="nx">$form</span><span class="p">.</span><span class="nx">onsubmit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
    
    <span class="c1">// 校验开始
</span><span class="c1"></span>    <span class="kd">let</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">$form</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span>  <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">304</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span>
          <span class="nx">$msg</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">msg</span> <span class="o">||</span> <span class="nx">data</span><span class="p">.</span><span class="nx">errMsg</span> 
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$msg</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="s1">&#39;接口异常&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="3-手写ajaxa-id手写ajax-href手写ajax--aa-hrefcatalogue--a">3. 手写AJAX<!-- raw HTML omitted --> § <!-- raw HTML omitted --><!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>使用原生 JS 写出一个 AJAX 请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">myButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;/xxx&#39;</span><span class="p">)</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">readystate</span> <span class="o">===</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span>
            <span class="kr">const</span> <span class="nx">stringObj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>后台的 <code>server.js</code> ，处理请求</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="k">if</span><span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">&#39;/xxx&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span><span class="s1">&#39;text/json;charset=utf-8&#39;</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`{&#34;status&#34;:&#34;ok&#34;}`</span><span class="p">)</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="4-ajax-的简陋封装a-idajax的简陋封装-hrefajax的简陋封装--a-a-hrefcatalogue--a">4. <code>ajax</code> 的简陋封装<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">cityParams</span><span class="p">,</span> <span class="nx">onsuccess</span><span class="p">,</span> <span class="nx">onerror</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">cityParams</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">arr</span> <span class="p">=&gt;</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span> <span class="o">||</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span><span class="mi">304</span><span class="p">){</span>
            <span class="nx">onsuccess</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">onerror</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">onerror</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">request</span><span class="p">(</span><span class="s1">&#39;http://rap2api.taobao.org/app/mock/244238/weather&#39;</span><span class="p">,{</span><span class="nx">city</span><span class="o">:</span><span class="s1">&#39;内蒙古&#39;</span><span class="p">},</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;请求成功&#39;</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="p">},</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;接口异常&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="5-fetch代替js原生ajax-a-idfetch-hreffetch--a-a-hrefcatalogue--a">5. <code>fetch</code>代替JS原生AJAX <!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>AJAX的API设计并不是很好，输入、输出、状态都在同一个接口管理，容易写出非常混乱的代码。</p>
</blockquote>
<ul>
<li>Fetch API 是一种ES6规范，用来取代XMLHttpRequest对象</li>
<li>两个特点，一是接口合理化，Ajax 将所有不同性质的接口都放在 XHR 对象上，而 Fetch 将它们分散在几个不同的对象上，设计更合理；</li>
<li>二是 Fetch 操作返回Promise对象，避免了嵌套的回调函数。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://api.jirengu.com/getWeather.php?city=北京&#39;</span>

<span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">()})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">weather_data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">weather</span>
    <span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>POST</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;http://api.jirengu.com/getWeather.php?city=北京&#39;</span>
<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;jirengu&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;13456&#39;</span><span class="p">}</span>

<span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,{</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">arr</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">),</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span>
    <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">()})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Success:&#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">)})</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API MDN</a></li>
</ul>
<hr>
<h2 id="使用githubpagesmock数据a-idgithubpagesmock-hrefgithubpagesmock--a-a-hrefcatalogue--a">使用<code>githubpagesmock</code>数据<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p><a href="http://book.jirengu.com/fe/%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80/Javascript/%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8.html">搭建服务器</a></p>
</blockquote>
<p>同步开发，约定格式，模拟数据，前后端联调</p>
<hr>
<h2 id="使用easymock来mock数据a-ideasymock-hrefeasymock--a-a-hrefcatalogue--a">使用<code>easymock</code>来<code>mock</code>数据<!-- raw HTML omitted --> § <!-- raw HTML omitted --> <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># curl http://....</span>
</code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="轮询与长轮询comet聊天室-a-hrefcatalogue--a">轮询与长轮询Comet聊天室 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h2>
<blockquote>
<p>双工通信：每隔固定时间发一次请求</p>
</blockquote>
<ul>
<li>AJAX轮询： <a href="https://github.com/jirengu/chat-xhr-poll">简陋的聊天室</a></li>
<li>长轮询（减少请求数量）<a href="https://github.com/jirengu/chat-comet">凑合聊天室</a></li>
<li><a href="https://github.com/jirengu/chat-websocket">WebSocket 聊天室</a></li>
</ul>
<blockquote>
<p>客户端</p>
</blockquote>
<ul>
<li>发请求，等待响应（pending）</li>
<li>当响应时，再次发一个请求</li>
</ul>
<blockquote>
<p>服务器端</p>
</blockquote>
<ul>
<li>请求到来，如果没新数据，则不发响应</li>
<li>当有新数据，需要通知客户端，再响应</li>
</ul>
<hr>
<ul>
<li><a href="https://static.xiedaimala.com/xdml/file/3ac7c224-c23d-491f-84b5-4fabfbeab9b8/2019-10-29-11-33-33.pdf">AJAX.pdf</a></li>
<li><a href="https://static.xiedaimala.com/xdml/file/f40ceb64-df08-4420-9226-7f76dbff15d5/2020-2-17-22-53-31.pdf">XMLHttpRequest与fetch.pdf</a></li>
<li><a href="https://github.com/FrankFang/ajax-1/blob/master/server.js">server.js 所有代码</a></li>
<li><a href="https://github.com/FrankFang/nodejs-test-cors">nodejs-test By Fang</a></li>
<li><a href="http://xmasuhai.xyz/post/http/http%E9%9D%9E%E5%85%A8%E8%A7%A3%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94-node.js-server/">【HTTP非全解】请求和响应 &amp; Node.Js Server</a></li>
<li><a href="https://juejin.im/post/5ec258535188256d800a5d85?from=groupmessage">「每日一题」JSON 是什么？</a></li>
</ul>
<hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<hr>
<h4 id="参考文章-a-hrefcatalogue--a">参考文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">XMLHttpRequest MDN</a></li>
<li><a href="https://wangdoc.com/javascript/bom/xmlhttprequest.html">XMLHttpRequest 对象 Wangdoc</a></li>
<li><a href="https://wangdoc.com/webapi/fetch.html">Fetch API 教程 Wangdoc</a></li>
<li><a href="https://zh.javascript.info/xmlhttprequest">网络请求 XMLHttpRequest 现代 JavaScript 教程</a></li>
</ul>
<h4 id="相关文章-a-hrefcatalogue--a">相关文章 <!-- raw HTML omitted --> ⇧ <!-- raw HTML omitted --></h4>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/28206325">【译】为什么我不再使用Fetch API开发应用 郭琛</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24329240">使用更优雅的异步请求API——fetch</a></li>
</ul>
<hr>
<ul>
<li>作者： Joel</li>
<li>文章链接：</li>
<li><a href="http://xmasuhai.xyz/posts/%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E%E9%93%BE%E6%8E%A5/">版权声明</a></li>
<li>非自由转载-非商用-非衍生-保持署名</li>
<li><!-- raw HTML omitted -->河<!-- raw HTML omitted -->
<!-- raw HTML omitted -->掘<!-- raw HTML omitted -->
<!-- raw HTML omitted -->思<!-- raw HTML omitted -->
<!-- raw HTML omitted -->知<!-- raw HTML omitted -->
<!-- raw HTML omitted -->简<!-- raw HTML omitted --></li>
</ul>
<hr>
<hr>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-01-26
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/frontend/">FrontEnd</a>
          <a href="http://xmasuhai.xyz/tags/ajax/">AJAX</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/js/js%E9%9D%9E%E5%85%A8%E8%A7%A309%E6%80%BB%E7%BB%93/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">【JS非全解09】总结</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/project/%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%AB%AF%E9%AB%98%E6%95%88%E5%AF%BC%E8%88%AAbinggo%E5%AF%BC%E8%88%AA/">
            <span class="next-text nav-default">实现前端高效导航——BingGo导航</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
