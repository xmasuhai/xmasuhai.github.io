<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>MVC 理论与实践 - Joel in The House</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Joel Xu" />
  <meta name="description" content="预览连接：http://xmasuhai.xyz/mvc/dist/index.html 代码链接：https://github.com/xm" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.59.1" />


<link rel="canonical" href="http://xmasuhai.xyz/post/mvc/mvc-%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.af20b78e95c84de86b00a0242a4a77bd2601700e1b250edf27537d957ac0041d.css" integrity="sha256-ryC3jpXITehrAKAkKkp3vSYBcA4bJQ7fJ1N9lXrABB0=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="MVC 理论与实践" />
<meta property="og:description" content="预览连接：http://xmasuhai.xyz/mvc/dist/index.html 代码链接：https://github.com/xm" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://xmasuhai.xyz/post/mvc/mvc-%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5/" />
<meta property="article:published_time" content="2020-07-19T18:51:47+08:00" />
<meta property="article:modified_time" content="2022-09-03T10:26:25+08:00" />
<meta itemprop="name" content="MVC 理论与实践">
<meta itemprop="description" content="预览连接：http://xmasuhai.xyz/mvc/dist/index.html 代码链接：https://github.com/xm">


<meta itemprop="datePublished" content="2020-07-19T18:51:47&#43;08:00" />
<meta itemprop="dateModified" content="2022-09-03T10:26:25&#43;08:00" />
<meta itemprop="wordCount" content="20899">



<meta itemprop="keywords" content="MVC,vue,Table-Driven,EventBus,JavaScript," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MVC 理论与实践"/>
<meta name="twitter:description" content="预览连接：http://xmasuhai.xyz/mvc/dist/index.html 代码链接：https://github.com/xm"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Joel in The House</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Joel in The House
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/post/">文档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/categories/">目录</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://xmasuhai.xyz/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">MVC 理论与实践</h1>
      
      <div class="post-meta">
        <time datetime="2020-07-19" class="post-time">
          2020-07-19
        </time>
        <div class="post-category">
            <a href="http://xmasuhai.xyz/categories/%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5/"> 理论与实践 </a>
            
          </div>
        <span class="more-meta"> 约 20899 字 </span>
          <span class="more-meta"> 预计阅读 42 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#目录-a-id-catalogue-href-catalogue-a-a-href-catalogue-a">目录<a id="catalogue" href="#catalogue" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#1-浅析-mvc-a-id-浅析mvc-href-浅析mvc-a-a-href-catalogue-a">1. 浅析 MVC <a id="浅析MVC" href="#浅析MVC"> § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#1-1-mvc是什么-a-id-mvc是什么-href-mvc是什么-a-a-href-catalogue-a">1.1 MVC是什么  <a id="MVC是什么" href="#MVC是什么">§ </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#代码级别的重复">代码级别的重复</a></li>
<li><a href="#页面级别">页面级别</a></li>
</ul></li>
<li><a href="#1-2-表驱动编程-a-id-表驱动编程-href-表驱动编程-a-a-href-catalogue-a">1.2. 表驱动编程 <a id="表驱动编程" href="#表驱动编程"> § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#1-3-eventbus-api-a-id-eventbus-href-eventbus-a-a-href-catalogue-a">1.3. EventBus API<a id="EventBus" href="#EventBus"> § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#1-4-理解模块化-a-id-理解模块化-href-理解模块化-a-a-href-catalogue-a">1.4. 理解模块化 <a id="理解模块化" href="#理解模块化"> § </a><a href="#catalogue"> ⇧ </a></a></li>
</ul></li>
<li><a href="#2-四个需求描述-a-id-四个需求描述-href-四个需求描述-a">2.四个需求描述<a id="四个需求描述" href="#四个需求描述"> § </a></a></li>
<li><a href="#3-模块化文件导入-css-jquery-a-id-模块化文件导入-href-模块化文件导入-a-a-href-catalogue-a">3.模块化文件导入（CSS jQuery）<a id="模块化文件导入" href="#模块化文件导入" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#修改-package-json">修改 <code>package.json</code></a></li>
<li><a href="#发布">发布</a></li>
<li><a href="#开发">开发</a></li>
<li><a href="#4-实现模块-a-id-实现模块-href-实现模块-a">4.实现模块<a id="实现模块" href="#实现模块"> § </a></a>
<ul>
<li><a href="#实现前两个模块">实现前两个模块</a></li>
<li><a href="#添加数据保存功能">添加数据保存功能</a></li>
<li><a href="#简化导入代码-import">简化导入代码 import</a></li>
<li><a href="#实现后两个模块">实现后两个模块</a></li>
<li><a href="#添加app2-app3数据保存功能">添加app2 app3数据保存功能</a></li>
</ul></li>
<li><a href="#5-抽象思维1-最小知识原则-js单一模块化-a-id-js单一模块化-href-js单一模块化-a-a-href-catalogue-a">5.抽象思维1 最小知识原则 js单一模块化 <a id="js单一模块化" href="#js单一模块化" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#小结">小结</a></li>
<li><a href="#6-抽象思维2-以不变应万变-封装成mvc三个对象-a-id-封装成mvc-href-封装成mvc-a-a-href-catalogue-a">6.抽象思维2 以不变应万变 封装成mvc三个对象 <a id="封装成mvc" href="#封装成mvc" > § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#debugger">debugger</a></li>
<li><a href="#模块传参-导出变量">模块传参，导出变量</a></li>
<li><a href="#事件委托">事件委托</a></li>
</ul></li>
<li><a href="#7-抽象思维3-用数据去渲染-a-id-用数据去渲染-href-用数据去渲染-a-a-href-catalogue-a">7.抽象思维3 用数据去渲染 <a id="用数据去渲染" href="#用数据去渲染" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#8-抽象思维4-表驱动编程-自动绑定事件-a-id-自动绑定事件-href-自动绑定事件-a-a-href-catalogue-a">8.抽象思维4 表驱动编程-自动绑定事件 <a id="自动绑定事件" href="#自动绑定事件" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#9-抽象思维5-俯瞰全局-对象间通信-a-id-对象间通信-href-对象间通信-a-a-href-catalogue-a">9.抽象思维5 俯瞰全局 对象间通信 <a id="对象间通信" href="#对象间通信" > § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#实现eventbus对象间通信">实现eventBus对象间通信</a></li>
<li><a href="#小结2">小结2</a></li>
</ul></li>
<li><a href="#10-第二个模块的使用mvc-a-id-第二个模块的使用mvc-href-第二个模块的使用mvc-a-a-href-catalogue-a">10.第二个模块的使用MVC <a id="第二个模块的使用MVC" href="#第二个模块的使用MVC" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#11-抽象思维6-事不过三-使用类优化代码-继承-a-id-类优化代码继承-href-类优化代码继承-a-a-href-catalogue-a">11.抽象思维6 事不过三 使用类优化代码 继承 <a id="类优化代码继承" href="#类优化代码继承" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#12-合并vc-a-id-合并vc-href-合并vc-a-a-href-catalogue-a">12.合并vc <a id="合并vc" href="#合并vc" > § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#再次使用类-改-app2-js">再次使用类 改 <code>app2.js</code></a></li>
</ul></li>
<li><a href="#13-让-m-和-v-继承-eventbus-a-id-继承eventbus-href-继承eventbus-a-a-href-catalogue-a">13.让 M 和 V 继承 eventBus <a id="继承EventBus" href="#继承EventBus" > § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#模块解耦">模块解耦</a></li>
<li><a href="#m-v继承-eventbus">M V继承 <code>EventBus</code></a></li>
</ul></li>
<li><a href="#14-mvc-过渡到-vue-a-id-过渡到vue-href-过渡到vue-a-a-href-catalogue-a">14.MVC 过渡到 vue <a id="过渡到vue" href="#过渡到vue" > § </a><a href="#catalogue"> ⇧ </a></a></li>
<li><a href="#15-总结-a-id-总结-href-总结-a-a-href-catalogue-a">15.总结 <a id="总结" href="#总结" > § </a><a href="#catalogue"> ⇧ </a></a>
<ul>
<li><a href="#参考文章">参考文章</a></li>
<li><a href="#相关文章">相关文章</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<ul>
<li>预览连接：<a href="http://xmasuhai.xyz/mvc/dist/index.html">http://xmasuhai.xyz/mvc/dist/index.html</a></li>
<li>代码链接：<a href="https://github.com/xmasuhai/mvc">https://github.com/xmasuhai/mvc</a></li>
</ul>

<hr />

<h2 id="目录-a-id-catalogue-href-catalogue-a-a-href-catalogue-a">目录<a id="catalogue" href="#catalogue" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li><a id="_$1_" href="#浅析MVC">1. 浅析 MVC § </a>

<ul>
<li><a id="_$1.1_" href="#MVC是什么">1.1. MVC是什么 § </a></li>
<li><a id="_$1.2_" href="#表驱动编程">1.2. 表驱动编程 § </a></li>
<li><a id="_$1.3_" href="#EventBus">1.3. EventBus § </a></li>
<li><a id="_$1.4_" href="#理解模块化">1.4. 理解模块化 § </a></li>
</ul></li>
<li><a id="_$2_" href="#模块化文件导入">2. 模块化文件导入（CSS jQuery） § </a></li>
<li><a id="_$3_" href="#四个需求描述">3. 四个需求描述 § </a></li>
<li><a id="_$4_" href="#实现模块">4. 实现模块 § </a></li>
<li><a id="_$5_" href="#js单一模块化">5. 抽象思维1：最小知识原则 js单一模块化 § </a></li>
<li><a id="_$6_" href="#封装成mvc">6. 抽象思维2: 以不变应万变 封装成mvc § </a></li>
<li><a id="_$7_" href="#用数据去渲染">7. 抽象思维3 用数据去渲染 <code>view = render(data)</code> § </a></li>
<li><a id="_$8_" href="#自动绑定事件">8. 抽象思维4 表驱动编程 自动绑定事件 § </a></li>
<li><a id="_$9_" href="#对象间通信">9. 抽象思维5 俯瞰全局 对象间通信 <code>EventBus</code> § </a></li>
<li><a id="_$a_" href="#第二个模块的使用MVC">10. 第二个模块的使用MVC § </a></li>
<li><a id="_$b_" href="#类优化代码继承">11. 抽象思维6 事不过三  类优化代码继承 § </a></li>
<li><a id="_$c_" href="#合并vc">12. 合并vc § </a></li>
<li><a id="_$d_" href="#继承EventBus">13. M V 继承EventBus § </a></li>
<li><a id="_$e_" href="#过渡到vue">14. 过渡到 vue § </a></li>
<li><a id="_$f_" href="#总结">15. 总结 § </a></li>
</ul>

<hr />

<h2 id="1-浅析-mvc-a-id-浅析mvc-href-浅析mvc-a-a-href-catalogue-a">1. 浅析 MVC <a id="浅析MVC" href="#浅析MVC"> § </a><a href="#catalogue"> ⇧ </a></h2>

<h3 id="1-1-mvc是什么-a-id-mvc是什么-href-mvc是什么-a-a-href-catalogue-a">1.1 MVC是什么  <a id="MVC是什么" href="#MVC是什么">§ </a><a href="#catalogue"> ⇧ </a></h3>

<ul>
<li>设计模式</li>
<li><strong>DRY原则</strong>：<code>Don't Repeat Yourself</code></li>
<li><a href="https://efe.baidu.com/blog/mvc-deformation/">前端MVC变形记</a></li>
</ul>

<blockquote>
<p>什么是重复</p>
</blockquote>

<h4 id="代码级别的重复">代码级别的重复</h4>

<ul>
<li>三行代码写了两遍</li>
<li>就需要重构</li>
<li>函数封装</li>
<li>组件封装</li>
<li>库封装</li>
<li>造轮子</li>
</ul>

<h4 id="页面级别">页面级别</h4>

<ul>
<li>类似的页面做了10遍</li>
<li>需要一个万金油写法</li>
</ul>

<blockquote>
<p>MVC就是万金油</p>
</blockquote>

<ul>
<li>所有页面都可以使用MVC优化代码结构</li>
<li>避免意大利面条式代码</li>
</ul>

<blockquote>
<p>MVC 的定义并不明确 MVC三个对象 分别做什么</p>
</blockquote>

<ul>
<li>每个模块都可以写成三个对象，分别是M、V、C</li>
<li>M - Model（数据模型）负责操作所有<strong>数据相关</strong>的任务</li>
<li>V - View（视图）负责所有UI（用户）界面</li>
<li>C -Controller（控制器）负责监听用户事件，然后调用 M 和 V 更新数据和视图</li>

<li><p>给出伪代码示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span><span class="nx">data</span><span class="p">}</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span><span class="nx">el</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">render</span><span class="p">}</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span><span class="nx">init</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>MVC 乱弹</p>
</blockquote>

<ul>
<li>react MV* 单向绑定 函数式Hooks</li>
<li>vue3 函数式 TS 单文件模板</li>
<li>Angular2 JS Dart TS</li>
</ul>

<h3 id="1-2-表驱动编程-a-id-表驱动编程-href-表驱动编程-a-a-href-catalogue-a">1.2. 表驱动编程 <a id="表驱动编程" href="#表驱动编程"> § </a><a href="#catalogue"> ⇧ </a></h3>

<blockquote>
<p>表指的是<code>hash</code>表 hashTable</p>
</blockquote>

<ul>
<li>提高代码可读性 易维护</li>
<li>减少重复代码</li>
<li>可扩展性</li>
<li>可重用性</li>
<li>主干清晰</li>
<li>恒定复杂度</li>
<li>隔离变化</li>
<li>机制和策略的分离</li>
</ul>

<blockquote>
<p>相对于程序逻辑，处理数据更易懂</p>
</blockquote>

<ul>
<li>将设计的复杂度从程序代码转移至数据</li>
</ul>

<blockquote>
<p>参考</p>
</blockquote>

<ul>
<li><a href="https://www.jianshu.com/p/868b97794224">JAVA表驱动编程总结</a></li>
<li><a href="https://www.cnblogs.com/youxin/p/3202034.html">C#表驱动法编程（数据驱动）</a></li>
<li><a href="https://www.cnblogs.com/cnlian/p/6064888.html">Table-Driven Design 表驱动设计 大三上</a></li>
<li><a href="https://www.cnblogs.com/angeldevil/p/3759486.html">表驱动法 -《代码大全》读书笔记</a></li>
<li><a href="https://www.eet-china.com/mp/a21543.html">空间换时间，查表法的经典例子</a></li>
<li><a href="https://blog.csdn.net/xuanwolanxue/article/details/72232283">c印记（十三）：表驱动编程——优美的逻辑优化者</a></li>
<li><a href="https://juejin.im/post/5dcbed6af265da309e6f19de">JS表驱动法（更优雅的写if-else、switch-case）</a></li>
<li><a href="https://www.techopedia.com/definition/30408/table-driven-design">Table-Driven Design</a></li>
<li><a href="https://www.codeproject.com/Articles/42732/Table-driven-Approach">Table-driven Approach</a></li>
<li><a href="https://mooreniemi.github.io/js/programming/2016/11/28/table-driven-methods.html">table driven methods</a></li>
<li><a href="https://www.codetips.co.uk/table-driven-tests/">Table Driven Tests</a></li>
<li><a href="https://github.com/golang/go/wiki/TableDrivenTests">TableDrivenTests GitHub</a></li>
<li><a href="https://www.oreilly.com/library/view/code-complete-second/0735619670/ch18.html">Chapter 18. Table-Driven Methods in Code Complete, Second Edition by</a></li>
</ul>

<h3 id="1-3-eventbus-api-a-id-eventbus-href-eventbus-a-a-href-catalogue-a">1.3. EventBus API<a id="EventBus" href="#EventBus"> § </a><a href="#catalogue"> ⇧ </a></h3>

<blockquote>
<p>给出伪代码示例</p>
</blockquote>

<h3 id="1-4-理解模块化-a-id-理解模块化-href-理解模块化-a-a-href-catalogue-a">1.4. 理解模块化 <a id="理解模块化" href="#理解模块化"> § </a><a href="#catalogue"> ⇧ </a></h3>

<hr />

<h2 id="2-四个需求描述-a-id-四个需求描述-href-四个需求描述-a">2.四个需求描述<a id="四个需求描述" href="#四个需求描述"> § </a></h2>

<ul>
<li>验证展示MVC</li>
<li>模块</li>
<li>类</li>
<li>四个需求：1. 加减乘除 2. Tab切换 3. 动画 4. 变色</li>
</ul>

<hr />

<h2 id="3-模块化文件导入-css-jquery-a-id-模块化文件导入-href-模块化文件导入-a-a-href-catalogue-a">3.模块化文件导入（CSS jQuery）<a id="模块化文件导入" href="#模块化文件导入" > § </a><a href="#catalogue"> ⇧ </a></h2>

<blockquote>
<p>模块化 脚本化加载CSS</p>
</blockquote>

<ul>
<li>在项目目录下打开终端</li>
</ul>

<blockquote>
<p>yarn初始化项目</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">yarn init -y</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>npm/yarn install</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">yarn add jquery@3.5.1
<span class="c1"># yarn add jquery</span>
<span class="c1"># npm i jquery</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意包的名字都是小写，大写会导致安装错误或版本错误</li>
<li>用<code>npm info &lt;name&gt; versions</code>命令可以查看包的所有历史版本号</li>
</ul>

<h2 id="修改-package-json">修改 <code>package.json</code></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JSON" data-lang="JSON"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JSON" data-lang="JSON"><span class="p">{</span>
  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;sass&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.26.9&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;rm -rf dist &amp;&amp; parcel build src/index.html --no-minify --public-url ./&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="发布">发布</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">yarn build src/index.html</code></pre></td></tr></table>
</div>
</div>
<h2 id="开发">开发</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">parcel src/index.html</code></pre></td></tr></table>
</div>
</div>
<hr />

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="c1">// console.log($)
</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="4-实现模块-a-id-实现模块-href-实现模块-a">4.实现模块<a id="实现模块" href="#实现模块"> § </a></h2>

<h3 id="实现前两个模块">实现前两个模块</h3>

<ul>
<li>面条代码</li>
</ul>

<blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;page&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app1&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app1&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;output&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;number&#34;</span><span class="p">&gt;</span>100<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;actions&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;add1&#34;</span><span class="p">&gt;</span>+1<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;minus1&#34;</span><span class="p">&gt;</span>-1<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mul2&#34;</span><span class="p">&gt;</span>×2<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;divide2&#34;</span><span class="p">&gt;</span>÷2<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app2&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app2&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tab-bar&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">span</span><span class="p">&gt;</span>111111<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">span</span><span class="p">&gt;</span>222222<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">ol</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tab-content&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>内容1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>内容2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">ol</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app3&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app3&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app4&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app4&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;./main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="添加数据保存功能">添加数据保存功能</h3>

<blockquote>
<p>当用户刷新时保存数据</p>
</blockquote>

<ul>
<li><p>获取<code>localStorage.getItem</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">);</span>
<span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span> <span class="o">||</span> <span class="mi">100</span><span class="p">)</span>

<span class="cm">/* 设置 */</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$button1</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$button2</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#minus1&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$button3</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mul2&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$button4</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divide2&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$number</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#number&#39;</span><span class="p">)</span>
<span class="c1">// 初始化数据
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">);</span>
<span class="c1">// 将数据渲染到页面
</span><span class="c1"></span><span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span> <span class="o">||</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1">// 绑定鼠标事件
</span><span class="c1"></span><span class="nx">$button1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
  <span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">$button2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
  <span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">$button3</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
  <span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">$button4</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
  <span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="nx">$recovery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app1.scss</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="nv">$whitesmoke</span><span class="o">:</span> <span class="mh">#f5f5f5</span><span class="p">;</span>
<span class="nv">$gold</span><span class="o">:</span> <span class="mh">#ffd700</span><span class="p">;</span>
<span class="nv">$orange</span><span class="o">:</span> <span class="mh">#ff4500</span><span class="p">;</span>

<span class="nc">.app1</span> <span class="p">{</span>
  <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">whitesmoke</span><span class="p">;</span>

  <span class="nc">.output</span> <span class="p">{</span>
    <span class="nt">font-size</span><span class="nd">:</span> <span class="nt">20px</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.actions</span> <span class="p">{</span>
    <span class="nt">font-size</span><span class="nd">:</span> <span class="nt">20px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意宽度为<code>17px</code>（14~19px）左右的<code>scroll bar</code></li>
<li>使用事件委托（jQuery）：<code>$.on('click', () =&gt; {})</code></li>
<li>禁止使用逻辑与样式耦合的jQuery代码： <code>$.css({//...})</code> <code>$.show()</code> <code>$.hide()</code></li>
<li>使用添加/去除 样式的API：<code>addClass('active')</code> <code>removeClass('active')</code></li>
<li>基于 <strong>样式和行为分离的</strong> 思想：JS只管功能不管具体样式，而CSS只管具体样式不管功能</li>
</ul>

<blockquote>
<p><code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="c1">// console.log($)
</span><span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$tabBar</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.app2 .tab-bar&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$tabContent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.app2 .tab-content&#39;</span><span class="p">)</span>
<span class="c1">// 绑定鼠标事件
</span><span class="c1"></span><span class="nx">$tabBar</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// console.log(e.target) // 点击时可能获取到目标元素的子元素 改成用 e.currentTarget
</span><span class="c1"></span>  <span class="c1">// console.log(e.currentTarget) // DOM 元素难用 换成用jQuery元素 封装$li
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">$li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">$li</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>
  <span class="c1">// console.log(index)
</span><span class="c1"></span>
  <span class="cm">/*
</span><span class="cm">    // 逻辑与样式耦合的代码1
</span><span class="cm">    $tabContent.children()
</span><span class="cm">      .eq(index).css({ display: &#39;block&#39; })
</span><span class="cm">      .siblings().css({
</span><span class="cm">        display: &#39;none&#39;
</span><span class="cm">      })
</span><span class="cm">
</span><span class="cm">    // 逻辑与样式耦合的代码2
</span><span class="cm">    $tabContent.children()
</span><span class="cm">      .eq(index).show()
</span><span class="cm">      .siblings().hide()
</span><span class="cm">   */</span>

  <span class="c1">// 行为与样式分离1 // 背景色切换
</span><span class="c1"></span>  <span class="nx">$li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">siblings</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>

  <span class="c1">// 行为与样式分离2 // 内容的显示与隐藏
</span><span class="c1"></span>  <span class="nx">$tabContent</span>
    <span class="p">.</span><span class="nx">children</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">siblings</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>

<span class="p">})</span>

<span class="c1">// 帮你点击 代替在HTML标签中设置样式属性 &#39;selected&#39; &#39;active&#39;
</span><span class="c1"></span><span class="nx">$tabBar</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app2.scss</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="nv">$temp-color</span><span class="o">:</span> <span class="mh">#8a2be2</span><span class="p">;</span>
<span class="nv">$shit-yellow</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">253</span><span class="o">,</span> <span class="mi">231</span><span class="o">,</span> <span class="mi">85</span><span class="p">);</span>
<span class="nv">$dirty-snow</span><span class="o">:</span> <span class="mh">#f4f4f4</span><span class="p">;</span>

<span class="nc">.app2</span> <span class="p">{</span>

  <span class="nt">height</span><span class="nd">:</span> <span class="nt">50vh</span><span class="p">;</span>
  <span class="nt">width</span><span class="nd">:</span> <span class="nt">50vw</span><span class="p">;</span>

  <span class="nc">.tab-bar</span> <span class="p">{</span>
    <span class="nt">display</span><span class="nd">:</span> <span class="nt">flex</span><span class="p">;</span>

    <span class="nt">li</span> <span class="p">{</span>
      <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="err">$</span><span class="nt">temp-color</span><span class="p">;</span>
      <span class="nt">width</span><span class="nd">:</span> <span class="nt">50</span><span class="err">%</span><span class="p">;</span>

      <span class="k">&amp;</span><span class="nc">.selected</span> <span class="p">{</span>
        <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">shit-yellow</span><span class="p">;</span>
        <span class="nt">color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">dirty-snow</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nc">.tab-content</span> <span class="p">{</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="nt">display</span><span class="nd">:</span> <span class="nt">none</span><span class="p">;</span>

      <span class="k">&amp;</span><span class="nc">.active</span> <span class="p">{</span>
        <span class="nt">display</span><span class="nd">:</span> <span class="nt">block</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">&amp;</span><span class="nc">.visibility</span> <span class="p">{</span>
        <span class="nt">visibility</span><span class="nd">:</span> <span class="nt">visible</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="简化导入代码-import">简化导入代码 import</h3>

<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">JavaScript modules 模块 MDN</a></li>
<li>使用 <code>export default x</code> 将一个变量默认导出给外部使用</li>
<li>使用 <code>import from './xxx.js'</code> 引用另一个模块导出的默认变量</li>
<li>使用 <code>import {x} from './xxx.js'</code> 引用另一个模块导出的名为 x 的变量</li>
</ul>

<blockquote>
<p>在app各自的js代码中引入css代码</p>
</blockquote>

<ul>
<li>CSS的<code>@import</code>，性能低，一般不使用</li>
</ul>

<hr />

<h3 id="实现后两个模块">实现后两个模块</h3>

<ul>
<li><p>不要用JS操作样式</p></li>

<li><p>面条代码</p></li>
</ul>

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app3&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app3&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;square&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app4&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app4&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;circle&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;heart&#34;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;heart-L&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;heart-R&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;heart square&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;shadow&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app3.scss</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="nv">$dirty-snow</span><span class="o">:</span> <span class="mh">#f4f4f4</span><span class="p">;</span>
<span class="nv">$shit-yellow</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">253</span><span class="o">,</span> <span class="mi">231</span><span class="o">,</span> <span class="mi">85</span><span class="p">);</span>
<span class="nv">$orange</span><span class="o">:</span> <span class="mh">#ff4500</span><span class="p">;</span>

<span class="nc">.app3</span> <span class="p">{</span>

  <span class="nc">.square</span> <span class="p">{</span>
    <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">shit-yellow</span><span class="p">;</span>
    <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="err">$</span><span class="nt">orange</span><span class="p">;</span>
    <span class="nt">height</span><span class="nd">:</span> <span class="nt">10vw</span><span class="p">;</span>
    <span class="nt">margin-left</span><span class="nd">:</span> <span class="nt">10vw</span><span class="p">;</span>
    <span class="nt">margin-top</span><span class="nd">:</span> <span class="nt">10vw</span><span class="p">;</span>
    <span class="nt">transition</span><span class="nd">:</span> <span class="nt">all</span> <span class="nt">1s</span><span class="p">;</span>
    <span class="nt">width</span><span class="nd">:</span> <span class="nt">10vw</span><span class="p">;</span>

    <span class="k">&amp;</span><span class="nc">.active</span> <span class="p">{</span>
      <span class="nt">background-color</span><span class="nd">:</span> <span class="nt">mix</span><span class="o">(</span><span class="err">$</span><span class="nt">shit-yellow</span><span class="o">,</span> <span class="err">$</span><span class="nt">orange</span><span class="o">,</span> <span class="err">$</span><span class="nt">weight</span><span class="nd">:</span> <span class="nc">.5</span><span class="o">)</span><span class="p">;</span>
      <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="err">$</span><span class="nt">dirty-snow</span><span class="p">;</span>
      <span class="nt">transform</span><span class="nd">:</span> <span class="nt">translateX</span><span class="o">(</span><span class="nt">15vw</span><span class="o">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app3.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.css&#39;</span>
<span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$square</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app3 .square&#39;</span><span class="p">)</span>
<span class="c1">// 绑定鼠标事件
</span><span class="c1"></span><span class="nx">$square</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$square</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app4.scss</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SCSS" data-lang="SCSS"><span class="c1">// ----- Base ----- //
</span><span class="c1"></span>
<span class="nv">$shit-yellow</span><span class="o">:</span> <span class="nf">rgb</span><span class="p">(</span><span class="mi">253</span><span class="o">,</span> <span class="mi">231</span><span class="o">,</span> <span class="mi">85</span><span class="p">);</span>
<span class="nv">$bg-color</span><span class="o">:</span> <span class="mh">#fdfdfd</span><span class="p">;</span>
<span class="nv">$fg-color</span><span class="o">:</span> <span class="mh">#f23f5d</span><span class="p">;</span>

<span class="c1">// ----- Animation ----- //
</span><span class="c1"></span>
<span class="nv">$anim-duration</span><span class="o">:</span> <span class="mi">2</span><span class="mf">.5</span><span class="kt">s</span><span class="p">;</span>
<span class="nv">$anim-timing-function</span><span class="o">:</span> <span class="nf">cubic-bezier</span><span class="p">(</span><span class="mf">.75</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mf">.5</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">$anim-iteration-count</span><span class="o">:</span> <span class="n">infinite</span><span class="p">;</span>
<span class="nv">$anim-direction</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>

<span class="c1">// ----- @mixin ----- //
</span><span class="c1"></span>
<span class="k">@mixin</span><span class="nf"> animation</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nt">animation</span><span class="nd">:</span> <span class="err">$</span><span class="nt">name</span> <span class="err">$</span><span class="nt">anim-duration</span> <span class="err">$</span><span class="nt">anim-timing-function</span> <span class="err">$</span><span class="nt">anim-iteration-count</span> <span class="err">$</span><span class="nt">anim-direction</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@mixin</span><span class="nf"> blue</span> <span class="p">{</span>
  <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">fg-color</span><span class="p">;</span>
  <span class="nt">height</span><span class="nd">:</span> <span class="nt">1em</span><span class="p">;</span>
  <span class="nt">width</span><span class="nd">:</span> <span class="nt">1em</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----- Style ----- //
</span><span class="c1"></span><span class="nn">#app4</span> <span class="p">{</span>
  <span class="k">&amp;</span><span class="nc">.app4</span> <span class="p">{</span>
    <span class="nt">align-items</span><span class="nd">:</span> <span class="nt">center</span><span class="p">;</span>
    <span class="nt">display</span><span class="nd">:</span> <span class="nt">grid</span><span class="p">;</span>
    <span class="nt">justify-items</span><span class="nd">:</span> <span class="nt">center</span><span class="p">;</span>
    <span class="nt">position</span><span class="nd">:</span> <span class="nt">relative</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nc">.circle</span> <span class="p">{</span>
    <span class="nt">border</span><span class="nd">:</span> <span class="nt">1px</span> <span class="nt">solid</span> <span class="err">$</span><span class="nt">fg-color</span><span class="p">;</span>
    <span class="nt">border-radius</span><span class="nd">:</span> <span class="nt">50</span><span class="err">%</span><span class="p">;</span>
    <span class="nt">height</span><span class="nd">:</span> <span class="nt">20vw</span><span class="p">;</span>
    <span class="nt">position</span><span class="nd">:</span> <span class="nt">relative</span><span class="p">;</span>
    <span class="nt">width</span><span class="nd">:</span> <span class="nt">20vw</span><span class="p">;</span>

    <span class="k">&amp;</span><span class="nc">.active</span> <span class="p">{</span>
      <span class="nt">animation</span><span class="nd">:</span> <span class="nt">change</span> <span class="nt">1s</span> <span class="nt">infinite</span> <span class="nt">both</span> <span class="nt">linear</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nc">.heart</span> <span class="p">{</span>
      <span class="k">@include</span><span class="nd"> animation</span><span class="p">(</span><span class="n">heart</span><span class="p">);</span>
      <span class="nt">left</span><span class="nd">:</span> <span class="nt">50</span><span class="err">%</span><span class="p">;</span>
      <span class="nt">position</span><span class="nd">:</span> <span class="nt">absolute</span><span class="p">;</span>
      <span class="nt">top</span><span class="nd">:</span> <span class="nt">50</span><span class="err">%</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----- Animations ----- //
</span><span class="c1"></span><span class="k">@keyframes</span> <span class="nt">change</span> <span class="p">{</span>
  <span class="nt">0</span><span class="err">%</span> <span class="p">{</span>
    <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">shit-yellow</span><span class="p">;</span>
    <span class="nt">transform</span><span class="nd">:</span> <span class="nt">scale</span><span class="o">(</span><span class="nc">.5</span><span class="o">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">100</span><span class="err">%</span> <span class="p">{</span>
    <span class="nt">background-color</span><span class="nd">:</span> <span class="err">$</span><span class="nt">fg-color</span><span class="p">;</span>
    <span class="nt">transform</span><span class="nd">:</span> <span class="nt">scale</span><span class="o">(</span><span class="nc">.8</span><span class="o">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app4.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.css&#39;</span>
<span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$circle</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app4 .circle&#39;</span><span class="p">)</span>
<span class="c1">// 绑定鼠标事件
</span><span class="c1"></span><span class="nx">$circle</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseenter&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$circle</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;mouseleave&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">$circle</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="添加app2-app3数据保存功能">添加app2 app3数据保存功能</h3>

<blockquote>
<p>当用户刷新时保存数据</p>
</blockquote>

<ul>
<li>添加<code>localStorage</code></li>
</ul>

<blockquote>
<p><code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$tabBar</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app2 .tab-bar&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">$tabContent</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app2 .tab-content&#39;</span><span class="p">)</span>
<span class="c1">// 初始化数据 read localStorage tab status
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app2.index&#39;</span>
<span class="c1">// 保底值
</span><span class="c1">// let index = localStorage.getItem(localKey) || 0
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">)</span> <span class="o">??</span> <span class="mi">0</span>

<span class="c1">// 绑定鼠标事件 事件委托
</span><span class="c1"></span><span class="nx">$tabBar</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// console.log(e.target) // 点击时可能获取到目标元素的子元素 改成用 e.currentTarget
</span><span class="c1"></span>  <span class="c1">// console.log(e.currentTarget) // DOM 元素难用 换成用jQuery元素 封装$li
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">$li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
  <span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">$li</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>
  <span class="c1">// console.log(index)
</span><span class="c1"></span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="c1">// write localStorage tab status
</span><span class="c1"></span>
  <span class="cm">/*
</span><span class="cm">    // 逻辑与样式耦合的代码1
</span><span class="cm">    $tabContent.children()
</span><span class="cm">      .eq(index).css({ display: &#39;block&#39; })
</span><span class="cm">      .siblings().css({
</span><span class="cm">        display: &#39;none&#39;
</span><span class="cm">      })
</span><span class="cm">
</span><span class="cm">    // 逻辑与样式耦合的代码2
</span><span class="cm">    $tabContent.children()
</span><span class="cm">      .eq(index).show()
</span><span class="cm">      .siblings().hide()
</span><span class="cm">   */</span>

  <span class="c1">// 行为与样式分离1 // 背景色切换
</span><span class="c1"></span>  <span class="nx">$li</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">siblings</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span>

  <span class="c1">// 行为与样式分离2 // 内容的显示与隐藏
</span><span class="c1"></span>  <span class="nx">$tabContent</span>
    <span class="p">.</span><span class="nx">children</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">siblings</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>

<span class="p">})</span>
<span class="c1">// 帮你点击 代替在HTML标签中设置样式属性 &#39;selected&#39; &#39;active&#39;
</span><span class="c1">// $tabBar.children().eq(0).trigger(&#39;click&#39;)
</span><span class="c1"></span><span class="nx">$tabBar</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">eq</span><span class="p">(</span><span class="nx">index</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app3.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.css&#39;</span>
<span class="c1">// 需要的元素
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">$square</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#app3 .square&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app3.active&#39;</span>
<span class="c1">// 初始化数据
</span><span class="c1">// 布尔值 判断是否点击了  no undefined / yes
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">active</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;yes&#39;</span>
<span class="cm">/*
</span><span class="cm">
</span><span class="cm">if(active) {
</span><span class="cm">  $square.addClass(&#39;active&#39;)
</span><span class="cm">} else {
</span><span class="cm">  $square.removeClass(&#39;active&#39;)
</span><span class="cm">}
</span><span class="cm">*/</span>
<span class="c1">// 简化成
</span><span class="c1"></span><span class="nx">$square</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="nx">active</span><span class="p">)</span>
<span class="c1">// 绑定鼠标事件
</span><span class="c1"></span><span class="nx">$square</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$square</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">$square</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">$square</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c1">// $square.toggleClass(&#39;active&#39;)
</span><span class="c1"></span><span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>webStorm</code>报错</p>
</blockquote>

<ul>
<li><code>localStorage.setItem('app3.active', false)</code> 参数类型是布尔值，</li>
<li>不应赋值给<code>string</code>，而<code>setItem</code>的取值只支持字符串</li>
<li>虽然会进行隐式转换类型为字符串</li>
<li>使用<code>getItem</code>取出的也是字符串<code>'false'</code>，不严谨</li>
<li>用<code>localStorage.setItem('app3.active', 'no')</code>代替</li>
</ul>

<hr />

<h2 id="5-抽象思维1-最小知识原则-js单一模块化-a-id-js单一模块化-href-js单一模块化-a-a-href-catalogue-a">5.抽象思维1 最小知识原则 js单一模块化 <a id="js单一模块化" href="#js单一模块化" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>引入一个模块需要引入html、css、js</li>
<li>引入一个模块需要引入html、js</li>
<li>引入一个模块需要引入js</li>
<li>需要的越少越好</li>
</ul>

<blockquote>
<p>代价</p>
</blockquote>

<ul>
<li>会使得页面一开始是空白的，没内容样式：白屏不是bug，而是由于浏览器的渲染机制</li>
<li>解决方案有加菊花<code>gif loading</code>、加骨架（掘金）、加占位内容（文章标题）等</li>
<li>或用SSR <code>{{app1}}</code> <code>{{app2}}</code> <code>{{app3}}</code> <code>{{app4}}</code>，大炮打蚊子</li>
</ul>

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./reset.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./global.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.js&#39;</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>ES6字符串模板</li>
<li>将不同模块的<code>html</code>标签变成字符串 放入js文件中</li>
<li>原来的<code>index.html</code>里只保留空的<code>&lt;div class=&quot;page&quot;&gt;&lt;/div&gt;</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 初始化html并加到页面里
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  &lt;section id=&#34;app1&#34; class=&#34;app1&#34;&gt;
</span><span class="sb">    &lt;div class=&#34;output&#34;&gt;
</span><span class="sb">      &lt;span id=&#34;number&#34;&gt;100&lt;/span&gt;
</span><span class="sb">    &lt;/div&gt;
</span><span class="sb">    &lt;div class=&#34;actions&#34;&gt;
</span><span class="sb">      &lt;button id=&#34;add1&#34;&gt;+1&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;minus1&#34;&gt;-1&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;mul2&#34;&gt;×2&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;divide2&#34;&gt;÷2&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;recovery&#34;&gt;恢复&lt;/button&gt;
</span><span class="sb">    &lt;/div&gt;
</span><span class="sb">  &lt;/section&gt;
</span><span class="sb">`</span>
<span class="c1">// 用jQuery方法见字符串变为HTML标签
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
    <span class="c1">//  .prependTo(document.body) 相当于.prependTo($(&#39;body&#39;))
</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 初始化html并加到页面里
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  &lt;section id=&#34;app2&#34; class=&#34;app2&#34;&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">      &lt;li&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">      &lt;li&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">      &lt;li&gt;内容1&lt;/li&gt;
</span><span class="sb">      &lt;li&gt;内容2&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">  &lt;/section&gt;
</span><span class="sb">`</span>
<span class="kr">const</span> <span class="nx">$element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app3.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 初始化html并加到页面里
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  &lt;section id=&#34;app3&#34; class=&#34;app3&#34;&gt;
</span><span class="sb">    &lt;div class=&#34;square&#34;&gt;&lt;/div&gt;
</span><span class="sb">  &lt;/section&gt;
</span><span class="sb">`</span>
<span class="kr">const</span> <span class="nx">$element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app4.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  &lt;section id=&#34;app4&#34; class=&#34;app4&#34;&gt;
</span><span class="sb">    &lt;div class=&#34;circle&#34;&gt;&lt;/div&gt;
</span><span class="sb">  &lt;/section&gt;
</span><span class="sb">`</span>
<span class="kr">const</span> <span class="nx">$element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>使用每个模块不用关心<code>HTML</code>是怎样的</li>
<li>注意<code>.prependTo($('body&gt;.page'))</code>在<code>webStorm</code>中智能显示的语法高亮，完胜<code>VSCode</code></li>
<li>又有重复<code>const $element = $(html).appendTo($('body&gt;.page'))</code></li>
<li>之后再重构插入节点</li>
</ul>

<hr />

<h2 id="小结">小结</h2>

<ul>
<li>在<code>index.html</code>只有空的结构</li>
<li>引入<code>main.js</code>的<code>script</code>标签</li>
<li><code>main.js</code>里依次引入四个模块，不具体操作各个模块内容</li>
<li>面条代码 -&gt; 模块代码</li>
<li>代价是网速慢时，加载的页面空白（chrome模拟slow 3G网速）</li>
</ul>

<hr />

<h2 id="6-抽象思维2-以不变应万变-封装成mvc三个对象-a-id-封装成mvc-href-封装成mvc-a-a-href-catalogue-a">6.抽象思维2 以不变应万变 封装成mvc三个对象 <a id="封装成mvc" href="#封装成mvc" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>每个模块都可以用 m + v + c 搞定</li>
<li>每个模块不用再考虑类似的需求了？</li>
</ul>

<blockquote>
<p>代价</p>
</blockquote>

<ul>
<li>有多余的代码</li>
<li>特殊情况：无html的模块</li>
</ul>

<blockquote>
<p>每个模块都有重复的思路</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 导入文件
</span><span class="c1">// 初始化html并加到页面里
</span><span class="c1">// 需要的元素
</span><span class="c1">// 初始化数据
</span><span class="c1">// 将数据渲染到页面
</span><span class="c1">// 绑定鼠标事件
</span></code></pre></td></tr></table>
</div>
</div>
<hr />

<ul>
<li>数据相关放到 m</li>
<li>视图相关放到 v</li>

<li><p>其他相关放到 c</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">html</span><span class="o">:</span> <span class="sb">``</span><span class="p">,</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{},</span>
<span class="p">}</span>
<span class="c1">// 第一次渲染html
</span><span class="c1"></span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>放在 v 还是放在 c</p>
</blockquote>

<ul>
<li>按目的 -&gt; 是否在页面上看得见</li>
<li>比如既不是数据，也不是看得见的放到 c 里</li>
</ul>

<p>~vim 重复操作快捷键 . 操作</p>

<hr />

<blockquote>
<p><code>app1.js</code>封装成 mvc 三个对象</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 有bug */</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 初始化数据
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">  &lt;section id=&#34;app1&#34; class=&#34;app1&#34;&gt;
</span><span class="sb">    &lt;div class=&#34;output&#34;&gt;
</span><span class="sb">      &lt;span id=&#34;number&#34;&gt;{{number}}&lt;/span&gt;
</span><span class="sb">    &lt;/div&gt;
</span><span class="sb">    &lt;div class=&#34;actions&#34;&gt;
</span><span class="sb">      &lt;button id=&#34;add1&#34;&gt;+1&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;minus1&#34;&gt;-1&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;mul2&#34;&gt;×2&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;divide2&#34;&gt;÷2&lt;/button&gt;
</span><span class="sb">      &lt;button id=&#34;recovery&#34;&gt;恢复&lt;/button&gt;
</span><span class="sb">    &lt;/div&gt;
</span><span class="sb">  &lt;/section&gt;
</span><span class="sb">  `</span><span class="p">,</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 将数据渲染到页面
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">??</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">// c.ui.number.text(m.data.n  || 100)
</span><span class="c1"></span>  <span class="p">},</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 用jQuery方法见字符串变为HTML标签
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
  <span class="p">},</span>
<span class="p">}</span>
<span class="cm">/* 其他相关放到 c */</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;$(&#39;#add1&#39;)&#34;</span><span class="p">)</span>
<span class="kr">debugger</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">))</span> <span class="c1">// null 空对象
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">ui</span><span class="o">:</span> <span class="p">{</span>
  <span class="c1">// 需要的元素
</span><span class="c1"></span>    <span class="nx">button1</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">),</span>
    <span class="nx">button2</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#minus1&#39;</span><span class="p">),</span>
    <span class="nx">button3</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mul2&#39;</span><span class="p">),</span>
    <span class="nx">button4</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divide2&#39;</span><span class="p">),</span>
    <span class="nx">number</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#number&#39;</span><span class="p">),</span>
    <span class="nx">recovery</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#recovery&#39;</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// console.log(&#39;bindEvents 执行了&#39;)
</span><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button1</span><span class="p">)</span> <span class="c1">//
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
      <span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button2</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
      <span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button3</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
      <span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button4</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
      <span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">recovery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;100&#39;</span><span class="p">)</span>
      <span class="kd">let</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
      <span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 第一次渲染html
</span><span class="c1"></span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>一个缺点是从页面视图里拿数据<code>let n = parseInt(c.ui.number.text())</code></li>
<li>而不是数据模块<code>m.data.n</code></li>
</ul>

<hr />

<blockquote>
<p>点击无效，未成功绑定事件</p>
</blockquote>

<h3 id="debugger">debugger</h3>

<ul>
<li>在点击事件里打印查看是否运行到<code>bindEvents()</code></li>

<li><p>执行了再看是否存在<code>c.ui.button1</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// ..
</span><span class="c1"></span><span class="p">,</span>
<span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;bindEvents 执行了&#39;</span><span class="p">)</span>
<span class="kr">debugger</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button1</span><span class="p">)</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="c1">// debugger
</span><span class="c1"></span>  <span class="c1">// ...
</span><span class="c1"></span><span class="p">})</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p><code>c.ui.button1</code>是个空对象</p>
</blockquote>

<ul>
<li><p>说明未定义<code>c.ui.button1</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;$(&#39;#add1&#39;)&#34;</span><span class="p">)</span>
<span class="kr">debugger</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">))</span> <span class="c1">// null
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">ui</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// 需要的元素
</span><span class="c1"></span>    <span class="nx">button1</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">),</span>
    <span class="nx">button2</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#minus1&#39;</span><span class="p">),</span>
    <span class="nx">button3</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mul2&#39;</span><span class="p">),</span>
    <span class="nx">button4</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divide2&#39;</span><span class="p">),</span>
    <span class="nx">number</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#number&#39;</span><span class="p">),</span>
    <span class="nx">recovery</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#recovery&#39;</span><span class="p">)</span>
<span class="p">},</span>
<span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/*..*/</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>之前改了代码顺序，代码运行至debugger断点处时，页面中没有button元素</p></li>

<li><p>button 初始化在 render() 之前</p></li>

<li><p>在赋值<code>button1</code>的时候，就立即执行（调用）了<code>$(#add1)</code></p></li>

<li><p>而此时<code>render()</code>还未执行</p></li>

<li><p>浏览器解析到函数调用，会立即调用</p></li>

<li><p>绑定事件<code>c.bindEvents()</code>在渲染页面之后<code>v.render()</code></p></li>

<li><p>在定义<code>c.ui</code>里的元素前，页面里还没有渲染，所以并没有取到元素</p></li>
</ul>

<blockquote>
<p>在c中写一个初始化方法<code>init()</code>，当调用时<code>init()</code>，才取到`<code>c.ui</code>的属性，即 button 初始化</p>
</blockquote>

<ul>
<li>将绑定事件方法<code>c.bindEvents()</code>写进初始化方法里<code>init()</code></li>
<li>即先初始化c.ui，再初始化绑定事件<code>c.bindEvents()</code></li>
<li>这样就可以实现先渲染，再初始化（绑定事件）</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// 需要的元素
</span><span class="c1"></span>        <span class="nx">button1</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">),</span>
        <span class="nx">button2</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#minus1&#39;</span><span class="p">),</span>
        <span class="nx">button3</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mul2&#39;</span><span class="p">),</span>
        <span class="nx">button4</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divide2&#39;</span><span class="p">),</span>
        <span class="nx">number</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#number&#39;</span><span class="p">),</span>
        <span class="nx">recovery</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#recovery&#39;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span>
 <span class="p">}</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>刷新无效</p>
</blockquote>

<ul>
<li>第一次渲染时将不变的<code>html</code>传入了，没有用到数据中的<code>n</code></li>
<li><code>const element = $(v.html).prependTo($('body&gt;.page'))</code></li>
<li>在<code>html</code>中加上占位符<code>{{number}}</code></li>
<li>传的时候将字符串<code>html</code> 用<code>replace()</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...
</span><span class="sb">        &lt;span id=&#34;number&#34;&gt;{{number}}&lt;/span&gt;
</span><span class="sb">        ...
</span><span class="sb">  `</span><span class="p">,</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 用jQuery方法见字符串变为HTML标签
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>之后更新<code>update()</code>方法代替原来操作DOM</li>

<li><p>未改变<code>m.data.n</code>，因为没有触发点击事件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 初始化html
</span><span class="c1"></span><span class="nx">html</span><span class="o">:</span> <span class="sb">`...
</span><span class="sb">    &lt;span id=&#34;number&#34;&gt;{{number}}&lt;/span&gt;
</span><span class="sb">    ...
</span><span class="sb">`</span><span class="p">,</span>
<span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<span class="p">},</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">// 用jQuery方法见字符串变为HTML标签
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
<span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>再点击事件中，直接从<code>m.data</code>中获取数据，而不是在页面上读取字符串<code>c.ui.number.text()</code></p>
</blockquote>

<ul>
<li>直接在事件监听函数中操作数据</li>
<li>然后在事件监听函数中重新调用渲染函数<code>v.render()</code></li>
<li>而不是之前直接操作DOM<code>c.ui.number.text(n)</code></li>
<li>不需要<code>update()</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// console.log(&#39;bindEvents 执行了&#39;)
</span><span class="c1"></span>    <span class="c1">// console.log(c.ui.button1)
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">button1</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 直接从`m.data`中获取数据 来操作
</span><span class="c1"></span>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;run here&#39;</span><span class="p">)</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="cm">/* ... */</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>渲染函数重复添加相同的节点（点击看效果）</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
<span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>每次渲染都添加，没有删除原来的，去掉<code>overflow: hidden;</code>可以看到</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>

<ul>
<li><p><code>m.data.n</code>是从<code>localStorage.getItem('n')</code>中获取的一个字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 初始化数据
</span><span class="c1"></span><span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
<span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>添加一个标记，<code>render()</code>中未使用变量<code>element</code></p></li>

<li><p>将视图渲染的结果放到<code>v</code>，初始值为<code>null</code></p></li>

<li><p>每次渲染判断一下<code>el</code>，有就替换，没有再添加</p></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 没渲染过
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&gt;.page&#39;</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 渲染过
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">newEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">newEl</span><span class="p">)</span>
      <span class="c1">// 更新地址 注意每次刷新都是不同的引用
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">newEl</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>目前做到了 点击一次</p>
</blockquote>

<ul>
<li>先改数据</li>
<li>再根据数据，刷新整个自己</li>
<li>bug: 点击只有一次有效</li>
</ul>

<blockquote>
<p>解决之前先看<code>v.el = $(v.html.replace('{{number}}', m.data.n)).prependTo($('body&gt;.page'))</code>，怎么知道页面上有<code>$('body&gt;.page')</code>，最好是传入</p>
</blockquote>

<ul>
<li>如果页面上的<code>.page</code>未知，可以传入</li>
<li>用<code>c.init()</code>的参数去接收</li>
<li>在初始化的方法<code>c.init()</code>中渲染<code>v.render()</code>一次，代替外部代码的先渲染，再初始化</li>
<li>先渲染，再做初始化的其他步骤</li>
<li>可以减少一次函数调用</li>
<li>再次体现了最小知识原则</li>
</ul>

<blockquote>
<p>渲染顺序 初始化顺序</p>
</blockquote>

<ul>
<li>初始化时接收一个参数，来记录渲染到页面的哪个位置</li>
<li>参数传递<code>init(container)</code>，可以是一个div标签</li>
<li>将<code>container</code>传给视图中的<code>v.render(container)</code></li>
<li>不需要写死<code>$('body&gt;.page')</code>，替换为<code>$(container)</code></li>
<li>可以传递任意标签</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="nx">render</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 没渲染过
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">))</span>
        <span class="c1">// .prependTo($(&#39;body&gt;.page&#39;))
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 渲染过
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">newEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">newEl</span><span class="p">)</span>
      <span class="c1">// 更新地址 注意每次刷新都是不同的引用
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">newEl</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div>
<h3 id="模块传参-导出变量">模块传参，导出变量</h3>

<blockquote>
<p>需要在初始化时，得到传入的<code>container</code>，需要在<code>app1.js</code>外暴露变量</p>
</blockquote>

<ul>
<li><code>app1</code>怎么知道外部容器`</li>
<li>在<code>app1.js</code>中无法直接得到，不可在在<code>app1.js</code>里调用<code>init()</code></li>

<li><p>暴露出变量<code>c</code>， 即导出变量<code>export default c</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// ...
</span><span class="c1">// c.init()
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p><code>app1.js</code>需要别的js文件来传入一个参数</p></li>

<li><p>在<code>main.js</code>中导入<code>c</code>，并初始化<code>app1.js</code></p></li>

<li><p>搭好骨架<code>&lt;section id=&quot;app1&quot;&gt;&lt;/section&gt;</code></p></li>

<li><p><code>app1</code>在<code>main.js</code>里初始化，并接受参数`import x from &ldquo;./app1&rdquo;</p></li>
</ul>

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./reset.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./global.css&#39;</span>

<span class="kr">import</span> <span class="nx">x</span> <span class="nx">from</span> <span class="s2">&#34;./app1&#34;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.js&#39;</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>写一个的容器作为骨架</li>
<li><code>x.init('#app1')</code>接受 id 为 app1 的容器</li>
<li>同时删除<code>app1.js</code>中<code>html</code>变量里 id 为 app1 的节点</li>
</ul>

<blockquote>
<p><code>index.html</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;page&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app1&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;./main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>修改对应的html</li>
<li><code>x</code>就是默认导出的<code>c</code>，引入的就是<code>c</code>的地址</li>
<li>把页面中的<code>#app1</code>传入模块，之后初始化</li>
<li>用<code>&lt;section id=&quot;app1&quot;&gt;&lt;/section&gt;</code>是因为css里写死了<code>section</code></li>
</ul>

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"> <span class="c1">// ...
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">x</span> <span class="nx">from</span> <span class="s2">&#34;./app1&#34;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="c1">// ...
</span><span class="c1"></span><span class="nx">x</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;#app1&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>在<code>main.js</code>中导入<code>app1.js</code>的<code>c</code>：<code>import x from &quot;./app1&quot;</code></li>
<li>x 为导出时的变量名</li>
<li>使用<code>c</code>中的<code>init()</code>方法：<code>x.init('#app1')</code>，将页面上的节点传入</li>
<li>即将页面中的<code>#app1</code>传给<code>app1.js</code>模块去初始化</li>
</ul>

<blockquote>
<p>再次运用了最小知识原则</p>
</blockquote>

<ul>
<li>模块不关心外部的 选择器 标签</li>
</ul>

<hr />

<blockquote>
<p>解决点击只有一次有效的bug</p>
</blockquote>

<ul>
<li>事件监听没了，原因是刷新页面之后，页面上新的<code>button1</code>不是原来的引用</li>
<li>更新地址<code>v.el = newEl</code> 注意每次刷新都是不同的引用</li>
<li>而绑定的监听函数是绑在替换之前初始化的<code>button1</code>节点上</li>
<li>操作 <code>DOM</code> 更新页面后 节点的引用改变（不是原来的节点） 绑定在节点上的事件也失效了</li>
<li>在不会动态更新的元素上绑定函数，即在不变的容器上添加事件监听</li>
</ul>

<blockquote>
<p>查看点击节点是否被替换，开发转工具相应节点添加属性<code>frank=&quot;yes&quot;</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-HTML" data-lang="HTML"><span class="p">&lt;</span><span class="nt">section</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;app1&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;app1&#34;</span> <span class="na">frank</span><span class="o">=</span><span class="s">&#34;yes&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;output&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;number&#34;</span><span class="p">&gt;</span>100<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;actions&#34;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;add1&#34;</span><span class="p">&gt;</span>+1<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;minus1&#34;</span><span class="p">&gt;</span>-1<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mul2&#34;</span><span class="p">&gt;</span>×2<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;divide2&#34;</span><span class="p">&gt;</span>÷2<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;recovery&#34;</span><span class="p">&gt;</span>恢复<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>如果改变了，就会消除<code>frank=&quot;yes&quot;</code></li>
<li>确认该元素不会被更新</li>
<li>原来的<code>bindEvents()</code>中访问不到<code>container</code></li>
</ul>

<hr />

<h3 id="事件委托">事件委托</h3>

<blockquote>
<p>绑定动态元素的事件无效 使用事件委托</p>
</blockquote>

<ul>
<li>将事件绑定到一个不会更新的标签上</li>
<li>使用事件委托</li>
<li>在<code>bindEvent()</code>如何获取到<code>v.container</code></li>
<li>在<code>v.render()</code>时，记下一个变量<code>v.container</code></li>
<li>目的是有一个地方可以存储<code>v.container</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 视图默认渲染结果
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 用jQuery封装对象 container &lt;- #app1
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="c1">// render(container) 省去参数 里面的替换为 $(v.container)
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">(</span> <span class="cm">/* container */</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 没渲染过
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">))</span>
      <span class="cm">/*
</span><span class="cm">      v.el = $(v.html.replace(&#39;{{number}}&#39;, m.data.n))
</span><span class="cm">        .prependTo($(container)) */</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 渲染过
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">newEl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">newEl</span><span class="p">)</span>
      <span class="c1">// 更新地址 注意每次刷新都是不同的引用
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">newEl</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="c1">// v.render(container) 改成 v.init(container)
</span><span class="c1"></span>    <span class="c1">// 将 `container`传给视图 v ：在v里创建 init(container) {}
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">button1</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add1&#39;</span><span class="p">),</span>
        <span class="nx">button2</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#minus1&#39;</span><span class="p">),</span>
        <span class="nx">button3</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mul2&#39;</span><span class="p">),</span>
        <span class="nx">button4</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#divide2&#39;</span><span class="p">),</span>
        <span class="nx">number</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#number&#39;</span><span class="p">),</span>
        <span class="nx">recovery</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#recovery&#39;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//事件委托
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#add1&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="c1">// console.log(&#39;bindEvents 执行了&#39;)
</span><span class="c1"></span>    <span class="c1">// console.log(c.ui.button1)
</span><span class="c1"></span>    <span class="cm">/*
</span><span class="cm">    c.ui.button1.on(&#39;click&#39;, () =&gt; {
</span><span class="cm">      // console.log(&#39;run here&#39;)
</span><span class="cm">      m.data.n += 1
</span><span class="cm">      // console.log(m.data.n)
</span><span class="cm">      v.render()
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">    */</span>
    <span class="c1">// ... app2 app3 app4
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>视图的外部的容器监听里面的元素</li>
<li>容器不会被替换，只替换容器里面的东西</li>
<li>而监听函数就不会失效</li>
</ul>

<blockquote>
<p>改其他绑定事件</p>
</blockquote>

<ul>
<li>并且<code>c.ui</code>选出的元素不需要了，直接在事件委托中选择</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 其他相关放到 c */</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="c1">// v.render(container)
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="cm">/*
</span><span class="cm">    c.ui = {
</span><span class="cm">        // 需要的元素
</span><span class="cm">        button1: $(&#39;#add1&#39;),
</span><span class="cm">        button2: $(&#39;#minus1&#39;),
</span><span class="cm">        button3: $(&#39;#mul2&#39;),
</span><span class="cm">        button4: $(&#39;#divide2&#39;),
</span><span class="cm">        number: $(&#39;#number&#39;),
</span><span class="cm">        recovery: $(&#39;#recovery&#39;)
</span><span class="cm">    }
</span><span class="cm">    */</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//事件委托
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#add1&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 直接从`m.data`中获取数据 来操作
</span><span class="c1"></span>      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#minus1&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#mul2&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#divide2&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#recovery&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>思路</p>
</blockquote>

<ul>
<li>每次刷新，<code>section</code>父容器（骨架）为不可变</li>
<li>每次点击时，更新整个父容器里面的<code>div</code>，原来绑定在button上的事件不存在了</li>
<li>但事件绑定在不变的父容器<code>section</code>上，并判断对应不同子元素，进行不同的操作，这就是事件委托</li>
<li>里面的引用变了，但<code>id</code>没变，每次点击：刷新子元素，重新绑定事件</li>
</ul>

<blockquote>
<p>反思：<code>MVC</code>带来什么好处</p>
</blockquote>

<ul>
<li>面向过程到面向对象的转变</li>
<li>模块化 各司其职</li>
<li>复杂度随着代码量平稳上升，而不是线性增长</li>
</ul>

<blockquote>
<p>折叠后的代码 <code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 初始化数据
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 视图默认渲染结果 视图元素
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 放入的容器元素
</span><span class="c1"></span>  <span class="nx">container</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="c1">// 接受外部参数（传入容器），视图初始化
</span><span class="c1"></span>  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">},</span>
  <span class="c1">// 负责渲染页面
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 其他相关放到 c */</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>抽象思维2 以不变应万变 每个模块都可以用 m + v + c 搞定</p>
</blockquote>

<ul>
<li>适用所有MVC，万金油代码</li>
<li>每个页面都有数据<code>data</code></li>
<li>每个视图都有元素<code>el</code></li>
<li>每个视图都有容器<code>container</code></li>
<li>每个视图都有数据<code>html</code></li>
<li>每个视图都需要初始化<code>init()</code></li>
<li>每个视图都需要更新渲染<code>render()</code></li>
<li>每个控制器都需要初始化<code>init()</code></li>
<li>每个控制器都需要绑定事件<code>bindEvents()</code></li>
<li>没有逻辑缺失</li>
</ul>

<blockquote>
<p>合并视图元素<code>el</code> <code>container</code></p>
</blockquote>

<ul>
<li>元素<code>el</code>和<code>container</code>可以合并</li>
<li><code>container</code>第一个元素就是<code>el</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 负责渲染页面
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/*
</span><span class="cm">    if(v.el === null) {
</span><span class="cm">      // 没渲染过
</span><span class="cm">      v.el = $(v.html.replace(&#39;{{number}}&#39;, m.data.n))
</span><span class="cm">        .prependTo(v.container)
</span><span class="cm">    } else {
</span><span class="cm">      // 渲染过
</span><span class="cm">      const newEl = $(v.html.replace(&#39;{{number}}&#39;, m.data.n))
</span><span class="cm">      v.el.replaceWith(newEl)
</span><span class="cm">      // 更新地址 注意每次刷新都是不同的引用
</span><span class="cm">      v.el = newEl
</span><span class="cm">    }
</span><span class="cm">    */</span>
    <span class="c1">// `v.container.children.length === 0` 代替看 `v.el === null`判断视图元素是否为空
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 没渲染过
</span><span class="c1"></span>      <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
              <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 渲染过
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
              <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>简化代码 <code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 负责渲染页面
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 没渲染过
</span><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 渲染过
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>再简化</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>v.container</code>代替了v<code>.el</code>，但名字太长 改名<code>v.el</code></p>
</blockquote>

<ul>
<li><p><code>v.el.children.length === 0</code> 代替 <code>v.el === null</code>判断视图元素是否为空</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">// 视图元素 容器元素
</span><span class="c1"></span><span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="c1">// 初始化html
</span><span class="c1"></span><span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
<span class="c1">// 接受外部参数（传入容器）视图初始化
</span><span class="c1"></span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 用jQuery封装对象 container &lt;- #app1
</span><span class="c1"></span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
<span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
<span class="p">},</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<h2 id="7-抽象思维3-用数据去渲染-a-id-用数据去渲染-href-用数据去渲染-a-a-href-catalogue-a">7.抽象思维3 用数据去渲染 <a id="用数据去渲染" href="#用数据去渲染" > § </a><a href="#catalogue"> ⇧ </a></h2>

<blockquote>
<p><code>view = render(data)</code></p>
</blockquote>

<ul>
<li>比起操作<code>DOM</code>对象，拙接render简单多了</li>
<li>只要改变<code>data</code>，就可以得到对应的<code>view</code></li>
<li><code>React</code>的诞生</li>
</ul>

<blockquote>
<p>代价</p>
</blockquote>

<ul>
<li><code>render</code>粗犷的渲染肯定比DOM操作耗费更多性能</li>
<li>用虚拟<code>DOM</code>能让<code>render</code>只更新改更新的地方</li>
</ul>

<blockquote>
<p>数据单向流动</p>
</blockquote>

<ul>
<li>同样是最小知识原则</li>
</ul>

<blockquote>
<p><code>none MVC</code></p>
</blockquote>

<table>
<thead>
<tr>
<th>JS(#add1)</th>
<th>数据流向</th>
<th>DOM（页面）</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>n = span.text</code></td>
<td><code>&lt;---</code></td>
<td>100</td>
</tr>

<tr>
<td><code>n += 1</code></td>
<td></td>
<td>100</td>
</tr>

<tr>
<td><code>span.text = n</code></td>
<td><code>---&gt;</code></td>
<td>101</td>
</tr>
</tbody>
</table>

<blockquote>
<p><code>MVC(React)</code></p>
</blockquote>

<table>
<thead>
<tr>
<th>JS(#add1)</th>
<th>数据流向</th>
<th>DOM（页面）</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>n = 100</code></td>
<td></td>
<td></td>
</tr>

<tr>
<td><code>render(n)</code></td>
<td><code>---&gt;</code></td>
<td>100</td>
</tr>

<tr>
<td><code>n += 1</code></td>
<td></td>
<td>100</td>
</tr>

<tr>
<td><code>render(n)</code></td>
<td><code>---&gt;</code></td>
<td>101</td>
</tr>
</tbody>
</table>

<blockquote>
<p>用数据去渲染改代码</p>
</blockquote>

<ul>
<li>数据：<code>m.data.n</code></li>
<li>视图：<code>v.render(n)</code></li>
<li><code>v</code> 不用知道 <code>m</code> 的存在</li>
<li>初始化<code>v.init(container)</code>和<code>v.render(m.data.n)</code>分开</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 初始化数据
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 视图元素 容器元素
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 初始化html
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="c1">// 接受外部参数（传入容器）视图初始化
</span><span class="c1"></span>  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 用jQuery封装对象 container &lt;- #app1
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="c1">// 负责渲染页面
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="nx">bindEvents</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#add1&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// console.log(&#39;run here&#39;)
</span><span class="c1"></span>      <span class="c1">// 直接从`m.data`中获取数据 来操作
</span><span class="c1"></span>      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="c1">// console.log(m.data.n)
</span><span class="c1"></span>      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 2nd view = render(data)
</span><span class="c1"></span>      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#minus1&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#mul2&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#divide2&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;#recovery&#39;</span><span class="p">,()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>重复的代码太多</p>
</blockquote>

<ul>
<li>一样的东西只写一遍</li>
</ul>

<hr />

<h2 id="8-抽象思维4-表驱动编程-自动绑定事件-a-id-自动绑定事件-href-自动绑定事件-a-a-href-catalogue-a">8.抽象思维4 表驱动编程-自动绑定事件 <a id="自动绑定事件" href="#自动绑定事件" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>当看到大批类似但不重复的代码</li>
<li>眯起眼睛，看看到底哪些才是重要的数据</li>
<li>将重要的数据做成哈希表，代码就简单明了</li>
<li>这就是数据结构知识的红利</li>
<li>可以减少重复代码，只将重要的信息放在表里，然后利用表来编程</li>
</ul>

<blockquote>
<p>代价</p>
</blockquote>

<ul>
<li>没有代价</li>
</ul>

<blockquote>
<p>哈希表 描述在做什么</p>
</blockquote>

<ul>
<li><code>'click #add1': 'add'</code>：<code>click</code>点击<code>#add1</code>的时候，调用<code>add</code>函数</li>
<li>添加<code>add1</code>函数</li>
<li>重复的<code>v.render(m.data.n)</code>不抄</li>
<li>遍历哈希表 循环绑定事件</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>    <span class="c1">// c.bindEvents()
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
  <span class="p">},</span>
  <span class="c1">// `&#39;click #add1&#39;: &#39;add&#39;`：`click`点击`#add1`的时候，调用`add`函数
</span><span class="c1"></span>  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click #add1&#39;</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #minus&#39;</span><span class="o">:</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #mul2&#39;</span><span class="o">:</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #divide2&#39;</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #recovery&#39;</span><span class="o">:</span> <span class="s1">&#39;recover&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="c1">// 表驱动编程-自动绑定事件
</span><span class="c1"></span>  <span class="c1">// `&#39;click #add1&#39;: &#39;add&#39;`：`click`点击`#add1`的时候，调用`add`函数
</span><span class="c1"></span>  <span class="c1">// 遍历哈希表 循环绑定事件
</span><span class="c1"></span>  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// console.log(key)
</span><span class="c1"></span>      <span class="c1">// app1.js:124 click #add1
</span><span class="c1"></span>      <span class="c1">// app1.js:124 click #minus
</span><span class="c1"></span>      <span class="c1">// app1.js:124 click #mul2
</span><span class="c1"></span>      <span class="c1">// app1.js:124 click #divide2
</span><span class="c1"></span>      <span class="c1">// app1.js:124 click #recovery
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="c1">// console.log(part1, &#39;,&#39;, part2)
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="cm">/*
</span><span class="cm">  ,
</span><span class="cm">  bindEvents() {
</span><span class="cm">    //事件委托
</span><span class="cm">    v.el.on(&#39;click&#39;, &#39;#add1&#39;, () =&gt; {
</span><span class="cm">      // 直接从`m.data`中获取数据 来操作
</span><span class="cm">      // console.log(&#39;run here&#39;)
</span><span class="cm">      m.data.n += 1
</span><span class="cm">      // console.log(m.data.n)
</span><span class="cm">      v.render(m.data.n) // 2nd view = render(data)
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">    v.el.on(&#39;click&#39;, &#39;#minus1&#39;,() =&gt; {
</span><span class="cm">      m.data.n -= 1
</span><span class="cm">      v.render(m.data.n)
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">    v.el.on(&#39;click&#39;, &#39;#mul2&#39;,() =&gt; {
</span><span class="cm">      m.data.n *= 2
</span><span class="cm">      v.render(m.data.n)
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">    v.el.on(&#39;click&#39;, &#39;#divide2&#39;,() =&gt; {
</span><span class="cm">      m.data.n /= 2
</span><span class="cm">      v.render(m.data.n)
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">    v.el.on(&#39;click&#39;, &#39;#recovery&#39;,() =&gt; {
</span><span class="cm">      m.data.n = 100
</span><span class="cm">      v.render()
</span><span class="cm">      localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">    })
</span><span class="cm">  }
</span><span class="cm">  */</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>guid报错</p>
</blockquote>

<h2 id="9-抽象思维5-俯瞰全局-对象间通信-a-id-对象间通信-href-对象间通信-a-a-href-catalogue-a">9.抽象思维5 俯瞰全局 对象间通信 <a id="对象间通信" href="#对象间通信" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>把所有的对象看成点</li>
<li>一个点和一个点怎么通信</li>
<li>一个点和多个点怎么通信</li>
<li>多个点和多个点怎么通信</li>
<li>最终找出一个专用的点负责通信</li>
<li>这个点就是<code>event bus</code>（事件总线）</li>
</ul>

<blockquote>
<p><code>eventBus</code>主要功能</p>
</blockquote>

<ul>
<li><code>eventBus</code> 主要用于对象间通信</li>
<li><code>eventBus</code> 提供了 <code>on</code>、<code>off</code> 和 <code>trigger</code> 等 <code>API</code></li>
<li><code>on</code> 用于监听事件，<code>trigger</code> 用域触发事件</li>
<li>使用 <code>eventBus</code> 可以满足最小知识原则，<code>m</code> 和 <code>v</code> 互相不知道对方的细节，但是却可以调用对方的功能</li>
</ul>

<h3 id="实现eventbus对象间通信">实现eventBus对象间通信</h3>

<ul>
<li>让 <code>v</code> 知道 <code>m</code> 发生变化</li>
<li>如何使得<code>v.render(m.data.n)</code>和<code>localStorage.setItem('n', m.data.n.toString())</code>从代码里消失</li>
<li>真实需求： <code>data</code> 的 n 一变，就自动 <code>render</code> 视图</li>
<li>监听 <code>n</code> 变化，直接更新数据，不关心视图</li>
<li>监听 <code>n</code> 变化的方法有：

<ol>
<li><code>eventBus</code></li>
<li><code>vue2</code> 的 <code>Object.definedProperty</code></li>
<li><code>vue3.0 proxy</code>  <a href="https://www.cnblogs.com/weiqian/p/12460730.html">Vue双向绑定原理 从vue2的Object.defineProperty到vue3的proxy</a></li>
</ol></li>
</ul>

<blockquote>
<p>使用<code>eventBus</code></p>
</blockquote>

<ul>
<li><code>const eventBus = $({}); console.log(eventBus)</code></li>
<li>获取 <code>jQuery</code> 空对象元素的API <code>on</code>监听事件 <code>trigger</code>触发事件</li>
<li><code>console.log(eventBus.on)</code> <code>console.log(eventBus.trigger)</code></li>
<li>在一个地方监听事件，在另一个地方标记触发事件</li>
<li>两个地方互相通信</li>
</ul>

<blockquote>
<p><code>m.update()</code>数据更新</p>
</blockquote>

<ul>
<li>将传入的参数<code>data</code>的所有可枚举的属性，覆盖到<code>m.data</code>上</li>
<li><code>Object.assign(m.data, data)</code></li>
<li>触发标记<code>eventBus.trigger('m:updated')</code></li>
<li>在一个地方监听标记，在另一个地方标记触发事件</li>
<li>在数据 m 中更新数据，并标记触发事件<code>eventBus.trigger('m:updated')</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 初始化数据
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">create</span><span class="p">()</span> <span class="p">{},</span>
  <span class="k">delete</span><span class="p">()</span> <span class="p">{},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 同名属性覆盖 赋值
</span><span class="c1"></span>    <span class="c1">// 监听 n 变化，直接更新数据，不关心视图
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">},</span>
  <span class="nx">get</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>在 c 中监听触发标记<code>'m:updated'</code></p>
</blockquote>

<ul>
<li>在一个地方监听标记，在另一个地方标记触发事件</li>
<li>在数据 m 中更新数据，并标记触发事件<code>eventBus.trigger('m:updated')</code></li>
<li>在控制器 c.init 中，监听标记触发事件<code>eventBus.on()</code>，统一渲染页面<code>v.render(m.data.n)</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>    <span class="c1">// c.bindEvents()
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="c1">// 监听触发标记`&#39;m:updated&#39;`
</span><span class="c1"></span>    <span class="c1">// 统一在`eventBus.on()`监听的回调函数中渲染`v.render(m.data.n)`
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click #add1&#39;</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #minus1&#39;</span><span class="o">:</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #mul2&#39;</span><span class="o">:</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #divide2&#39;</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #recovery&#39;</span><span class="o">:</span> <span class="s1">&#39;recover&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// m.data.n += 1
</span><span class="c1"></span>    <span class="c1">// v.render(m.data.n)
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// m.data.n -= 1
</span><span class="c1"></span>    <span class="c1">// v.render(m.data.n)
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// m.data.n *= 2
</span><span class="c1"></span>    <span class="c1">// v.render(m.data.n)
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// m.data.n /= 2
</span><span class="c1"></span>    <span class="c1">// v.render(m.data.n)
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// m.data.n = 100
</span><span class="c1"></span>    <span class="c1">// v.render(m.data.n)
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>debugger</code> 过程</p>
</blockquote>

<ul>
<li><code>eventBus.trigger('m update')</code>中的<strong>事件名，不能有空格</strong></li>
<li>对于 <code>m.trigger('x xx')</code>有空格的<code>debugger</code></li>
<li>点击<code>add</code>没反应</li>
<li>找到<code>add() {}</code>函数，里面写一句<code>console.log(&quot;add&quot;)</code></li>
<li>控制台里查看<code>add()</code>是否运行</li>
<li>执行到了，会调用<code>m.update()</code>，找到<code>update() {}</code>函数</li>
<li><code>update() {}</code>函数里写一句<code>console.log(&quot;here&quot;)</code></li>
<li>执行到了，触发<code>eventBus.trigger('m:updated')</code>，查看监听<code>eventBus.on('m:updated',() =&gt; {})</code></li>
<li>监听是在<code>c.init</code>里，在<code>eventBus.on('m:updated',() =&gt; {})</code>的回调函数中写一句<code>console.log(&quot;here&quot;)</code></li>
<li>发现没有成功监听</li>
<li><code>eventBus</code>的事件没有调用，定位bug</li>
<li>改一下事件名<code>xxx</code>，可以执行<code>eventBus</code></li>
<li><code>eventBus.trigger('xxx')</code>中的事件名<code>xxx</code>，不能有空格</li>
</ul>

<hr />

<h3 id="小结2">小结2</h3>

<ul>
<li>数据 <code>m</code> 中 实现增删改查的方法</li>
<li><code>eventBus.trigger('xxx')</code>中的事件名xxx，不能有空格</li>
<li>虚拟DOM改良<code>render</code></li>
<li>events的代码抽象了所有操作<code>'click #add1': 'add'</code></li>
<li>即<code>'事件 选择器': '回调函数'</code></li>
<li>c 中的控制函数，还原其最恰当本分的逻辑<code>add() {m.update({n: m.data.n += 1})}</code>，不用关心视图 v</li>
<li>解耦</li>
<li><a href="https://www.jianshu.com/p/1996ad3e09f9">JS简易实现eventBus</a></li>
<li><a href="https://codepen.io/jorin/pen/lKmow?__cf_chl_jschl_tk__=7253a8f51abb42a9ec95ace4f6764d554a8d30ea-1594731788-0-AZ9WQE6vtzi-0ONSVvr5sC7nDM9KKMyppldTQI61sg7UF5AtqYUjxyNPckUl-05Bu-gy3iqP0uLpTXCHmulFqRQup51p0Bl_eejvRTJLHFIQI_SwHAFNL4VyQhBXwbQ6MZa13JgBR_OOtLrRNBRQEtGs5JTEc9gm2DSWDppVF_efiwuyDtooecyqi6Y2a6PRziQr2dqOmHttiPr-xSee_Oio--bVdek_m8xQE3vUajrPKTS36InOq-uSQAE8xU9qwAUFXx3uv-usMqj9isdda_va8CCpJtIVLUt1kyAqPXuHDFFwfuO-EgqPJVPg2vboI50AiHnbZZO2XT-WuumxM1Z0lEbBA4wrn5FGCaCetJZ1">An event bus example in jquery CodePen</a></li>
<li><a href="https://www.jqhtml.com/16901.html">vue篇之事件总线（EventBus）</a></li>
<li><a href="https://www.jqhtml.com/26568.html">EventBus原理深度解析</a></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="c1">// 获取 jQuery对象的 on 和 trigger 方法
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 初始化数据
</span><span class="c1"></span>  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 容器
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 视图
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">    &lt;div&gt;
</span><span class="sb">      &lt;div class=&#34;output&#34;&gt;
</span><span class="sb">        &lt;span id=&#34;number&#34;&gt;{{number}}&lt;/span&gt;
</span><span class="sb">      &lt;/div&gt;
</span><span class="sb">      &lt;div class=&#34;actions&#34;&gt;
</span><span class="sb">        &lt;button id=&#34;add1&#34;&gt;+1&lt;/button&gt;
</span><span class="sb">        &lt;button id=&#34;minus1&#34;&gt;-1&lt;/button&gt;
</span><span class="sb">        &lt;button id=&#34;mul2&#34;&gt;×2&lt;/button&gt;
</span><span class="sb">        &lt;button id=&#34;divide2&#34;&gt;÷2&lt;/button&gt;
</span><span class="sb">        &lt;button id=&#34;recovery&#34;&gt;恢复&lt;/button&gt;
</span><span class="sb">      &lt;/div&gt;
</span><span class="sb">    &lt;/div&gt;
</span><span class="sb">  `</span><span class="p">,</span>
  <span class="c1">// 接受外部参数（传入容器）视图初始化
</span><span class="c1"></span>  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 用jQuery封装容器 container &lt;- #app1节点
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="c1">// 渲染
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cm">/* 其他相关放到 c */</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 初始化渲染html
</span><span class="c1"></span>    <span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>    <span class="nx">c</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="c1">// 监听触发标记`&#39;m:updated&#39;` 统一渲染
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click #add1&#39;</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #minus1&#39;</span><span class="o">:</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #mul2&#39;</span><span class="o">:</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #divide2&#39;</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
    <span class="s1">&#39;click #recovery&#39;</span><span class="o">:</span> <span class="s1">&#39;recover&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="c1">// 表驱动编程-自动绑定事件
</span><span class="c1"></span>  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="10-第二个模块的使用mvc-a-id-第二个模块的使用mvc-href-第二个模块的使用mvc-a-a-href-catalogue-a">10.第二个模块的使用MVC <a id="第二个模块的使用MVC" href="#第二个模块的使用MVC" > § </a><a href="#catalogue"> ⇧ </a></h2>

<blockquote>
<p><code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// 错误代码
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">localKey</span><span class="o">:</span> <span class="s1">&#39;app2.index&#39;</span><span class="p">,</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
  <span class="c1">// 不能在声明m的时候，在对象的右边使用m，会变成undefined
</span><span class="c1"></span>    <span class="nx">index</span><span class="o">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">localKey</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>不能在声明一个对象的时候，在对象的右边使用这个对象，会变成<code>undefined</code></li>
</ul>

<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./reset.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./global.css&#39;</span>
<span class="c1">// 导入 控制器 c
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">x</span> <span class="nx">from</span> <span class="s2">&#34;./app1.js&#34;</span>
<span class="kr">import</span> <span class="nx">y</span> <span class="nx">from</span> <span class="s2">&#34;./app2.js&#34;</span>

<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.js&#39;</span>
<span class="c1">// 传入初始化需要填入的节点
</span><span class="c1"></span><span class="nx">x</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;#app1&#39;</span><span class="p">)</span>
<span class="c1">// 导出初始化方法init 在main.js 中获取el &lt;- #app2
</span><span class="c1"></span><span class="nx">y</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="s1">&#39;#app2&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>app2.js</code>中导出 c <code>export default c</code></li>
</ul>

<blockquote>
<p>函数封装 字符模板替换</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">html</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="k">return</span> <span class="sb">`
</span><span class="sb">  &lt;div&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34;&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34;&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容1&lt;/li&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容2&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">  &lt;/div&gt;
</span><span class="sb">`</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>在render中使用html()调用</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">render</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">index</span><span class="p">)).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>视图 v 中定义了 提供控制器 c 使用的回调函数</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">html</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sb">`...`</span>
  <span class="p">},</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">render</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">index</span><span class="p">)).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>绑定自定义属性<code>data-index</code> 用DOM做标记</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="c1">// v ...
</span><span class="c1"></span><span class="nx">html</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sb">`
</span><span class="sb">  &lt;div&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;0&#34;&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;1&#34;&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">    &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容1&lt;/li&gt;
</span><span class="sb">      &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容2&lt;/li&gt;
</span><span class="sb">    &lt;/ol&gt;
</span><span class="sb">  &lt;/div&gt;
</span><span class="sb">  `</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>获取标记</p>
</blockquote>

<ul>
<li><code>focus()</code>获取当前点击处的index是第几个</li>
<li>把 data-index 写到 li 上， 在<code>focus()</code>中取<code>dataset.index</code></li>

<li><p>更新数据 <code>m.update({index: dataIndex})</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{},</span>
<span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
<span class="s1">&#39;click .tab-bar li&#39;</span><span class="o">:</span> <span class="s1">&#39;focus&#39;</span>
<span class="p">},</span>
<span class="nx">focus</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// console.log(e.currentTarget.dataset.index)
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
<span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">index</span><span class="o">:</span> <span class="nx">index</span><span class="p">})</span>
<span class="c1">// console.log(&#39;x&#39;)
</span><span class="c1"></span><span class="p">},</span>
<span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>用<code>webStorm</code>的<code>local history</code>回顾代码，思考为什么使用<code>MVC</code></p></li>
</ul>

<blockquote>
<p><code>none MVC</code></p>
</blockquote>

<table>
<thead>
<tr>
<th>JS(#add2)</th>
<th>数据流向</th>
<th>DOM（页面）</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>$(html).appendTo</code></td>
<td><code>---&gt;</code></td>
<td>tab Content</td>
</tr>

<tr>
<td><code>DOM操作10行代码</code></td>
<td></td>
<td>tab0</td>
</tr>

<tr>
<td><code>$li.addClass</code></td>
<td><code>---&gt;</code></td>
<td>tab0</td>
</tr>

<tr>
<td><code>$tabContent.addClass</code></td>
<td><code>---&gt;</code></td>
<td>tab1</td>
</tr>
</tbody>
</table>

<blockquote>
<p><code>MVC</code></p>
</blockquote>

<table>
<thead>
<tr>
<th>JS(#add2)</th>
<th>数据流向</th>
<th>DOM（页面）</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>index = 0</code></td>
<td></td>
<td></td>
</tr>

<tr>
<td><code>render(n)</code></td>
<td><code>---&gt;</code></td>
<td>tab0</td>
</tr>

<tr>
<td><code>index = 1</code></td>
<td></td>
<td>tab0</td>
</tr>

<tr>
<td><code>render(n)</code></td>
<td><code>---&gt;</code></td>
<td>tab1</td>
</tr>
</tbody>
</table>

<ul>
<li><code>MVC</code>复杂度稳定很小，应对复杂需求</li>
<li><code>DOM</code>操作越复杂，代码线性增长</li>
</ul>

<hr />

<h2 id="11-抽象思维6-事不过三-使用类优化代码-继承-a-id-类优化代码继承-href-类优化代码继承-a-a-href-catalogue-a">11.抽象思维6 事不过三 使用类优化代码 继承 <a id="类优化代码继承" href="#类优化代码继承" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>同样的代码写三遍，就该抽成一个函数</li>
<li>同样的属性写三遍，就该做成共用属性（原型或类）</li>
<li>同样的原型写三遍，就该用继承</li>
</ul>

<blockquote>
<p>代价</p>
</blockquote>

<ul>
<li>有时候会造成继承层级太深，无法一下看懂代码</li>
<li>可以通过写文档，画类图解决</li>
</ul>

<blockquote>
<p>使用类优化代码</p>
</blockquote>

<ul>
<li>引入类（代替重复对象）</li>
<li>引入继承（代替重复功能）</li>
<li>路由</li>
</ul>

<blockquote>
<p><code>app2.js</code> 代码结构</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app2.index&#39;</span>
<span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{...}</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{...}</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{...}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app1.js</code> 和 <code>app2.js</code> 重复的代码</p>
</blockquote>

<ul>
<li>m create, delete, update, get</li>
<li>v el, html, init, render</li>

<li><p>c init, events, autoBindEvents</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* app1.js */</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="c1">// 获取 jQuery对象的 on 和 trigger 方法
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/*
</span><span class="cm">const m = {
</span><span class="cm">// 初始化数据
</span><span class="cm">data: {
</span><span class="cm">n: parseInt(localStorage.getItem(&#39;n&#39;)) || 100
</span><span class="cm">},
</span><span class="cm">update(data) {
</span><span class="cm">// 更新数据
</span><span class="cm">Object.assign(m.data, data)
</span><span class="cm">// 标记数据更新
</span><span class="cm">eventBus.trigger(&#39;m:updated&#39;)
</span><span class="cm">localStorage.setItem(&#39;n&#39;, m.data.n.toString())
</span><span class="cm">}
</span><span class="cm">}
</span><span class="cm">*/</span>

<span class="cm">/* app2.js */</span>
<span class="cm">/*
</span><span class="cm">const m = {
</span><span class="cm">data: {
</span><span class="cm">index: parseInt(localStorage.getItem(localKey)) || 0
</span><span class="cm">},
</span><span class="cm">update(data) {
</span><span class="cm">Object.assign(m.data, data)
</span><span class="cm">eventBus.trigger(&#39;m:updated&#39;)
</span><span class="cm">localStorage.setItem(localKey, m.data.index.toString())
</span><span class="cm">}
</span><span class="cm">}
</span><span class="cm">*/</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<blockquote>
<p>相同属性抽成公共属性 原型/类</p>
</blockquote>

<ul>
<li>注意大写 <code>Model.js</code></li>
<li>实例化<code>const m = new Model({...})</code></li>
</ul>

<blockquote>
<p><code>Model.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">class</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="c1">// 属性传参 data
</span><span class="c1"></span>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="c1">// 传参复制到对象实例中
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="c1">// 原型方法
</span><span class="c1"></span>  <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// if(console &amp;&amp; console.error) console.error(&#39;未实现 create&#39;)
</span><span class="c1"></span>    <span class="c1">// console &amp;&amp; console.error &amp;&amp; console.error(&#39;未实现 create&#39;)
</span><span class="c1"></span>    <span class="c1">// 可选链语法 `?.` 语法
</span><span class="c1"></span>    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 create&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">delete</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 delete&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 update&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 get&#39;</span><span class="p">)}</span>
<span class="p">}</span>

<span class="c1">// 使用时 实例化： // const m = new Model() //m.create() //m.delete()
</span><span class="c1"></span>
<span class="c1">// 导出
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>用类改写 <code>app1.js</code> 的 <code>m</code></p>
</blockquote>

<ul>
<li><code>import Model from './base/Model'</code></li>
<li><code>m.update</code>属性覆盖</li>
<li>Chrome 打出的<code>console.dir(m)</code>是构造函数 查看属于哪个类</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">}})</span>
<span class="c1">// 可以直接覆盖
</span><span class="c1"></span><span class="nx">m</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 更新数据
</span><span class="c1"></span>  <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="c1">// 标记数据更新
</span><span class="c1"></span>  <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
<span class="p">}</span>
<span class="c1">// Chrome 打出的是构造函数 查看属于哪个类
</span><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
<span class="nx">m</span><span class="p">.</span><span class="nx">create</span><span class="p">()</span> <span class="c1">// 未实现 create
</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>可以将 <code>m.update</code> 写到 <code>new Model</code> 参数中</p>
</blockquote>

<ul>
<li>先改 <code>Model.js</code></li>
<li>为了让实例化中的传参更明确 在类中的形参 传一个对象<code>option</code></li>
<li>对象<code>option.data</code> 遍历简化代码<code>['data', 'update', 'create', 'delete', 'get']</code></li>
</ul>

<blockquote>
<p><code>Model.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">class</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="c1">// 属性传参 data
</span><span class="c1"></span>  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this.data = options.data
</span><span class="c1"></span>    <span class="c1">// this.update = options.update
</span><span class="c1"></span>    <span class="c1">// this.delete = options.delete
</span><span class="c1"></span>    <span class="c1">// this.get = options.get
</span><span class="c1"></span>    <span class="c1">// 事不过三 简化代码 遍历 // 传参复制到对象实例中
</span><span class="c1"></span>    <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">].</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="c1">// 原型方法
</span><span class="c1"></span>  <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// if(console &amp;&amp; console.error) console.error(&#39;未实现 create&#39;)
</span><span class="c1"></span>    <span class="c1">// console &amp;&amp; console.error &amp;&amp; console.error(&#39;未实现 create&#39;)
</span><span class="c1"></span>    <span class="c1">// 可选链语法 `?.`
</span><span class="c1"></span>    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 create&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">delete</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 delete&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 update&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 get&#39;</span><span class="p">)}</span>
<span class="p">}</span>
<span class="c1">// 使用时 实例化： // const m = new Model() //m.create() //m.delete()
</span><span class="c1">// 导出
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>遍历<code>['data', 'update', 'create', 'delete', 'get'].forEach((key) =&gt; {}</code> 代码的复杂度是稳定的</li>
<li>无论数据规模多大，稳定地简单</li>
<li>可选链语法 <code>?.</code></li>
</ul>

<blockquote>
<p><code>app1.js</code> 的 <code>m</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model&#39;</span>
<span class="c1">// 获取 jQuery对象的 on 和 trigger 方法
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>注意<code>update(data) {}</code>可以写成<code>update: function(data) {}</code></li>
<li>在面向对象的构造函数中不建议写箭头函数，易错</li>
</ul>

<hr />

<blockquote>
<p><code>app2.js</code> 的 <code>m</code></p>
</blockquote>

<ul>
<li><p>可以点击Model自动引入<code>import Model from './base/Model'</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model&#39;</span>
<span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app2.index&#39;</span>
<span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>

<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
<span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
<span class="nx">index</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
<span class="p">},</span>
<span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
<span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
<span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
<span class="p">}</span>
<span class="p">})</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<blockquote>
<p><code>app1.js</code> 用类简化代码 <code>v</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 视图相关放到 v */</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 容器
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 视图
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="c1">// 接受外部参数（传入容器）视图初始化
</span><span class="c1"></span>  <span class="cm">/*
</span><span class="cm">  init(container) {
</span><span class="cm">    // 用jQuery封装容器 container &lt;- #app1节点
</span><span class="cm">    v.el = $(container)
</span><span class="cm">  },
</span><span class="cm">  */</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="c1">// 渲染
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>touch src/base/View.js</code></li>
<li>大写<code>View</code></li>
<li>不同的属性写到构造函数中 <code>el</code> <code>html</code></li>
<li>相同的写到原型/类中 <code>init</code></li>
<li><code>render</code>通过虚拟DOM可以变成一样，之后再改</li>
<li><code>render</code>目前，不放到共用属性里</li>
</ul>

<blockquote>
<p><code>View.js</code> 解构赋值传参</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">class</span> <span class="nx">View</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">({</span><span class="nx">el</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">render</span><span class="p">})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="nx">render</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">View</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app1.js</code></p>
</blockquote>

<ul>
<li>将 v 的初始化放到 c</li>
<li>v 和 c 的联系紧密，共用为一个对象</li>
<li>必须在 c 中拿到 el ；拿到el后，才能初始化v</li>

<li><p>在<code>c</code>的<code>init(container)</code>中，用<code>c.initV()</code>代替<code>v.init(container)</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="cm">/* 视图相关放到 v */</span>
<span class="cm">/* 其他相关放到 c */</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
<span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
<span class="kr">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
  <span class="c1">// 容器
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="nx">container</span><span class="p">,</span>
  <span class="c1">// 视图
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="c1">// 初始化渲染html
</span><span class="c1"></span><span class="nx">v</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
<span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span><span class="nx">c</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
<span class="c1">// 监听触发标记`&#39;m:updated&#39;` 统一渲染
</span><span class="c1"></span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
<span class="p">})</span>
<span class="p">},</span>
<span class="nx">events</span><span class="o">:</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">add</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">minus</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">mul</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">div</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">recover</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">},</span>
<span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<hr />

<h2 id="12-合并vc-a-id-合并vc-href-合并vc-a-a-href-catalogue-a">12.合并vc <a id="合并vc" href="#合并vc" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>v c 都有<code>init</code>，合并<code>init</code>方法</li>
<li>对象合并重写 v 改成 <code>c.v</code></li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model.js&#39;</span>
<span class="kr">import</span> <span class="nx">View</span> <span class="nx">from</span> <span class="s1">&#39;./base/View&#39;</span>
<span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="cm">/* 合并重写c 中的 v 改成 c.v */</span>
<span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">v</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">initV</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">v</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
      <span class="c1">// 容器
</span><span class="c1"></span>      <span class="nx">el</span><span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span> <span class="c1">// // c.container = container from c.init(container)
</span><span class="c1"></span>      <span class="c1">// 视图
</span><span class="c1"></span>      <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
      <span class="c1">// 渲染
</span><span class="c1"></span>      <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
          <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>  <span class="p">},</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">container</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">initV</span><span class="p">()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="c1">// 监听触发标记`&#39;m:updated&#39;` 统一渲染
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{...},</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="c1">// 表驱动编程-自动绑定事件
</span><span class="c1"></span>  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">c</span><span class="p">.</span><span class="nx">v</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">c</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>开始声明对象时就合并</li>
<li>过度到<code>vue</code></li>
<li>重构Refactor 变量名c -&gt; view</li>
<li>确认重构 DO REFACTOR</li>
</ul>

<blockquote>
<p><code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model.js&#39;</span>
<span class="c1">// 获取 jQuery对象的 on 和 trigger 方法
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="cm">/* 合并 vc */</span>
<span class="kr">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 容器
</span><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="c1">// 视图
</span><span class="c1"></span>  <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span> <span class="c1">// 1st view = render(data)
</span><span class="c1"></span>    <span class="nx">view</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="c1">// 监听触发标记`&#39;m:updated&#39;` 统一渲染
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="c1">// 渲染
</span><span class="c1"></span>  <span class="nx">render</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{...},</span>
  <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">view</span><span class="p">[</span><span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">view</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<h3 id="再次使用类-改-app2-js">再次使用类 改 <code>app2.js</code></h3>

<blockquote>
<p>修改前 <code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model&#39;</span>
<span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app2.index&#39;</span>
<span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>

<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">view</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">el</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">html</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="sb">`
</span><span class="sb">      &lt;div&gt;
</span><span class="sb">        &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;0&#34;&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span><span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;1&#34;&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">        &lt;/ol&gt;
</span><span class="sb">        &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容1&lt;/li&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="si">}</span><span class="sb">&#34;&gt;内容2&lt;/li&gt;
</span><span class="sb">        &lt;/ol&gt;
</span><span class="sb">      &lt;/div&gt;
</span><span class="sb">    `</span>
  <span class="p">},</span>
  <span class="nx">render</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">index</span><span class="p">)).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click .tab-bar li&#39;</span><span class="o">:</span> <span class="s1">&#39;focus&#39;</span>
  <span class="p">},</span>
  <span class="nx">focus</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// console.log(e.currentTarget.dataset.index)
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">tabIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">index</span><span class="o">:</span> <span class="nx">tabIndex</span><span class="p">})</span>
    <span class="c1">// console.log(&#39;x&#39;)
</span><span class="c1"></span>  <span class="p">},</span>
  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="nx">view</span><span class="p">[</span><span class="nx">view</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">view</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>合并v c</li>
<li>重构对象名<code>view</code></li>
</ul>

<blockquote>
<p><code>View.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">class</span> <span class="nx">View</span> <span class="p">{</span>
  <span class="c1">// {el, html, render, data, eventBus, events, methods}
</span><span class="c1"></span>  <span class="nx">constructor</span><span class="p">({</span><span class="nx">el</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">eventBus</span><span class="p">,</span> <span class="nx">events</span><span class="p">,</span> <span class="nx">methods</span><span class="p">})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="nx">render</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">eventBus</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="nx">events</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">autoBindEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">View</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><p>重构 遍历</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">class</span> <span class="nx">View</span> <span class="p">{</span>
<span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">// 将 options 的所有属性 复制到 this 上
</span><span class="c1"></span><span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="c1">// {el, html, render, data, eventBus, events, methods}
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
<span class="c1">// console.log(this.data)
</span><span class="c1"></span><span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="k">this</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
<span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
<span class="p">})</span>
<span class="p">}</span>
<span class="nx">autoBindEvents</span><span class="p">(){</span> <span class="p">...}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>

<blockquote>
<p>类继承 <code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model.js&#39;</span>
<span class="kr">import</span> <span class="nx">View</span> <span class="nx">from</span> <span class="s1">&#39;./base/View.js&#39;</span>
<span class="c1">// 获取 jQuery对象的 on 和 trigger 方法
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">({})</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="cm">/* 合并 vc */</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// const view =
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">View</span> <span class="p">({</span> <span class="c1">// {el, html, render, data, eventBus, events, methods}
</span><span class="c1"></span>    <span class="c1">// 容器
</span><span class="c1"></span>    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
    <span class="nx">eventBus</span><span class="o">:</span> <span class="nx">eventBus</span><span class="p">,</span>
    <span class="c1">// 视图
</span><span class="c1"></span>    <span class="nx">html</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
    <span class="c1">// 渲染
</span><span class="c1"></span>    <span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">n</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{...},</span>
    <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 导出初始化方法init 在main.js 中获取el &lt;- #app1
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./reset.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./global.css&#39;</span>
<span class="c1">// 导入 控制器 c
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">x</span> <span class="nx">from</span> <span class="s2">&#34;./app1.js&#34;</span>
<span class="kr">import</span> <span class="nx">y</span> <span class="nx">from</span> <span class="s2">&#34;./app2.js&#34;</span>

<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.js&#39;</span>
<span class="c1">// 传入初始化需要填入的节点
</span><span class="c1"></span><span class="nx">x</span><span class="p">(</span><span class="s1">&#39;#app1&#39;</span><span class="p">)</span>
<span class="nx">y</span><span class="p">(</span><span class="s1">&#39;#app2&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>bug <code>n: parseFloat(localStorage.getItem('n')) || 100</code></li>
<li>搜索并去除 console.log， 右键<code>.cache</code> 选 Mark Directory as &gt;  Excluded</li>
</ul>

<hr />

<h2 id="13-让-m-和-v-继承-eventbus-a-id-继承eventbus-href-继承eventbus-a-a-href-catalogue-a">13.让 M 和 V 继承 eventBus <a id="继承EventBus" href="#继承EventBus" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>没有必要每次在实例化构造函数<code>new View</code>中声明<code>eventBus</code></li>
<li>所有<code>eventBus</code>都是同一个</li>
<li>新建一个<code>EventBus.js</code>类的文件</li>
<li>偷梁换柱地使用jQuery封装的EventBus</li>
</ul>

<blockquote>
<p><code>EventBus.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./Model&#39;</span>
<span class="kr">class</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="c1">// 偷梁换柱地使用jQuery封装的EventBus
</span><span class="c1"></span>  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 监听
</span><span class="c1"></span>  <span class="nx">on</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 触发
</span><span class="c1"></span>  <span class="nx">trigger</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 取消监听
</span><span class="c1"></span>  <span class="nx">off</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">EventBus</span>

<span class="c1">// 用法 const e = new EventBus({})
</span><span class="c1">// e.on()
</span><span class="c1">// e.trigger()
</span><span class="c1">// e.off()
</span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>修改 <code>app1.js</code> 和 <code>app2.js</code></p>
</blockquote>

<ul>
<li>导入<code>import EventBus from './base/EventBus'</code></li>
<li>替换<code>const eventBus = $({})</code>为<code>const eventBus = new EventBus()</code></li>
<li>抽像成类的好处在于，可以随时改变<code>EventBus</code>的实现</li>
<li>比如不依赖<code>jQuery</code>，用虚拟<code>DOM</code></li>
</ul>

<hr />

<h3 id="模块解耦">模块解耦</h3>

<ul>
<li>建立中间层 M V E</li>
<li>具体功能模块依赖中间模块</li>
<li>中间模块再依赖<code>jQuery</code></li>
<li>修改依赖时，只需重构中间模块，具体功能模块无需变动</li>
<li>中间模块成为胶水层 粘合底层和依赖</li>
<li>是用来隔绝底层细节</li>
</ul>

<blockquote>
<p>能否使<code>eventBus.trigger('m:updated')</code>直接用<code>m.trigger('m:updated')</code>实现，来隐藏细节具体实现的method</p>
</blockquote>

<ul>
<li>让 <code>Model</code> 和 <code>View</code> 都继承 <code>EventBus</code></li>
<li>实现Model中的<code>m.trigger('...')</code>，View中的 <code>this.on('...')</code></li>
<li>用类继承类<code>m.trigger</code> <code>v.on</code></li>
<li>主流的库，以及JS原生的DOM都是这么做的</li>
</ul>

<blockquote>
<p>控制台</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
<span class="c1">// 第一层属性 __proto__: HTMLBodyElement
</span><span class="c1">// 第二层属性 __proto__: HTMLElement
</span><span class="c1">// 第三层属性 __proto__: Element
</span><span class="c1">// 第四层属性 __proto__: Node
</span><span class="c1">// 第五层属性 __proto__: EventTarget
</span><span class="c1">// 第六层属性 __proto__: Object
</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>DOM 的 EventTarget 就是 所谓的EventBus</li>
<li>这就是所有DOM元素都可以监听和触发事件的原因</li>
<li>所有DOM元素都继承于EventTarget</li>
</ul>

<hr />

<h3 id="m-v继承-eventbus">M V继承 <code>EventBus</code></h3>

<blockquote>
<p><code>Model.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">EventBus</span> <span class="nx">from</span> <span class="s1">&#39;./EventBus&#39;</span>
<span class="kr">class</span> <span class="nx">Model</span> <span class="kr">extends</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span> <span class="c1">// EventBus # constructor()
</span><span class="c1"></span>    <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">].</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>先引入后继承</li>
<li>类继承，<code>extends</code>，必须在<code>constructor</code>初始化里调用以下父类的初始化<code>this._eventBus = $(window)</code>，即用<code>super()</code>调用</li>
<li>否则报错：Missed super class constructor invocation，且只有共有属性/方法</li>
</ul>

<blockquote>
<p><code>View.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">EventBus</span> <span class="nx">from</span> <span class="s1">&#39;./EventBus.js&#39;</span>
<span class="kr">class</span> <span class="nx">View</span> <span class="kr">extends</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="c1">// {el, html, render, data, eventBus, events, methods}
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">autoBindEvents</span><span class="p">(){...}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>之后就可以删除<code>app1 2</code>中的<code>EventBus</code>引入和声明，直接用<code>EventBus</code>的方法</li>
<li>注意<code>class View extends EventBus</code>后不可加括号，不能直接调用类作为函数调用：<code>Cannot call a class as a function</code></li>
<li><code>['data', 'update', 'create', 'delete', 'get'].forEach()</code>的BUG</li>

<li><p>JS代码不能以括号开头，JS解释器会合并以括号开头的代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nx">a</span>
<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">// 1
</span><span class="c1"></span><span class="nx">a</span>
<span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">forEach</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">fn</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="nx">fn</span><span class="p">()</span> <span class="c1">//  [1, 2, 3]
</span><span class="c1"></span><span class="nx">fn</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">// 1
</span><span class="c1"></span><span class="nx">fn</span>
<span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">forEach</span>

<span class="c1">// `[&#39;data&#39;, &#39;update&#39;, &#39;create&#39;, &#39;delete&#39;, &#39;get&#39;]`返回undefined
</span><span class="c1"></span><span class="kr">super</span><span class="p">()</span>
<span class="sb">`[&#39;data&#39;, &#39;update&#39;, &#39;create&#39;, &#39;delete&#39;, &#39;get&#39;].forEach()`</span><span class="p">.</span><span class="nx">forEach</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div></li>

<li><p>写JS 要么每句话加分号；要么 <strong>不可以括号开头</strong></p></li>

<li><p>不加分号报错？我还是选择不加分号</p></li>
</ul>

<blockquote>
<p><code>Model.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">EventBus</span> <span class="nx">from</span> <span class="s1">&#39;./EventBus&#39;</span>
<span class="kr">class</span> <span class="nx">Model</span> <span class="kr">extends</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="kr">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">]</span>
    <span class="nx">keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<p>目前的代码</p>

<blockquote>
<p><code>src/base/EventBus.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">class</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 监听
</span><span class="c1"></span>  <span class="nx">on</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 触发
</span><span class="c1"></span>  <span class="nx">trigger</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// 取消监听
</span><span class="c1"></span>  <span class="nx">off</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_eventBus</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">EventBus</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>src/base/Model.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">EventBus</span> <span class="nx">from</span> <span class="s1">&#39;./EventBus&#39;</span>
<span class="kr">class</span> <span class="nx">Model</span> <span class="kr">extends</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="kr">const</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">]</span>
    <span class="nx">keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">create</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 create&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">delete</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 delete&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 update&#39;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="o">?</span><span class="p">.</span><span class="nx">error</span><span class="o">?</span><span class="p">.(</span><span class="s1">&#39;未实现 get&#39;</span><span class="p">)}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">Model</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>src/base/View.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">EventBus</span> <span class="nx">from</span> <span class="s1">&#39;./EventBus.js&#39;</span>
<span class="kr">class</span> <span class="nx">View</span> <span class="kr">extends</span> <span class="nx">EventBus</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">()</span>
    <span class="cm">/* options: {el, html, render, data,
</span><span class="cm">    eventBus, events, methods} */</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">autoBindEvents</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">autoBindEvents</span><span class="p">(){</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="kr">const</span> <span class="nx">spaceIndex</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part1</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">spaceIndex</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">part2</span> <span class="o">=</span> <span class="nx">key</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">spaceIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
      <span class="kr">const</span> <span class="nx">valueMethod</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">key</span><span class="p">]]</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">part1</span><span class="p">,</span> <span class="nx">part2</span><span class="p">,</span> <span class="nx">valueMethod</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">View</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>src/app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model.js&#39;</span>
<span class="kr">import</span> <span class="nx">View</span> <span class="nx">from</span> <span class="s1">&#39;./base/View.js&#39;</span>
<span class="cm">/* 数据相关放到 m */</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">n</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 更新数据
</span><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="c1">// 标记数据更新
</span><span class="c1"></span>    <span class="nx">m</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">View</span> <span class="p">({</span>
  <span class="c1">// {el, html, render, data, eventBus, events, methods}
</span><span class="c1"></span>    <span class="c1">// 容器
</span><span class="c1"></span>    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
    <span class="c1">// eventBus: eventBus,
</span><span class="c1"></span>    <span class="c1">// 视图
</span><span class="c1"></span>    <span class="nx">html</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">      &lt;div&gt;
</span><span class="sb">        &lt;div class=&#34;output&#34;&gt;
</span><span class="sb">          &lt;span id=&#34;number&#34;&gt;{{number}}&lt;/span&gt;
</span><span class="sb">        &lt;/div&gt;
</span><span class="sb">        &lt;div class=&#34;actions&#34;&gt;
</span><span class="sb">          &lt;button id=&#34;add1&#34;&gt;+1&lt;/button&gt;
</span><span class="sb">          &lt;button id=&#34;minus1&#34;&gt;-1&lt;/button&gt;
</span><span class="sb">          &lt;button id=&#34;mul2&#34;&gt;×2&lt;/button&gt;
</span><span class="sb">          &lt;button id=&#34;divide2&#34;&gt;÷2&lt;/button&gt;
</span><span class="sb">          &lt;button id=&#34;recovery&#34;&gt;恢复&lt;/button&gt;
</span><span class="sb">        &lt;/div&gt;
</span><span class="sb">      &lt;/div&gt;
</span><span class="sb">  `</span><span class="p">,</span>
    <span class="c1">// 渲染
</span><span class="c1"></span>    <span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">n</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{{number}}&#39;</span><span class="p">,</span> <span class="nx">n</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">prependTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;click #add1&#39;</span><span class="o">:</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #minus1&#39;</span><span class="o">:</span> <span class="s1">&#39;minus&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #mul2&#39;</span><span class="o">:</span> <span class="s1">&#39;mul&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #divide2&#39;</span><span class="o">:</span> <span class="s1">&#39;div&#39;</span><span class="p">,</span>
      <span class="s1">&#39;click #recovery&#39;</span><span class="o">:</span> <span class="s1">&#39;recover&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">div</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">n</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="mi">100</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 导出初始化方法init 在main.js 中获取el &lt;- #app1
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>src/app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">$</span> <span class="nx">from</span> <span class="s1">&#39;jquery&#39;</span>
<span class="kr">import</span> <span class="nx">Model</span> <span class="nx">from</span> <span class="s1">&#39;./base/Model&#39;</span>
<span class="kr">import</span> <span class="nx">View</span> <span class="nx">from</span> <span class="s1">&#39;./base/View&#39;</span>

<span class="kr">const</span> <span class="nx">localKey</span> <span class="o">=</span> <span class="s1">&#39;app2.index&#39;</span>
<span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">({</span>
  <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
  <span class="p">},</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
    <span class="nx">m</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;m:updated&#39;</span><span class="p">)</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localKey</span><span class="p">,</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// let view = new View () 直接 new 不需再赋值 不需变量名 所有this代指对象实例
</span><span class="c1"></span>  <span class="k">new</span> <span class="nx">View</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
    <span class="nx">html</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="sb">`
</span><span class="sb">      &lt;div&gt;
</span><span class="sb">        &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;0&#34;&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;selected&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34; data-index=&#34;1&#34;&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">        &lt;/ol&gt;
</span><span class="sb">        &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34;&gt;内容1&lt;/li&gt;
</span><span class="sb">          &lt;li class=&#34;</span><span class="si">${</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;active&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb">&#34;&gt;内容2&lt;/li&gt;
</span><span class="sb">        &lt;/ol&gt;
</span><span class="sb">      &lt;/div&gt;
</span><span class="sb">    `</span>
    <span class="p">},</span>
    <span class="nx">render</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">tabIndex</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">index</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">tabIndex</span><span class="p">)).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;click .tab-bar li&#39;</span><span class="o">:</span> <span class="s1">&#39;focus&#39;</span>
    <span class="p">},</span>
    <span class="nx">focus</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">tabIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">index</span><span class="o">:</span> <span class="nx">tabIndex</span><span class="p">})</span>
    <span class="p">},</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 导出初始化方法init 在main.js 中获取el &lt;- #app2
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>src/main.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./reset.css&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./global.css&#39;</span>
<span class="c1">// 导入 控制器 c
</span><span class="c1"></span><span class="kr">import</span> <span class="nx">x</span> <span class="nx">from</span> <span class="s2">&#34;./app1.js&#34;</span>
<span class="kr">import</span> <span class="nx">y</span> <span class="nx">from</span> <span class="s2">&#34;./app2.js&#34;</span>

<span class="kr">import</span> <span class="s1">&#39;./app1.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app2.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app3.js&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app4.js&#39;</span>
<span class="c1">// 传初始化需要填入的节点
</span><span class="c1"></span><span class="nx">x</span><span class="p">(</span><span class="s1">&#39;#app1&#39;</span><span class="p">)</span>
<span class="nx">y</span><span class="p">(</span><span class="s1">&#39;#app2&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<hr />

<h2 id="14-mvc-过渡到-vue-a-id-过渡到vue-href-过渡到vue-a-a-href-catalogue-a">14.MVC 过渡到 vue <a id="过渡到vue" href="#过渡到vue" > § </a><a href="#catalogue"> ⇧ </a></h2>

<blockquote>
<p>安装 <code>vue</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">yarn add vue</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>导入</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">vue</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>报错 <code>runtime-only built of vue</code></p>
</blockquote>

<ul>
<li><p>编译版 <code>package.json</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JSON" data-lang="JSON"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JSON" data-lang="JSON"><span class="p">{</span>
<span class="err">//</span> <span class="err">...</span>
<span class="err">,</span>
  <span class="nt">&#34;alias&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;vue&#34;</span><span class="p">:</span> <span class="s2">&#34;./node_modules/vue/dist/vue.common.js&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div></li>

<li><p><code>template</code> 就是 html，默认用当前的替换原来的div</p></li>

<li><p>m 也可以并入 v <code>data: { n: parseFloat(localStorage.getItem('n')) || 100 },</code></p></li>

<li><p>自动更新</p></li>

<li><p>方法 监听函数放入 <code>methods</code></p></li>

<li><p>监听数据变化 放入 <code>watch</code></p></li>
</ul>

<blockquote>
<p>用<code>vue</code>改写<code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">num</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">add</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">},</span>
      <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">},</span>
      <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">},</span>
      <span class="nx">div</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">},</span>
      <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">=</span> <span class="mi">100</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">num</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="p">}</span>
      <span class="c1">// num : function() {} // 不可用箭头函数 this 失效
</span><span class="c1"></span>    <span class="p">},</span>
    <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">      &lt;section id=&#34;app1&#34; class=&#34;app1&#34;&gt;
</span><span class="sb">        &lt;div class=&#34;output&#34;&gt;
</span><span class="sb">          &lt;span id=&#34;number&#34;&gt;{{num}}&lt;/span&gt;
</span><span class="sb">        &lt;/div&gt;
</span><span class="sb">        &lt;div class=&#34;actions&#34;&gt;
</span><span class="sb">          &lt;button @click=&#34;add&#34; id=&#34;add1&#34;&gt;+1&lt;/button&gt;
</span><span class="sb">          &lt;button @click=&#34;minus&#34; id=&#34;minus1&#34;&gt;-1&lt;/button&gt;
</span><span class="sb">          &lt;button @click=&#34;mul&#34; id=&#34;mul2&#34;&gt;×2&lt;/button&gt;
</span><span class="sb">          &lt;button @click=&#34;div&#34; id=&#34;divide2&#34;&gt;÷2&lt;/button&gt;
</span><span class="sb">          &lt;button @click=&#34;recover&#34; id=&#34;recovery&#34;&gt;恢复&lt;/button&gt;
</span><span class="sb">        &lt;/div&gt;
</span><span class="sb">      &lt;/section&gt;
</span><span class="sb">    `</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<ul>
<li><code>template</code>预封装<code>html()</code>，样式的动态绑定JS <code>:class</code></li>
</ul>

<blockquote>
<p>用<code>vue</code>改写<code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">index</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;app2.index&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;app2.index&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">template</span><span class="o">:</span> <span class="sb">`
</span><span class="sb">      &lt;section id=&#34;app2&#34; class=&#34;app2&#34;&gt;
</span><span class="sb">          &lt;ol class=&#34;tab-bar&#34;&gt;
</span><span class="sb">            &lt;li :class=&#34;index === 0 ? &#39;selected&#39;:&#39;&#39;&#34;
</span><span class="sb">                @click=&#34;index = 0&#34;&gt;&lt;span&gt;111111&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">            &lt;li :class=&#34;index === 1 ? &#39;selected&#39;:&#39;&#39;&#34;
</span><span class="sb">                @click=&#34;index = 1&#34;&gt;&lt;span&gt;222222&lt;/span&gt;&lt;/li&gt;
</span><span class="sb">          &lt;/ol&gt;
</span><span class="sb">          &lt;ol class=&#34;tab-content&#34;&gt;
</span><span class="sb">            &lt;li :class=&#34;index === 0? &#39;active&#39;: &#39;&#39;&#34;&gt;内容1&lt;/li&gt;
</span><span class="sb">            &lt;li :class=&#34;index === 1? &#39;active&#39;: &#39;&#39;&#34;&gt;内容2&lt;/li&gt;
</span><span class="sb">          &lt;/ol&gt;
</span><span class="sb">      &lt;/section&gt;
</span><span class="sb">    `</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 导出初始化方法init(el) 在main.js 中获取el &lt;- #app2: y(&#39;#app2&#39;)
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>抽离数据 <code>app1.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">import</span> <span class="s1">&#39;./app1.css&#39;</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">100</span>
    <span class="p">},</span>
    <span class="nx">set</span><span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">num</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">get</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">add</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">},</span>
      <span class="nx">minus</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">},</span>
      <span class="nx">mul</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">},</span>
      <span class="nx">div</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">},</span>
      <span class="nx">recover</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span> <span class="o">=</span> <span class="mi">100</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">num</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">num</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">template</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>app2.js</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">import</span> <span class="s1">&#39;./app2.css&#39;</span>
<span class="kr">import</span> <span class="nx">Vue</span> <span class="nx">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kr">const</span> <span class="nx">init</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;app2.index&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="mi">0</span>
    <span class="p">},</span>
    <span class="nx">set</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;app2.index&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">index</span><span class="o">:</span> <span class="nx">m</span><span class="p">.</span><span class="nx">get</span><span class="p">()</span>
    <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">template</span><span class="o">:</span> <span class="sb">`...`</span><span class="p">,</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// 导出初始化方法init(el) 在main.js 中获取el &lt;- #app2: y(&#39;#app2&#39;)
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">init</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>vue</code> 也实现了 <code>EventBus</code> 的继承</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-JavaScript" data-lang="JavaScript"><span class="kr">const</span> <span class="nx">eventBus</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">()</span>
<span class="nx">eventBus</span><span class="p">.</span><span class="nx">$on</span><span class="p">()</span>
<span class="nx">eventBus</span><span class="p">.</span><span class="nx">$emit</span><span class="p">()</span> <span class="c1">// trigger
</span><span class="c1"></span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">$off</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">eventBus</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">$on</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">$emit</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">eventBus</span><span class="p">.</span><span class="nx">$off</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p><code>vue</code> 没有体现抽象思维3 用数据去渲染 <code>view = render(data)</code></p>
</blockquote>

<ul>
<li>监听数据变化，自动局部渲染</li>
<li>元素没有被移除页面<code>&lt;button id=&quot;xxx&quot;&gt;&lt;/button&gt;</code>数据改变刷新页面，<code>id=&quot;xxx&quot;</code>还在</li>
<li>react显式地调用<code>view = render(data)</code></li>
</ul>

<hr />

<h2 id="15-总结-a-id-总结-href-总结-a-a-href-catalogue-a">15.总结 <a id="总结" href="#总结" > § </a><a href="#catalogue"> ⇧ </a></h2>

<ul>
<li>再也不用DOM操作了，不用jQuery，直接在封装的元素上写逻辑，不需要id属性，id属性只给CSS用</li>
<li>6个抽象思维

<ul>
<li>抽象思维1 最小知识原则 <code>js模块</code> 模块解耦</li>
<li>抽象思维2 以不变应万变 <code>m + v + c</code></li>
<li>抽象思维3 用数据去渲染 <code>view = render(data)</code></li>
<li>抽象思维4 表驱动编程-自动绑定事件  将不同的部分作为字符串存入<code>hashMap</code> 取用</li>
<li>抽象思维5 俯瞰全局 <code>EventBus</code></li>
<li>抽象思维6 事不过三 <code>class</code>继承</li>
</ul></li>
<li>刻意用到项目中</li>
<li>写文章总结</li>
</ul>

<hr />

<!-- Article End -->

<hr />

<!-- test -->

<div style="text-align:center;">·未完待续·</div>

<!-- ok -->

<hr />

<h3 id="参考文章">参考文章</h3>

<ul>
<li><a href="https://static.xiedaimala.com/xdml/file/3ac7c224-c23d-491f-84b5-4fabfbeab9b8/2019-11-19-12-0-22.pdf">MVC.pdf</a></li>
<li><a href="https://github.com/FrankFang/mvc-demo-1/tree/master/src">代码（上）</a></li>
<li><a href="https://github.com/FrankFang/mvc-demo-2/blob/master/src/app1.js">代码（中）</a></li>
<li><a href="https://github.com/FrankFang/mvc-demo-3/tree/master/src">代码（下）</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">JavaScript modules 模块 MDN</a></li>
<li><a href="https://efe.baidu.com/blog/mvc-deformation/">前端MVC变形记</a></li>
</ul>

<h3 id="相关文章">相关文章</h3>

<ul>
<li>无</li>
</ul>

<hr />

<ul>
<li>作者： Joel</li>
<li>文章链接：</li>
<li><a href="http://xmasuhai.xyz/posts/版权声明链接/">版权声明</a></li>
<li>非自由转载-非商用-非衍生-保持署名</li>
<li><a style='color:#DB2D5D;' href='https://xiedaimala.com/bbs/users/8c266e6f-55a2-4348-a180-17cb8cdb2c46#/?page=1' target='_blank' rel='noreferrer noopener'>河</a>
<a style='color:#006CFF;' href='https://juejin.im/user/59abfad26fb9a0248f4aa221' target='_blank' rel='noreferrer noopener'>掘</a>
<a style='color:#009A61;' href='https://segmentfault.com/u/joel_59b17eb9d2155' target='_blank' rel='noreferrer noopener'>思</a>
<a style='color:#0084FF;' href='https://www.zhihu.com/people/xue-shou-41/posts' target='_blank' rel='noreferrer noopener'>知</a>
<a style='color:#EA6F5A;' href='https://www.jianshu.com/u/079916729823' target='_blank' rel='noreferrer noopener'>简</a></li>
</ul>

<hr />

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Joel Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2022-09-03
      
        
        
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://xmasuhai.xyz/tags/mvc/">MVC</a>
          <a href="http://xmasuhai.xyz/tags/vue/">vue</a>
          <a href="http://xmasuhai.xyz/tags/table-driven/">Table-Driven</a>
          <a href="http://xmasuhai.xyz/tags/eventbus/">EventBus</a>
          <a href="http://xmasuhai.xyz/tags/javascript/">JavaScript</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/bundler/webpack/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Webpack</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/project/%E9%A1%B9%E7%9B%AE-%E5%8A%A8%E6%80%81css-%E7%BB%98%E5%88%B6%E5%8A%A8%E7%94%BB%E8%A7%92%E8%89%B2/">
            <span class="next-text nav-default">【项目】动态CSS——绘制动画角色</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  
  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:xmasuhai@163.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/xmasuhai" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/xue-shou-41/posts" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://xmasuhai.xyz/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2026
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Joel Xu
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
